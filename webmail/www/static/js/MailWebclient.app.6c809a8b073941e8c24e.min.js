webpackJsonp([14],{246:function(e,t,s){"use strict";function i(e,t){this.bShown=!1,this.currentPage=r.observable(1),this.count=r.observable(e),this.perPage=r.observable(t),this.firstPage=r.observable(1),this.lastPage=r.observable(1),this.pagesCount=r.computed(function(){var e=this.perPage()>0?Math.ceil(this.count()/this.perPage()):0;return e>0?e:1},this),r.computed(function(){var e=20,t=4,s=this.pagesCount(),i=this.currentPage(),o=i,n=i;if(s>1)for(;;){if(e--,1<o&&(o--,t--),0===t)break;if(s>n&&(n++,t--),0===t)break;if(0===e)break}this.firstPage(o),this.lastPage(n)},this),this.visibleFirst=r.computed(function(){return this.firstPage()>1},this),this.visibleLast=r.computed(function(){return this.lastPage()<this.pagesCount()},this),this.clickPage=o.bind(this.clickPage,this),this.pages=r.computed(function(){var e=this.firstPage(),t=[];if(this.firstPage()<this.lastPage())for(;e<=this.lastPage();e++)t.push({number:e,current:e===this.currentPage(),clickFunc:this.clickPage});return t},this),l.isMobile()||this.hotKeysBind()}var o=s(2),n=s(1),r=s(44),a=s(217),l=s(182);i.prototype.ViewTemplate="CoreWebclient_PageSwitcherView",i.prototype.hotKeysBind=function(){n(document).on("keydown",n.proxy(function(e){if(this.bShown&&!a.isTextFieldFocused()){var t=e.keyCode;e.ctrlKey&&t===Enums.Key.Left?this.clickPreviousPage():e.ctrlKey&&t===Enums.Key.Right&&this.clickNextPage()}},this))},i.prototype.hide=function(){this.bShown=!1},i.prototype.show=function(){this.bShown=!0},i.prototype.clear=function(){this.currentPage(1),this.count(0)},i.prototype.setCount=function(e){this.count(e),this.currentPage()>this.pagesCount()&&this.currentPage(this.pagesCount())},i.prototype.setPage=function(e,t){this.perPage(t),e>this.pagesCount()?this.currentPage(this.pagesCount()):this.currentPage(e)},i.prototype.clickPage=function(e){var t=e.number;t<1&&(t=1),t>this.pagesCount()&&(t=this.pagesCount()),this.currentPage(t)},i.prototype.clickFirstPage=function(){this.currentPage(1)},i.prototype.clickPreviousPage=function(){var e=this.currentPage()-1;e<1&&(e=1),this.currentPage(e)},i.prototype.clickNextPage=function(){var e=this.currentPage()+1;e>this.pagesCount()&&(e=this.pagesCount()),this.currentPage(e)},i.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())},e.exports=i},256:function(e,t,s){"use strict";var i=s(2),o=s(188),n={};n.checkIfFieldsEmpty=function(e,t){var s=i.find(e,function(e){return""===e()});return!s||(t&&o.showError(t),s.focused(!0),!1)},n.checkPassword=function(e,t){var i=s(185),n=s(43),r=!1;return t!==e?o.showError(i.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")):n.PasswordMinLength>0&&e.length<n.PasswordMinLength?o.showError(i.i18n("COREWEBCLIENT/ERROR_PASSWORD_TOO_SHORT").replace("%N%",n.PasswordMinLength)):!n.PasswordMustBeComplex||e.match(/([0-9])/)&&e.match(/([!,%,&,@,#,$,^,*,?,_,~])/)?r=!0:o.showError(i.i18n("COREWEBCLIENT/ERROR_PASSWORD_TOO_SIMPLE")),r},e.exports=n},264:function(e,t,s){"use strict";var i=s(185),o={};o.getMonthNamesArray=function(){for(var e=i.i18n("COREWEBCLIENT/LIST_MONTH_NAMES").split(" "),t=12,s=e.length;s<t;s++)e[s]="";return e},o.daysInMonth=function(e,t){return 0<e&&13>e&&0<t?new Date(t,e,0).getDate():31},e.exports=o},265:function(e,t,s){"use strict";function i(){this.iTimeStampInUTC=0,this.oMoment=null}var o=s(49),n=s(185),r=s(217),a=s(43);i.prototype.parse=function(e){this.iTimeStampInUTC=e,this.oMoment=o.unix(this.iTimeStampInUTC)},i.prototype.setDate=function(e,t,s){this.oMoment=o([e,t,s])},i.prototype.getTimeFormat=function(){return a.timeFormat()===window.Enums.TimeFormat.F24?"HH:mm":"hh:mm A"},i.prototype.getFullDate=function(){return this.getDate()+" "+this.getTime()},i.prototype.getMidDate=function(){return this.getShortDate(!0)},i.prototype.getShortDate=function(e){var t="",s=null;return this.oMoment&&(s=o(),s.format("L")===this.oMoment.format("L")?t=this.oMoment.format(this.getTimeFormat()):(t=s.clone().subtract(1,"days").format("L")===this.oMoment.format("L")?n.i18n("COREWEBCLIENT/LABEL_YESTERDAY"):a.UserSelectsDateFormat?this.oMoment.format(r.getDateFormatForMoment(a.dateFormat())):s.year()===this.oMoment.year()?this.oMoment.format("MMM D"):this.oMoment.format("MMM D, YYYY"),e&&(t+=", "+this.oMoment.format(this.getTimeFormat())))),t},i.prototype.getDate=function(){var e="ddd, MMM D, YYYY";return a.UserSelectsDateFormat&&(e="ddd, "+r.getDateFormatForMoment(a.dateFormat())),this.oMoment?this.oMoment.format(e):""},i.prototype.getTime=function(){return this.oMoment?this.oMoment.format(this.getTimeFormat()):""},i.prototype.getTimeStampInUTC=function(){return this.iTimeStampInUTC},e.exports=i},268:function(e,t,s){function i(e){this.sName="",this.visible=o.observable(!0),this.baseHash=o.observable(""),this.hash=o.observable(""),this.linkText=o.observable(e),this.isCurrent=o.observable(!1),this.recivedAnim=o.observable(!1).extend({autoResetToFalse:500}),this.unseenCount=o.observable(0),this.allowChangeTitle=o.observable(!1),this.inactiveTitle=o.observable(""),this.excludedHashes=o.observableArray([])}var o=s(44),n=s(195);i.prototype.ViewTemplate="CoreWebclient_HeaderItemView",i.prototype.setName=function(e){this.sName=e.toLowerCase(),""===this.baseHash()?(this.hash(n.buildHashFromArray([e.toLowerCase()])),this.baseHash(this.hash())):this.hash(this.baseHash())},e.exports=i},278:function(e,t,s){"use strict";function i(e){return void 0===e}function o(e,t){var s=!1;return e&&t&&(s=e===t||(e.contains?e.contains(t):!!t.compareDocumentPosition&&!!(8&t.compareDocumentPosition(e)))),s}function n(e){0<e&&clearTimeout(e),e=0}function r(e){return e=e&&(e.originalEvent?e.originalEvent:e)||window.event,e.dataTransfer?e:null}function a(e,t,s){return e&&t&&!i(e[t])?e[t]:s}function l(e,t,s){e[t]=s}function h(e,t){return function(){return e.apply(i(t)?null:t,Array.prototype.slice.call(arguments))}}function c(e){var t="",s="0123456789abcdefghijklmnopqrstuvwxyz";for(e=i(e)?32:T.pInt(e);t.length<e;)t+=s.substr(Math.round(Math.random()*s.length),1);return t}function u(){return"jua-uid-"+c(16)+"-"+(new Date).getTime()}function d(e,t){var s=i(e.fileName)?i(e.name)?null:e.name:e.fileName,o=i(e.fileSize)?i(e.size)?null:e.size:e.fileSize,n=i(e.type)?null:e.type;return{FileName:s,Size:o,Type:n,Folder:i(t)?"":t,File:e}}function p(e,t,s,o,n,r){var a=0,l=0,h=0,c=null,u=null,p=!1,m=!1,g=function(e,t,s,l){if(e&&!i(e.name))if(t=t||"",e.isFile)e.file(function(e){!p||0<=--n?s(d(e,t)):p&&!m&&0>n&&r&&(m=!0,r(a))});else if(o&&e.isDirectory&&e.createReader){var h=e.createReader(),c=0,u=0;h&&h.readEntries&&h.readEntries(function(i){if(i&&T.isNonEmptyArray(i))for(c=0,u=i.length;c<u;c++)g(i[c],t+e.name+"/",s,l)})}};if(o=!!i(o)||!!o,s=!i(s)&&!!s,n=i(n)?D:T.pInt(n),a=n,p=0<n,e=e&&0<e.length?e:null)for(h=0,l=e.length;h<l;h++)c=e[h],c&&(s?"file"===c.kind&&c.webkitGetAsEntry&&(u=c.webkitGetAsEntry(),u&&g(u,"",t,r)):!p||0<=--n?t(d(c)):p&&!m&&0>n&&r&&(m=!0,r(a)))}function m(e,t,s,i){var o=e&&e.files&&0<e.files.length?e.files:null;o?p(o,t,!1,!1,s,i):t({FileName:e.value.split("\\").pop().split("/").pop(),Size:null,Type:null,Folder:"",File:null})}function g(e){var t=!1;if(e&&e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.length)for(var s=0,i=e.dataTransfer.types.length;s<i;s++)if("files"===e.dataTransfer.types[s].toLowerCase()){t=!0;break}return t}function f(e,t,s,i,o){var n=null,l=null;e=r(e),e&&(n=(e.dataTransfer?a(e.dataTransfer,"items",null):null)||a(e,"items",null),n&&0<n.length&&n[0]&&n[0].webkitGetAsEntry?p(n,t,!0,o,s,i):g(e)&&(l=a(e,"files",null)||(e.dataTransfer?a(e.dataTransfer,"files",null):null),l&&0<l.length&&p(l,t,!1,!1,s,i)))}function b(){return C('<label style="position: absolute; background-color:#fff; right: 0px; top: 0px; left: 0px; bottom: 0px; margin: 0px; padding: 0px; cursor: pointer;"></label>').css({opacity:0})}function v(e,t){return""!==t&&(t=' accept="'+t+'"'),C('<input type="file" tabindex="-1" hidefocus="hidefocus" style="position: absolute; '+e+': -9999px;"'+t+" />")}function y(e,t,s,o){e=i(e)?"":""+e,s=i(s)?"left":""+s,o=i(o)?"":""+o;var n=v(s,o);return 0<e.length&&n.attr("name",e),!i(t)&&!t||n.prop("multiple",!0),n}function A(e,t){return T.pString(I.isFunction(e)?e.apply(null,I.isArray(t)?t:[]):e)}function E(e,t){this.oXhrs={},this.oUids={},this.oJua=e,this.oOptions=t}function S(e,t){this.oUids={},this.oForms={},this.oJua=e,this.oOptions=t}function F(e){e=i(e)?{}:e;var t=this;t.bEnableDnD=!0,t.bEnableButton=!0,t.oEvents={onDialog:null,onSelect:null,onStart:null,onComplete:null,onCompleteAll:null,onProgress:null,onDragEnter:null,onDragLeave:null,onDrop:null,onBodyDragEnter:null,onBodyDragLeave:null,onLimitReached:null},t.oOptions=I.extend({action:"",name:"",hidden:{},queueSize:10,clickElement:!1,dragAndDropElement:!1,dragAndDropBodyElement:!1,disableAjaxUpload:!1,disableFolderDragAndDrop:!0,disableDragAndDrop:!1,disableMultiple:!1,disableDocumentDropPrevent:!1,disableAutoUploadOnDrop:!1,multipleSizeLimit:50,hiddenElementsPosition:"left"},e),t.oQueue=M(T.pInt(a(t.oOptions,"queueSize",10))),t.runEvent("onCompleteAll")&&t.oQueue.await(function(){t.runEvent("onCompleteAll")}),t.oDriver=t.isAjaxUploaderSupported()&&!a(t.oOptions,"disableAjaxUpload",!1)?new E(t,t.oOptions):new S(t,t.oOptions),t.oClickElement=a(t.oOptions,"clickElement",null),t.oClickElement&&(C(t.oClickElement).css({position:"relative",overflow:"hidden"}),"inline"===C(this.oClickElement).css("display")&&C(this.oClickElement).css("display","inline-block"),this.oDriver.generateNewInput(this.oClickElement)),this.oDriver.isDragAndDropSupported()&&a(this.oOptions,"dragAndDropElement",!1)&&!a(this.oOptions,"disableAjaxUpload",!1)?!function(e){var t=C(document),s=C(a(e.oOptions,"dragAndDropBodyElement",!1)||t),i=a(e.oOptions,"dragAndDropElement",!1),l=function(t){if(e.bEnableDnD&&t&&(t=r(t),t&&t.dataTransfer&&g(t)))try{var i=t.dataTransfer.effectAllowed;n(e.iDocTimer),t.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy",t.stopPropagation(),t.preventDefault(),s.trigger("dragover",t)}catch(e){}},h=function(t){e.bEnableDnD&&t&&(t=r(t),t&&g(t)&&(t.preventDefault(),f(t,function(s){s&&(a(e.oOptions,"disableAutoUploadOnDrop",!1)?e.runEvent("onDrop",[s,t,function(){e.addNewFile(s),n(e.iDocTimer)}]):(e.runEvent("onDrop",[s,t]),e.addNewFile(s),n(e.iDocTimer)))},a(e.oOptions,"multipleSizeLimit",D),e.getEvent("onLimitReached"),!a(e.oOptions,"disableFolderDragAndDrop",!0)))),e.runEvent("onDragLeave",[t])},c=function(t){e.bEnableDnD&&t&&(t=r(t),t&&g(t)&&(n(e.iDocTimer),t.preventDefault(),e.runEvent("onDragEnter",[i,t])))},u=function(t){if(e.bEnableDnD&&t){if(t=r(t)){var s=document.elementFromPoint?document.elementFromPoint(t.clientX,t.clientY):null;if(s&&o(this,s))return;n(e.iDocTimer),e.runEvent("onDragLeave",[i,t])}}else;};i&&(a(e.oOptions,"disableDocumentDropPrevent",!1)||t.on("dragover",function(t){if(e.bEnableDnD&&t&&(t=r(t),t&&t.dataTransfer&&g(t)))try{t.dataTransfer.dropEffect="none",t.preventDefault()}catch(e){}}),s&&s[0]&&s.on("dragover",function(t){e.bEnableDnD&&t&&n(e.iDocTimer)}).on("dragenter",function(t){e.bEnableDnD&&t&&(t=r(t),t&&g(t)&&(n(e.iDocTimer),t.preventDefault(),e.runEvent("onBodyDragEnter",[t])))}).on("dragleave",function(t){e.bEnableDnD&&t&&(t=r(t),t&&(n(e.iDocTimer),e.iDocTimer=setTimeout(function(){e.runEvent("onBodyDragLeave",[t])},200)))}).on("drop",function(t){if(e.bEnableDnD&&t&&(t=r(t))){var s=g(t);return s&&t.preventDefault(),e.runEvent("onBodyDragLeave",[t]),!s}return!1}),C(i).bind("dragenter",c).bind("dragover",l).bind("dragleave",u).bind("drop",h))}(t):t.bEnableDnD=!1,l(t,"on",t.on),l(t,"cancel",t.cancel),l(t,"isDragAndDropSupported",t.isDragAndDropSupported),l(t,"isAjaxUploaderSupported",t.isAjaxUploaderSupported),l(t,"setDragAndDropEnabledStatus",t.setDragAndDropEnabledStatus)}var C=s(1),I=s(2),w=s(44),M=s(279),T=s(181),L=s(182),D=20;E.prototype.oXhrs={},E.prototype.oUids={},E.prototype.oJua=null,E.prototype.oOptions={},E.prototype.isDragAndDropSupported=function(){return!0},E.prototype.regTaskUid=function(e){this.oUids[e]=!0},E.prototype.uploadTask=function(e,t,s,o,n,r,l){if(!1===this.oUids[e]||!t||!t.File)return o(null,e),!1;try{var h=this,c=new XMLHttpRequest,u=new FormData,d=a(this.oOptions,"action",""),p=I.clone(a(this.oOptions,"hidden",{})),m=this.oJua.getEvent("onStart"),g=this.oJua.getEvent("onComplete"),f=this.oJua.getEvent("onProgress");return c.open("POST",d,!0),c.setRequestHeader("Authorization","Bearer "+C.cookie("AuthToken")),f&&c.upload&&(c.upload.onprogress=function(s){s&&s.lengthComputable&&!i(s.loaded)&&!i(s.total)&&(void 0===l?f(e,s.loaded,s.total):f(e,l+s.loaded>t.Size?t.Size:l+s.loaded,t.Size))}),c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){if(g&&!n){var t=!1,s=null;try{s=C.parseJSON(c.responseText),t=!0}catch(e){s=null}g(e,t,s)}i(h.oXhrs[e])||(h.oXhrs[e]=null),r?o(c.responseText,e):o(null,e)}else 4===c.readyState&&(g(e,!1,null),o(null,e))},m&&m(e),u.append("jua-post-type","ajax"),u.append(a(this.oOptions,"name","juaFile"),t.File,t.FileName),s=I.extend(s,t.Hidden||{}),p.Parameters=JSON.stringify(s),C.each(p,function(e,s){u.append(e,A(s,[t]))}),c.send(u),this.oXhrs[e]=c,!0}catch(e){window.console&&window.console.error(e)}return o(null,e),!1},E.prototype.generateNewInput=function(e){var t=this,s=null,i=null;e&&(i=y("",!a(this.oOptions,"disableMultiple",!1),a(this.oOptions,"hiddenElementsPosition","left"),a(this.oOptions,"accept","")),s=b(),s.append(i),C(e).append(s),i.on("click",function(e){if(!t.oJua.bEnableButton)return void e.preventDefault();var s=t.oJua.getEvent("onDialog");s&&s()}).on("change",function(){m(this,function(i){t.oJua.addNewFile(i),t.generateNewInput(e),setTimeout(function(){s.remove()},10)},a(t.oOptions,"multipleSizeLimit",D),t.oJua.getEvent("onLimitReached"))}))},E.prototype.cancel=function(e){if(this.oUids[e]=!1,this.oXhrs[e]){try{this.oXhrs[e].abort&&this.oXhrs[e].abort()}catch(e){}this.oXhrs[e]=null}},S.prototype.oUids={},S.prototype.oForms={},S.prototype.oJua=null,S.prototype.oOptions={},S.prototype.isDragAndDropSupported=function(){return!1},S.prototype.regTaskUid=function(e){this.oUids[e]=!0},S.prototype.uploadTask=function(e,t,s,i,o,n,r){if(!1===this.oUids[e])return i(null,e),!1;var l=this.oForms[e],h=I.clone(a(this.oOptions,"hidden",{})),c=this.oJua.getEvent("onStart"),u=this.oJua.getEvent("onComplete");return l?(l.append(C('<input type="hidden" />').attr("name","jua-post-type").val("iframe")),s=I.extend(s,t.Hidden||{}),h.Parameters=JSON.stringify(s),C.each(h,function(e,s){l.append(C('<input type="hidden" />').attr("name",e).val(A(s,[t])))}),l.trigger("submit"),c&&c(e),l.find("iframe").on("load",function(t){var s=!1,o=null,n={};if(u){try{o=this.contentDocument?this.contentDocument:this.contentWindow.document,n=C.parseJSON(o.body.innerHTML),s=!0}catch(e){n={}}u(e,s,n)}i(null,e),window.setTimeout(function(){l.remove()},100)})):i(null,e),!0},S.prototype.generateNewInput=function(e){var t=this,s="",i=null,o=null,n=a(this.oOptions,"action",""),r=null,l=a(this.oOptions,"hiddenElementsPosition","left");e&&(s=u(),i=y(a(this.oOptions,"name","juaFile"),!a(this.oOptions,"disableMultiple",!1),a(this.oOptions,"hiddenElementsPosition","left"),a(this.oOptions,"accept","")),r=C('<form action="'+n+'" target="iframe-'+s+'"  method="POST" enctype="multipart/form-data" style="display: block; cursor: pointer;"></form>'),o=C('<iframe name="iframe-'+s+'" tabindex="-1" src="javascript:void(0);"  style="position: absolute; top: -1000px; '+l+': -1000px; cursor: pointer;" />').css({opacity:0}),r.append(b().append(i)).append(o),C(e).append(r),this.oForms[s]=r,i.on("click",function(e){if(!t.oJua.bEnableButton)return void e.preventDefault();var s=t.oJua.getEvent("onDialog");s&&s()}).on("change",function(){m(this,function(i){if(i){var o=a(t.oOptions,"hiddenElementsPosition","left");r.css({position:"absolute",top:-1e3}),r.css(o,-1e3),t.oJua.addFile(s,i),t.generateNewInput(e)}},a(t.oOptions,"multipleSizeLimit",D),t.oJua.getEvent("onLimitReached"))}))},S.prototype.cancel=function(e){this.oUids[e]=!1,this.oForms[e]&&(this.oForms[e].remove(),this.oForms[e]=!1)},F.prototype.bEnableDnD=!0,F.prototype.iDocTimer=0,F.prototype.oOptions={},F.prototype.oEvents={},F.prototype.oQueue=null,F.prototype.oDriver=null,F.prototype.on=function(e,t){return this.oEvents[e]=t,this},F.prototype.runEvent=function(e,t){this.oEvents[e]&&this.oEvents[e].apply(null,t||[])},F.prototype.getEvent=function(e){return this.oEvents[e]||null},F.prototype.cancel=function(e){this.oDriver.cancel(e)},F.prototype.isAjaxUploaderSupported=function(){return function(){var e=document.createElement("input");return e.type="file",!!("XMLHttpRequest"in window&&"multiple"in e&&"FormData"in window&&(new XMLHttpRequest).upload)}()},F.prototype.setDragAndDropEnabledStatus=function(e){this.bEnableDnD=!!e},F.prototype.isDragAndDropSupported=function(){return this.oDriver.isDragAndDropSupported()},F.prototype.addNewFile=function(e){this.addFile(u(),e)},F.prototype.addFile=function(e,t){var s=this.getEvent("onSelect"),i=null,o=!1,n=a(this.oOptions,"hidden",{}),r=this.getEvent("onComplete"),l=I.bind(function(e,t){var s=a(this.oOptions,"hidden",{}),i=JSON.parse(A(s.Parameters,[t]));this.oDriver.regTaskUid(e),this.oQueue.defer(h(this.oDriver.uploadTask,this.oDriver),e,t,i)},this),c=this.getEvent("onCancel");if(!t||s&&!1===s(e,t))this.oDriver.cancel(e);else{i=I.bind(function(e,t,s,o,n,l){var h=null;h=function(t,o){var n=null;try{n=C.parseJSON(t)}catch(e){}n&&n.Result&&!n.Result.Error&&!n.ErrorCode?s(e,i):n&&n.Result&&n.Result.Error?(L.broadcastEvent("Jua::FileUploadingError"),r(o,!1,{ErrorCode:n.Result.Error})):n&&n.ErrorCode?(L.broadcastEvent("Jua::FileUploadingError"),r(o,!1,{ErrorCode:n.ErrorCode})):(L.broadcastEvent("Jua::FileUploadingError"),r(o,!1))};var c=a(this.oOptions,"hidden",{}),u=JSON.parse(A(c.Parameters,[t]));this.oDriver.regTaskUid(e),this.oDriver.uploadTask(e,t,u,h,o<n,!0,l)},this);var u=w.observable(!0),d=JSON.parse(A(n.Parameters,[t]));L.broadcastEvent("Jua::FileUpload::isUploadAvailable",{isUploadAvailable:u,sModuleName:n.Module,sUid:e,oFileInfo:t}),u()?(o=L.broadcastEvent("Jua::FileUpload::before",{sUid:e,oFileInfo:t,fOnChunkReadyCallback:i,sModuleName:n.Module,fRegularUploadFileCallback:l,fCancelFunction:c,sStorageType:d.Type}),o===!1&&l(e,t)):I.isFunction(c)&&c(e)}},F.prototype.setOption=function(e,t){this.oOptions[e]=t},e.exports=F},279:function(e,t,s){var i;!function(){function o(e){function t(){for(;a=c<h.length&&e>u;){var t=c++,i=h[t],o=r.call(i,1);o.push(s(t)),++u,i[0].apply(null,o)}}function s(e){return function(s,o){--u,null==p&&(null!=s?(p=s,c=d=NaN,i()):(h[e]=o,--d?a||t():i()))}}function i(){null!=p?m(p):l?m(p,h):m.apply(null,[p].concat(h))}var o,a,l,h=[],c=0,u=0,d=0,p=null,m=n;return e||(e=1/0),o={defer:function(){return p||(h.push(arguments),++d,t()),o},await:function(e){return m=e,l=!1,d||i(),o},awaitAll:function(e){return m=e,l=!0,d||i(),o}}}function n(){}var r=[].slice;o.version="1.0.7",i=function(){return o}.call(t,s,t,e),!(void 0!==i&&(e.exports=i))}()},280:function(e,t,s){"use strict";function i(e,t,s,i,l,c,u,d,p,m,g){this.fSelectCallback=t||function(){},this.fDeleteCallback=s||function(){},this.fDblClickCallback=!h.isMobile()&&i?i:function(){},this.fEnterCallback=l||function(){},this.bResetCheckedOnClick=!!u,this.bCheckOnSelect=!!d,this.bUnselectOnCtrl=!!p,this.bDisableMultiplySelection=!!m,this.bChangeOnSelect=void 0===g||!!g,this.useKeyboardKeys=r.observable(!1),this.list=r.observableArray([]),e&&e.subscribe&&e.subscribe(function(e){this.list(e)},this),this.multiplyLineFactor=c,this.oLast=null,this.oListScope=null,this.oScrollScope=null,this.iTimer=0,this.iFactor=1,this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Up,this.KeyRight=Enums.Key.Down,this.multiplyLineFactor&&(this.multiplyLineFactor.subscribe?this.multiplyLineFactor.subscribe(function(e){this.iFactor=0<e?e:1},this):this.iFactor=a.pInt(this.multiplyLineFactor),this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Left,this.KeyRight=Enums.Key.Right,n("html").hasClass("rtl")&&(this.KeyLeft=Enums.Key.Right,this.KeyRight=Enums.Key.Left)),this.sActionSelector="",this.sSelectabelSelector="",this.sCheckboxSelector="";var f=this;this.listChecked=r.computed({read:function(){var e=o.filter(this.list(),function(e){var t=e.checked(),s=e.selected();return t||f.bCheckOnSelect&&s});return e},write:function(e){e=!!e,o.each(this.list(),function(t){t.checked(e)}),this.list.valueHasMutated()},owner:this}),this.checkAll=r.computed({read:function(){return 0<this.listChecked().length},write:function(e){this.listChecked(!!e)},owner:this}),this.selectorHook=r.observable(null),this.selectorHook.subscribe(function(){var e=this.selectorHook();e&&e.selected(!1)},this,"beforeChange"),this.selectorHook.subscribe(function(e){e&&e.selected(!0)},this),this.itemSelected=r.computed({read:this.selectorHook,write:function(e){this.selectorHook(e),e&&(f.scrollToSelected(),this.oLast=e)},owner:this}),this.list.subscribe(function(e){if(o.isArray(e)){var t=this.itemSelected();t&&(o.find(e,function(e){return t===e})||this.itemSelected(null))}else this.itemSelected(null)},this),this.listCheckedOrSelected=r.computed({read:function(){var e=this.itemSelected(),t=this.listChecked();return 0<t.length?t:e?[e]:[]},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.listCheckedAndSelected=r.computed({read:function(){var e=[],t=this.itemSelected(),s=this.listChecked();return s&&(e=s.slice(0)),t&&o.indexOf(s,t)===-1&&e.push(t),e},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.isIncompleteChecked=r.computed(function(){var e=this.list().length,t=this.listChecked().length;return 0<e&&0<t&&e>t},this),this.onKeydownBound=o.bind(this.onKeydown,this)}var o=s(2),n=s(1),r=s(44),a=s(181),l=s(217),h=s(182),c=s(180),u=s(192);i.prototype.iTimer=0,i.prototype.bResetCheckedOnClick=!1,i.prototype.bCheckOnSelect=!1,i.prototype.bUnselectOnCtrl=!1,i.prototype.bDisableMultiplySelection=!1,i.prototype.getLastOrSelected=function(){var e=0,t=null;return o.each(this.list(),function(s){s.checked()&&e++,s.selected()&&(t=s)}),0===e&&t?t:this.oLast},i.prototype.initOnApplyBindings=function(e,t,s,i,o){n(document).on("keydown",this.onKeydownBound),this.oListScope=i,this.oScrollScope=o,this.sActionSelector=e,this.sSelectabelSelector=t,this.sCheckboxSelector=s;var a=this,l=function(e,t,s){var i=0,o=0,n=null,r=!1,l=!1,h=[],c=!1;if(t=t?t:null,s&&s.shiftKey&&null!==t&&null!==e&&t!==e)for(h=a.list(),c=t.checked(),i=0,o=h.length;i<o;i++)n=h[i],r=!1,n!==e&&n!==t||(r=!0),r&&(l=!l),(l||r)&&n.checked(c);t&&(a.oLast=t)};n(this.oListScope).on("dblclick",e,function(e){var t=r.dataFor(this);!t||!e||e.ctrlKey||e.altKey||e.shiftKey||a.onDblClick(t)}),c.mobileDevice&&n(this.oListScope).on("touchstart",e,function(e){if(e){var t=e.timeStamp,s=n(this).data("lastTouch")||t,i=t-s,o=e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches.length:0;n(this).data("lastTouch",t),!i||i>250||o>1||(e.preventDefault(),n(this).trigger("dblclick"))}}),n(this.oListScope).on("click",e,function(e){var t=!0,s=null,i=a.getLastOrSelected(),o=r.dataFor(this);o&&e&&(e.shiftKey?(t=!1,a.bDisableMultiplySelection||(null===a.oLast&&(a.oLast=o),o.checked(!o.checked()),l(i,o,e))):e.ctrlKey&&(t=!1,a.bDisableMultiplySelection||(a.oLast=o,s=a.itemSelected(),!s||s.checked()||o.checked()||s.checked(!0),a.bUnselectOnCtrl&&o===a.itemSelected()?(o.checked(!o.selected()),a.itemSelected(null)):o.checked(!o.checked()))),t&&a.selectionFunc(o))}),n(this.oListScope).on("click",s,function(e){var t=r.dataFor(this);t&&e&&!a.bDisableMultiplySelection&&(e.shiftKey?(null===a.oLast&&(a.oLast=t),l(a.getLastOrSelected(),t,e)):a.oLast=t),e&&e.stopPropagation&&e.stopPropagation()}),n(this.oListScope).on("dblclick",s,function(e){e&&e.stopPropagation&&e.stopPropagation()})},i.prototype.getResultSelection=function(e,t){var s=this,i=!1,r=!1,a=null,l=this.iFactor,h=!!this.multiplyLineFactor,c=0,u=0,d=[];if(!e&&-1<n.inArray(t,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]))d=this.list(),d&&0<d.length&&(-1<n.inArray(t,[this.KeyDown,this.KeyRight,Enums.Key.PageUp,Enums.Key.Home])?a=d[0]:-1<n.inArray(t,[this.KeyUp,this.KeyLeft,Enums.Key.PageDown,Enums.Key.End])&&(a=d[d.length-1]));else if(e&&(d=this.list(),u=d?d.length:0,0<u))if(Enums.Key.Home===t||Enums.Key.PageUp===t||Enums.Key.End===t||Enums.Key.PageDown===t||h&&(Enums.Key.Left===t||Enums.Key.Right===t)||!h&&(Enums.Key.Up===t||Enums.Key.Down===t))o.each(d,function(o){if(!i)switch(t){case s.KeyUp:case s.KeyLeft:e===o?i=!0:a=o;break;case Enums.Key.Home:case Enums.Key.PageUp:a=o,i=!0;break;case s.KeyDown:case s.KeyRight:r?(a=o,i=!0):e===o&&(r=!0);break;case Enums.Key.End:case Enums.Key.PageDown:a=o}});else if(h&&this.KeyDown===t){for(;c<u;c++)if(e===d[c]){c+=l,u-1<c&&(c-=l),a=d[c];break}}else if(h&&this.KeyUp===t)for(c=u;c>=0;c--)if(e===d[c]){c-=l,0>c&&(c+=l),a=d[c];break}return a},i.prototype.shiftClickResult=function(e,t,s){if(t){var i=!!this.multiplyLineFactor,r=!1,a=!1;-1<n.inArray(s,i?[Enums.Key.Left,Enums.Key.Right]:[Enums.Key.Up,Enums.Key.Down])?t.checked(!t.checked()):-1<n.inArray(s,i?[Enums.Key.Up,Enums.Key.Down,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]:[Enums.Key.Left,Enums.Key.Right,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End])&&(a=!t.checked(),o.each(this.list(),function(s){var i=!1;s!==e&&t!==s||(r=!r,i=!0),(r||i)&&(s.checked(a),i=!1)}),i&&e&&(s===Enums.Key.Up||s===Enums.Key.Down)&&e.checked(!e.checked()))}},i.prototype.clickNewSelectPosition=function(e,t){var s=this.itemSelected(),i=this.getResultSelection(s,e);i&&(t&&this.shiftClickResult(i,s,e),this.selectionFunc(i))},i.prototype.onKeydown=function(e){var t=!0,s=0;return this.useKeyboardKeys()&&e&&!l.isTextFieldFocused()&&!u.hasOpenedMaximizedPopups()&&(s=e.keyCode,e.ctrlKey||this.KeyUp!==s&&this.KeyDown!==s&&this.KeyLeft!==s&&this.KeyRight!==s&&Enums.Key.PageUp!==s&&Enums.Key.PageDown!==s&&Enums.Key.Home!==s&&Enums.Key.End!==s?Enums.Key.Del!==s||e.ctrlKey||e.shiftKey?Enums.Key.Enter===s?0<this.list().length&&!e.ctrlKey&&(this.onEnter(this.itemSelected()),t=!1):!e.ctrlKey||e.altKey||e.shiftKey||Enums.Key.a!==s||(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),t=!1):0<this.list().length&&(this.onDelete(),t=!1):(this.clickNewSelectPosition(s,e.shiftKey),t=!1)),t},i.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected())},i.prototype.onEnter=function(e){this.fEnterCallback.call(this,e)},i.prototype.selectionFunc=function(e){this.bChangeOnSelect&&this.itemSelected(null),this.bResetCheckedOnClick&&this.listChecked(!1),this.bChangeOnSelect&&this.itemSelected(e),this.fSelectCallback.call(this,e)},i.prototype.onDblClick=function(e){this.fDblClickCallback.call(this,e)},i.prototype.koCheckAll=function(){return r.computed({read:this.checkAll,write:this.checkAll,owner:this})},i.prototype.koCheckAllIncomplete=function(){return r.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,owner:this})},i.prototype.scrollToSelected=function(){if(!this.oListScope||!this.oScrollScope)return!1;var e=20,t=n(this.sSelectabelSelector,this.oScrollScope),s=t.position(),i=this.oScrollScope.height(),o=t.outerHeight();return!(!s||!(s.top<0||s.top+o>i))&&(s.top<0?this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+s.top-e):this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+s.top-i+o+e),!0)},e.exports=i},311:function(e,t,s){"use strict";e.exports=function(e){s(312);var t=s(2),i=s(44),o=s(185),n=s(182),r=s(42),a=s(313),l=n.getUserRole()===Enums.UserRole.SuperAdmin,h=n.getUserRole()===Enums.UserRole.NormalUser,c=null,u=null,d=null;if(a.init(e),!r.isModuleAvailable(a.ServerModuleName))return null;if(c=s(314),l)return{start:function(e){e.run("AdminPanelWebclient","registerAdminPanelTab",[function(e){s.e(1,function(){e(s(380))})},a.HashModuleName+"-servers",o.i18n("MAILWEBCLIENT/LABEL_SERVERS_SETTINGS_TAB")]),e.run("AdminPanelWebclient","registerAdminPanelTab",[function(e){s.e(1,function(){e(s(381))})},a.HashModuleName,o.i18n("MAILWEBCLIENT/LABEL_SETTINGS_TAB")])},getAccountList:function(){return c},disableEditDomainsInServer:function(){a.disableEditDomainsInServer()}};if(h){var p=s(316);if(p.init(),n.isNewTab()){var m=function(){if(null===u){var e=s(335);u=new e}return u};return{start:function(){s(349)},getScreens:function(){var e={};return e[a.HashModuleName+"-view"]=function(){return s(350)},e[a.HashModuleName+"-compose"]=function(){return m()},e},registerComposeToolbarController:function(e){var t=m();t.registerToolbarController(e)},getComposeMessageToAddresses:function(){var e=!0,t=s(330);return!!e&&t.composeMessageToAddresses},getComposeMessageWithAttachments:function(){var e=!0,t=s(330);return!!e&&t.composeMessageWithAttachments},getSearchMessagesInCurrentFolder:function(){var e=window.opener&&window.opener.MainTabMailMethods;return!!e&&t.bind(e.searchMessagesInCurrentFolder,e)}}}var g={enableModule:i.observable(a.AllowAddAccounts||c.hasAccount()),getComposeMessageToAddresses:function(){var e=!0,t=s(330);return!!e&&t.composeMessageToAddresses},getComposeMessageWithAttachments:function(){var e=!0,t=s(330);return!!e&&t.composeMessageWithAttachments},getPrefetcher:function(){return s(329)},registerComposeToolbarController:function(e){var t=s(333);t.registerToolbarController(e)},getSearchMessagesInInbox:function(){return t.bind(p.searchMessagesInInbox,p)},getFolderHash:function(e){return p.getFolderHash(e)},getSearchMessagesInCurrentFolder:function(){return t.bind(p.searchMessagesInCurrentFolder,p)},getAllAccountsFullEmails:function(){return c.getAllFullEmails()},getAccountList:function(){return c},setCustomRouting:function(e,t,i,o,n,r){var a=s(195),l=s(318);a.setHash(l.getMailbox(e,t,i,o,n,r))}};return n.isMobile()||(g=t.extend(g,{start:function(e){var o=s(185),n=s(180),r=s(338);if(s(349),s(351),a.AllowAppRegisterMailto&&r.registerMailto(n.firefox),a.AllowAddAccounts||c.hasAccount()){e.run("SettingsWebclient","registerSettingsTab",[function(){return s(352)},a.HashModuleName,o.i18n("MAILWEBCLIENT/LABEL_SETTINGS_TAB")]);var l=a.AllowMultiAccounts?o.i18n("MAILWEBCLIENT/LABEL_ACCOUNTS_SETTINGS_TAB"):o.i18n("MAILWEBCLIENT/LABEL_ACCOUNT_SETTINGS_TAB");e.run("SettingsWebclient","registerSettingsTab",[function(){return s(353)},a.HashModuleName+"-accounts",l])}i.computed(function(){var e=t.filter(c.collection(),function(e){return e.useToAuthorize()}),s=t.map(e,function(e){return e.email()});a.userMailAccountsCount(e.length),a.mailAccountsEmails(s)},this)},getScreens:function(){var e={};return e[a.HashModuleName]=function(){var e=s(375);return new e},e},getHeaderItem:function(){return null===d&&(d=s(379)),{item:d,name:a.HashModuleName}},getMobileSyncSettingsView:function(){return s(371)}})),g}return null}},312:function(e,t,s){"use strict";var i=s(2),o={};o.FolderFilter={Flagged:"flagged",Unseen:"unseen"},o.FolderTypes={Inbox:1,Sent:2,Drafts:3,Spam:4,Trash:5,Virus:6,Starred:7,Template:8,System:9,User:10},o.Importance={Low:5,Normal:3,High:1},o.Sensitivity={Nothing:0,Confidential:1,Private:2,Personal:3},o.AnotherMessageComposedAnswer={Discard:"Discard",SaveAsDraft:"SaveAsDraft",Cancel:"Cancel"},o.ReplyType={Reply:"reply",ReplyAll:"reply-all",Resend:"resend",Forward:"forward",ForwardAsAttach:"eml"},o.HtmlEditorImageSizes={Small:"small",Medium:"medium",Large:"large",Original:"original"},o.UseSignature={Off:"0",On:"1"},o.MailErrors={CannotMoveMessageQuota:4008},void 0===window.Enums&&(window.Enums={}),i.extendOwn(window.Enums,o)},313:function(e,t,s){"use strict";var i=s(44),o=s(2),n=s(181),r=s(182);e.exports={ServerModuleName:"Mail",HashModuleName:"mail",FetchersServerModuleName:"MtaConnector",EnableMultiTenant:!1,AllowAddAccounts:!1,AllowAutoresponder:!1,AllowAutosaveInDrafts:!0,AllowDefaultAccountForUser:!0,AllowEditDomainsInServer:!0,AllowFetchers:!1,AllowFilters:!1,AllowForward:!1,AllowIdentities:!1,AllowInsertImage:!0,AllowMultiAccounts:!1,
AutoSaveIntervalSeconds:60,AllowTemplateFolders:!1,AllowAlwaysRefreshFolders:!1,AutocreateMailAccountOnNewUserFirstLogin:!1,IgnoreImapSubscription:!1,ImageUploadSizeLimit:0,AllowAppRegisterMailto:!1,AllowChangeInputDirection:!0,AllowExpandFolders:!1,AllowSpamFolder:!0,AllowAddNewFolderOnMainScreen:!1,ComposeToolbarOrder:["back","send","save","importance","MailSensitivity","confirmation","OpenPgp"],DefaultFontName:"Tahoma",DefaultFontSize:3,JoinReplyPrefixes:!0,MailsPerPage:20,MaxMessagesBodiesSizeToPrefetch:5e4,MessageBodyTruncationThreshold:65e4,ShowEmailAsTabName:!0,AllowShowMessagesCountInFolderList:!1,showMessagesCountInFolderList:i.observable(!1),AllowSearchMessagesBySubject:!1,PrefixesToRemoveBeforeSearchMessagesBySubject:[],AllowHorizontalLayout:!1,HorizontalLayout:!1,HorizontalLayoutByDefault:!1,userMailAccountsCount:i.observable(0),mailAccountsEmails:i.observableArray([]),init:function(e){var t=e.Core,s=e[this.ServerModuleName],i=e.MailWebclient,a=e[this.FetchersServerModuleName];o.isEmpty(t)||(this.EnableMultiTenant=n.pBool(t.EnableMultiTenant,this.EnableMultiTenant)),o.isEmpty(s)||(this.AllowAddAccounts=n.pBool(s.AllowAddAccounts,this.AllowAddAccounts),this.AllowAutoresponder=n.pBool(s.AllowAutoresponder,this.AllowAutoresponder),this.AllowAutosaveInDrafts=n.pBool(s.AllowAutosaveInDrafts,this.AllowAutosaveInDrafts),this.AllowDefaultAccountForUser=n.pBool(s.AllowDefaultAccountForUser,this.AllowDefaultAccountForUser),this.AllowEditDomainsInServer=n.pBool(s.AllowEditDomainsInServer,this.AllowEditDomainsInServer),this.AllowFilters=n.pBool(s.AllowFilters,this.AllowFilters),this.AllowForward=n.pBool(s.AllowForward,this.AllowForward),this.AllowIdentities=n.pBool(s.AllowIdentities,this.AllowIdentities),this.AllowInsertImage=n.pBool(s.AllowInsertImage,this.AllowInsertImage),this.AllowMultiAccounts=n.pBool(s.AllowMultiAccounts,this.AllowMultiAccounts),this.AutoSaveIntervalSeconds=n.pNonNegativeInt(s.AutoSaveIntervalSeconds,this.AutoSaveIntervalSeconds),this.AllowTemplateFolders=n.pBool(s.AllowTemplateFolders,this.AllowTemplateFolders),this.AllowAlwaysRefreshFolders=n.pBool(s.AllowAlwaysRefreshFolders,this.AllowAlwaysRefreshFolders),this.AutocreateMailAccountOnNewUserFirstLogin=n.pBool(s.AutocreateMailAccountOnNewUserFirstLogin,this.AutocreateMailAccountOnNewUserFirstLogin),this.IgnoreImapSubscription=n.pBool(s.IgnoreImapSubscription,this.IgnoreImapSubscription),this.ImageUploadSizeLimit=n.pNonNegativeInt(s.ImageUploadSizeLimit,this.ImageUploadSizeLimit),window.Enums.SmtpAuthType=n.pObject(s.SmtpAuthType)),o.isEmpty(i)||(this.AllowAppRegisterMailto=n.pBool(i.AllowAppRegisterMailto,this.AllowAppRegisterMailto),this.AllowChangeInputDirection=n.pBool(i.AllowChangeInputDirection,this.AllowChangeInputDirection),this.AllowExpandFolders=n.pBool(i.AllowExpandFolders,this.AllowExpandFolders),this.AllowSpamFolder=n.pBool(i.AllowSpamFolder,this.AllowSpamFolder),this.AllowAddNewFolderOnMainScreen=n.pBool(i.AllowAddNewFolderOnMainScreen,this.AllowAddNewFolderOnMainScreen),this.ComposeToolbarOrder=n.pArray(i.ComposeToolbarOrder,this.ComposeToolbarOrder),this.DefaultFontName=n.pString(i.DefaultFontName,this.DefaultFontName),this.DefaultFontSize=n.pPositiveInt(i.DefaultFontSize,this.DefaultFontSize),this.JoinReplyPrefixes=n.pBool(i.JoinReplyPrefixes,this.JoinReplyPrefixes),this.MailsPerPage=n.pPositiveInt(i.MailsPerPage,this.MailsPerPage),this.MaxMessagesBodiesSizeToPrefetch=n.pNonNegativeInt(i.MaxMessagesBodiesSizeToPrefetch,this.MaxMessagesBodiesSizeToPrefetch),this.MessageBodyTruncationThreshold=n.pNonNegativeInt(i.MessageBodyTruncationThreshold,this.MessageBodyTruncationThreshold),this.ShowEmailAsTabName=n.pBool(i.ShowEmailAsTabName,this.ShowEmailAsTabName),this.AllowShowMessagesCountInFolderList=n.pBool(i.AllowShowMessagesCountInFolderList,this.AllowShowMessagesCountInFolderList),this.showMessagesCountInFolderList(n.pBool(i.ShowMessagesCountInFolderList,this.showMessagesCountInFolderList())),this.AllowSearchMessagesBySubject=n.pBool(i.AllowSearchMessagesBySubject,this.AllowSearchMessagesBySubject),this.PrefixesToRemoveBeforeSearchMessagesBySubject=n.pArray(i.PrefixesToRemoveBeforeSearchMessagesBySubject,this.PrefixesToRemoveBeforeSearchMessagesBySubject),this.AllowHorizontalLayout=n.pBool(i.AllowHorizontalLayout,this.AllowHorizontalLayout),this.HorizontalLayout=this.AllowHorizontalLayout&&n.pBool(i.HorizontalLayout,this.HorizontalLayout),this.HorizontalLayoutByDefault=this.AllowHorizontalLayout&&n.pBool(i.HorizontalLayoutByDefault,this.HorizontalLayoutByDefault)),o.isEmpty(a)||(this.AllowFetchers=n.pBool(a.AllowFetchers,this.AllowFetchers)),r.registerUserAccountsCount(this.userMailAccountsCount),r.registerAccountsWithPass(this.mailAccountsEmails)},update:function(e,t,s,i){this.AllowAutosaveInDrafts=n.pBool(t,this.AllowAutosaveInDrafts),this.AllowChangeInputDirection=n.pBool(s,this.AllowChangeInputDirection),this.MailsPerPage=n.pPositiveInt(e,this.MailsPerPage),this.showMessagesCountInFolderList(n.pBool(i,this.showMessagesCountInFolderList()))},updateAdmin:function(e,t,s){this.AutocreateMailAccountOnNewUserFirstLogin=n.pBool(e,this.AutocreateMailAccountOnNewUserFirstLogin),this.AllowAddAccounts=n.pBool(t,this.AllowAddAccounts),this.HorizontalLayoutByDefault=n.pBool(s,this.HorizontalLayoutByDefault)},disableEditDomainsInServer:function(){this.AllowEditDomainsInServer=!1}}},314:function(e,t,s){"use strict";function i(){this.collection=n.observableArray([])}var o=s(2),n=s(44),r=s(181),a=s(182),l=a.isNewTab()&&window.opener?window.opener.MainTabMailMethods:null,h=s(195),c=s(191),u=s(315),d=s(318),p=s(313),m=s(343),g=s(347),f=s(348);i.prototype.getAccountByHash=function(e){return o.find(this.collection(),function(t){return t.hash()===e},this)},i.prototype.changeCurrentAccountByHash=function(e){var t=this.getAccountByHash(e);t&&t.id()!==this.currentId()&&this.changeCurrentAccount(t.id(),!1)},i.prototype.changeCurrentAccount=function(e,t){var s=this.getCurrent(),i=this.getAccount(e);i&&this.currentId()!==e?(s&&s.isCurrent(!1),this.currentId(e),i.isCurrent(!0)):s||this.currentId(0),t&&h.setHash(d.getMailbox())},i.prototype.changeEditedAccountByHash=function(e){var t=this.getAccountByHash(e);t&&t.id()!==this.editedId()&&this.changeEditedAccount(t.id())},i.prototype.changeEditedAccount=function(e){var t=this.getEdited(),s=this.getAccount(e);s&&this.editedId()!==e?(t&&t.isEdited(!1),this.editedId(e),s.isEdited(!0)):t||this.editedId(0)},i.prototype.getDefaultFriendlyName=function(){var e=this.getCurrent(),t=o.find(e&&e.identities()||[],function(e){return e.isDefault()})||e;return t?t.friendlyName()||t.email():""},i.prototype.getIdentityByHash=function(e){var t=null;return o.each(this.collection(),function(s){t||(t=o.find(s.identities()||[],function(t){return t.hash()===e}))},this),t},i.prototype.getFetcherByHash=function(e){var t=null;return o.each(this.collection(),function(s){t||(t=o.find(s.fetchers(),function(t){return t.hash()===e}))},this),t},i.prototype.parse=function(e){o.isArray(e)&&(this.collection(o.map(e,function(e){return new m(e)})),this.initObservables(this.collection().length>0?this.collection()[0].id():0))},i.prototype.initObservables=function(e){var t=this.getAccount(e);t&&(t.isCurrent(!0),t.isEdited(!0)),this.currentId=n.observable(e),this.editedId=n.observable(e)},i.prototype.hasAccount=function(){return this.collection().length>0},i.prototype.getAccount=function(e){var t=o.find(this.collection(),function(t){return t.id()===e},this);return t},i.prototype.getDefault=function(){var e=o.find(this.collection(),function(e){return e.bDefault},this);return e},i.prototype.getCurrent=function(){return this.getAccount(this.currentId())},i.prototype.getEdited=function(){return this.getAccount(this.editedId())},i.prototype.getEmail=function(e){e=e||this.currentId();var t="",s=this.getAccount(e);return s&&(t=s.email()),t},i.prototype.addAccount=function(e){this.collection.push(e)},i.prototype.deleteAccount=function(e){this.collection.remove(function(t){return t.id()===e});var t=this.collection().length>0?this.collection()[0].id():0;this.changeCurrentAccount(t,!1),this.changeEditedAccount(t)},i.prototype.hasAccountWithId=function(e){var t=o.find(this.collection(),function(t){return t.id()===e},this);return!!t},i.prototype.populateFetchersIdentities=function(){this.populateFetchers(),this.populateIdentities()},i.prototype.populateFetchers=function(){p.AllowFetchers&&c.send(p.FetchersServerModuleName,"GetFetchers",{AccountID:this.editedId()},this.onGetFetchersResponse,this)},i.prototype.onGetFetchersResponse=function(e,t){var s={};r.isNonEmptyArray(e.Result)&&o.each(e.Result,function(e){var t=new g;t.parse(e),s[t.accountId()]||(s[t.accountId()]=[]),s[t.accountId()].push(t)}),o.each(this.collection(),function(e){var t=r.isNonEmptyArray(s[e.id()])?s[e.id()]:[];e.fetchers(t)},this)},i.prototype.populateIdentities=function(e){p.AllowIdentities&&this.collection().length>=1&&u.send("GetIdentities",null,function(t,s){this.onGetIdentitiesResponse(t,s),o.isFunction(e)&&e()},this)},i.prototype.onGetIdentitiesResponse=function(e,t){var s={};r.isNonEmptyArray(e.Result)&&o.each(e.Result,function(e){var t=new f,i=-1;t.parse(e),i=t.accountId(),s[i]||(s[i]=[]),s[i].push(t)}),o.each(this.collection(),function(e){var t=s[e.id()],i=new f;r.isNonEmptyArray(t)||(t=[]),i.parse({"@Object":"Object/Aurora\\Modules\\Mail\\Classes\\Identity",AccountPart:!0,Default:!o.find(t,function(e){return e.isDefault()}),Email:e.email(),FriendlyName:e.friendlyName(),IdAccount:e.id(),EntityId:1e5*e.id(),Signature:e.signature(),UseSignature:e.useSignature()}),t.unshift(i),e.identities(t)})},i.prototype.populateIdentitiesFromSourceAccount=function(e){e&&o.each(this.collection(),function(t){var s=e.getAccount(t.id());s&&(t.fetchers(s.fetchers()),t.identities(s.identities()),t.signature(s.signature()),t.useSignature(s.useSignature()))})},i.prototype.getAccountsEmails=function(){return o.uniq(o.map(this.collection(),function(e){return e.email()}))},i.prototype.getAllFullEmails=function(){var e=[];return o.each(this.collection(),function(t){t&&(r.isNonEmptyArray(t.identities())?o.each(t.identities(),function(t){e.push(t.fullEmail())}):e.push(t.fullEmail()),o.each(t.fetchers(),function(t){t.isEnabled()&&t.isOutgoingEnabled()&&""!==t.fullEmail()&&e.push(t.fullEmail())}))}),e},i.prototype.getCurrentFetchersAndFiltersFolderNames=function(){var e=this.getCurrent(),t=[];return e&&(e.filters()&&o.each(e.filters().collection(),function(e){t.push(e.folder())},this),o.each(e.fetchers(),function(e){t.push(e.folder())},this)),t},i.prototype.getAttendee=function(e){var t=[],s="";return o.each(this.collection(),function(e){t=e.isCurrent()?o.union([e.email()],e.getFetchersIdentitiesEmails(),t):o.union(t,[e.email()],e.getFetchersIdentitiesEmails())}),t=o.uniq(t),o.each(t,o.bind(function(t){if(""===s){var i=o.find(e,function(e){return e===t});i===t&&(s=t)}},this)),s};var b=new i;window.auroraAppData.Mail&&o.isArray(window.auroraAppData.Mail.Accounts)?b.parse(window.auroraAppData.Mail.Accounts):b.parse([]),l&&b.populateIdentitiesFromSourceAccount(l.getAccountList()),e.exports=b},315:function(e,t,s){"use strict";var i=s(191),o=s(313);i.registerAbortRequestHandler(o.ServerModuleName,function(e,t){var s=e.Parameters,i=t.Parameters;switch(e.Method){case"MoveMessages":case"DeleteMessages":return"GetMessage"===t.Method||"GetMessages"===t.Method&&i.Folder===s.Folder;case"GetMessages":case"SetMessagesSeen":case"SetMessageFlagged":return"GetMessages"===t.Method&&i.Folder===s.Folder;case"SetAllMessagesSeen":return("GetMessages"===t.Method||"GetMessages"===t.Method)&&i.Folder===s.Folder;case"ClearFolder":return"GetRelevantFoldersInformation"===t.Method||"GetMessages"===t.Method&&i.Folder===s.Folder;case"GetRelevantFoldersInformation":return"GetRelevantFoldersInformation"===t.Method&&s.AccountID===i.AccountID;case"GetMessagesFlags":return"GetMessagesFlags"===t.Method}return!1}),e.exports={getOpenedRequest:function(e){i.getOpenedRequest("Mail",e)},hasOpenedRequests:function(e){i.hasOpenedRequests("Mail",e)},registerOnAllRequestsClosedHandler:i.registerOnAllRequestsClosedHandler,send:function(e,t,n,r){var a=s(316),l="GetMessagesBodies"===e?1e5:void 0;t&&!t.AccountID&&(t.AccountID=a.currentAccountId()),i.send(o.ServerModuleName,e,t,n,r,l)}}},316:function(e,t,s){"use strict";function i(){this.currentAccountId=A.currentId,this.currentAccountId.subscribe(function(e){var t=A.getAccount(e),s=this.oFolderListItems[e];t?(t.quotaRecieved(!1),this.messagesLoadingError(!1),s?this.folderList(s):(this.messagesLoading(!0),this.folderList(new C),this.messages([]),this.currentMessage(null),this.getFolderList(e))):this.folderList(new C)},this),this.editedAccountId=A.editedId,this.editedAccountId.subscribe(function(e){var t=this.oFolderListItems[e];t?this.editedFolderList(t):this.currentAccountId()!==e&&(this.editedFolderList(new C),this.getFolderList(e))},this),this.oFolderListItems={},this.quotaChangeTrigger=r.observable(!1),this.checkMailStarted=r.observable(!1),this.checkMailStartedAccountId=r.observable(0),this.folderList=r.observable(new C),this.folderListLoading=r.observableArray([]),this.editedFolderList=r.observable(new C),this.newMessagesCount=r.computed(function(){var e=this.folderList().inboxFolder();return e?e.unseenMessageCount():0},this),this.messages=r.observableArray([]),this.messages.subscribe(function(){this.messages().length>0&&this.messagesLoadingError(!1)},this),this.uidList=r.observable(new I),this.page=r.observable(1),this.messagesLoading=r.observable(!1),this.messagesLoadingError=r.observable(!1),this.currentMessage=r.observable(null),this.nextMessageUid=r.observable(""),this.prevMessageUid=r.observable(""),this.savingDraftUid=r.observable(""),this.editedDraftUid=r.observable(""),this.disableComposeAutosave=r.observable(!1),this.aResponseHandlers=[],this.iAutoCheckMailTimer=-1,this.waitForUnseenMessages=r.observable(!0),this.iSetMessagesSeenCount=0,d.subscribeEvent("ReceiveAjaxResponse::after",o.bind(function(e){!this.checkMailStarted()&&"Ping"===e.Response.Method&&"Core"===e.Response.Module&&e.Response.Result&&this.setAutocheckmailTimer()},this))}var o=s(2),n=s(1),r=s(44),a=s(49),l=s(185),h=s(181),c=s(217),u=s(186),d=s(182),p=s(317),m=s(195),g=s(43),f=s(200),b=s(192),v=s(201),y=s(318),A=s(314),E=s(315),S=null,F=s(313),C=s(319),I=s(328),w=d.isNewTab()&&window.opener&&window.opener.MainTabMailMethods;i.prototype.requirePrefetcher=function(){S=s(329)},i.prototype.init=function(){if(E.registerOnAllRequestsClosedHandler(function(){o.delay(function(){E.hasOpenedRequests()||(M.checkMailStarted(!1),M.folderListLoading.removeAll())},10),E.hasOpenedRequests()||M.savingDraftUid("")}),w){if(this.oFolderListItems=w.getFolderListItems(),this.uidList(w.getUidList()),window.name){var e=h.pInt(window.name);0===e&&(e=w.getComposedMessageAccountId(window.name)),0!==e&&this.currentAccountId(e)}this.currentAccountId.valueHasMutated(),this.initPrevNextSubscribes()}else this.currentAccountId.valueHasMutated()},i.prototype.initPrevNextSubscribes=function(){this.bInThreadLevel=!1,this.currentMessage.subscribe(this.calcNextMessageUid,this),this.uidList.subscribe(this.calcNextMessageUid,this),this.currentMessage.subscribe(this.calcPrevMessageUid,this),this.uidList.subscribe(this.calcPrevMessageUid,this)},i.prototype.calcNextMessageUid=function(){var e="",t="",s=null,i=null,n=!1;this.currentMessage()&&(n=this.currentMessage().threadPart()&&""!==this.currentMessage().threadParentUid(),s=this.folderList().getFolderByFullName(this.currentMessage().folder()),e=this.currentMessage().uid(),this.bInThreadLevel||n?(this.bInThreadLevel=!0,n&&(i=s.getMessageByUid(this.currentMessage().threadParentUid()),i&&(o.each(i.threadUids(),function(s,i,o){s===e&&i>0&&(t=o[i-1])}),h.isNonEmptyString(t)||(t=i.uid())))):(o.each(this.uidList().collection(),function(s,i,o){s===e&&i>0&&(t=o[i-1]||"")}),""===t&&w&&(this.requirePrefetcher(),S.prefetchNextPage(e)))),this.nextMessageUid(t)},i.prototype.calcPrevMessageUid=function(){var e=this.currentMessage()?this.currentMessage().uid():"",t="",s=null,i=null,n=!1;this.currentMessage()&&(n=this.currentMessage().threadPart()&&""!==this.currentMessage().threadParentUid(),s=this.folderList().getFolderByFullName(this.currentMessage().folder()),e=this.currentMessage().uid(),this.bInThreadLevel||n?(this.bInThreadLevel=!0,n?(i=s.getMessageByUid(this.currentMessage().threadParentUid()),i&&o.each(i.threadUids(),function(s,i,o){s===e&&i+1<o.length&&(t=o[i+1]||"")})):this.currentMessage().threadCount()>0&&(t=this.currentMessage().threadUids()[0])):(o.each(this.uidList().collection(),function(s,i,o){s===e&&i+1<o.length&&(t=o[i+1]||"")}),""===t&&w&&(this.requirePrefetcher(),S.prefetchPrevPage(e)))),this.prevMessageUid(t)},i.prototype.getCurrentFolder=function(){return this.folderList().currentFolder()},i.prototype.getFolderByFullName=function(e,t){var s=this.oFolderListItems[e];return s?s.getFolderByFullName(t):null},i.prototype.checkCurrentFolderList=function(){var e=A.getCurrent(),t=e?this.oFolderListItems[e.id()]:null;!e||t||this.messagesLoading()||(this.messagesLoading(!0),this.messagesLoadingError(!1),this.getFolderList(e.id()))},i.prototype.getFolderList=function(e){var t=A.getAccount(e);t?(this.folderListLoading.push(e),E.send("GetFolders",{AccountID:e},this.onGetFoldersResponse,this)):e===this.currentAccountId()&&this.messagesLoading(!1)},i.prototype.markMessageReplied=function(e,t,s,i){var o=this.oFolderListItems[e],n=null;o&&(n=o.getFolderByFullName(t),n&&n.markMessageReplied(s,i))},i.prototype.hideThreads=function(e){var t=A.getCurrent();t&&t.threadingIsAvailable()&&e.folder()===this.folderList().currentFolderFullName()&&!e.threadOpened()&&this.folderList().currentFolder().hideThreadMessages(e)},i.prototype.showOpenedThreads=function(e){this.messages(this.getMessagesWithThreads(e,this.uidList(),this.messages()))},i.prototype.useThreadingInCurrentList=function(e){e=e||this.uidList();var t=A.getCurrent(),s=this.folderList().currentFolder(),i=s&&s.withoutThreads(),o=""===e.search()&&""===e.filters();return t&&t.threadingIsAvailable()&&!i&&o},i.prototype.getMessagesWithThreads=function(e,t,s){var i=[],n=[],r=this.folderList().currentFolder();return r&&e===r.fullName()&&this.useThreadingInCurrentList(t)?(n=o.filter(s,function(e){return!e.threadPart()}),o.each(n,function(e){var t=[];i.push(e),e.threadCount()>0&&(e.threadOpened()&&(t=this.folderList().currentFolder().getThreadMessages(e),i=o.union(i,t)),r.computeThreadData(e))},this),i):s},i.prototype.setMessagesFromUidList=function(e,t,s,i){var n=e.getUidsForOffset(t,s),r=o.map(n,function(e){return s[e]},this),a=r.length;return i&&(this.messages(this.getMessagesWithThreads(this.folderList().currentFolderFullName(),e,r)),t+a<e.resultCount()&&a<F.MailsPerPage&&(e.filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.messagesLoading(!0),this.currentMessage()&&(this.currentMessage().deleted()||this.currentMessage().folder()!==this.folderList().currentFolderFullName())&&this.currentMessage(null)),n},i.prototype.getNamesOfFoldersToRefresh=function(){var e=this.oFolderListItems[this.currentAccountId()],t=e?e.getNamesOfFoldersToRefresh():[],s=A.getCurrentFetchersAndFiltersFolderNames();return t=o.uniq(o.compact(o.union(t,s)))},i.prototype.getUseListStatusIfPossibleValue=function(e){var t=this.oFolderListItems[this.currentAccountId()],s=t?t.getFoldersCount():0;return s<100||e>50},i.prototype.executeCheckMail=function(e){var t=this.currentAccountId(),s=this.getNamesOfFoldersToRefresh(),i=this.checkMailStarted()&&this.checkMailStartedAccountId()===t,o=null;d.getUserRole()!==Enums.UserRole.Anonymous&&(e||!E.hasOpenedRequests("GetRelevantFoldersInformation")||!i)&&s.length>0&&(o={AccountID:t,Folders:s,UseListStatusIfPossible:this.getUseListStatusIfPossibleValue(s.length)},this.checkMailStarted(!0),this.checkMailStartedAccountId(t),A.getAccount(t)&&E.send("GetRelevantFoldersInformation",o,this.onGetRelevantFoldersInformationResponse,this))},i.prototype.setAutocheckmailTimer=function(){clearTimeout(this.iAutoCheckMailTimer),!d.isNewTab()&&g.AutoRefreshIntervalMinutes>0&&(this.iAutoCheckMailTimer=setTimeout(function(){M.isSearchExecuting()||(M.checkMessageFlags(),M.executeCheckMail(!1))},60*g.AutoRefreshIntervalMinutes*1e3))},i.prototype.isSearchExecuting=function(){var e=E.getOpenedRequest("GetMessages"),t=e&&e.Parameters;return t&&""!==t.Search},i.prototype.checkMessageFlags=function(){var e=this.folderList().inboxFolder(),t=e?e.getFlaggedMessageUids():[],s={Folder:this.folderList().inboxFolderFullName(),Uids:t};t.length>0&&E.send("GetMessagesFlags",s,this.onGetMessagesFlagsResponse,this)},i.prototype.onGetMessagesFlagsResponse=function(e,t){var s=t.Parameters,i=this.oFolderListItems[s.AccountID],n=i?i.inboxFolder():null;n&&(e.Result&&o.each(e.Result,function(e,t){o.indexOf(e,"\\flagged")===-1&&n.setMessageUnflaggedByUid(t)}),n.removeFlaggedMessageListsFromCache(),this.requirePrefetcher(),S.prefetchStarredMessageList())},i.prototype.changeCurrentMessageList=function(e,t,s,i){this.requestCurrentMessageList(e,t,s,i,!0)},i.prototype.requestCurrentMessageList=function(e,t,s,i,o){var n=this.requestMessageList(e,t,s,i||"",!0,o||!1),r=60*g.AutoRefreshIntervalMinutes*1e3,l=n.Folder.relevantInformationLastMoment?a().diff(n.Folder.relevantInformationLastMoment):r+1;this.uidList(n.UidList),this.page(t),this.messagesLoading(n.RequestStarted),this.messagesLoadingError(!1),!n.RequestStarted&&r>0&&l>r&&this.executeCheckMail(!0)},i.prototype.requestMessageList=function(e,t,s,i,o,n){var r=this.oFolderListItems[this.currentAccountId()],a=r?r.getFolderByFullName(e):null,l=a&&a.withoutThreads(),h=A.getCurrent(),c=h&&h.threadingIsAvailable()&&!l&&""===s&&""===i,u=a?a.getUidList(s,i):null,d=u&&u.resultCount()===-1,p=(t-1)*F.MailsPerPage,m={Folder:e,Offset:p,Limit:F.MailsPerPage,Search:s,Filters:i,UseThreading:c},g=!1,f=!1,b=o?this.onCurrentGetMessagesResponse:this.onGetMessagesResponse,v=[];return a.type()===Enums.FolderTypes.Inbox&&""===i?m.InboxUidnext=a.sUidNext:m.InboxUidnext="",d&&u.search()===this.uidList().search()&&u.filters()===this.uidList().filters()&&(u=this.uidList()),u&&(v=this.setMessagesFromUidList(u,p,a.oMessages,n)),u&&(f=d||p+v.length<u.resultCount()&&v.length<F.MailsPerPage,g=a.hasChanges()||f),g?E.send("GetMessages",m,b,this):this.waitForUnseenMessages(!1),{UidList:u,RequestStarted:g,DataExpected:f,Folder:a}},i.prototype.executeEmptyTrash=function(){var e=this.folderList().trashFolder();e&&e.emptyFolder()},i.prototype.executeEmptySpam=function(){var e=this.folderList().spamFolder();e&&e.emptyFolder()},i.prototype.onClearFolder=function(e){if(e&&e.selected()){this.messages.removeAll(),this.currentMessage(null);var t=e?e.getUidList(this.uidList().search(),this.uidList().filters()):null;t?this.uidList(t):this.uidList(new I),this.checkMailStarted(!1),this.setAutocheckmailTimer()}},i.prototype.getOpenedDraftUids=function(){var e=f.getOpenedWindows(),t=o.map(e,function(e){return e.SlaveTabMailMethods&&window.location.origin===e.location.origin?e.SlaveTabMailMethods.getEditedDraftUid():""});return b.hasOpenedMinimizedPopups()&&t.push(this.editedDraftUid()),o.uniq(o.compact(t))},i.prototype.closeComposesWithDraftUids=function(e){var t=f.getOpenedWindows();if(o.each(t,function(t){t.SlaveTabMailMethods&&window.location.origin===t.location.origin&&-1!==n.inArray(t.SlaveTabMailMethods.getEditedDraftUid(),e)&&t.close()}),-1!==n.inArray(this.editedDraftUid(),e)){var i=s(330);o.isFunction(i.closeComposePopup)&&i.closeComposePopup()}},i.prototype.moveMessagesToFolder=function(e,t){if(t.length>0){var s=this.folderList().currentFolder(),i=s&&s.type()===Enums.FolderTypes.Drafts,r=i&&this.getOpenedDraftUids(),a=i&&o.find(t,o.bind(function(e){return-1!==n.inArray(e,r)},this)),h=this.folderList().getFolderByFullName(e),c={Folder:s?s.fullName():"",ToFolder:e,Uids:t.join(",")},u=null,d=o.bind(function(){this.uidList().filters()===Enums.FolderFilter.Unseen&&this.uidList().resultCount()>F.MailsPerPage&&this.waitForUnseenMessages(!0),u=s.markDeletedByUids(t),h.addMessagesCountsDiff(u.MinusDiff,u.UnseenMinusDiff),h.recivedAnim(!0),this.excludeDeletedMessages(),h.markHasChanges(),E.send("MoveMessages",c,this.onMoveMessagesResponse,this)},this);s&&h&&(a?(this.disableComposeAutosave(!0),b.showPopup(v,[l.i18n("MAILWEBCLIENT/CONFIRM_MESSAGE_FOR_DELETE_IS_EDITED"),o.bind(function(e){e&&(this.closeComposesWithDraftUids(t),d()),this.disableComposeAutosave(!1)},this),"",l.i18n("MAILWEBCLIENT/ACTION_CLOSE_DELETE_DRAFT")])):d())}},i.prototype.copyMessagesToFolder=function(e,t){if(t.length>0){var s=this.folderList().currentFolder(),i=this.folderList().getFolderByFullName(e),o={Folder:s?s.fullName():"",ToFolder:e,Uids:t.join(",")};s&&i&&(i.recivedAnim(!0),i.markHasChanges(),E.send("CopyMessages",o,this.onCopyMessagesResponse,this))}},i.prototype.excludeDeletedMessages=function(){o.delay(o.bind(function(){var e=this.folderList().currentFolder(),t=(this.page()-1)*F.MailsPerPage;this.setMessagesFromUidList(this.uidList(),t,e.oMessages,!0)},this),500)},i.prototype.removeOneMessageFromCacheForFolder=function(e,t,s){var i=this.oFolderListItems[e],o=i?i.getFolderByFullName(t):null;o&&o.type()===Enums.FolderTypes.Drafts&&(o.markDeletedByUids([s]),o.commitDeleted([s]))},i.prototype.startMessagesLoadingWhenDraftSaving=function(e,t){var s=this.oFolderListItems[e],i=s?s.getFolderByFullName(t):null;i&&i.type()===Enums.FolderTypes.Drafts&&i.selected()&&this.messagesLoading(!0)},i.prototype.removeMessagesFromCacheForFolder=function(e,t){var s=this.oFolderListItems[e],i=s?s.getFolderByFullName(t):null,o=s?s.currentFolderFullName():null;i&&(i.markHasChanges(),this.currentAccountId()===e&&t===o&&this.requestCurrentMessageList(o,this.page(),this.uidList().search(),"",!0))},i.prototype.deleteMessages=function(e){var t=this.folderList().currentFolder();t&&this.deleteMessagesFromFolder(t,e)},i.prototype.deleteMessagesFromFolder=function(e,t){var s={Folder:e.fullName(),Uids:t.join(",")};e.markDeletedByUids(t),this.excludeDeletedMessages(),E.send("DeleteMessages",s,this.onMoveMessagesResponse,this)},i.prototype.showExternalPictures=function(e){var t=[],s=null;this.currentMessage()&&(t=this.currentMessage().oFrom.aCollection,s=this.folderList().getFolderByFullName(this.currentMessage().folder()),e&&t.length>0?s.alwaysShowExternalPicturesForSender(t[0].sEmail):s.showExternalPictures(this.currentMessage().uid()))},i.prototype.setCurrentMessage=function(e,t){var s=this.folderList().currentFolder(),i=null;!d.isNewTab()||s&&s.fullName()===t||(this.folderList().setCurrentFolder(t,""),s=this.folderList().currentFolder()),s&&e&&(i=s.oMessages[e]),i&&!i.deleted()?(this.currentMessage(i),this.currentMessage().seen()||this.executeGroupOperation("SetMessagesSeen",[this.currentMessage().uid()],"seen",!0),s.getCompletelyFilledMessage(e,this.onCurrentMessageResponse,this)):(this.currentMessage(null),d.isNewTab()&&s&&s.getCompletelyFilledMessage(e,this.onCurrentMessageResponse,this))},i.prototype.onCurrentMessageResponse=function(e,t,s){var i=this.currentMessage()?this.currentMessage().uid():"";null===e&&w&&s&&u.showErrorByCode(s,"",!0),null===e&&i===t?this.currentMessage(null):e&&i===t?this.currentMessage.valueHasMutated():d.isNewTab()&&e&&null===this.currentMessage()&&this.currentMessage(e)},i.prototype.getMessage=function(e,t,s,i){var o=this.folderList().getFolderByFullName(e);o&&o.getCompletelyFilledMessage(t,s,i)},i.prototype.executeGroupOperation=function(e,t,s,i){var o=this.folderList().currentFolder(),n={Folder:o?o.fullName():"",Uids:t.join(","),SetAction:i},r=(this.page()-1)*F.MailsPerPage,a=t.length,l=this.folderList().oStarredFolder?this.folderList().oStarredFolder.messageCount():0,h=o?o.getUidList("",Enums.FolderFilter.Flagged):null,c="SetMessagesSeen"===e?this.onSetMessagesSeenResponse:function(){};o&&("SetMessagesSeen"===e&&this.iSetMessagesSeenCount++,E.send(e,n,c,this),o.executeGroupOperation(s,t,i),o.type()===Enums.FolderTypes.Inbox&&"flagged"===s&&(this.uidList().filters()===Enums.FolderFilter.Flagged?i||(this.uidList().deleteUids(t),this.folderList().oStarredFolder&&this.folderList().oStarredFolder.messageCount(h.resultCount())):(o.removeFlaggedMessageListsFromCache(),""===this.uidList().search()&&this.folderList().oStarredFolder&&(i?this.folderList().oStarredFolder.messageCount(l+a):this.folderList().oStarredFolder.messageCount(l-a>0?l-a:0)))),"seen"===s&&o.removeUnseenMessageListsFromCache(),(this.uidList().filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.setMessagesFromUidList(this.uidList(),r,o.oMessages,!0))},i.prototype.onSetMessagesSeenResponse=function(e,t){this.iSetMessagesSeenCount--,this.iSetMessagesSeenCount<0&&(this.iSetMessagesSeenCount=0),this.folderList().currentFolder()&&0===this.iSetMessagesSeenCount&&(this.uidList().filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&this.requestCurrentMessageList(this.folderList().currentFolder().fullName(),this.page(),this.uidList().search(),this.uidList().filters(),!1)},i.prototype.onGetFoldersResponse=function(e,t){var s=t.Parameters,i=new C,n=s.AccountID,r=this.oFolderListItems[n],a=r?r.oNamedCollection:{};e.Result===!1?(u.showErrorByCode(e),s.AccountID===this.currentAccountId()&&0===this.messages().length&&(this.messagesLoading(!1),this.messagesLoadingError(!0))):(i.parse(n,e.Result,a),r&&i.oStarredFolder.messageCount(r.oStarredFolder.messageCount()),this.oFolderListItems[n]=i,setTimeout(o.bind(this.getAllFoldersRelevantInformation,this,n),2e3),this.currentAccountId()===n&&this.folderList(i),this.editedAccountId()===n&&this.editedFolderList(i)),this.folderListLoading.remove(n)},i.prototype.getAllFoldersRelevantInformation=function(e){var t=this.oFolderListItems[e],s=t?t.getFoldersWithoutCountInfo():[],i={AccountID:e,Folders:s,UseListStatusIfPossible:this.getUseListStatusIfPossibleValue(s.length)};s.length>0&&A.getAccount(e)&&E.send("GetRelevantFoldersInformation",i,this.onGetRelevantFoldersInformationResponse,this)},i.prototype.onGetRelevantFoldersInformationResponse=function(e,t){var s=!1,i=t.Parameters,n=i.AccountID,r=this.oFolderListItems[n],a=this.folderList().currentFolderFullName(),l=this.currentAccountId()===n;e.Result===!1?(u.showErrorByCode(e),E.hasOpenedRequests("GetRelevantFoldersInformation")&&(s=!0)):r&&(o.each(e.Result&&e.Result.Counts,function(e,t){if(o.isArray(e)&&e.length>3){var i=e[0],n=e[1],h=e[2],c=e[3],u=!1,d=!1,p=null;p=r.getFolderByFullName(t),p&&(d=l&&p.fullName()===a,u=p.setRelevantInformation(h,c,i,n,d),d&&u&&this.uidList().filters()!==Enums.FolderFilter.Unseen&&(this.requestCurrentMessageList(p.fullName(),this.page(),this.uidList().search(),this.uidList().filters(),!1),s=!0))}},this),r.countsCompletelyFilled(!0)),this.checkMailStarted(s),this.checkMailStarted()||this.setAutocheckmailTimer()},i.prototype.showNotificationsForNewMessages=function(e){var t=this.folderList().currentFolderFullName(),s=0,i="",n={},r="",a=[];e.Result.New&&e.Result.New.length>0&&(s=e.Result.New.length,i=e.Result.New[0].Uid,n={action:"show",icon:"static/styles/images/logo_140x140.png",title:l.i18n("MAILWEBCLIENT/INFO_NEW_MESSAGES_PLURAL",{COUNT:s},null,s),timeout:5e3,callback:function(){window.focus(),m.setHash(y.getMailbox(t,1,i,"",""))}},1===s&&(h.isNonEmptyString(e.Result.New[0].Subject)&&a.push(l.i18n("MAILWEBCLIENT/LABEL_SUBJECT")+": "+e.Result.New[0].Subject),r=o.map(e.Result.New[0].From,function(e){return""!==e.DisplayName?e.DisplayName:e.Email}).join(", "),h.isNonEmptyString(r)&&a.push(l.i18n("MAILWEBCLIENT/LABEL_FROM")+": "+r),n.body=a.join("\r\n")),c.desktopNotify(n))},i.prototype.onCurrentGetMessagesResponse=function(e,t){this.checkMailStarted(!1),e.Result?(this.messagesLoadingError(!1),this.parseMessageList(e,t)):(u.showErrorByCode(e),this.messagesLoading()!==!0||0!==this.messages().length&&e.ErrorCode===Enums.Errors.NotDisplayedError||this.messagesLoadingError(!0),this.messagesLoading(!1),this.setAutocheckmailTimer())},i.prototype.onGetMessagesResponse=function(e,t){e&&e.Result&&this.parseMessageList(e,t);
},i.prototype.parseMessageList=function(e,t){var s=e.Result,i=t.Parameters,n=i.AccountID,r=this.oFolderListItems[n],a=null,l=null,h=i.UseThreading,c=!1,u=this.currentAccountId()===n&&this.folderList().currentFolderFullName()===s.FolderName,d=u&&this.uidList().search()===s.Search&&this.uidList().filters()===s.Filters,p=this.page()===s.Offset/F.MailsPerPage+1,m=[];this.showNotificationsForNewMessages(e),s!==!1&&"Collection/MessageCollection"===s["@Object"]&&(a=r.getFolderByFullName(s.FolderName),a.setRelevantInformation(""+s.UidNext,s.FolderHash,s.MessageCount,s.MessageUnseenCount,u&&!d),c=a.hasChanges(),a.removeAllMessageListsFromCacheIfHasChanges(),l=a.getUidList(s.Search,s.Filters),l.setUidsAndCount(s),o.each(s["@Collection"],function(e){var t=a.parseAndCacheMessage(e,!1,h);m.push(t)},this),d&&(this.uidList(l),p&&(l.filters()!==Enums.FolderFilter.Unseen||this.waitForUnseenMessages())&&(this.messagesLoading(!1),this.waitForUnseenMessages(!1),this.setMessagesFromUidList(l,s.Offset,a.oMessages,!0),this.messagesLoading()||this.setAutocheckmailTimer())),!c||!u||d&&p||this.uidList().filters()===Enums.FolderFilter.Unseen||this.requestCurrentMessageList(this.folderList().currentFolderFullName(),this.page(),this.uidList().search(),this.uidList().filters(),!1),a.type()===Enums.FolderTypes.Inbox&&l.filters()===Enums.FolderFilter.Flagged&&""===l.search()&&this.folderList().oStarredFolder&&(this.folderList().oStarredFolder.messageCount(l.resultCount()),this.folderList().oStarredFolder.hasExtendedInfo(!0)))},i.prototype.increaseStarredCount=function(){this.folderList().oStarredFolder&&this.folderList().oStarredFolder.increaseCountIfHasNotInfo()},i.prototype.onMoveMessagesResponse=function(e,t){var s=e.Result,i=t.Parameters,n=this.folderList().getFolderByFullName(i.Folder),r=this.folderList().getFolderByFullName(i.ToFolder),a=r&&r.type()===Enums.FolderTypes.Trash,c=r&&r.type()===Enums.FolderTypes.Spam,d=null,p=a?l.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_DELETE_WITHOUT_TRASH"):l.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_MARK_SPAM_WITHOUT_SPAM"),g=o.bind(function(e){e&&n&&this.deleteMessagesFromFolder(n,i.Uids.split(","))},this),f=this.folderList().currentFolder(),y=f?f.fullName():"",A=!1;if(s===!1?(n&&(d=n.revertDeleted(i.Uids.split(","))),r?(d&&r.addMessagesCountsDiff(-d.PlusDiff,-d.UnseenPlusDiff),e.ErrorCode===Enums.MailErrors.CannotMoveMessageQuota&&(a||c)?(h.isNonEmptyString(e.ErrorMessage)&&(p+=" ("+e.ErrorMessage+")"),b.showPopup(v,[p,g])):u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_MOVING_MESSAGES"))):u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_DELETING_MESSAGES")),A=!0):n&&(n.commitDeleted(i.Uids.split(",")),o.each(i.Uids.split(","),function(e){m.replaceHashWithoutMessageUid(e)})),n&&y===n.fullName()||r&&y===r.fullName())switch(f.markHasChanges(),this.uidList().filters()){case Enums.FolderFilter.Flagged:break;case Enums.FolderFilter.Unseen:this.waitForUnseenMessages()&&this.requestCurrentMessageList(y,this.page(),this.uidList().search(),this.uidList().filters(),A);break;default:this.requestCurrentMessageList(y,this.page(),this.uidList().search(),this.uidList().filters(),A)}else n&&y!==n.fullName()?(this.requirePrefetcher(),S.startFolderPrefetch(n)):r&&y!==r.fullName()&&(this.requirePrefetcher(),S.startFolderPrefetch(r))},i.prototype.onCopyMessagesResponse=function(e,t){var s=e.Result,i=t.Parameters,o=this.folderList().getFolderByFullName(i.Folder),n=this.folderList().getFolderByFullName(i.ToFolder),r=this.folderList().currentFolder(),a=r.fullName();s===!1&&u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_COPYING_MESSAGES")),a===o.fullName()||n&&a===n.fullName()?(r.markHasChanges(),this.requestCurrentMessageList(a,this.page(),this.uidList().search(),"",!1)):a!==o.fullName()?(this.requirePrefetcher(),S.startFolderPrefetch(o)):n&&a!==n.fullName()&&(this.requirePrefetcher(),S.startFolderPrefetch(n))},i.prototype.searchMessagesInCurrentFolder=function(e){var t=this.folderList().currentFolderFullName()||"INBOX",s=this.currentMessage()?this.currentMessage().uid():"",i=this.uidList().filters();m.setHash(y.getMailbox(t,1,s,e,i))},i.prototype.searchMessagesInInbox=function(e){m.setHash(y.getMailbox(this.folderList().inboxFolderFullName()||"INBOX",1,"",e,""))},i.prototype.getFolderHash=function(e){return m.buildHashFromArray(y.getMailbox(e,1,"","",""))},i.prototype.countMessages=function(e){var t=[],s=function(e){o.each(e.subfolders(),function(e,i){e.subscribed()&&(t.push(e.unseenMessageCount()),e.subfolders().length&&e.subscribed()&&s(e))},this)};e.expanded()||e.bNamespace?e.subfoldersMessagesCount(0):(s(e),e.subfoldersMessagesCount(o.reduce(t,function(e,t){return e+t},0)))},i.prototype.changeDatesInMessages=function(){o.each(this.oFolderListItems,function(e){o.each(e.oNamedCollection,function(e){o.each(e.oMessages,function(e){e.updateMomentDate()},this)})})},i.prototype.clearMessagesCache=function(e){var t=this.oFolderListItems[e];o.each(t.collection(),function(e){e.markHasChanges(),e.removeAllMessageListsFromCacheIfHasChanges()},this),e===this.currentAccountId()&&this.messages([])},i.prototype.getTemplateFolder=function(){var e=this.folderList(),t="",s=e.currentFolder()?e.currentFolder().fullName():"";return h.isNonEmptyArray(this.getCurrentTemplateFolders())&&(t=-1!==n.inArray(s,this.getCurrentTemplateFolders())?s:o.find(this.getCurrentTemplateFolders(),function(t){return!!e.oNamedCollection[t]})),"string"==typeof t?t:""},i.prototype.getCurrentTemplateFolders=function(){return F.AllowTemplateFolders?this.folderList().aTemplateFolders:[]},i.prototype.changeTemplateFolder=function(e,t){F.AllowTemplateFolders&&this.folderList().changeTemplateFolder(e,t)};var M=new i;p.registerDayOfMonthFunction(o.bind(M.changeDatesInMessages,M)),g.timeFormat.subscribe(M.changeDatesInMessages,M),g.dateFormat.subscribe(M.changeDatesInMessages,M),e.exports=M},317:function(e,t,s){"use strict";var i=s(2),o=s(1),n=s(44),r=s(49),a=[],l=[],h=n.observable(r().date());window.setInterval(function(){i.each(a,function(e){e()}),h(r().date())},6e4),h.subscribe(function(){i.each(l,function(e){e()})},this),e.exports={registerEveryMinuteFunction:function(e){o.isFunction(e)&&a.push(e)},registerDayOfMonthFunction:function(e){o.isFunction(e)&&l.push(e)}}},318:function(e,t,s){"use strict";function i(e){return"p"===e.substr(0,1)&&/^[1-9][\d]*$/.test(e.substr(1))}function o(e){return"msg"===e.substr(0,3)&&/^[1-9][\d]*$/.test(e.substr(3))}var n=s(2),r=s(181),a=s(313),l={};l.getMailbox=function(e,t,i,o,n,l){var h=s(314),c=h.getCurrent(),u=[a.HashModuleName,c?c.hash():""];return t=r.pInt(t,1),i=r.pString(i),o=r.pString(o),n=r.pString(n),e&&""!==e&&u.push(e),n&&""!==n&&u.push("filter:"+n),1<t&&u.push("p"+t),i&&""!==i&&u.push("msg"+i),o&&""!==o&&u.push(o),l&&""!==l&&u.push("custom:"+l),u},l.parseMailbox=function(e,t){var s=e.length>0&&"compose"===e[0]&&"to"===e[1],n=s?[]:e,a="",l="INBOX",h=1,c="",u="",d="",p="",m="",g=0;return r.isNonEmptyArray(n)&&(a=r.pString(n[g]),g++),r.isNonEmptyArray(n)&&(l=r.pString(n[g]),g++,n.length>g&&(m=r.pString(n[g]),m==="filter:"+Enums.FolderFilter.Flagged&&(d=Enums.FolderFilter.Flagged,g++),m==="filter:"+Enums.FolderFilter.Unseen&&(d=Enums.FolderFilter.Unseen,g++)),n.length>g&&(m=r.pString(n[g]),i(m)&&(h=r.pInt(m.substr(1)),h<=0&&(h=1),g++)),n.length>g&&(m=r.pString(n[g]),o(m)&&(c=m.substr(3),g++)),n.length>g&&(m=r.pString(n[g]),"custom:"!==m.substr(0,7)&&(u=m,g++)),n.length>g&&(m=r.pString(n[g]),"custom:"===m.substr(0,7)&&(p=m.substr(7)))),{MailtoCompose:s,AccountHash:a,Folder:""===l?t:l,Page:h,Uid:c,Search:u,Filters:d,Custom:p}},l.getViewMessage=function(e,t){var i=s(314),o=i.getCurrent(),n=o?o.hash():"";return[a.HashModuleName+"-view",n,e,"msg"+t]},l.getCompose=function(){var e=s(314),t=e.getCurrent(),i=t?t.hash():"";return[a.HashModuleName+"-compose",i]},l.getComposeFromMessage=function(e,t,i){var o=s(314),n=o.getCurrent(),r=n?n.hash():"";return[a.HashModuleName+"-compose",r,e,t,i]},l.getComposeWithToField=function(e){var t=s(314),i=t.getCurrent(),o=i?i.hash():"";return[a.HashModuleName+"-compose",o,"to",e]},l.getComposeWithObject=function(e,t){var i=s(314),o=i.getCurrent(),n=o?o.hash():"";return[a.HashModuleName+"-compose",n,e,t]},l.getComposeWithEmlObject=function(e,t,i){var o=s(314),n=o.getCurrent(),r=n?n.hash():"";return[a.HashModuleName+"-compose",r,Enums.ReplyType.ForwardAsAttach,e,t,i]},l.parseCompose=function(e){var t=e.length>0?e[0]:"",s=e.length>1?e[1]:"",i=(s===Enums.ReplyType.ForwardAsAttach||"attachments"===s)&&e.length>2?s===Enums.ReplyType.ForwardAsAttach?e[4]:e[2]:null,o="to"===s&&e.length>2?l.parseToAddr(e[2]):null,n=(s===Enums.ReplyType.Reply||s===Enums.ReplyType.ReplyAll||s===Enums.ReplyType.Resend||s===Enums.ReplyType.Forward||"drafts"===s||s===Enums.ReplyType.ForwardAsAttach)&&e.length>2,r=n?e[2]:"",a=n?e[3]:"";return{AccountHash:t,RouteType:s,ToAddr:o,Object:i,MessageFolderName:r,MessageUid:a}},l.parseToAddr=function(e){var t=decodeURI(r.pString(e)),s=t.indexOf("mailto:")!==-1,i=[],o=[],a="",l="",h="",c="";return s&&(i=t.replace(/^mailto:/,"").split("?"),t=i[0],2===i.length&&(o=i[1].split("&"),n.each(o,function(e){var t=e.split("=");if(2===t.length)switch(t[0].toLowerCase()){case"subject":a=t[1];break;case"cc":l=t[1];break;case"bcc":h=t[1];break;case"body":c=t[1]}}))),{to:t,hasMailto:s,subject:a,cc:l,bcc:h,body:c}},e.exports=l},319:function(e,t,s){"use strict";function i(){this.iAccountId=0,this.initialized=n.observable(!1),this.bExpandFolders=!1,this.expandNames=n.observableArray([]),this.collection=n.observableArray([]),this.options=n.observableArray([]),this.sNamespaceFolder="",this.oStarredFolder=null,this.oNamedCollection={},this.aLinedCollection=[];var e=this,t=function(e){return function(t){t&&t.type(e)}},s=function(t){return{read:function(){return this.collection(),t()?t().fullName():""},write:function(e){t(this.getFolderByFullName(e))},owner:e}};this.currentFolder=n.observable(null),this.inboxFolder=n.observable(null),this.sentFolder=n.observable(null),this.draftsFolder=n.observable(null),this.spamFolder=n.observable(null),this.trashFolder=n.observable(null),this.aTemplateFolders=[],this.countsCompletelyFilled=n.observable(!1),this.inboxFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.sentFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.draftsFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.spamFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.trashFolder.subscribe(t(Enums.FolderTypes.User),this,"beforeChange"),this.inboxFolder.subscribe(t(Enums.FolderTypes.Inbox)),this.sentFolder.subscribe(t(Enums.FolderTypes.Sent)),this.draftsFolder.subscribe(t(Enums.FolderTypes.Drafts)),this.spamFolder.subscribe(t(Enums.FolderTypes.Spam)),this.trashFolder.subscribe(t(Enums.FolderTypes.Trash)),this.inboxFolderFullName=n.computed(s(this.inboxFolder)),this.sentFolderFullName=n.computed(s(this.sentFolder)),this.draftsFolderFullName=n.computed(s(this.draftsFolder)),this.spamFolderFullName=n.computed(s(this.spamFolder)),this.trashFolderFullName=n.computed(s(this.trashFolder)),this.currentFolderFullName=n.computed(s(this.currentFolder)),this.currentFolderType=n.computed(function(){return this.currentFolder()?this.currentFolder().type():Enums.FolderTypes.User},this),this.sDelimiter=""}var o=s(2),n=s(44),r=s(181),a=s(221),l=s(313),h=s(320);i.prototype.getFoldersCount=function(){return this.aLinedCollection.length},i.prototype.getTotalMessageCount=function(){var e=0;return o.each(this.oNamedCollection,function(t){e+=t.messageCount()},this),e},i.prototype.getFoldersWithoutCountInfo=function(){var e=o.compact(o.map(this.oNamedCollection,function(e,t){return e.canBeSelected()&&!e.hasExtendedInfo()?t:null}));return e},i.prototype.getNamesOfFoldersToRefresh=function(){var e=[this.inboxFolderFullName(),this.spamFolderFullName(),this.currentFolderFullName()];return o.each(this.oNamedCollection,function(t){t.isAlwaysRefresh()&&e.push(t.fullName())}),o.uniq(e)},i.prototype.setCurrentFolder=function(e,t){var s=this.getFolderByFullName(e);null!==s&&s.canBeSelected()||(s=this.inboxFolder()),null!==s&&(this.currentFolder()&&(this.currentFolder().selected(!1),this.oStarredFolder&&this.oStarredFolder.selected(!1)),this.currentFolder(s),t===Enums.FolderFilter.Flagged?this.oStarredFolder&&this.oStarredFolder.selected(!0):this.currentFolder().selected(!0))},i.prototype.getFolderByFullName=function(e){var t=this.oNamedCollection[e];return t?t:null},i.prototype.renameFolder=function(e,t,s){var i=this.oNamedCollection[e];i.fullName(t),i.fullNameHash(s),this.oNamedCollection[t]=i,this.oNamedCollection[e]=void 0},i.prototype.changeTemplateFolder=function(e,t){l.AllowTemplateFolders&&(t?this.aTemplateFolders.push(e):this.aTemplateFolders=o.without(this.aTemplateFolders,e))},i.prototype.parse=function(e,t,s){var i=r.pString(t.Namespace),o=t.Folders["@Collection"];i.length>0&&(this.sNamespaceFolder=i.substring(0,i.length-1)),this.iAccountId=e,this.initialized(!0),this.bExpandFolders=l.AllowExpandFolders&&!a.hasData("folderAccordion"),a.hasData("folderAccordion")||a.setData("folderAccordion",[]),this.oNamedCollection={},this.aLinedCollection=[],this.collection(this.parseRecursively(o,s))},i.prototype.parseRecursively=function(e,t,s,i){var n=[],l=0,c=0,u=null,d=null,p="",m=null,g=[];if(i=i||"",void 0===s&&(s=-1),s++,o.isArray(e)){for(c=e.length;l<c;l++){switch(p=r.pString(e[l].FullNameRaw),d=t[p],u=new h(this.iAccountId),m=u.parse(e[l],i,this.sNamespaceFolder),d&&d.hasExtendedInfo()&&!u.hasExtendedInfo()&&u.setRelevantInformation(d.sUidNext,d.sHash,d.messageCount(),d.unseenMessageCount(),!1),this.bExpandFolders&&null!==m&&(u.expanded(!0),this.expandNames().push(r.pString(e[l].Name))),u.setLevel(s),u.type()){case Enums.FolderTypes.Inbox:this.inboxFolder(u),this.sDelimiter=u.sDelimiter;break;case Enums.FolderTypes.Sent:this.sentFolder(u);break;case Enums.FolderTypes.Drafts:this.draftsFolder(u);break;case Enums.FolderTypes.Trash:this.trashFolder(u);break;case Enums.FolderTypes.Spam:this.spamFolder(u);break;case Enums.FolderTypes.Template:this.aTemplateFolders.push(u.fullName())}this.oNamedCollection[u.fullName()]=u,this.aLinedCollection.push(u),n.push(u),null===m&&u.type()===Enums.FolderTypes.Inbox?(this.createStarredFolder(u.fullName(),s),this.oStarredFolder&&n.push(this.oStarredFolder)):null!==m&&(g=this.parseRecursively(m["@Collection"],t,s,u.fullName()),u.type()===Enums.FolderTypes.Inbox&&(u.bNamespace?(this.createStarredFolder(u.fullName(),s+1),this.oStarredFolder&&g.unshift(this.oStarredFolder)):(this.createStarredFolder(u.fullName(),s),this.oStarredFolder&&n.push(this.oStarredFolder))),u.subfolders(g))}this.bExpandFolders&&a.setData("folderAccordion",this.expandNames())}return n},i.prototype.createStarredFolder=function(e,t){this.oStarredFolder=new h(this.iAccountId),this.oStarredFolder.initStarredFolder(t,e)},i.prototype.repopulateLinedCollection=function(){function e(s){o.each(s,function(s){t.aLinedCollection.push(s),s.subfolders().length>0&&e(s.subfolders())})}var t=this;return this.aLinedCollection=[],e(this.collection()),this.aLinedCollection},i.prototype.getOptions=function(e,t,s,i,n){t=!!t,s=!!s,i=!!i,n=!!n;var r="",a=[];return o.each(this.aLinedCollection,function(e){if(e&&!e.bVirtual&&(!s||Enums.FolderTypes.Inbox!==e.type())&&(!n||e.subscribed())){var o=Array(e.iLevel+1).join(r);a.push({name:e.name(),fullName:e.fullName(),displayName:o+e.name(),translatedDisplayName:o+e.displayName(),disable:!t&&e.isSystem()||!i&&!e.canBeSelected()})}}),""!==e&&a.unshift({name:e,fullName:"",displayName:e,translatedDisplayName:e,disable:!1}),a},e.exports=i},320:function(e,t,s){"use strict";function i(e){this.iAccountId=e,this.bNamespace=!1,this.iLevel=0,this.bIgnoreImapSubscription=A.IgnoreImapSubscription,this.bAllowTemplateFolders=A.AllowTemplateFolders,this.isTemplateStorage=r.observable(!1),this.bAllowAlwaysRefreshFolders=A.AllowAlwaysRefreshFolders,this.isAlwaysRefresh=r.observable(!1),this.sDelimiter="",this.bExists=!0,this.sUidNext="",this.sHash="",this.messageCount=r.observable(0),this.unseenMessageCount=r.observable(0),this.sRealUnseenMessageCount=0,this.hasExtendedInfo=r.observable(!1),this.fullName=r.observable(""),this.fullNameHash=r.observable(""),this.bSelectable=!0,this.subscribed=r.observable(!0),this.name=r.observable(""),this.nameForEdit=r.observable(""),this.subfolders=r.observableArray([]),this.subfoldersMessagesCount=r.observable(0),this.type=r.observable(Enums.FolderTypes.User),this.bVirtual=!1,this.selected=r.observable(!1),this.expanded=r.observable(!1),this.recivedAnim=r.observable(!1).extend({autoResetToFalse:500}),this.edited=r.observable(!1),this.oMessages={},this.oUids={},this.aResponseHandlers=[],this.aRequestedUids=[],this.aRequestedThreadUids=[],this.requestedLists=[],this.hasChanges=r.observable(!1),this.relevantInformationLastMoment=null}var o=s(2),n=s(1),r=s(44),a=s(49),l=s(185),h=s(181),c=s(315),u=s(186),d=s(182),p=s(195),m=s(221),g=s(192),f=s(201),b=s(318),v=s(314),y=null,A=s(313),E=s(321),S=s(328);i.prototype.requireMailCache=function(){null===y&&(y=s(316))},i.prototype.setLevel=function(e){this.iLevel=e},i.prototype.getMessageByUid=function(e){return this.oMessages[e]},i.prototype.getFlaggedMessageUids=function(){var e=[];return o.each(this.oMessages,function(t){t.flagged()&&e.push(t.uid())}),e},i.prototype.setMessageUnflaggedByUid=function(e){var t=this.oMessages[e];t&&t.flagged(!1)},i.prototype.hideThreadMessages=function(e){o.each(e.threadUids(),function(e){var t=this.oMessages[e];t&&(t.deleted()||(t.threadShowAnimation(!1),t.threadHideAnimation(!0),setTimeout(function(){t.threadHideAnimation(!1)},1e3)))},this)},i.prototype.getThreadMessages=function(e){var t=[],s=[],i=[],n=0,r=null,a=50;return o.each(e.threadUids(),function(o){if(n<e.threadCountForLoad()){var l=this.oMessages[o];l?l.deleted()||(l.markAsThreadPart(a,e.uid()),t.push(l),i.push(l.uid()),n++,r=l):(s.push(o),i.push(o),n++)}else i.push(o)},this),e.threadLoading()||this.loadThreadMessages(s),e.changeThreadUids(i,t.length),r&&t.length<e.threadUids().length&&r.showNextLoadingLink(o.bind(e.increaseThreadCountForLoad,e)),this.addThreadUidsToUidLists(e.uid(),e.threadUids()),t},i.prototype.computeThreadData=function(e){var t=0,s=!1,i=[],r=[],a=e.oFrom.getFirstEmail();o.each(e.threadUids(),function(e){var o=this.oMessages[e],h="";o&&!o.deleted()&&(o.seen()||t++,o.flagged()&&(s=!0),h=o.oFrom.getFirstEmail(),h!==a&&-1===n.inArray(h,r)&&(r.push(h),h===v.getEmail()?i.push(l.i18n("MAILWEBCLIENT/LABEL_ME_SENDER")):i.push(o.oFrom.getFirstDisplay())))},this),e.threadUnreadCount(t),e.partialFlagged(s)},i.prototype.addThreadUidsToUidLists=function(e,t){o.each(this.oUids,function(s){o.each(s,function(s){s.addThreadUids(e,t)})})},i.prototype.loadThreadMessages=function(e){if(e.length>0){var t={Folder:this.fullName(),Uids:e};c.send("GetMessagesByUids",t,this.onGetMessagesByUidsResponse,this)}},i.prototype.getThreadCheckedUidsFromList=function(e){var t=this,s=[];return o.each(e,function(e){e.threadCount()>0&&!e.threadOpened()&&o.each(e.threadUids(),function(e){var i=t.oMessages[e];i&&!i.deleted()&&i.checked()&&s.push(e)})}),s},i.prototype.parseAndCacheMessage=function(e,t,s){var i=""+e.Uid,o=!this.oMessages[i],n=o?new E:this.oMessages[i];return n.parse(e,this.iAccountId,t,s),this.type()===Enums.FolderTypes.Inbox&&o&&n.flagged()&&(this.requireMailCache(),y.increaseStarredCount()),this.oMessages[n.uid()]=n,n},i.prototype.onGetMessagesByUidsResponse=function(e,t){var s=e.Result;s&&"Collection/MessageCollection"===s["@Object"]&&(o.each(s["@Collection"],function(e){this.parseAndCacheMessage(e,!0,!0)},this),this.requireMailCache(),y.showOpenedThreads(this.fullName()))},i.prototype.addRequestedUids=function(e){this.aRequestedUids=o.union(this.aRequestedUids,e)},i.prototype.hasUidBeenRequested=function(e){return o.indexOf(this.aRequestedUids,e)!==-1},i.prototype.addRequestedThreadUids=function(e){this.aRequestedThreadUids=o.union(this.aRequestedThreadUids,e)},i.prototype.hasThreadUidBeenRequested=function(e){return o.indexOf(this.aRequestedThreadUids,e)!==-1},i.prototype.hasListBeenRequested=function(e){var t=o.where(this.requestedLists,e),s=t.length>0;return s||this.requestedLists.push(e),s},i.prototype.markMessageReplied=function(e,t){var s=this.oMessages[e];if(s)switch(t){case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:s.answered(!0);break;case Enums.ReplyType.Forward:case Enums.ReplyType.ForwardAsAttach:s.forwarded(!0)}},i.prototype.removeAllMessages=function(){var e=null;this.oMessages={},this.oUids={},this.messageCount(0),this.unseenMessageCount(0),this.sRealUnseenMessageCount=0,e=this.getUidList("",""),e.resultCount(0)},i.prototype.removeAllMessageListsFromCacheIfHasChanges=function(){this.hasChanges()&&(this.oUids={},this.requestedLists=[],this.aRequestedThreadUids=[],this.hasChanges(!1))},i.prototype.removeFlaggedMessageListsFromCache=function(){o.each(this.oUids,function(e,t){delete this.oUids[t][Enums.FolderFilter.Flagged]},this)},i.prototype.removeUnseenMessageListsFromCache=function(){o.each(this.oUids,function(e,t){delete this.oUids[t][Enums.FolderFilter.Unseen]},this)},i.prototype.setRelevantInformation=function(e,t,s,i,o){var n=this.hasExtendedInfo()&&(this.sHash!==t||this.sRealUnseenMessageCount!==i);return o||(this.sUidNext=e),this.sHash=t,this.hasExtendedInfo()&&o||(this.messageCount(s),this.unseenMessageCount(i),0===i&&this.unseenMessageCount.valueHasMutated()),this.sRealUnseenMessageCount=i,this.hasExtendedInfo(!0),n&&this.markHasChanges(),this.relevantInformationLastMoment=a(),n},i.prototype.increaseCountIfHasNotInfo=function(){this.hasExtendedInfo()||this.messageCount(this.messageCount()+1)},i.prototype.markHasChanges=function(){this.hasChanges(!0)},i.prototype.addMessagesCountsDiff=function(e,t){var s=this.messageCount()+e,i=this.unseenMessageCount()+t;s<0&&(s=0),this.messageCount(s),i<0&&(i=0),i>s&&(i=s),this.unseenMessageCount(i)},i.prototype.markDeletedByUids=function(e){var t=0,s=0;return o.each(e,function(e){var i=this.oMessages[e];i&&(t++,i.seen()||s++,i.deleted(!0))},this),this.addMessagesCountsDiff(-t,-s),{MinusDiff:t,UnseenMinusDiff:s}},i.prototype.revertDeleted=function(e){var t=0,s=0;return o.each(e,function(e){var i=this.oMessages[e];i&&i.deleted()&&(t++,i.seen()||s++,i.deleted(!1))},this),this.addMessagesCountsDiff(t,s),{PlusDiff:t,UnseenPlusDiff:s}},i.prototype.commitDeleted=function(e){o.each(e,o.bind(function(e){delete this.oMessages[e]},this)),o.each(this.oUids,function(t){o.each(t,function(t){t.deleteUids(e)})})},i.prototype.getUidList=function(e,t){var s=null;return void 0===this.oUids[e]&&(this.oUids[e]={}),void 0===this.oUids[e][t]&&(s=new S,s.search(e),s.filters(t),this.oUids[e][t]=s),this.oUids[e][t]},i.prototype.initStarredFolder=function(e,t){this.bVirtual=!0,this.setLevel(e),this.fullName(t),this.name(l.i18n("MAILWEBCLIENT/LABEL_FOLDER_STARRED")),this.type(Enums.FolderTypes.Starred),this.initSubscriptions(""),this.initComputedFields(!0)},i.prototype.parse=function(e,t,s){var i="",n=Enums.FolderTypes.User,r=m.getData("folderAccordion")||[];return"Object/Folder"===e["@Object"]?(i=h.pString(e.Name),this.name(i),this.nameForEdit(i),this.fullName(h.pString(e.FullNameRaw)),this.fullNameHash(h.pString(e.FullNameHash)),this.sDelimiter=e.Delimiter,n=h.pInt(e.Type),A.AllowTemplateFolders||n!==Enums.FolderTypes.Template||(n=Enums.FolderTypes.User),(A.AllowSpamFolder||n!==Enums.FolderTypes.Spam)&&this.type(n),this.isTemplateStorage(this.type()===Enums.FolderTypes.Template),this.bNamespace=s===this.fullName(),this.isAlwaysRefresh(A.AllowAlwaysRefreshFolders&&!!e.AlwaysRefresh),this.subscribed(!!A.IgnoreImapSubscription||e.IsSubscribed),this.bSelectable=e.IsSelectable,this.bExists=e.Exists,e.Extended&&this.setRelevantInformation(""+e.Extended.UidNext,e.Extended.Hash,e.Extended.MessageCount,e.Extended.MessageUnseenCount,!1),o.find(r,function(e){return e===this.name()},this)&&this.expanded(!0),this.initSubscriptions(t),this.initComputedFields(),d.broadcastEvent("MailWebclient::ParseFolder::after",this),e.SubFolders):null},i.prototype.initSubscriptions=function(e){this.requireMailCache(),this.unseenMessageCount.subscribe(function(){o.delay(o.bind(function(){y.countMessages(this)},this),1e3)},this),this.subscribed.subscribe(function(){if(e){var t=y.folderList().getFolderByFullName(e);t&&y.countMessages(t)}},this),this.edited.subscribe(function(e){e===!1&&this.nameForEdit(this.name())},this),this.hasChanges.subscribe(function(){this.requestedLists=[]},this)},i.prototype.initComputedFields=function(){this.routingHash=r.computed(function(){return this.bVirtual?p.buildHashFromArray(b.getMailbox(this.fullName(),1,"","",Enums.FolderFilter.Flagged)):p.buildHashFromArray(b.getMailbox(this.fullName()))},this),this.isSystem=r.computed(function(){return this.type()!==Enums.FolderTypes.User},this),this.withoutThreads=r.computed(function(){return this.type()===Enums.FolderTypes.Drafts||this.type()===Enums.FolderTypes.Spam||this.type()===Enums.FolderTypes.Trash},this),this.enableEmptyFolder=r.computed(function(){return(this.type()===Enums.FolderTypes.Spam||this.type()===Enums.FolderTypes.Trash)&&this.messageCount()>0},this),this.virtualEmpty=r.computed(function(){return this.bVirtual&&0===this.messageCount()},this),this.hasSubscribedSubfolders=r.computed(function(){return o.any(this.subfolders(),function(e){return e.subscribed()})},this),this.canExpand=r.computed(function(){return!this.bNamespace&&this.hasSubscribedSubfolders()},this),this.unseenMessagesCountToShow=r.computed(function(){return!d.isMobile()&&this.canExpand()?this.unseenMessageCount()+this.subfoldersMessagesCount():this.unseenMessageCount()},this),this.showUnseenMessagesCount=r.computed(function(){return this.unseenMessagesCountToShow()>0&&this.type()!==Enums.FolderTypes.Drafts},this),this.showMessagesCount=r.computed(function(){return this.messageCount()>0&&(this.type()===Enums.FolderTypes.Drafts||A.AllowShowMessagesCountInFolderList&&A.showMessagesCountInFolderList())},this),this.visible=r.computed(function(){return this.subscribed()||this.isSystem()||this.hasSubscribedSubfolders()},this),this.canBeSelected=r.computed(function(){return this.bExists&&this.bSelectable&&this.subscribed()},this),this.canSubscribe=r.computed(function(){return!A.IgnoreImapSubscription&&!this.isSystem()&&this.bExists&&this.bSelectable},this),this.canDelete=r.computed(function(){return!this.isSystem()&&this.hasExtendedInfo()&&0===this.messageCount()&&0===this.subfolders().length},this),this.canRename=this.canSubscribe,this.visibleTemplateTrigger=r.computed(function(){return A.AllowTemplateFolders&&(this.bSelectable&&!this.isSystem()||this.isTemplateStorage())},this),this.templateButtonHint=r.computed(function(){return this.visibleTemplateTrigger()?this.isTemplateStorage()?l.i18n("MAILWEBCLIENT/ACTION_TURN_TEMPLATE_FOLDER_OFF"):l.i18n("MAILWEBCLIENT/ACTION_TURN_TEMPLATE_FOLDER_ON"):""},this),this.alwaysRefreshButtonHint=r.computed(function(){return A.AllowAlwaysRefreshFolders?this.isAlwaysRefresh()?l.i18n("MAILWEBCLIENT/ACTION_TURN_ALWAYS_REFRESH_OFF"):l.i18n("MAILWEBCLIENT/ACTION_TURN_ALWAYS_REFRESH_ON"):""},this),this.subscribeButtonHint=r.computed(function(){return this.canSubscribe()?this.subscribed()?l.i18n("MAILWEBCLIENT/ACTION_HIDE_FOLDER"):l.i18n("MAILWEBCLIENT/ACTION_SHOW_FOLDER"):""},this),this.deleteButtonHint=r.computed(function(){return this.canDelete()?l.i18n("MAILWEBCLIENT/ACTION_DELETE_FOLDER"):""},this),this.usedAs=r.computed(function(){switch(this.type()){case Enums.FolderTypes.Inbox:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_INBOX");case Enums.FolderTypes.Sent:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_SENT");case Enums.FolderTypes.Drafts:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_DRAFTS");case Enums.FolderTypes.Trash:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_TRASH");case Enums.FolderTypes.Spam:return l.i18n("MAILWEBCLIENT/LABEL_USED_AS_SPAM")}return""},this),this.displayName=r.computed(function(){switch(this.type()){case Enums.FolderTypes.Inbox:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_INBOX");case Enums.FolderTypes.Sent:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_SENT");case Enums.FolderTypes.Drafts:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_DRAFTS");case Enums.FolderTypes.Trash:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_TRASH");case Enums.FolderTypes.Spam:return l.i18n("MAILWEBCLIENT/LABEL_FOLDER_SPAM")}return this.name()},this)},i.prototype.onGetMessageResponse=function(e,t){var s=e.Result,i=t.Parameters,o=null,n=s?""+s.Uid:""+i.Uid,r=this.oMessages[n],a=!!r&&r.selected(),h=!1;s?r=this.parseAndCacheMessage(s,!1,!1):(a&&(u.showErrorByCode(e,l.i18n("COREWEBCLIENT/ERROR_UNKNOWN")),p.replaceHashWithoutMessageUid(n)),r=null,h=!0),o=this.aResponseHandlers[n],o&&(o.handler.call(o.context,r,n,h?e:null),delete this.aResponseHandlers[n])},i.prototype.getCompletelyFilledMessage=function(e,t,s){var i=this.oMessages[e],o={AccountID:i?i.accountId():0,Folder:this.fullName(),Uid:e,MessageBodyTruncationThreshold:A.MessageBodyTruncationThreshold};e.length>0&&(i&&i.completelyFilled()&&!i.truncated()?t&&s&&t.call(s,i,e):(t&&s&&(this.aResponseHandlers[e]={handler:t,context:s}),c.send("GetMessage",o,this.onGetMessageResponse,this)))},i.prototype.showExternalPictures=function(e){var t=this.oMessages[e];void 0!==t&&t.showExternalPictures()},i.prototype.alwaysShowExternalPicturesForSender=function(e){o.each(this.oMessages,function(t){var s=t.oFrom.aCollection;s.length>0&&s[0].sEmail===e&&t.alwaysShowExternalPicturesForSender()},this)},i.prototype.executeGroupOperation=function(e,t,s){var i=0;o.each(this.oMessages,function(n){t.length>0?o.each(t,function(t){n&&n.uid()===t&&n[e]()!==s&&(n[e](s),i++)}):n[e](s)}),0===t.length&&(i=s?this.unseenMessageCount():this.messageCount()-this.unseenMessageCount()),"seen"===e&&i>0&&(s?this.addMessagesCountsDiff(0,-i):this.addMessagesCountsDiff(0,i),this.markHasChanges())},i.prototype.emptyFolder=function(){var e=l.i18n("MAILWEBCLIENT/CONFIRM_EMPTY_FOLDER"),t=o.bind(this.clearFolder,this);this.enableEmptyFolder()&&g.showPopup(f,[e,t])},i.prototype.clearFolder=function(e){this.enableEmptyFolder()&&e&&(c.send("ClearFolder",{Folder:this.fullName()}),this.removeAllMessages(),this.requireMailCache(),y.onClearFolder(this))},i.prototype.onAccordion=function(e,t){var s=!this.expanded(),i=m.getData("folderAccordion")||[];s?i.push(this.name()):i=o.reject(i,function(e){return e===this.name()},this),m.setData("folderAccordion",i),this.expanded(s),this.requireMailCache(),y.countMessages(this),t&&t.stopPropagation()},i.prototype.executeUnseenFilter=function(){var e=!1;return this.unseenMessagesCountToShow()>this.unseenMessageCount()&&this.onAccordion(),!(this.unseenMessageCount()>0)||(this.requireMailCache(),y.waitForUnseenMessages(!0),e=p.setHash(b.getMailbox(this.fullName(),1,"","",Enums.FolderFilter.Unseen)),e&&y.changeCurrentMessageList(this.fullName(),1,"",Enums.FolderFilter.Unseen),!1)},i.prototype.onDeleteClick=function(){var e=l.i18n("MAILWEBCLIENT/CONFIRM_DELETE_FOLDER"),t=o.bind(this.deleteAfterConfirm,this);this.canDelete()?g.showPopup(f,[e,t]):d.broadcastEvent("MailWebclient::AttemptDeleteNonemptyFolder")},i.prototype.deleteAfterConfirm=function(e){if(e){var t=y.editedFolderList(),s=this.fullName(),i=function(e){return s===e.fullName()||(e.subfolders.remove(i),!1)};t.collection.remove(i),c.send("DeleteFolder",{AccountID:v.editedId(),Folder:this.fullName()},function(e){e.Result||(u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_DELETE_FOLDER")),y.getFolderList(v.editedId()))},this)}},i.prototype.onSubscribeClick=function(){if(this.canSubscribe()){var e={AccountID:v.editedId(),Folder:this.fullName(),SetAction:!this.subscribed()};this.subscribed(!this.subscribed()),c.send("SubscribeFolder",e,function(e){e.Result||(this.subscribed()?u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_SUBSCRIBE_FOLDER")):u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_UNSUBSCRIBE_FOLDER")),y.getFolderList(v.editedId()))},this)}},i.prototype.afterMove=function(e){o.each(e,function(e){"CAccountFoldersPaneView"===e.constructor.name&&e.afterMove();
})},i.prototype.cancelNameEdit=function(){this.edited(!1)},i.prototype.applyNameEdit=function(){if(this.name()!==this.nameForEdit()){var e={AccountID:v.editedId(),PrevFolderFullNameRaw:this.fullName(),NewFolderNameInUtf8:this.nameForEdit()};c.send("RenameFolder",e,o.bind(this.onResponseFolderRename,this),this),this.name(this.nameForEdit())}this.edited(!1)},i.prototype.onResponseFolderRename=function(e,t){if(e&&e.Result){if(e&&e.Result&&e.Result.FullName){var s=y.editedFolderList();s.renameFolder(this.fullName(),e.Result.FullName,e.Result.FullNameHash)}}else u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_RENAME_FOLDER")),y.getFolderList(v.editedId())},i.prototype.triggerTemplateState=function(){if(this.visibleTemplateTrigger()){this.isTemplateStorage()?(this.type(Enums.FolderTypes.User),this.isTemplateStorage(!1)):(this.type(Enums.FolderTypes.Template),this.isTemplateStorage(!0)),y.changeTemplateFolder(this.fullName(),this.isTemplateStorage());var e={FolderFullName:this.fullName(),SetTemplate:this.isTemplateStorage()};c.send("SetTemplateFolderType",e,this.onSetTemplateFolderType,this)}},i.prototype.onSetTemplateFolderType=function(e){e.Result||(u.showErrorByCode(e,l.i18n("MAILWEBCLIENT/ERROR_SETUP_SPECIAL_FOLDERS")),y.getFolderList(v.editedId()))},i.prototype.triggerAlwaysRefreshState=function(){if(A.AllowAlwaysRefreshFolders){this.isAlwaysRefresh(!this.isAlwaysRefresh());var e={AccountID:this.iAccountId,FolderFullName:this.fullName(),AlwaysRefresh:this.isAlwaysRefresh()};c.send("SetAlwaysRefreshFolder",e,this.onSetAlwaysRefreshFolder,this)}},i.prototype.onSetAlwaysRefreshFolder=function(e){e.Result||(u.showErrorByCode(e),y.getFolderList(v.editedId()))},e.exports=i},321:function(e,t,s){"use strict";function i(){this.accountId=r.observable(g.currentId()),this.folder=r.observable(""),this.uid=r.observable(""),this.sUniq="",this.subject=r.observable(""),this.emptySubject=r.computed(function(){return""===n.trim(this.subject())},this),this.subjectForDisplay=r.computed(function(){return this.emptySubject()?l.i18n("MAILWEBCLIENT/LABEL_NO_SUBJECT"):this.subject()},this),this.messageId=r.observable(""),this.size=r.observable(0),this.friendlySize=r.computed(function(){return l.getFriendlySize(this.size())},this),this.textSize=r.observable(0),this.oDateModel=new p,this.fullDate=r.observable(""),this.oFrom=new d,this.fullFrom=r.observable(""),this.oTo=new d,this.to=r.observable(""),this.fromOrToText=r.observable(""),this.oCc=new d,this.cc=r.observable(""),this.oBcc=new d,this.bcc=r.observable(""),this.oReplyTo=new d,this.seen=r.observable(!1),this.flagged=r.observable(!1),this.partialFlagged=r.observable(!1),this.answered=r.observable(!1),this.forwarded=r.observable(!1),this.hasAttachments=r.observable(!1),this.hasIcalAttachment=r.observable(!1),this.hasVcardAttachment=r.observable(!1),this.folderObject=r.computed(function(){return this.requireMailCache(),f.getFolderByFullName(this.accountId(),this.folder())},this),this.threadsAllowed=r.computed(function(){var e=g.getAccount(this.accountId()),t=this.folderObject(),s=t&&(t.type()===Enums.FolderTypes.Drafts||t.type()===Enums.FolderTypes.Spam||t.type()===Enums.FolderTypes.Trash);return e&&e.threadingIsAvailable()&&!s},this),this.otherSendersAllowed=r.computed(function(){var e=this.folderObject();return e&&e.type()!==Enums.FolderTypes.Drafts&&e.type()!==Enums.FolderTypes.Sent},this),this.threadPart=r.observable(!1),this.threadPart.subscribe(function(){this.threadPart()&&this.partialFlagged(!1)},this),this.threadParentUid=r.observable(""),this.threadUids=r.observableArray([]),this.threadCount=r.computed(function(){return this.threadUids().length},this),this.threadUnreadCount=r.observable(0),this.threadOpened=r.observable(!1),this.threadLoading=r.observable(!1),this.threadLoadingVisible=r.computed(function(){return this.threadsAllowed()&&this.threadOpened()&&this.threadLoading()},this),this.threadCountVisible=r.computed(function(){return this.threadsAllowed()&&this.threadCount()>0&&!this.threadLoading()},this),this.threadCountHint=r.computed(function(){return this.threadCount()>0?this.threadOpened()?l.i18n("MAILWEBCLIENT/ACTION_FOLD_THREAD"):this.threadUnreadCount()>0?l.i18n("MAILWEBCLIENT/ACTION_UNFOLD_THREAD_WITH_UNREAD",{},null,this.threadUnreadCount()):l.i18n("MAILWEBCLIENT/ACTION_UNFOLD_THREAD"):""},this),this.threadCountForLoad=r.observable(5),this.threadNextLoadingVisible=r.observable(!1),this.threadNextLoadingLinkVisible=r.observable(!1),this.threadFunctionLoadNext=null,this.threadShowAnimation=r.observable(!1),this.threadHideAnimation=r.observable(!1),this.importance=r.observable(Enums.Importance.Normal),this.draftInfo=r.observableArray([]),this.hash=r.observable(""),this.sDownloadAsEmlUrl="",this.completelyFilled=r.observable(!1),this.checked=r.observable(!1),this.checked.subscribe(function(e){if(this.requireMailCache(),!this.threadOpened()&&f.useThreadingInCurrentList()){var t=f.folderList().getFolderByFullName(this.folder());o.each(this.threadUids(),function(s){var i=t.oMessages[s];i&&i.checked(e)})}},this),this.selected=r.observable(!1),this.deleted=r.observable(!1),this.truncated=r.observable(!1),this.inReplyTo=r.observable(""),this.references=r.observable(""),this.readingConfirmationAddressee=r.observable(""),this.sensitivity=r.observable(Enums.Sensitivity.Nothing),this.isPlain=r.observable(!1),this.text=r.observable(""),this.textBodyForNewWindow=r.observable(""),this.$text=null,this.rtl=r.observable(!1),this.hasExternals=r.observable(!1),this.isExternalsShown=r.observable(!1),this.isExternalsAlwaysShown=r.observable(!1),this.foundCids=r.observableArray([]),this.attachments=r.observableArray([]),this.safety=r.observable(!1),this.sourceHeaders=r.observable(""),this.date=r.observable(""),this.textRaw=r.observable(""),this.domMessageForPrint=r.observable(null),this.Custom={}}var o=s(2),n=s(1),r=s(44),a=s(49),l=(s(322),s(185)),h=s(181),c=s(179),u=(s(315),s(188)),d=s(323),p=s(265),m=s(325),g=s(314),f=null,b=(s(313),s(326)),v=s(182);i.prototype.requireMailCache=function(){null===f&&(f=s(316))},i.prototype.viewMessage=function(e){var t=this.getDomText(c.getAppPath()),s="";this.textBodyForNewWindow(t.html()),s=n(this.domMessageForPrint()).html(),e&&(n(e.document.body).html(s),e.focus(),o.each(this.attachments(),function(t){var s=n(e.document.body).find("[data-hash='download-"+t.hash()+"']");t.hasAction("download")?s.on("click",o.bind(t.executeAction,t,"download")):s.hide(),s=n(e.document.body).find("[data-hash='view-"+t.hash()+"']"),t.hasAction("view")?s.on("click",o.bind(t.executeAction,t,"view")):s.hide()},this))},i.prototype.fillFromOrToText=function(){this.requireMailCache();var e=f.getFolderByFullName(this.accountId(),this.folder()),t=g.getAccount(this.accountId());e.type()===Enums.FolderTypes.Drafts||e.type()===Enums.FolderTypes.Sent?this.fromOrToText(this.oTo.getDisplay(l.i18n("MAILWEBCLIENT/LABEL_ME_RECIPIENT"),t.email())):this.fromOrToText(this.oFrom.getDisplay(l.i18n("MAILWEBCLIENT/LABEL_ME_SENDER"),t.email()))},i.prototype.changeThreadUids=function(e,t){this.threadUids(e),this.threadLoading(t<Math.min(this.threadUids().length,this.threadCountForLoad()))},i.prototype.showNextLoadingLink=function(e){this.threadNextLoadingLinkVisible()&&(this.threadNextLoadingVisible(!0),this.threadFunctionLoadNext=e)},i.prototype.increaseThreadCountForLoad=function(){this.threadCountForLoad(this.threadCountForLoad()+5),this.requireMailCache(),f.showOpenedThreads(this.folder())},i.prototype.loadNextMessages=function(){this.threadFunctionLoadNext&&(this.threadFunctionLoadNext(),this.threadNextLoadingLinkVisible(!1),this.threadFunctionLoadNext=null)},i.prototype.markAsThreadPart=function(e,t){var s=this;this.threadPart(!0),this.threadParentUid(t),this.threadUids([]),this.threadNextLoadingVisible(!1),this.threadNextLoadingLinkVisible(!0),this.threadFunctionLoadNext=null,this.threadHideAnimation(!1),setTimeout(function(){s.threadShowAnimation(!0)},e)},i.prototype.parse=function(e,t,s,i){var n="",r="";i&&this.threadPart(s),this.threadPart()||this.threadParentUid(""),"Object/MessageListItem"===e["@Object"]&&(this.seen(!!e.IsSeen),this.flagged(!!e.IsFlagged),this.answered(!!e.IsAnswered),this.forwarded(!!e.IsForwarded),e.Custom&&(this.Custom=e.Custom)),"Object/Message"!==e["@Object"]&&"Object/MessageListItem"!==e["@Object"]||(this.Custom.Sensitivity=e.Sensitivity,this.accountId(t),this.folder(e.Folder),this.uid(h.pString(e.Uid)),this.sUniq=this.accountId()+this.folder()+this.uid(),this.subject(h.pString(e.Subject)),this.messageId(h.pString(e.MessageId)),this.size(e.Size),this.textSize(e.TextSize),this.oDateModel.parse(e.TimeStampInUTC),this.oFrom.parse(e.From),this.oTo.parse(e.To),this.fillFromOrToText(),this.oCc.parse(e.Cc),this.oBcc.parse(e.Bcc),this.oReplyTo.parse(e.ReplyTo),this.fullDate(this.oDateModel.getFullDate()),this.fullFrom(this.oFrom.getFull()),this.to(this.oTo.getFull()),this.cc(this.oCc.getFull()),this.bcc(this.oBcc.getFull()),this.hasAttachments(!!e.HasAttachments),this.hasIcalAttachment(!!e.HasIcalAttachment),this.hasVcardAttachment(!!e.HasVcardAttachment),"Object/MessageListItem"===e["@Object"]&&i&&this.threadUids(o.map(e.Threads,function(e){return""+e},this)),this.importance(h.pInt(e.Importance)),Enums.has("Importance",this.importance())||this.importance(Enums.Importance.Normal),this.sensitivity(h.pInt(e.Sensitivity)),Enums.has("Sensitivity",this.sensitivity())||this.sensitivity(Enums.Sensitivity.Nothing),o.isArray(e.DraftInfo)&&this.draftInfo(e.DraftInfo),this.hash(h.pString(e.Hash)),this.sDownloadAsEmlUrl=h.pString(e.DownloadAsEmlUrl),"Object/Message"===e["@Object"]&&(this.truncated(e.Truncated),this.inReplyTo(e.InReplyTo),this.references(e.References),this.readingConfirmationAddressee(h.pString(e.ReadingConfirmationAddressee)),n=h.pString(e.Html),r=h.pString(e.Plain),""!==n?(this.textRaw(e.HtmlRaw),this.text(n),this.isPlain(!1)):(this.textRaw(e.PlainRaw),this.text(""!==r?"<div>"+r+"</div>":""),this.isPlain(!0)),this.$text=null,this.isExternalsShown(!1),this.rtl(e.Rtl),this.hasExternals(!!e.HasExternals),this.foundCids(e.FoundedCIDs),this.parseAttachments(e.Attachments,t),this.safety(e.Safety),this.sourceHeaders(e.Headers),this.aExtend=e.Extend,this.completelyFilled(!0),v.broadcastEvent("MailWebclient::ParseMessage::after",{msg:this})),this.updateMomentDate())},i.prototype.updateMomentDate=function(){this.date(this.oDateModel.getShortDate(a().clone().subtract(1,"days").format("L")===a.unix(this.oDateModel.getTimeStampInUTC()).format("L")))},i.prototype.getDomText=function(e,t){var s=this.$text;return e=e||"",null!==this.$text&&""===e||(this.completelyFilled()?(this.$text=n(this.text()),this.showInlinePictures(e),this.safety()===!0&&this.alwaysShowExternalPicturesForSender(),t&&this.isExternalsShown()&&this.showExternalPictures(),s=this.$text):s=n("")),s.clone()},i.prototype.getConvertedHtml=function(e,t){var s=this.getDomText(e,t);return s.length>0?s.wrap("<p>").parent().html():""},i.prototype.parseAttachments=function(e,t){var s=e?e["@Collection"]:[];this.attachments([]),h.isNonEmptyArray(s)&&this.attachments(o.map(s,function(e){var t=new b;return t.setMessageData(this.folder(),this.uid()),t.parse(e,this.folder(),this.uid()),t},this))},i.prototype.parseAddressArray=function(e){var t=[];return o.isArray(e)&&(t=o.map(e,function(e){var t=new CAddressModel;return t.parse(e),t})),t},i.prototype.showInlinePictures=function(e){var t=o.map(this.attachments(),function(e){return{CID:e.cid(),ContentLocation:e.contentLocation(),ViewLink:e.getActionUrl("view")}});m.showInlinePictures(this.$text,t,this.foundCids(),e)},i.prototype.showExternalPictures=function(){m.showExternalPictures(this.$text),this.isExternalsShown(!0)},i.prototype.alwaysShowExternalPicturesForSender=function(){this.completelyFilled()&&(this.isExternalsAlwaysShown(!0),this.isExternalsShown()||this.showExternalPictures())},i.prototype.openThread=function(){if(this.threadCountVisible()){var e=this.folder();this.threadOpened(!this.threadOpened()),this.requireMailCache(),this.threadOpened()?f.showOpenedThreads(e):(f.hideThreads(this),setTimeout(function(){f.showOpenedThreads(e)},500))}},i.prototype.getAttachmentsHashes=function(){var e=o.filter(this.attachments(),function(e){return!e.linked()}),t=o.map(e,function(e){return e.hash()});return t},i.prototype.onSaveAttachmentsToFilesResponse=function(e,t){var s=t.Parameters,i=0,n=s.Attachments.length;e.Result&&o.each(s.Attachments,function(t){void 0!==e.Result[t]&&i++}),0===i?u.showError(l.i18n("MAILWEBCLIENT/ERROR_CANT_SAVE_ATTACHMENTS_TO_FILES")):i<n?u.showError(l.i18n("MAILWEBCLIENT/ERROR_SOME_ATTACHMENTS_WERE_NOT_SAVED",{SAVED_COUNT:i,TOTAL_COUNT:n})):u.showReport(l.i18n("MAILWEBCLIENT/REPORT_ATTACHMENTS_SAVED_TO_FILES"))},i.prototype.downloadAllAttachmentsSeparately=function(){o.each(this.attachments(),function(e){e.linked()||e.executeAction("download")})},i.prototype.toJSON=function(){return{uid:this.uid(),accountId:this.accountId(),to:this.to(),subject:this.subject(),threadPart:this.threadPart(),threadUids:this.threadUids(),threadOpened:this.threadOpened()}},e.exports=i},322:function(e,t,s){"use strict";var i=s(185),o=s(192),n=s(193),r=s(43),a={};a.getDownloadLink=function(e,t,s){return t.length>0?"?/Download/"+e+"/DownloadFile/"+t+"/"+(s?"0/"+s:""):""},a.getIframeWrappwer=function(e,t){return"?/Raw/Iframe/"+e+"/"+window.encodeURIComponent(t)+"/"},a.thumbQueue=function(){var e={},t={},s=2;return function(i,o,n){o&&n?!(i in t)||t[i]>0?(i in t||(t[i]=s,e[i]=[]),t[i]--,n(o)):e[i].push({imageSrc:o,imageSrcObserver:n,messageUid:i}):e[i]&&e[i].length&&(e[i][0].imageSrcObserver(e[i][0].imageSrc),e[i].shift())}}(),a.showErrorIfAttachmentSizeLimit=function(e,t){var s=i.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE_DETAILED",{FILENAME:e,MAXSIZE:i.getFriendlySize(r.AttachmentSizeLimit)});return r.AttachmentSizeLimit>0&&t>r.AttachmentSizeLimit&&(o.showPopup(n,[s]),!0)},e.exports=a},323:function(e,t,s){"use strict";function i(){this.aCollection=[]}var o=s(2),n=s(324);i.prototype.parse=function(e){var t=e?e["@Collection"]:[];this.aCollection=[],o.isArray(t)&&(this.aCollection=o.map(t,function(e){var t=new n;return t.parse(e),t}))},i.prototype.addCollection=function(e){o.each(e,function(e){var t=o.find(this.aCollection,function(t){return e.sEmail===t.sEmail});t||this.aCollection.push(e)},this)},i.prototype.excludeCollection=function(e){o.each(e,function(e){this.aCollection=o.filter(this.aCollection,function(t){return e.sEmail!==t.sEmail})},this)},i.prototype.getFirstEmail=function(){return this.aCollection.length>0?this.aCollection[0].getEmail():""},i.prototype.getFirstName=function(){return this.aCollection.length>0?this.aCollection[0].getName():""},i.prototype.getFirstDisplay=function(){return this.aCollection.length>0?this.aCollection[0].getDisplay():""},i.prototype.getDisplay=function(e,t){var s=o.map(this.aCollection,function(s){return e&&t===s.sEmail?e:s.getDisplay(e)});return s.join(", ")},i.prototype.getFull=function(){var e=o.map(this.aCollection,function(e){return e.getFull()});return e.join(", ")},i.prototype.getEmails=function(){var e=o.map(this.aCollection,function(e){return e.getEmail()});return e},e.exports=i},324:function(e,t,s){"use strict";function i(){this.sName="",this.sEmail="",this.sDisplay="",this.sFull="",this.loaded=o.observable(!1),this.found=o.observable(!1)}var o=s(44),n=s(205),r=s(181);i.prototype.parse=function(e){null!==e&&(this.sName=r.pString(e.DisplayName),this.sEmail=r.pString(e.Email),this.sDisplay=this.sName.length>0?this.sName:this.sEmail,this.sFull=n.getFullEmail(this.sName,this.sEmail))},i.prototype.getEmail=function(){return this.sEmail},i.prototype.getName=function(){return this.sName},i.prototype.getDisplay=function(){return this.sDisplay},i.prototype.getFull=function(){return this.sFull},e.exports=i},325:function(e,t,s){"use strict";var i=s(2),o=s(1),n=s(181),r={};r.showInlinePictures=function(e,t,s,n){var r=function(e){return i.find(t,function(t){return t.CID===e})},a=function(e){return i.find(t,function(t){return t.ContentLocation===e})};"string"!=typeof n&&(n=""),s.length>0&&(o("[data-x-src-cid]",e).each(function(){var e=o(this).attr("data-x-src-cid"),t=r(e);t&&t.ViewLink.length>0&&o(this).attr("src",n+t.ViewLink)}),o("[data-x-style-cid]",e).each(function(){var e="",t=o(this).attr("data-x-style-cid-name"),s=o(this).attr("data-x-style-cid"),i=r(s);i&&i.ViewLink.length>0&&""!==t&&(e=o.trim(o(this).attr("style")),e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",o(this).attr("style",e+t+": url('"+i.ViewLink+"')"))})),o("[data-x-src-location]",e).each(function(){var e=o(this).attr("data-x-src-location"),t=a(e);t||(t=r(e)),t&&t.ViewLink.length>0&&o(this).attr("src",n+t.ViewLink)})},r.showExternalPictures=function(e){o("[data-x-src]",e).each(function(){o(this).attr("src",o(this).attr("data-x-src")).removeAttr("data-x-src")}),o("[data-x-style-url]",e).each(function(){var e=o.trim(o(this).attr("style"));e=""===e?"":";"===e.substr(-1)?e+" ":e+"; ",o(this).attr("style",e+o(this).attr("data-x-style-url")).removeAttr("data-x-style-url")})},r.joinReplyPrefixesInSubject=function(e,t,s){var r=[t.toUpperCase()],a=[s.toUpperCase()],l=i.union(r,a).join("|"),h="",c=e.split(":"),u=[],d="";return i.each(c,function(e){if(0===d.length){var h=o.trim(e.toUpperCase()),c=i.indexOf(r,h)!==-1,p=i.indexOf(a,h)!==-1,m=1,g=u.length>0?u[u.length-1]:null;if(!c&&!p){var f=new window.RegExp("^\\s?("+l+")\\s?[\\[\\(]([\\d]+)[\\]\\)]$","gi").exec(h);f&&3===f.length&&(c=i.indexOf(r,f[1].toUpperCase())!==-1,p=i.indexOf(a,f[1].toUpperCase())!==-1,m=n.pInt(f[2]))}c?g&&g.prefix===t?g.count+=m:u.push({prefix:t,count:m}):p?g&&g.prefix===s?g.count+=m:u.push({prefix:s,count:m}):d=e}else d+=":"+e}),i.each(u,function(e){h+=1===e.count?e.prefix+": ":e.prefix+"["+e.count+"]: "}),h+=o.trim(d)},e.exports=r},326:function(e,t,s){"use strict";function i(){this.folderName=r.observable(""),this.messageUid=r.observable(""),this.cid=r.observable(""),this.contentLocation=r.observable(""),this.inline=r.observable(!1),this.linked=r.observable(!1),this.mimePartIndex=r.observable(""),this.messagePart=r.observable(null),u.call(this),this.content=r.observable(""),this.isMessageType=r.computed(function(){return this.mimeType(),this.mimePartIndex(),"message/rfc822"===this.mimeType()},this)}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(181),h=s(182),c=s(200),u=s(327),d=s(315);o.extendOwn(i.prototype,u.prototype),i.prototype.getNewInstance=function(){return new i},i.prototype.getCopy=function(){var e=new i;return e.copyProperties(this),e},i.prototype.copyProperties=function(e){this.fileName(e.fileName()),this.tempName(e.tempName()),this.size(e.size()),this.hash(e.hash()),this.mimeType(e.mimeType()),this.cid(e.cid()),this.contentLocation(e.contentLocation()),this.inline(e.inline()),this.linked(e.linked()),this.thumbnailSrc(e.thumbnailSrc()),this.thumbnailLoaded(e.thumbnailLoaded()),this.statusText(e.statusText()),this.uploaded(e.uploaded()),this.oActionsData=e.oActionsData,this.actions(e.actions()),this.thumbUrlInQueue(e.thumbUrlInQueue())},i.prototype.additionalParse=function(e){this.content(l.pString(e.Content)),this.mimePartIndex(l.pString(e.MimePartIndex)),this.cid(l.pString(e.CID)),this.contentLocation(l.pString(e.ContentLocation)),this.inline(!!e.IsInline),this.linked(!!e.IsLinked),h.broadcastEvent("MailWebclient::ParseFile::after",this)},i.prototype.setMessageData=function(e,t){this.folderName(e),this.messageUid(t)},i.prototype.onGetMessageResponse=function(e,t){var i=t.Parameters,e=e.Result,o=s(321),n=new o;e&&this.oNewWindow&&(n.parse(e,i.AccountID,!1,!0),this.messagePart(n),this.messagePart().viewMessage(this.oNewWindow),this.oNewWindow=void 0)},i.prototype.viewFile=function(){this.isMessageType()?this.viewMessageFile():this.viewCommonFile()},i.prototype.viewMessageFile=function(){var e=null,t='<div style="margin: 30px; text-align: center; font: normal 14px Tahoma;">'+a.i18n("COREWEBCLIENT/INFO_LOADING")+"</div>";e=c.open("",this.fileName()),e&&(this.messagePart()?this.messagePart().viewMessage(e):(n(e.document.body).html(t),this.oNewWindow=e,d.send("GetMessage",{Folder:this.folderName(),Uid:this.messageUid(),Rfc822MimeIndex:this.mimePartIndex()},this.onGetMessageResponse,this)),e.focus())},i.prototype.fillDataAfterUploadComplete=function(e,t){this.cid(l.pString(t)),e&&e.Result&&e.Result.Attachment&&(this.tempName(l.pString(e.Result.Attachment.TempName)),this.mimeType(l.pString(e.Result.Attachment.MimeType)),this.size(l.pInt(e.Result.Attachment.Size)),this.hash(l.pString(e.Result.Attachment.Hash)),this.parseActions(e.Result.Attachment))},i.prototype.parseFromUpload=function(e,t,s){this.setMessageData(t,s),this.fileName(l.pString(e.Name)),this.tempName(e.TempName?l.pString(e.TempName):this.fileName()),this.mimeType(l.pString(e.MimeType)),this.size(l.pInt(e.Size)),this.hash(l.pString(e.Hash)),this.parseActions(e),this.uploadUid(this.hash()),this.uploaded(!0),this.uploadStarted(!1)},i.prototype.parseActions=function(e){this.thumbUrlInQueue(""!==l.pString(e.ThumbnailUrl)?l.pString(e.ThumbnailUrl)+"/"+Math.random():""),this.commonParseActions(e),this.isMessageType()?""!==this.folderName()&&""!==this.messageUid()?(this.hasAction("view")||this.actions.unshift("view"),this.otherTemplates.push({name:"MailWebclient_PrintMessageView",data:this.messagePart})):this.actions(o.without(this.actions(),"view")):this.commonExcludeActions()},i.prototype.errorFromUpload=function(){this.uploaded(!0),this.uploadError(!0),this.uploadStarted(!1),this.statusText(a.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN"))},e.exports=i},327:function(e,t,s){"use strict";function i(){this.id=r.observable(""),this.index=r.observable(0),this.fileName=r.observable(""),this.tempName=r.observable(""),this.displayName=r.observable(""),this.extension=r.observable(""),this.fileName.subscribe(function(e){this.id(e),this.displayName(e),this.extension(d.getFileExtension(e))},this),this.size=r.observable(0),this.friendlySize=r.computed(function(){return this.size()>0?h.getFriendlySize(this.size()):""},this),this.hash=r.observable(""),this.thumbUrlInQueue=r.observable(""),this.thumbUrlInQueueSubscribtion=this.thumbUrlInQueue.subscribe(function(){this.getInThumbQueue()},this),this.thumbnailSrc=r.observable(""),this.thumbnailLoaded=r.observable(!1),this.thumbnailSessionUid=r.observable(""),this.mimeType=r.observable(""),this.uploadUid=r.observable(""),this.uploaded=r.observable(!1),this.uploadError=r.observable(!1),this.downloading=r.observable(!1),this.isViewMimeType=r.computed(function(){return-1!==n.inArray(this.mimeType(),m)},this),this.bHasHtmlEmbed=!1,this.otherTemplates=r.observableArray([]),this.visibleCancelButton=r.observable(!0),this.statusText=r.observable(""),this.statusTooltip=r.computed(function(){return this.uploadError()?this.statusText():""},this),this.progressPercent=r.observable(0),this.visibleProgress=r.observable(!1),this.uploadStarted=r.observable(!1),this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))},this),this.downloading.subscribe(function(){this.downloading()?this.visibleProgress(!0):(this.visibleProgress(!1),this.progressPercent(0))},this),this.allowDrag=r.observable(!1),this.allowUpload=r.observable(!1),this.allowPublicLink=r.observable(!1),this.bIsSecure=r.observable(!1),this.isShared=r.observable(!1),this.sHeaderText="",this.oActionsData={view:{Text:h.i18n("COREWEBCLIENT/ACTION_VIEW_FILE"),Handler:o.bind(function(){this.viewFile()},this)},download:{Text:h.i18n("COREWEBCLIENT/ACTION_DOWNLOAD_FILE"),Handler:o.bind(function(){this.downloadFile()},this),Tooltip:r.computed(function(){var e=h.i18n("COREWEBCLIENT/INFO_CLICK_TO_DOWNLOAD_FILE",{FILENAME:this.fileName(),SIZE:this.friendlySize()});return""===this.friendlySize()&&(e=e.replace(" ()","")),e},this)}},this.allowActions=r.observable(!0),this.iconAction=r.observable("download"),this.cssClasses=r.computed(function(){return this.getCommonClasses().join(" ")},this),this.actions=r.observableArray([]),this.firstAction=r.computed(function(){return this.actions().length>1?this.actions()[0]:""},this),this.secondAction=r.computed(function(){return 1===this.actions().length?this.actions()[0]:this.actions().length>1?this.actions()[1]:""},this),this.subFiles=r.observableArray([]),this.subFilesExpanded=r.observable(!1)}var o=s(2),n=s(1),r=s(44),a=s(182),l=s(322),h=s(185),c=s(181),u=s(179),d=s(217),p=s(200),m=["image/jpeg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript"],g=[];n("html").hasClass("pdf")&&(m.push("application/pdf"),m.push("application/x-pdf")),i.prototype.addAction=function(e,t,s){t?this.actions.unshift(e):this.actions.push(e),this.actions(o.compact(this.actions())),s&&(this.oActionsData[e]=s)},i.prototype.removeAction=function(e){this.actions(o.without(this.actions(),e))},i.prototype.getMainAction=function(){return this.actions()[0]},i.prototype.hasAction=function(e){return o.indexOf(this.actions(),e)!==-1},i.prototype.getActionText=function(e){return this.hasAction(e)&&this.oActionsData[e]&&("string"==typeof this.oActionsData[e].Text||o.isFunction(this.oActionsData[e].Text))?o.isFunction(this.oActionsData[e].Text)?this.oActionsData[e].Text():this.oActionsData[e].Text:""},i.prototype.getActionUrl=function(e){return this.hasAction(e)&&this.oActionsData[e]?this.oActionsData[e].Url||"":""},i.prototype.executeAction=function(e){this.hasAction(e)&&this.oActionsData[e]&&o.isFunction(this.oActionsData[e].Handler)&&this.oActionsData[e].Handler()},i.prototype.getTooltip=function(e){var t=this.hasAction(e)&&this.oActionsData[e]?this.oActionsData[e].Tooltip:"";return"string"==typeof t?t:o.isFunction(t)?t():""},i.prototype.getCommonClasses=function(){var e=[];return(this.allowUpload()&&!this.uploaded()||this.downloading())&&e.push("incomplete"),this.uploadError()?e.push("fail"):e.push("success"),e},i.prototype.parse=function(e){this.fileName(c.pString(e.FileName)),this.tempName(c.pString(e.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.mimeType(c.pString(e.MimeType)),this.size(e.EstimatedSize?c.pInt(e.EstimatedSize):c.pInt(e.SizeInBytes)),this.hash(c.pString(e.Hash)),this.parseActions(e),this.uploadUid(this.hash()),this.uploaded(!0),n.isFunction(this.additionalParse)&&this.additionalParse(e)},i.prototype.parseActions=function(e){this.thumbUrlInQueue(""!==c.pString(e.ThumbnailUrl)?c.pString(e.ThumbnailUrl)+"/"+Math.random():""),this.commonParseActions(e),this.commonExcludeActions()},i.prototype.commonExcludeActions=function(){this.isViewSupported()||this.actions(o.without(this.actions(),"view"))},i.prototype.commonParseActions=function(e){o.each(e.Actions,function(e,t){this.oActionsData[t]||(this.oActionsData[t]={}),this.oActionsData[t].Url=c.pString(e.url),this.actions.push(t)},this)},i.addViewExtensions=function(e){o.isArray(e)&&(g=o.union(g,e))},i.prototype.isViewSupported=function(){return-1!==n.inArray(this.mimeType(),m)||-1!==n.inArray(this.extension(),g)},i.prototype.getInThumbQueue=function(){""===this.thumbUrlInQueue()||this.linked&&(!this.linked||this.linked())||(this.thumbnailSessionUid(""+Date.now()),l.thumbQueue(this.thumbnailSessionUid(),this.thumbUrlInQueue(),this.thumbnailSrc))},i.prototype.downloadFile=function(){var e=this.getActionUrl("download"),t={File:this,CancelDownload:!1};e.length>0&&"#"!==e&&(a.broadcastEvent("AbstractFileModel::FileDownload::before",t),t.CancelDownload||(o.isFunction(t.CustomDownloadHandler)?t.CustomDownloadHandler():u.downloadByUrl(e)))},i.prototype.viewFile=function(e,t){d.calmEvent(t),this.viewCommonFile()},i.prototype.viewCommonFile=function(e){var t=null,s=null;c.isNonEmptyString(e)||(e=u.getAppPath()+this.getActionUrl("view")),e.length>0&&"#"!==e&&(s={sUrl:e,index:this.index(),bBreakView:!1},a.broadcastEvent("AbstractFileModel::FileView::before",s),s.bBreakView||(t=p.open(e,e,!1),t&&t.focus()))},i.prototype.eventDragStart=function(e,t){var s=t.originalEvent||t;return e&&s&&s.dataTransfer&&s.dataTransfer.setData&&s.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},i.prototype.generateTransferDownloadUrl=function(){var e=this.getActionUrl("download");return"http"!==e.substr(0,4)&&(e=u.getAppPath()+e),this.mimeType()+":"+this.fileName()+":"+e},i.prototype.onUploadSelect=function(e,t,s){s||(this.fileName(c.pString(t.FileName)),this.mimeType(c.pString(t.Type)),this.size(c.pInt(t.Size))),this.uploadUid(e),this.uploaded(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1)},i.prototype.onUploadStart=function(){this.visibleProgress(!0)},i.prototype.onUploadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(!0))},i.prototype.onDownloadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(this.progressPercent()<100))},i.prototype.onUploadComplete=function(e,t,s){var i=!(t&&s&&!s.ErrorCode&&s.Result&&!s.Result.Error),o=s&&s.ErrorCode&&s.ErrorCode===Enums.Errors.CanNotUploadFileLimit?h.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):h.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN");this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(i),this.statusText(i?o:h.i18n("COREWEBCLIENT/REPORT_UPLOAD_COMPLETE")),i||(this.fillDataAfterUploadComplete(s,e),setTimeout(function(e){return function(){e.statusText("")}}(this),3e3))},i.prototype.fillDataAfterUploadComplete=function(e,t){},i.prototype.onImageLoad=function(e,t){""===this.thumbUrlInQueue()||this.thumbnailLoaded()||(this.thumbnailLoaded(!0),l.thumbQueue(this.thumbnailSessionUid()))},i.prototype.stopDownloading=function(){this.downloading(!1)},i.prototype.startDownloading=function(){this.downloading(!0)},e.exports=i},328:function(e,t,s){"use strict";function i(){this.resultCount=n.observable(-1),this.search=n.observable(""),this.filters=n.observable(""),this.collection=n.observableArray([]),this.threadUids={}}var o=s(2),n=s(44),r=s(313);i.prototype.addThreadUids=function(e,t){-1!==o.indexOf(this.collection(),e)&&(this.threadUids[e]=t)},i.prototype.setUidsAndCount=function(e){"Collection/MessageCollection"===e["@Object"]&&(o.each(e.Uids,function(t,s){this.collection()[s+e.Offset]=""+t},this),this.resultCount(e.MessageResultCount))},i.prototype.getUidsForOffset=function(e,t){for(var s=0,i=this.collection().length,o="",n=0,a=[],l=null;s<i;s++)s>=e&&n<r.MailsPerPage&&(o=this.collection()[s],l=t[o],(l&&!l.deleted()||void 0===o)&&(n++,void 0!==o&&a.push(o)));return a},i.prototype.deleteUids=function(e){for(var t=0,s=this.collection().length,i="",n=[],r=0;t<s;t++)i=this.collection()[t],o.indexOf(e,i)===-1?n.push(i):r++;this.collection(n),this.resultCount(this.resultCount()-r)},e.exports=i},329:function(e,t,s){"use strict";var i=s(2),o=s(182),n=s(43),r=s(314),a=s(315),l=s(313),h=s(316),c={},u=!1,d=!1;c.prefetchFetchersIdentities=function(){return!(o.isNewTab()||u||!l.AllowFetchers&&!l.AllowIdentities)&&(r.populateFetchersIdentities(),u=!0,!0)},c.prefetchAccountFilters=function(){var e=r.getCurrent();e&&!e.filters()&&l.AllowFilters&&e.requestFilters()},c.prefetchStarredMessageList=function(){var e=h.folderList(),t=e?e.inboxFolder():null,s=null,i=!1;return t&&(s=h.requestMessageList(t.fullName(),1,"",Enums.FolderFilter.Flagged,!1,!1),i=!!s&&!!s.RequestStarted),d||(d=i),i},c.prefetchUnseenMessageList=function(){var e=h.folderList(),t=e?e.inboxFolder():null,s=null;return t&&t.hasChanges()&&(s=h.requestMessageList(t.fullName(),1,"",Enums.FolderFilter.Unseen,!1,!1)),s&&s.RequestStarted},c.prefetchNextPage=function(e){var t=h.uidList(),s=i.indexOf(t.collection(),e),o=Math.ceil(s/l.MailsPerPage)+1;this.startPagePrefetch(o-1)},c.prefetchPrevPage=function(e){var t=h.uidList(),s=i.indexOf(t.collection(),e),o=Math.ceil((s+1)/l.MailsPerPage)+1;this.startPagePrefetch(o)},c.startPagePrefetch=function(e){var t=h.folderList().currentFolder(),s=h.uidList(),i=(e-1)*l.MailsPerPage,o=e>0&&i<s.resultCount(),n=null,r=null;
return t&&!t.hasChanges()&&o&&(n={folder:t.fullName(),page:e,search:s.search()},t.hasListBeenRequested(n)||(r=h.requestMessageList(n.folder,n.page,n.search,"",!1,!1))),r&&r.RequestStarted},c.startOtherFoldersPrefetch=function(){var e=h.folderList(),t=e.currentFolderFullName(),s=h.getNamesOfFoldersToRefresh(),o=e?[e.inboxFolderFullName(),e.sentFolderFullName(),e.draftsFolderFullName(),e.spamFolderFullName()]:[],n=s.length<5?this.getOtherFolderNames(5-s.length):[],r=i.uniq(i.compact(i.union(o,s,n))),a=!1;return i.each(r,i.bind(function(s){a||t===s||(a=this.startFolderPrefetch(e.getFolderByFullName(s)))},this)),a},c.getOtherFolderNames=function(e){var t=h.folderList().inboxFolder(),s=t?t.subfolders():[],o=i.filter(h.folderList().collection(),function(e){return!e.isSystem()},this),n=i.first(i.union(s,o),e);return i.map(n,function(e){return e.fullName()})},c.startFolderPrefetch=function(e){var t=1,s="",i={folder:e?e.fullName():"",page:t,search:s},o=null;return e&&!e.hasListBeenRequested(i)&&(o=h.requestMessageList(i.folder,i.page,i.search,"",!1,!1)),!!o&&o.RequestStarted},c.startThreadListPrefetch=function(){var e=[],t=h.getCurrentFolder();return i.each(h.messages(),function(s){s.threadCount()>0&&i.each(s.threadUids(),function(s){var i=t.oMessages[s];i||t.hasThreadUidBeenRequested(s)||e.push(s)})},this),e.length>0&&(e=e.slice(0,l.MailsPerPage),t.addRequestedThreadUids(e),t.loadThreadMessages(e),!0)},c.startMessagesPrefetch=function(){var e=h.currentAccountId(),t=h.getCurrentFolder(),s=0,o=l.MaxMessagesBodiesSizeToPrefetch,n=[],r=null,c=2048,u=function(e){var r=!e.deleted()&&!e.completelyFilled(),a=!i.find(n,function(t){return t===e.uid()},this),h=!t.hasUidBeenRequested(e.uid()),u=e.textSize()<l.MessageBodyTruncationThreshold?e.textSize():l.MessageBodyTruncationThreshold;s<o&&r&&a&&h&&(n.push(e.uid()),s+=u+c)};return!!(t&&t.selected()&&(i.each(h.messages(),u),i.each(t.oMessages,u),n.length>0))&&(t.addRequestedUids(n),r={AccountID:e,Folder:t.fullName(),Uids:n,MessageBodyTruncationThreshold:l.MessageBodyTruncationThreshold},a.send("GetMessagesBodies",r,this.onGetMessagesBodiesResponse,this),!0)},c.onGetMessagesBodiesResponse=function(e,t){var s=t.Parameters,o=h.getFolderByFullName(s.AccountID,s.Folder);i.isArray(e.Result)&&i.each(e.Result,function(e){o.parseAndCacheMessage(e,!1,!1)})},c.prefetchAccountQuota=function(){var e=r.getCurrent(),t=e&&!e.quotaRecieved();return!(!n.ShowQuotaBar||!t)&&(e.updateQuotaParams(),!0)},e.exports={startMin:function(){var e=!1;return e=c.prefetchFetchersIdentities(),e||(e=c.prefetchAccountFilters()),d||e||(e=c.prefetchStarredMessageList()),e||(e=c.prefetchAccountQuota()),e},startAll:function(){var e=!1;return e=c.prefetchFetchersIdentities(),e||(e=c.prefetchAccountFilters()),e||(e=c.startMessagesPrefetch()),e||(e=c.startThreadListPrefetch()),d||e||(e=c.prefetchStarredMessageList()),e||(e=c.startPagePrefetch(h.page()+1)),e||(e=c.startPagePrefetch(h.page()-1)),e||(e=c.prefetchUnseenMessageList()),e||(e=c.prefetchAccountQuota()),e||(e=c.startOtherFoldersPrefetch()),e},prefetchStarredMessageList:function(){c.prefetchStarredMessageList()},startFolderPrefetch:function(e){c.startFolderPrefetch(e)},prefetchNextPage:function(e){c.prefetchNextPage(e)},prefetchPrevPage:function(e){c.prefetchPrevPage(e)}}},330:function(e,t,s){"use strict";var i=s(182),o=s(i.isMobile()||i.isNewTab()?331:332);e.exports=o},331:function(e,t,s){"use strict";var i=s(195),o=s(318),n={};n.composeMessage=function(){i.setHash(o.getCompose())},n.composeMessageFromDrafts=function(e,t){var s=o.getComposeFromMessage("drafts",e,t);i.setHash(s)},n.composeMessageAsReplyOrForward=function(e,t,s){var n=o.getComposeFromMessage(e,t,s);i.setHash(n)},n.composeMessageToAddresses=function(e){var t=o.getComposeWithToField(e);i.setHash(t)},n.composeMessageWithEml=function(e){var t=o.getComposeWithEmlObject(e.folder(),e.uid(),e);t.shift(),t.shift(),i.goDirectly(o.getCompose(),t)},n.composeMessageWithAttachments=function(e){var t=o.getComposeWithObject("attachments",e);t.shift(),t.shift(),i.goDirectly(o.getCompose(),t)},e.exports=n},332:function(e,t,s){"use strict";function i(){return s(333)}var o=s(192),n=s(318),r={};r.composeMessage=function(){o.showPopup(i())},r.composeMessageFromDrafts=function(e,t){var s=n.getComposeFromMessage("drafts",e,t);s.shift(),o.showPopup(i(),[s])},r.composeMessageAsReplyOrForward=function(e,t,s){var r=n.getComposeFromMessage(e,t,s);r.shift(),o.showPopup(i(),[r])},r.composeMessageToAddresses=function(e){var t=n.getComposeWithToField(e);t.shift(),o.showPopup(i(),[t])},r.composeMessageWithEml=function(e){var t=n.getComposeWithEmlObject(e.folder(),e.uid(),e);t.shift(),o.showPopup(i(),[t])},r.composeMessageWithAttachments=function(e){var t=n.getComposeWithObject("attachments",e);t.shift(),o.showPopup(i(),[t])},r.closeComposePopup=function(){o.showPopup(i(),[["close"]])},e.exports=r},333:function(e,t,s){"use strict";function i(){c.call(this),d.call(this),this.minimized=r.observable(!1),this.fPreventBackspace=function(e){var t=e.which===n.ui.keyCode.BACKSPACE,s="INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName,i="DIV"===e.target.tagName&&"true"===n(e.target).attr("contenteditable");!t||s||i||(e.preventDefault(),e.stopPropagation())},this.minimized.subscribe(function(){this.minimized()?this.preventBackspaceOff():this.shown()&&this.preventBackspaceOn()},this),this.minimizedTitle=r.computed(function(){return this.subject()||a.i18n("MAILWEBCLIENT/HEADING_MINIMIZED_NEW_MESSAGE")},this)}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(180),h=s(192),c=s(194),u=s(334),d=s(335);o.extendOwn(i.prototype,c.prototype),o.extendOwn(i.prototype,d.prototype),i.prototype.PopupTemplate="MailWebclient_ComposePopup",i.prototype.preventBackspaceOn=function(){n(document).on("keydown",this.fPreventBackspace)},i.prototype.preventBackspaceOff=function(){n(document).off("keydown",this.fPreventBackspace)},i.prototype.onClose=function(){this.preventBackspaceOff()},i.prototype.onOpen=function(e){if(e=e||[],1===e.length&&"close"===e[0])this.closePopup();else{var t=3===e.length&&"drafts"===e[0]&&e[2]===this.draftUid(),s=this.minimized();this.maximize(),this.shown()||s?(e.length>0&&!t?this.hasUnsavedChanges()?(this.disableAutosave(!0),h.showPopup(u,[o.bind(function(t){switch(t){case Enums.AnotherMessageComposedAnswer.Discard:this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.SaveAsDraft:this.hasUnsavedChanges()&&this.executeSave(!0,!1),this.onRoute(e);break;case Enums.AnotherMessageComposedAnswer.Cancel:}this.disableAutosave(!1)},this)])):this.onRoute(e):s||this.onRoute(e),this.oHtmlEditor.clearUndoRedo()):this.onRoute(e),this.preventBackspaceOn()}},i.prototype.minimize=function(){this.minimized(!0),this.$popupDom.addClass("minimized")},i.prototype.maximize=function(){this.minimized(!1),this.$popupDom.removeClass("minimized")},i.prototype.saveAndClose=function(){this.hasUnsavedChanges()&&this.saveCommand(),this.closePopup()},i.prototype.cancelPopup=function(){this.hasUnsavedChanges()?this.minimize():this.closePopup()},i.prototype.onEscHandler=function(e){var t=this.oHtmlEditor.hasOpenedPopup(),s=!l.ie&&e.target&&"input"===e.target.tagName.toLowerCase()&&"file"===e.target.type.toLowerCase();s&&e.target.blur(),!h.hasOnlyOneOpenedPopup()||t||s||this.minimize(),t&&this.oHtmlEditor.closeAllPopups()},e.exports=new i},334:function(e,t,s){"use strict";function i(){r.call(this),this.fConfirmCallback=null,this.shown=!1}var o=s(2),n=s(1),r=s(194);o.extendOwn(i.prototype,r.prototype),i.prototype.PopupTemplate="MailWebclient_ConfirmAnotherMessageComposedPopup",i.prototype.onOpen=function(e){this.fConfirmCallback=n.isFunction(e)?e:null,this.shown=!0},i.prototype.onClose=function(){this.shown=!1},i.prototype.onDiscardClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Discard),this.closePopup()},i.prototype.onSaveAsDraftClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.SaveAsDraft),this.closePopup()},i.prototype.cancelPopup=function(){this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Cancel),this.closePopup()},i.prototype.onEnterHandler=function(){this.onSaveAsDraftClick()},e.exports=new i},335:function(e,t,s){"use strict";function i(){A.call(this,"MailWebclient"),this.browserTitle=r.computed(function(){return w.getEmail()+" - "+h.i18n("MAILWEBCLIENT/HEADING_COMPOSE_BROWSER_TAB")});var e=this;this.toAddrDom=r.observable(),this.toAddrDom.subscribe(function(){this.initInputosaurus(this.toAddrDom,this.toAddr,this.lockToAddr,"to")},this),this.ccAddrDom=r.observable(),this.ccAddrDom.subscribe(function(){this.initInputosaurus(this.ccAddrDom,this.ccAddr,this.lockCcAddr,"cc")},this),this.bccAddrDom=r.observable(),this.bccAddrDom.subscribe(function(){this.initInputosaurus(this.bccAddrDom,this.bccAddr,this.lockBccAddr,"bcc")},this),this.folderList=L.folderList,this.folderList.subscribe(function(){this.getMessageOnRoute()},this),this.bNewTab=d.isNewTab(),this.bDemo=v.IsDemo,this.sending=r.observable(!1),this.saving=r.observable(!1),this.oHtmlEditor=new x(!1,this),this.visibleBcc=r.observable(!1),this.visibleBcc.subscribe(function(){O.toggleClass("screen-compose-bcc",this.visibleCc()),o.defer(o.bind(function(){n(this.bccAddrDom()).inputosaurus("resizeInput")},this))},this),this.visibleCc=r.observable(!1),this.visibleCc.subscribe(function(){O.toggleClass("screen-compose-cc",this.visibleCc()),o.defer(o.bind(function(){n(this.ccAddrDom()).inputosaurus("resizeInput")},this))},this),this.sendReadingConfirmation=r.observable(!1).extend({reversible:!0}),this.composeUploaderButton=r.observable(null),this.composeUploaderButton.subscribe(function(){this.initUploader()},this),this.composeUploaderDropPlace=r.observable(null),this.composeUploaderBodyDragOver=r.observable(!1),this.composeUploaderDragOver=r.observable(!1),this.allowDragNDrop=r.observable(!1),this.uploaderBodyDragOver=r.computed(function(){return this.allowDragNDrop()&&this.composeUploaderBodyDragOver()},this),this.uploaderDragOver=r.computed(function(){return this.allowDragNDrop()&&this.composeUploaderDragOver()},this),this.selectedImportance=r.observable(Enums.Importance.Normal).extend({reversible:!0}),this.senderAccountId=N.senderAccountId,this.senderList=N.senderList,this.visibleFrom=r.computed(function(){return this.senderList().length>1},this),this.selectedSender=N.selectedSender,this.selectedFetcherOrIdentity=N.selectedFetcherOrIdentity,this.selectedFetcherOrIdentity.subscribe(function(){this.oHtmlEditor.isEditing()||this.oHtmlEditor.clearUndoRedo()},this),this.signature=r.observable(""),this.prevSignature=r.observable(null),r.computed(function(){var e=I.getClearSignature(this.senderAccountId(),this.selectedFetcherOrIdentity());null===this.prevSignature()?(this.prevSignature(e),this.signature(e)):(this.prevSignature(this.signature()),this.signature(e),this.oHtmlEditor.changeSignatureContent(this.signature(),this.prevSignature()))},this),this.lockToAddr=r.observable(!1),this.toAddr=r.observable("").extend({reversible:!0}),this.toAddr.subscribe(function(){this.lockToAddr()||(n(this.toAddrDom()).val(this.toAddr()),n(this.toAddrDom()).inputosaurus("refresh"))},this),this.lockCcAddr=r.observable(!1),this.ccAddr=r.observable("").extend({reversible:!0}),this.ccAddr.subscribe(function(){this.lockCcAddr()||(n(this.ccAddrDom()).val(this.ccAddr()),n(this.ccAddrDom()).inputosaurus("refresh"))},this),this.lockBccAddr=r.observable(!1),this.bccAddr=r.observable("").extend({reversible:!0}),this.bccAddr.subscribe(function(){this.lockBccAddr()||(n(this.bccAddrDom()).val(this.bccAddr()),n(this.bccAddrDom()).inputosaurus("refresh"))},this),this.recipientEmails=r.computed(function(){var e=[this.toAddr(),this.ccAddr(),this.bccAddr()].join(",").split(","),t=[];return o.each(e,function(e){var s=n.trim(e),i=null;""!==s&&(i=a.getEmailParts(s),i.email&&t.push(i.email))}),t},this),this.subject=r.observable("").extend({reversible:!0}),this.plainText=r.observable(!1),this.textBody=r.observable(""),this.textBody.subscribe(function(){this.oHtmlEditor.setText(this.textBody(),this.plainText()),this.oHtmlEditor.commit()},this),this.focusedField=r.observable(),this.oHtmlEditor.textFocused.subscribe(function(){this.oHtmlEditor.textFocused()&&this.focusedField("text")},this),this.subjectFocused=r.observable(!1),this.subjectFocused.subscribe(function(){this.subjectFocused()&&this.focusedField("subject")},this),this.templateUid=r.observable(""),this.templateFolderName=r.observable(L.getTemplateFolder()),this.draftUid=r.observable(""),this.draftUid.subscribe(function(){L.editedDraftUid(this.draftUid())},this),this.draftInfo=r.observableArray([]),this.routeType=r.observable(""),this.routeParams=r.observableArray([]),this.inReplyTo=r.observable(""),this.references=r.observable(""),this.bUploadStatus=!1,this.iUploadAttachmentsTimer=0,this.messageUploadAttachmentsStarted=r.observable(!1),this.messageUploadAttachmentsStarted.subscribe(function(t){window.clearTimeout(e.iUploadAttachmentsTimer),t?e.iUploadAttachmentsTimer=window.setTimeout(function(){e.bUploadStatus=!0,b.showLoading(h.i18n("MAILWEBCLIENT/INFO_ATTACHMENTS_LOADING"))},4e3):e.bUploadStatus?e.iUploadAttachmentsTimer=window.setTimeout(function(){e.bUploadStatus=!1,b.hideLoading()},1e3):b.hideLoading()},this),this.attachments=r.observableArray([]),this.attachmentsChanged=r.observable(!1),this.attachments.subscribe(function(){this.attachmentsChanged(!0)},this),this.notUploadedAttachments=r.computed(function(){return o.filter(this.attachments(),function(e){return!e.uploaded()})},this),this.allAttachmentsUploaded=r.computed(function(){return 0===this.notUploadedAttachments().length&&!this.messageUploadAttachmentsStarted()},this),this.notInlineAttachments=r.computed(function(){return o.filter(this.attachments(),function(e){return!e.linked()})},this),this.notInlineAttachments.subscribe(function(){O.toggleClass("screen-compose-attachments",this.notInlineAttachments().length>0)},this),this.allowStartSending=r.computed(function(){return!this.saving()},this),this.allowStartSending.subscribe(function(){this.allowStartSending()&&this.requiresPostponedSending()&&(I.sendPostponedMail(this.draftUid()),this.requiresPostponedSending(!1))},this),this.requiresPostponedSending=r.observable(!1),this.oJua=null,this.isDraftsCleared=r.observable(!1),this.backToListOnSendOrSave=r.observable(!1),this.composeShown=r.computed(function(){return!!this.opened&&this.opened()||!!this.shown&&this.shown()},this),this.toolbarControllers=r.observableArray([]),this.disableHeadersEdit=r.computed(function(){var e=!1;return o.each(this.toolbarControllers(),function(t){e=e||!!t.disableHeadersEdit&&t.disableHeadersEdit()}),e},this),r.computed(function(){var e=!1;o.each(this.toolbarControllers(),function(t){e=e||!!t.disableBodyEdit&&t.disableBodyEdit()}),this.oHtmlEditor.setDisableEdit(e)},this),this.draftFolderIsAvailable=r.computed(function(){return!!L.folderList().draftsFolder()},this),this.disableAutosave=r.observable(!1),R.AllowAutosaveInDrafts&&R.AutoSaveIntervalSeconds>0&&(this.iAutosaveInterval=-1,r.computed(function(){var e=this.draftFolderIsAvailable()&&this.composeShown()&&!this.sending()&&!this.saving()&&!this.disableAutosave()&&!L.disableComposeAutosave();o.each(this.toolbarControllers(),function(t){e=e&&!(t.disableAutosave&&t.disableAutosave())}),window.clearInterval(this.iAutosaveInterval),e&&(this.iAutosaveInterval=window.setInterval(o.bind(this.executeSave,this,!0),1e3*R.AutoSaveIntervalSeconds))},this)),this.backToListCommand=u.createCommand(this,this.executeBackToList),this.sendCommand=u.createCommand(this,this.executeSend,this.isEnableSending),this.saveCommand=u.createCommand(this,this.executeSaveCommand,this.isEnableSaving),this.visibleSaveTemplateControl=r.observable(!1),this.saveTemplateCommand=u.createCommand(this,this.executeTemplateSaveCommand,this.isEnableSaving),this.messageFields=r.observable(null),this.bottomPanel=r.observable(null),this.sHotkeysHintsViewTemplate=p.mobileDevice?"":"MailWebclient_Compose_HotkeysHintsView",this.sPopupButtonsViewTemplate=d.isNewTab()?"":"MailWebclient_Compose_PopupButtonsView",this.aHotkeys=[{value:"Ctrl+Enter",action:h.i18n("MAILWEBCLIENT/LABEL_SEND_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+S",action:h.i18n("MAILWEBCLIENT/LABEL_SAVE_HOTKEY"),visible:this.draftFolderIsAvailable},{value:"Ctrl+Z",action:h.i18n("MAILWEBCLIENT/LABEL_UNDO_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+Y",action:h.i18n("MAILWEBCLIENT/LABEL_REDO_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+K",action:h.i18n("MAILWEBCLIENT/LABEL_LINK_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+B",action:h.i18n("MAILWEBCLIENT/LABEL_BOLD_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+I",action:h.i18n("MAILWEBCLIENT/LABEL_ITALIC_HOTKEY"),visible:r.observable(!0)},{value:"Ctrl+U",action:h.i18n("MAILWEBCLIENT/LABEL_UNDERLINE_HOTKEY"),visible:r.observable(!0)}],this.bAllowFiles=!!F,this.ignoreHasUnsavedChanges=r.observable(!1),this.changedInPreviousWindow=r.observable(!1),this.hasUnsavedChanges=r.computed(function(){return!this.ignoreHasUnsavedChanges()&&this.isChanged()&&this.isEnableSaving()},this),this.saveAndCloseTooltip=r.computed(function(){return this.draftFolderIsAvailable()&&this.hasUnsavedChanges()?h.i18n("MAILWEBCLIENT/ACTION_SAVE_CLOSE"):h.i18n("MAILWEBCLIENT/ACTION_CLOSE")},this),this.splitterDom=r.observable(),this.headersCompressed=r.observable(!1),this.allowCcBccSwitchers=r.computed(function(){return!this.disableHeadersEdit()&&!this.headersCompressed()},this),this.registerOwnToolbarControllers(),d.broadcastEvent("MailWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var o=s(2),n=s(1),r=s(44),a=s(205),l=s(322),h=s(185),c=s(181),u=s(217),d=s(182),p=s(180),m=s(278),g=s(42),f=s(195),b=s(188),v=s(43),y=s(200),A=s(198),E=s(192),S=s(193),F=g.run("FilesWebclient","getSelectFilesPopup"),C=s(318),I=s(336),w=s(314),M=s(191),T=s(315),L=s(316),D=s(337),N=s(339),R=s(313),P=s(321),_=s(326),x=s(340),k=d.isNewTab()&&window.opener&&window.opener.MainTabMailMethods,O=n("html");o.extendOwn(i.prototype,A.prototype),i.prototype.ViewTemplate=d.isNewTab()?"MailWebclient_ComposeScreenView":"MailWebclient_ComposeView",i.prototype.ViewConstructorName="CComposeView",i.prototype.isEnableSending=function(){var e=0===this.toAddr().length&&0===this.ccAddr().length&&0===this.bccAddr().length,t=this.folderList()&&0!==this.folderList().iAccountId;return t&&!this.sending()&&!e&&this.allAttachmentsUploaded()},i.prototype.isEnableSaving=function(){var e=this.folderList()&&0!==this.folderList().iAccountId;return this.composeShown()&&e&&!this.sending()&&!this.saving()},i.prototype.initInputosaurus=function(e,t,s,i){e()&&n(e()).length>0&&n(e()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:g.run("ContactsWebclient","getSuggestionsAutocompleteCallback",["all"])||function(){},autoCompleteDeleteItem:g.run("ContactsWebclient","getSuggestionsAutocompleteDeleteHandler")||function(){},autoCompleteAppendTo:n(e()).closest("td"),change:o.bind(function(e){s(!0),this.setRecipient(t,e.target.value),s(!1)},this),copy:o.bind(function(e){this.inputosaurusBuffer=e},this),paste:o.bind(function(){var e=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",e},this),focus:o.bind(this.focusedField,this,i),mobileDevice:p.mobileDevice})},i.prototype.changeHeadersCompressed=function(){this.headersCompressed(!this.headersCompressed())},i.prototype.onBind=function(){g.run("SessionTimeoutWeblient","registerFunction",[o.bind(this.executeSave,this,!1)]),d.isMobile()||this.hotKeysBind()},i.prototype.hotKeysBind=function(){(this.$popupDom||this.$viewDom).on("keydown",n.proxy(function(e){if(e&&e.ctrlKey&&!e.altKey&&!e.shiftKey){var t=e.keyCode,s=this.composeShown()&&(!this.minimized||!this.minimized())&&e&&e.ctrlKey;s&&t===Enums.Key.s?(e.preventDefault(),e.returnValue=!1,this.isEnableSaving()&&this.saveCommand()):s&&t===Enums.Key.Enter&&""!==this.toAddr()&&this.sendCommand()}},this))},i.prototype.getMessageOnRoute=function(){var e=C.parseCompose(this.routeParams());""!==this.routeType()&&e.MessageFolderName&&e.MessageUid&&L.getMessage(e.MessageFolderName,e.MessageUid,this.onMessageResponse,this)},i.prototype.onShow=function(){var e=this.focusedField();n(this.splitterDom()).trigger("resize"),n(this.bottomPanel()).trigger("resize"),this.oHtmlEditor.isInitialized()||(this.oHtmlEditor.init(this.textBody(),this.plainText(),"7"),this.oHtmlEditor.commit()),this.initUploader(),this.backToListOnSendOrSave(!1),this.focusedField(e),O.addClass("screen-compose"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0),this.visibleSaveTemplateControl(L.getCurrentTemplateFolders().length>0)},i.prototype.reset=function(){this.plainText(!1),this.bUploadStatus=!1,window.clearTimeout(this.iUploadAttachmentsTimer),this.messageUploadAttachmentsStarted(!1),this.templateUid(""),this.templateFolderName(L.getTemplateFolder()),this.draftUid(""),this.draftInfo.removeAll(),this.setDataFromMessage(new P),this.isDraftsCleared(!1),this.ignoreHasUnsavedChanges(!1)},i.prototype.onRoute=function(e){var t=C.parseCompose(e);switch(w.changeCurrentAccountByHash(t.AccountHash),this.reset(),this.routeType(t.RouteType),this.routeType()){case Enums.ReplyType.ForwardAsAttach:this.routeParams(e),this.fillDefault(t);case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:case Enums.ReplyType.Resend:case Enums.ReplyType.Forward:case"drafts":this.routeParams(e),0!==this.folderList().iAccountId&&this.getMessageOnRoute();break;default:this.routeParams(e),this.fillDefault(t)}},i.prototype.fillDefault=function(e){var t=I.getSignatureText(this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),s=k?k.getComposedMessage(window.name):null,i=e.ToAddr;s?(this.setMessageDataInNewTab(s),this.changedInPreviousWindow()&&o.defer(o.bind(this.executeSave,this,!0))):""!==t&&this.textBody("<br /><br />"+t+"<br />"),i&&(this.setRecipient(this.toAddr,i.to),i.hasMailto&&(this.subject(i.subject),this.setRecipient(this.ccAddr,i.cc),this.setRecipient(this.bccAddr,i.bcc),""!==i.body&&this.textBody("<div>"+i.body+"</div>"))),this.routeType()===Enums.ReplyType.ForwardAsAttach&&e.Object&&this.addMessageAsAttachment(e.Object),"attachments"===this.routeType()&&e.Object&&this.addAttachments(e.Object),o.defer(o.bind(function(){this.focusAfterFilling()},this)),this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(!0)},i.prototype.focusToAddr=function(){n(this.toAddrDom()).inputosaurus("focus")},i.prototype.focusCcAddr=function(){n(this.ccAddrDom()).inputosaurus("focus")},i.prototype.focusBccAddr=function(){n(this.bccAddrDom()).inputosaurus("focus")},i.prototype.focusAfterFilling=function(){switch(this.focusedField()){case"to":this.focusToAddr();break;case"cc":this.visibleCc(!0),this.focusCcAddr();break;case"bcc":this.visibleBcc(!0),this.focusBccAddr();break;case"subject":this.subjectFocused(!0);break;case"text":this.oHtmlEditor.setFocus();break;default:0===this.toAddr().length?this.focusToAddr():0===this.subject().length?this.subjectFocused(!0):this.oHtmlEditor.setFocus()}},i.prototype.onHide=function(){!o.isFunction(this.closePopup)&&this.hasUnsavedChanges()&&this.executeSave(!0),this.headersCompressed(!1),this.routeParams([]),this.subjectFocused(!1),this.focusedField(""),this.messageUploadAttachmentsStarted(!1),O.removeClass("screen-compose").removeClass("screen-compose-cc").removeClass("screen-compose-bcc").removeClass("screen-compose-attachments"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},i.prototype.setRecipient=function(e,t){e()===t?e.valueHasMutated():e(t)},i.prototype.onMessageResponse=function(e){var t=null;if(null===e)this.setDataFromMessage(new P);else{switch(this.routeType()){case Enums.ReplyType.Reply:case Enums.ReplyType.ReplyAll:N.setFetcherOrIdentityByReplyMessage(e),t=I.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.setRecipient(this.toAddr,t.To),this.setRecipient(this.ccAddr,t.Cc),this.setRecipient(this.bccAddr,t.Bcc),this.subject(t.Subject),this.textBody(t.Text),this.attachments(t.Attachments),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.ForwardAsAttach:t=I.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.Forward:N.setFetcherOrIdentityByReplyMessage(e),t=I.getReplyDataFromMessage(e,this.routeType(),this.senderAccountId(),this.selectedFetcherOrIdentity(),!0),this.draftInfo(t.DraftInfo),this.draftUid(t.DraftUid),this.setRecipient(this.toAddr,t.To),this.setRecipient(this.ccAddr,t.Cc),this.subject(t.Subject),this.textBody(t.Text),this.attachments(t.Attachments),this.inReplyTo(t.InReplyTo),this.references(t.References);break;case Enums.ReplyType.Resend:this.setDataFromMessage(e);break;case"drafts":-1!==n.inArray(e.folder(),L.getCurrentTemplateFolders())?(this.templateUid(e.uid()),this.templateFolderName(e.folder())):this.draftUid(e.uid()),this.setDataFromMessage(e)}this.routeType()!==Enums.ReplyType.ForwardAsAttach&&this.attachments().length>0&&this.requestAttachmentsTempName(),this.routeType("")}this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(!0),o.defer(o.bind(function(){this.focusAfterFilling()},this))},i.prototype.setDataFromMessage=function(e){var t="",s=I.getFirstFetcherOrIdentityByRecipientsOrDefault(e.oFrom.aCollection,e.accountId());N.changeSenderAccountId(e.accountId(),s),t=e.isPlain()?e.textRaw():e.getConvertedHtml(),this.draftInfo(e.draftInfo()),this.inReplyTo(e.inReplyTo()),this.references(e.references()),this.setRecipient(this.toAddr,e.oTo.getFull()),this.setRecipient(this.ccAddr,e.oCc.getFull()),this.setRecipient(this.bccAddr,e.oBcc.getFull()),this.subject(e.subject()),this.attachments(e.attachments()),this.plainText(e.isPlain()),this.textBody(t),this.selectedImportance(e.importance()),this.sendReadingConfirmation(""!==e.readingConfirmationAddressee()),o.each(this.toolbarControllers(),function(t){o.isFunction(t.doAfterPopulatingMessage)&&t.doAfterPopulatingMessage({bDraft:!!e.folderObject()&&e.folderObject().type()===Enums.FolderTypes.Drafts,bPlain:e.isPlain(),sRawText:e.textRaw(),iSensitivity:e.sensitivity()})})},i.prototype.onDataAsAttachmentUpload=function(e,t){var s=t.Parameters,i=e.Result,n=s.Hash,r=o.find(this.attachments(),function(e){return e.hash()===n});this.messageUploadAttachmentsStarted(!1),r&&(i&&i.Attachment?r.parseFromUpload(i.Attachment):r.errorFromUpload())},i.prototype.addAttachments=function(e){o.each(e,o.bind(function(e){var t=new _;t.parseFromUpload(e),this.attachments.push(t)},this))},i.prototype.addFilesAsAttachment=function(e){var t=null,s=[];o.each(e,function(e){t=new _,t.fileName(e.fileName()),t.hash(e.hash()),t.thumbUrlInQueue(e.thumbUrlInQueue()),t.uploadStarted(!0),this.attachments.push(t),s.push(e.hash())},this),s.length>0&&(this.messageUploadAttachmentsStarted(!0),M.send("Files","GetFilesForUpload",{Hashes:s},this.onFilesUpload,this))},i.prototype.onFilesUpload=function(e,t){var s=t.Parameters,i=e.Result,n=s.Hashes;this.messageUploadAttachmentsStarted(!1),o.isArray(i)?o.each(i,function(e){var t=o.find(this.attachments(),function(t){return t.hash()===e.Hash});t&&(t.parseFromUpload(e),t.hash(e.NewHash))},this):o.each(n,function(e){var t=o.find(this.attachments(),function(t){return t.hash()===e});t&&t.errorFromUpload()},this)},i.prototype.addMessageAsAttachment=function(e){var t=new _,s=null;e&&(t.fileName(e.subject()+".eml"),t.uploadStarted(!0),this.attachments.push(t),s={MessageFolder:e.folder(),MessageUid:e.uid(),FileName:t.fileName()},this.messageUploadAttachmentsStarted(!0),T.send("SaveMessageAsTempFile",s,this.onSaveMessageAsTempFile,this))},i.prototype.onSaveMessageAsTempFile=function(e,t){var s=e.Result,i=t.Parameters.FileName,n=null;this.messageUploadAttachmentsStarted(!1),s?(n=o.find(this.attachments(),function(e){return e.fileName()===i&&e.uploadStarted()}),n&&n.parseFromUpload(s,t.Parameters.MessageFolder,t.Parameters.MessageUid)):(n=o.find(this.attachments(),function(e){return e.fileName()===i&&e.uploadStarted()}),n&&n.errorFromUpload())},i.prototype.onContactVCardUpload=function(e,t){var s=t.Parameters,i=e.Result,n=null;this.messageUploadAttachmentsStarted(!1),i?(n=o.find(this.attachments(),function(e){return e.fileName()===i.Name&&e.uploadStarted()}),n&&n.parseFromUpload(i)):(n=o.find(this.attachments(),function(e){return e.fileName()===s.Name&&e.uploadStarted()}),n&&n.errorFromUpload())},i.prototype.requestAttachmentsTempName=function(){var e=o.map(this.attachments(),function(e){return e.uploadUid(e.hash()),e.uploadStarted(!0),e.hash()});e.length>0&&(this.messageUploadAttachmentsStarted(!0),T.send("SaveAttachmentsAsTempFiles",{Attachments:e},this.onMessageUploadAttachmentsResponse,this))},i.prototype.onMessageUploadAttachmentsResponse=function(e,t){var s=t.Parameters.Attachments;this.messageUploadAttachmentsStarted(!1),e.Result?o.each(e.Result,o.bind(this.setAttachTepmNameByHash,this)):(o.each(s,function(e){var t=o.find(this.attachments(),function(t){return t.hash()===e});t&&t.errorFromUpload()},this),b.showError(h.i18n("MAILWEBCLIENT/ERROR_UPLOAD_FORWARD_ATTACHMENTS")))},i.prototype.setAttachTepmNameByHash=function(e,t){o.each(this.attachments(),function(s){s.hash()===e&&(s.tempName(t),s.uploadStarted(!1))})},i.prototype.setMessageDataInNewTab=function(e){this.templateUid(e.templateUid),this.templateFolderName(e.templateFolderName),this.draftInfo(e.draftInfo),this.draftUid(e.draftUid),this.inReplyTo(e.inReplyTo),this.references(e.references),this.setRecipient(this.toAddr,e.toAddr),this.setRecipient(this.ccAddr,e.ccAddr),this.setRecipient(this.bccAddr,e.bccAddr),this.subject(e.subject),this.attachments(o.map(e.attachments,function(e){var t=new _;return t.parse(e),t},this)),this.plainText(e.plainText),this.textBody(e.textBody),this.selectedImportance(e.selectedImportance),this.sendReadingConfirmation(e.sendReadingConfirmation),this.changedInPreviousWindow(e.changedInPreviousWindow),o.each(this.toolbarControllers(),function(t){o.isFunction(t.doAfterApplyingMainTabParameters)&&t.doAfterApplyingMainTabParameters(e)}),N.changeSenderAccountId(e.senderAccountId,e.selectedFetcherOrIdentity),this.focusedField(e.focusedField)},i.prototype.commit=function(e){this.toAddr.commit(),this.ccAddr.commit(),this.bccAddr.commit(),this.subject.commit(),this.selectedImportance.commit(),this.sendReadingConfirmation.commit(),o.each(this.toolbarControllers(),function(e){o.isFunction(e.commit)&&e.commit()}),this.oHtmlEditor.commit(),this.attachmentsChanged(!1),e||this.changedInPreviousWindow(!1)},i.prototype.isChanged=function(){var e=this.toAddr.changed(),t=this.ccAddr.changed(),s=this.bccAddr.changed(),i=this.subject.changed(),n=this.selectedImportance.changed(),r=this.sendReadingConfirmation.changed(),a=!1,l=this.oHtmlEditor.textChanged(),h=this.attachmentsChanged(),c=this.changedInPreviousWindow();return o.each(this.toolbarControllers(),function(e){o.isFunction(e.isChanged)&&(a=a||e.isChanged())}),e||t||s||i||n||r||a||l||h||c},i.prototype.executeBackToList=function(){d.isNewTab()?window.close():this.shown&&this.shown()&&f.setPreviousHash(),this.backToListOnSendOrSave(!1)},i.prototype.onFileUploadSelect=function(e,t){var s;return!l.showErrorIfAttachmentSizeLimit(t.FileName,c.pInt(t.Size))&&(s=new _,s.onUploadSelect(e,t),this.attachments.push(s),!0)},i.prototype.getAttachmentByUid=function(e){return o.find(this.attachments(),function(t){return t.uploadUid()===e})},i.prototype.onFileUploadStart=function(e){var t=this.getAttachmentByUid(e);t&&t.onUploadStart()},i.prototype.onFileUploadProgress=function(e,t,s){var i=this.getAttachmentByUid(e);i&&i.onUploadProgress(t,s)},i.prototype.onFileUploadComplete=function(e,t,s){var i=this.getAttachmentByUid(e);i&&i.onUploadComplete(e,t,s);
},i.prototype.onFileRemove=function(e){var t=this.getAttachmentByUid(e);this.oJua&&this.oJua.cancel(e),this.attachments.remove(t)},i.prototype.initUploader=function(){this.composeShown()&&this.composeUploaderButton()&&null===this.oJua&&(this.oJua=new m({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.composeUploaderButton(),hiddenElementsPosition:v.IsRTL?"right":"left",dragAndDropElement:this.composeUploaderDropPlace(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:o.extendOwn({Module:R.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:L.currentAccountId()})}},d.getCommonRequestParameters())}),this.oJua.on("onDragEnter",o.bind(this.composeUploaderDragOver,this,!0)).on("onDragLeave",o.bind(this.composeUploaderDragOver,this,!1)).on("onBodyDragEnter",o.bind(this.composeUploaderBodyDragOver,this,!0)).on("onBodyDragLeave",o.bind(this.composeUploaderBodyDragOver,this,!1)).on("onProgress",o.bind(this.onFileUploadProgress,this)).on("onSelect",o.bind(this.onFileUploadSelect,this)).on("onStart",o.bind(this.onFileUploadStart,this)).on("onComplete",o.bind(this.onFileUploadComplete,this)),this.allowDragNDrop(this.oJua.isDragAndDropSupported()))},i.prototype.getSendSaveParameters=function(e,t){var s=I.convertAttachmentsForSending(this.attachments()),i=null;return o.each(this.oHtmlEditor.getUploadedImagesData(),function(e){s[e.TempName]=[e.Name,e.CID,"1","1"]}),i={AccountID:this.senderAccountId(),FetcherID:this.selectedFetcherOrIdentity()&&this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",IdentityID:this.selectedFetcherOrIdentity()&&!this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",DraftInfo:this.draftInfo(),DraftUid:this.draftUid(),To:this.toAddr(),Cc:this.ccAddr(),Bcc:this.bccAddr(),Subject:this.subject(),Text:this.plainText()?this.oHtmlEditor.getPlainText():this.oHtmlEditor.getText(e),IsHtml:!this.plainText(),Importance:this.selectedImportance(),SendReadingConfirmation:this.sendReadingConfirmation(),Attachments:s,InReplyTo:this.inReplyTo(),References:this.references()},o.each(this.toolbarControllers(),function(e){o.isFunction(e.doAfterPreparingSendMessageParameters)&&e.doAfterPreparingSendMessageParameters(i)}),""!==this.templateFolderName()&&t&&(i.DraftFolder=this.templateFolderName(),i.DraftUid=this.templateUid()),i},i.prototype.onSendOrSaveMessageResponse=function(e,t){var s=I.onSendOrSaveMessageResponse(e,t,this.requiresPostponedSending()),n=t.Parameters;switch(this.commit(),s.Method){case"SaveMessage":s.Result&&t.DraftUid===this.templateUid()&&t.DraftFolder===this.templateFolderName()?(this.templateUid(c.pString(s.NewUid)),this instanceof i&&f.replaceHashDirectly(C.getComposeFromMessage("drafts",n.DraftFolder,this.templateUid()))):s.Result&&n.DraftUid===this.draftUid()&&(this.draftUid(c.pString(s.NewUid)),this instanceof i&&f.replaceHashDirectly(C.getComposeFromMessage("drafts",n.DraftFolder,this.draftUid()))),this.saving(!1);break;case"SendMessage":s.Result&&this.backToListOnSendOrSave()&&(o.isFunction(this.closePopup)?this.closePopup():this.executeBackToList()),this.sending(!1)}},i.prototype.verifyDataForSending=function(){var e=a.getIncorrectEmailsFromAddressString(this.toAddr()),t=a.getIncorrectEmailsFromAddressString(this.ccAddr()),s=a.getIncorrectEmailsFromAddressString(this.bccAddr()),i=o.union(e,t,s),n=o.map(i,function(e){return h.encodeHtml(e)}),r=h.i18n("MAILWEBCLIENT/ERROR_INPUT_CORRECT_EMAILS")+n.join(", ");return!(i.length>0)||(E.showPopup(S,[r]),!1)},i.prototype.executeSend=function(e){var t=!1,s=o.bind(function(){this.sending(!0),this.requiresPostponedSending(!this.allowStartSending()),I.send("SendMessage",this.getSendSaveParameters(!0),!0,this.onSendOrSaveMessageResponse,this,this.requiresPostponedSending()),this.backToListOnSendOrSave(!0)},this);this.isEnableSending()&&this.verifyDataForSending()&&(o.each(this.toolbarControllers(),function(e){o.isFunction(e.doBeforeSend)&&(t=t||e.doBeforeSend(s))}),t||s())},i.prototype.executeSaveCommand=function(){this.draftFolderIsAvailable()&&this.executeSave(!1)},i.prototype.executeTemplateSaveCommand=function(){this.executeSave(!1,!0,!0)},i.prototype.executeSave=function(e,t,s){e=!!e,t=void 0===t||t,s=!!s;var i=t?this.onSendOrSaveMessageResponse:I.onSendOrSaveMessageResponse,n=t?this:I,r=o.bind(function(o){o&&(this.saving(t),I.send("SaveMessage",this.getSendSaveParameters(!1,s),!e,i,n))},this),a=!1;this.isEnableSaving()&&(e&&!this.isChanged()||(e||o.each(this.toolbarControllers(),function(e){o.isFunction(e.doBeforeSave)&&(a=a||e.doBeforeSave(r))},this),a||r(!0)),this.backToListOnSendOrSave(!0))},i.prototype.changeBccVisibility=function(){this.visibleBcc(!this.visibleBcc()),this.visibleBcc()?this.focusBccAddr():this.focusToAddr()},i.prototype.changeCcVisibility=function(){this.visibleCc(!this.visibleCc()),this.visibleCc()?this.focusCcAddr():this.focusToAddr()},i.prototype.getMessageDataForNewTab=function(){var e=o.map(this.attachments(),function(e){return{"@Object":"Object/Aurora\\Modules\\Mail\\Classes\\Attachment",FileName:e.fileName(),TempName:e.tempName(),MimeType:e.mimeType(),MimePartIndex:e.mimePartIndex(),EstimatedSize:e.size(),CID:e.cid(),ContentLocation:e.contentLocation(),IsInline:e.inline(),IsLinked:e.linked(),Hash:e.hash()}}),t=null;return t={accountId:this.senderAccountId(),templateUid:this.templateUid(),templateFolderName:this.templateFolderName(),draftInfo:this.draftInfo(),draftUid:this.draftUid(),inReplyTo:this.inReplyTo(),references:this.references(),senderAccountId:this.senderAccountId(),selectedFetcherOrIdentity:this.selectedFetcherOrIdentity(),toAddr:this.toAddr(),ccAddr:this.ccAddr(),bccAddr:this.bccAddr(),subject:this.subject(),attachments:e,plainText:this.plainText(),textBody:this.plainText()?this.oHtmlEditor.getPlainText():this.oHtmlEditor.getText(),selectedImportance:this.selectedImportance(),sendReadingConfirmation:this.sendReadingConfirmation(),changedInPreviousWindow:this.isChanged(),focusedField:this.focusedField()},o.each(this.toolbarControllers(),function(e){o.isFunction(e.doAfterPreparingMainTabParameters)&&e.doAfterPreparingMainTabParameters(t)}),t},i.prototype.openInNewWindow=function(){var e="id"+Math.random(),t={},s=null,i=f.buildHashFromArray(C.getCompose());this.ignoreHasUnsavedChanges(!0),t=this.getMessageDataForNewTab(),this.draftUid().length>0&&!this.isChanged()?(i=f.buildHashFromArray(C.getComposeFromMessage("drafts",L.folderList().draftsFolderFullName(),this.draftUid(),!0)),s=y.openTab("?message-newtab"+i)):this.templateUid().length>0&&!this.isChanged()?(i=f.buildHashFromArray(C.getComposeFromMessage("drafts",this.templateFolderName(),this.templateUid(),!0)),s=y.openTab("?message-newtab"+i)):this.isChanged()?(D.passComposedMessage(e,t),s=y.openTab("?message-newtab"+i,e)):(this.routeParams().length>0&&(i=f.buildHashFromArray(o.union([R.HashModuleName+"-compose"],this.routeParams()))),s=y.openTab("?message-newtab"+i)),this.commit(),o.isFunction(this.closePopup)?this.closePopup():this.executeBackToList()},i.prototype.onShowFilesPopupClick=function(){this.bAllowFiles&&E.showPopup(F,[o.bind(this.addFilesAsAttachment,this)])},i.prototype.registerOwnToolbarControllers=function(){this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_BackButtonView",sId:"back",bOnlyMobile:!0,backToListCommand:this.backToListCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SendButtonView",sId:"send",bAllowMobile:!0,sendCommand:this.sendCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SaveButtonView",sId:"save",bAllowMobile:!0,visible:this.draftFolderIsAvailable,saveCommand:this.saveCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_SaveTemplateButtonView",sId:"save-template",bAllowMobile:!1,visible:this.visibleSaveTemplateControl,saveTemplateCommand:this.saveTemplateCommand}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_ImportanceDropdownView",sId:"importance",selectedImportance:this.selectedImportance}),this.registerToolbarController({ViewTemplate:"MailWebclient_Compose_ConfirmationCheckboxView",sId:"confirmation",sendReadingConfirmation:this.sendReadingConfirmation})},i.prototype.registerToolbarController=function(e){var t=d.isMobile()?e.bAllowMobile:!e.bOnlyMobile,s=R.ComposeToolbarOrder.length;t&&(this.toolbarControllers.push(e),this.toolbarControllers(o.sortBy(this.toolbarControllers(),function(e){var t=o.indexOf(R.ComposeToolbarOrder,e.sId);return t!==-1?t:s})),o.isFunction(e.assignComposeExtInterface)&&e.assignComposeExtInterface(this.getExtInterface()))},i.prototype.getExtInterface=function(){return{isHtml:o.bind(function(){return!this.plainText()},this),hasAttachments:o.bind(function(){return this.notInlineAttachments().length>0},this),getPlainText:o.bind(this.oHtmlEditor.getPlainText,this.oHtmlEditor),getFromEmail:o.bind(function(){return w.getEmail(this.senderAccountId())},this),getRecipientEmails:o.bind(function(){return this.recipientEmails()},this),saveSilently:o.bind(this.executeSave,this,!0),setPlainTextMode:o.bind(this.plainText,this,!0),setPlainText:o.bind(function(e){this.textBody(e)},this),setHtmlTextMode:o.bind(this.plainText,this,!1),setHtmlText:o.bind(function(e){this.textBody(e)},this),undoHtml:o.bind(this.oHtmlEditor.undoAndClearRedo,this.oHtmlEditor)}},e.exports=i},336:function(e,t,s){(function(t){"use strict";function i(e,t,s,i){var o=r.i18n("MAILWEBCLIENT/TEXT_REPLY_MESSAGE",{DATE:e.oDateModel.getDate(),TIME:e.oDateModel.getTime(),SENDER:r.encodeHtml(e.oFrom.getFull())}),n="<br /><br />"+this.getSignatureText(t,s,i)+'<br /><br /><div data-anchor="reply-title">'+o+"</div><blockquote>"+e.getConvertedHtml()+"</blockquote>";return n}function o(e,t,s){var i=new p,o=n.union(e.oTo.aCollection,e.oCc.aCollection,e.oBcc.aCollection),r=n.find(g.collection(),function(e){return e.id()===t},this),a=new d,l=new d;return a.sEmail=r.email(),l.sEmail=s?s.email():"",i.addCollection(o),i.excludeCollection(n.union(e.oFrom.aCollection,[a,l])),i.getFull()}var n=s(2),r=s(185),a=s(181),l=s(186),h=s(182),c=s(195),u=s(188),d=s(324),p=s(323),m=s(325),g=s(314),f=s(315),b=s(316),v=s(313),y=h.isNewTab()&&window.opener&&window.opener.MainTabMailMethods,A={sReplyText:"",sReplyDraftUid:"",oPostponedMailData:null};A.setReplyData=function(e,t){this.sReplyText=e,this.sReplyDraftUid=t},A.send=function(e,t,s,i,o,n){var l=t.AccountID,h=g.getAccount(l),d=b.oFolderListItems[l],p="",m=d?d.sentFolderFullName():"",v=d?d.draftsFolderFullName():"",A=h?h.email():"",E=t.To.indexOf(A)>-1||t.Cc.indexOf(A)>-1||t.Bcc.indexOf(A)>-1;switch(h.bSaveRepliesToCurrFolder&&!E&&a.isNonEmptyArray(t.DraftInfo,3)&&(m=t.DraftInfo[2]),t.Method=e,t.ShowReport=s,e){case"SendMessage":p=r.i18n("COREWEBCLIENT/INFO_SENDING"),t.SentFolder=m,""!==t.DraftUid&&(t.DraftFolder=v,y?(y.removeOneMessageFromCacheForFolder(t.AccountID,t.DraftFolder,t.DraftUid),y.replaceHashWithoutMessageUid(t.DraftUid)):(b.removeOneMessageFromCacheForFolder(t.AccountID,t.DraftFolder,t.DraftUid),c.replaceHashWithoutMessageUid(t.DraftUid)));break;case"SaveMessage":p=r.i18n("MAILWEBCLIENT/INFO_SAVING"),void 0===t.DraftFolder&&(t.DraftFolder=v),b.savingDraftUid(t.DraftUid),y?(y.startMessagesLoadingWhenDraftSaving(t.AccountID,t.DraftFolder),y.replaceHashWithoutMessageUid(t.DraftUid)):(b.startMessagesLoadingWhenDraftSaving(t.AccountID,t.DraftFolder),c.replaceHashWithoutMessageUid(t.DraftUid))}s&&u.showLoading(p),n?this.postponedMailData={Parameters:t,SendMessageResponseHandler:i,SendMessageResponseContext:o}:f.send(e,t,i,o)},A.sendPostponedMail=function(e){var t=this.postponedMailData,s=t.Parameters,i=s.AccountID,o=b.oFolderListItems[i],n=o?o.draftsFolderFullName():"";""!==e&&(s.DraftUid=e,s.DraftFolder=n,y?(y.removeOneMessageFromCacheForFolder(s.AccountID,s.DraftFolder,s.DraftUid),y.replaceHashWithoutMessageUid(s.DraftUid)):(b.removeOneMessageFromCacheForFolder(s.AccountID,s.DraftFolder,s.DraftUid),c.replaceHashWithoutMessageUid(s.DraftUid))),this.postponedMailData&&(f.send(s.Method,s,t.SendMessageResponseHandler,t.SendMessageResponseContext),this.postponedMailData=null)},A.sendReplyMessage=function(e,t,s,i,o,n){var r=null,a=b.currentMessage(),l=[],h=null;a&&(l=a.oTo.aCollection.concat(a.oCc.aCollection),h=this.getFirstFetcherOrIdentityByRecipientsOrDefault(l,a.accountId()),r=this.getReplyDataFromMessage(a,Enums.ReplyType.ReplyAll,a.accountId(),h,!1,t,s),r.AccountID=a.accountId(),h&&(r.FetcherID=h&&h.FETCHER?h.id():"",r.IdentityID=h&&!h.FETCHER?h.id():""),r.Bcc="",r.Importance=Enums.Importance.Normal,r.SendReadingConfirmation=!1,r.IsQuickReply=!0,r.IsHtml=!0,r.Attachments=this.convertAttachmentsForSending(r.Attachments),this.send(e,r,!1,i,o,n))},A.convertAttachmentsForSending=function(e){var t={};return n.each(e,function(e){t[e.tempName()]=[e.fileName(),e.linked()?e.cid():"",e.inline()?"1":"0",e.linked()?"1":"0",e.contentLocation()]}),t},A.onSendOrSaveMessageResponse=function(e,s,i){var o,a,h,c=s.Parameters,d=!!e.Result;switch(i||u.hideLoading(),s.Method){case"SaveMessage":b.savingDraftUid(""),d?(c.ShowReport&&!i&&(-1!==t.inArray(s.Parameters.DraftFolder,b.getCurrentTemplateFolders())?u.showReport(r.i18n("MAILWEBCLIENT/REPORT_TEMPLATE_SAVED")):u.showReport(r.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SAVED"))),e.Result.NewUid||(v.AllowAutosaveInDrafts=!1)):c.ShowReport&&(-1!==t.inArray(s.Parameters.DraftFolder,b.getCurrentTemplateFolders())?l.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_TEMPLATE_SAVING")):l.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_MESSAGE_SAVING")));break;case"SendMessage":d?(c.IsQuickReply?u.showReport(r.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")):y?y.showReport(r.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")):u.showReport(r.i18n("MAILWEBCLIENT/REPORT_MESSAGE_SENT")),n.isArray(c.DraftInfo)&&3===c.DraftInfo.length&&(h=c.DraftInfo[0],a=c.DraftInfo[1],o=c.DraftInfo[2],b.markMessageReplied(c.AccountID,o,a,h))):l.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_MESSAGE_SENDING")),c.SentFolder&&(y?y.removeMessagesFromCacheForFolder(c.AccountID,c.SentFolder):b.removeMessagesFromCacheForFolder(c.AccountID,c.SentFolder))}return c.DraftFolder&&!i&&(y?y.removeMessagesFromCacheForFolder(c.AccountID,c.DraftFolder):b.removeMessagesFromCacheForFolder(c.AccountID,c.DraftFolder)),{Method:s.Method,Result:d,NewUid:e.Result?e.Result.NewUid:""}},A.getReplyDataFromMessage=function(e,t,s,r,a,l,h){var c={DraftInfo:[],DraftUid:"",To:"",Cc:"",Bcc:"",Subject:"",Attachments:[],InReplyTo:e.messageId(),References:this.getReplyReferences(e)},u=[],d=e.oReplyTo.getFull(),p=e.oTo.getFull();switch((""===d||e.oFrom.getFirstEmail()===e.oReplyTo.getFirstEmail()&&""===e.oReplyTo.getFirstName())&&(d=e.oFrom.getFull()),l&&""!==l||(l=this.sReplyText,this.sReplyText=""),"forward"===t?c.Text=l+this.getForwardMessageBody(e,s,r):"resend"===t?(c.Text=e.getConvertedHtml(),c.Cc=e.cc(),c.Bcc=e.bcc()):c.Text=l+i.call(this,e,s,r,a),h?c.DraftUid=h:(c.DraftUid=this.sReplyDraftUid,this.sReplyDraftUid=""),t){case Enums.ReplyType.Reply:c.DraftInfo=[Enums.ReplyType.Reply,e.uid(),e.folder()],c.To=d,c.Subject=this.getReplySubject(e.subject(),!0),u=n.filter(e.attachments(),function(e){return e.linked()});break;case Enums.ReplyType.ReplyAll:c.DraftInfo=[Enums.ReplyType.ReplyAll,e.uid(),e.folder()],c.To=d,c.Cc=o(e,s,r),c.Subject=this.getReplySubject(e.subject(),!0),u=n.filter(e.attachments(),function(e){return e.linked()});break;case Enums.ReplyType.Resend:c.DraftInfo=[Enums.ReplyType.Resend,e.uid(),e.folder(),e.cc(),e.bcc()],c.To=p,c.Subject=e.subject(),u=e.attachments();break;case Enums.ReplyType.ForwardAsAttach:case Enums.ReplyType.Forward:c.DraftInfo=[Enums.ReplyType.Forward,e.uid(),e.folder()],c.Subject=this.getReplySubject(e.subject(),!1),u=e.attachments()}return n.each(u,function(e){if(e.getCopy){var t=e.getCopy();c.Attachments.push(t)}}),c},A.getReplyReferences=function(e){var t=e.references(),s=e.messageId(),i=t.indexOf(s);return i===-1&&(t+=" "+s),t},A.getClearSignature=function(e,t){var s=g.getAccount(e),i="";return t&&t.accountId()===e&&t.useSignature()?i=t.signature():s&&s.useSignature()&&(i=s.signature()),i},A.getSignatureText=function(e,t,s){var i=this.getClearSignature(e,t);return s?'<div data-anchor="signature">'+i+"</div>":"<div>"+i+"</div>"},A.getFirstFetcherOrIdentityByRecipientsOrDefault=function(e,t){var s=g.getAccount(t),i=this.getAccountFetchersIdentitiesList(s),o=[],r=null;return n.each(e,function(e){if(!r)switch(o=n.filter(i,function(t){return e.sEmail===t.email}),o.length){case 0:break;case 1:r=o[0];break;default:r=n.find(o,function(t){return e.sEmail===t.email&&e.sName===t.name}),r||(r=n.find(o,function(e){return e.isDefault}),r||(r=o[0]))}}),r||(r=n.find(i,function(e){return e.isDefault})),r&&r.result},A.getAccountFetchersIdentitiesList=function(e){var t=[];return e&&(n.each(e.fetchers(),function(e){t.push({email:e.email(),name:e.userName(),isDefault:!1,result:e})}),n.each(e.identities(),function(e){t.push({email:e.email(),name:e.friendlyName(),isDefault:e.isDefault(),result:e})})),t},A.getForwardMessageBody=function(e,t,s){var i=r.encodeHtml(e.oCc.getFull()),o=""!==i?r.i18n("MAILWEBCLIENT/TEXT_FORWARD_MESSAGE_CCPART",{CCADDR:i}):"",n=r.i18n("MAILWEBCLIENT/TEXT_FORWARD_MESSAGE",{FROMADDR:r.encodeHtml(e.oFrom.getFull()),TOADDR:r.encodeHtml(e.oTo.getFull()),CCPART:o,FULLDATE:e.oDateModel.getFullDate(),SUBJECT:r.encodeHtml(e.subject())}),a="<br /><br />"+this.getSignatureText(t,s,!0)+'<br /><br /><div data-anchor="reply-title">'+n+"</div><br /><br />"+e.getConvertedHtml();return a},A.hasReplyAllCcAddrs=function(e){var t=e.accountId(),s=e.oTo.aCollection.concat(e.oCc.aCollection),i=this.getFirstFetcherOrIdentityByRecipientsOrDefault(s,e.accountId()),n=o(e,t,i);return""!==n},A.getReplySubject=function(e,t){var s=r.i18n("MAILWEBCLIENT/TEXT_REPLY_PREFIX"),i=r.i18n("MAILWEBCLIENT/TEXT_FORWARD_PREFIX"),o=t?s:i,n=o+": "+e;return v.JoinReplyPrefixes&&(n=m.joinReplyPrefixesInSubject(n,s,i)),n},A.getHtmlFromText=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")},e.exports=A}).call(t,s(1))},337:function(e,t,s){"use strict";var i=s(182),o=s(188),n=s(195),r=s(338),a=s(314),l=s(316),h=[],c=[];if(i.isNewTab()){var u={getEditedDraftUid:function(){return l.editedDraftUid()}};window.SlaveTabMailMethods=u,e.exports={}}else{var d={showReport:function(e){o.showReport(e)},getAccountList:function(){return a},getFolderListItems:function(){return l.oFolderListItems},getUidList:function(){return l.uidList()},getComposedMessageAccountId:function(e){var t=h[e];return t?t.accountId:0},getComposedMessage:function(e){var t=h[e];return delete h[e],t},removeOneMessageFromCacheForFolder:function(e,t,s){l.removeOneMessageFromCacheForFolder(e,t,s)},replaceHashWithoutMessageUid:function(e){n.replaceHashWithoutMessageUid(e)},startMessagesLoadingWhenDraftSaving:function(e,t){l.startMessagesLoadingWhenDraftSaving(e,t)},removeMessagesFromCacheForFolder:function(e,t){l.removeMessagesFromCacheForFolder(e,t)},searchMessagesInCurrentFolder:function(e){l.searchMessagesInCurrentFolder(e)},getReplyData:function(e){var t=c[e];return delete c[e],t},deleteMessage:function(e,t){r.deleteMessages([e],t)}};window.MainTabMailMethods=d,e.exports={passReplyData:function(e,t){c[e]=t},passComposedMessage:function(e,t){h[e]=t}}}},338:function(e,t,s){"use strict";var i=s(1),o=s(185),n=s(179),r=s(221),a=s(43),l=s(192),h=s(201),c=s(316),u={};u.deleteMessages=function(e,t){i.isFunction(t)||(t=function(){});var s=c.folderList(),n=s.currentFolderFullName(),r=s.trashFolder(),a=r&&n===r.fullName(),u=s.spamFolder(),d=u&&n===u.fullName(),p=function(s){s&&(c.deleteMessages(e),t())};d?(c.deleteMessages(e),t()):a?l.showPopup(h,[o.i18n("MAILWEBCLIENT/CONFIRM_DELETE_MESSAGES_PLURAL",{},null,e.length),p,"",o.i18n("COREWEBCLIENT/ACTION_DELETE")]):r?(c.moveMessagesToFolder(r.fullName(),e),t()):r||l.showPopup(h,[o.i18n("MAILWEBCLIENT/CONFIRM_MESSAGES_DELETE_NO_TRASH_FOLDER"),p])},u.registerMailto=function(e){!window.navigator||!i.isFunction(window.navigator.registerProtocolHandler)||e&&r.getData("MailtoAsked")===!0||(window.navigator.registerProtocolHandler("mailto",n.getAppPath()+"#mail/compose/to/%s",""!==a.SiteName?a.SiteName:"WebMail"),r.setData("MailtoAsked",!0))},e.exports=u},339:function(e,t,s){"use strict";function i(){this.senderList=n.observableArray([]),this.senderAccountId=n.observable(l.currentId()),this.selectedFetcherOrIdentity=n.observable(null),this.lockSelectedSender=n.observable(!1),this.selectedSender=n.observable(""),this.selectedSender.subscribe(function(){if(!this.lockSelectedSender()){var e=l.getAccount(this.senderAccountId()),t=this.selectedSender(),s=null;r.isNonEmptyString(t)&&(0===t.indexOf("fetcher")?(t=t.replace("fetcher",""),s=o.find(e.fetchers(),function(e){return e.id()===r.pInt(t)})):s=o.find(e.identities(),function(e){return e.id()===r.pInt(t)})),s&&this.selectedFetcherOrIdentity(s)}},this)}var o=s(2),n=s(44),r=s(181),a=s(336),l=s(314);i.prototype.changeSelectedSender=function(e){if(e){var t=r.pString(e.id());e.FETCHER&&(t="fetcher"+t),o.find(this.senderList(),function(e){return e.id===t})&&(this.lockSelectedSender(!0),this.selectedSender(t),this.selectedFetcherOrIdentity(e),this.lockSelectedSender(!1))}},i.prototype.changeSenderAccountId=function(e,t){var s=!1;this.senderAccountId()!==e&&(l.hasAccountWithId(e)?(this.senderAccountId(e),s=!0):l.hasAccountWithId(this.senderAccountId())||(this.senderAccountId(l.currentId()),s=!0)),(s||0===this.senderList().length)&&(this.fillSenderList(t),s=!0),!s&&t&&this.changeSelectedSender(t)},i.prototype.fillSenderList=function(e){var t=[],s=l.getAccount(this.senderAccountId());s&&(o.isArray(s.identities())&&o.each(s.identities(),function(e){t.push({fullEmail:e.fullEmail(),id:r.pString(e.id())})},this),s.identitiesSubscribtion&&s.identitiesSubscribtion.dispose(),s.identitiesSubscribtion=s.identities.subscribe(function(){this.fillSenderList(e),this.changeSelectedSender(s.getDefaultIdentity())},this),o.each(s.fetchers(),function(e){var s=e.fullEmail();e.isEnabled()&&e.isOutgoingEnabled()&&s.length>0&&t.push({fullEmail:s,id:"fetcher"+e.id()})},this),s.fetchersSubscribtion&&s.fetchersSubscribtion.dispose(),s.fetchersSubscribtion=s.fetchers.subscribe(function(){this.fillSenderList(e)},this)),this.senderList(t),this.changeSelectedSender(e)},i.prototype.setFetcherOrIdentityByReplyMessage=function(e){var t=e.oTo.aCollection.concat(e.oCc.aCollection),s=a.getFirstFetcherOrIdentityByRecipientsOrDefault(t,e.accountId());s&&this.changeSelectedSender(s)},e.exports=new i},340:function(e,t,s){"use strict";function i(e,t){this.oParent=t,this.creaId="creaId"+(""+Math.random()).replace(".",""),this.textFocused=r.observable(!1),this.workareaDom=r.observable(),this.uploaderAreaDom=r.observable(),this.editorUploaderBodyDragOver=r.observable(!1),this.htmlEditorDom=r.observable(),this.toolbarDom=r.observable(),this.colorPickerDropdownDom=r.observable(),this.insertLinkDropdownDom=r.observable(),this.insertImageDropdownDom=r.observable(),this.isFWBold=r.observable(!1),this.isFSItalic=r.observable(!1),this.isTDUnderline=r.observable(!1),this.isTDStrikeThrough=r.observable(!1),this.isEnumeration=r.observable(!1),this.isBullets=r.observable(!1),this.isEnable=r.observable(!0),this.isEnable.subscribe(function(){this.oCrea&&this.oCrea.setEditable(this.isEnable())},this),this.bInsertImageAsBase64=e,this.bAllowFileUpload=!(e&&void 0===window.File),this.bAllowInsertImage=y.AllowInsertImage,this.lockFontSubscribing=r.observable(!1),this.bAllowImageDragAndDrop=!u.ie10AndAbove,this.aFonts=["Arial","Arial Black","Courier New","Tahoma","Times New Roman","Verdana"],this.sDefaultFont=y.DefaultFontName,this.correctFontFromSettings(),this.selectedFont=r.observable(""),this.selectedFont.subscribe(function(){!this.oCrea||this.lockFontSubscribing()||this.inactive()||this.oCrea.fontName(this.selectedFont())},this),this.iDefaultSize=y.DefaultFontSize,this.selectedSize=r.observable(0),this.selectedSize.subscribe(function(){!this.oCrea||this.lockFontSubscribing()||this.inactive()||this.oCrea.fontSize(this.selectedSize())},this),this.visibleInsertLinkPopup=r.observable(!1),this.linkForInsert=r.observable(""),this.linkFocused=r.observable(!1),this.visibleLinkPopup=r.observable(!1),this.linkPopupDom=r.observable(null),this.linkHrefDom=r.observable(null),this.linkHref=r.observable(""),this.visibleLinkHref=r.observable(!1),this.visibleImagePopup=r.observable(!1),this.visibleImagePopup.subscribe(function(){this.onImageOut()},this),this.imagePopupTop=r.observable(0),this.imagePopupLeft=r.observable(0),this.imageSelected=r.observable(!1),this.tooltipText=r.observable(""),this.tooltipPopupTop=r.observable(0),this.tooltipPopupLeft=r.observable(0),this.visibleInsertImagePopup=r.observable(!1),this.imageUploaderButton=r.observable(null),this.aUploadedImagesData=[],this.imagePathFromWeb=r.observable(""),this.visibleFontColorPopup=r.observable(!1),this.oFontColorPickerView=new A(l.i18n("MAILWEBCLIENT/LABEL_TEXT_COLOR"),this.setTextColorFromPopup,this),this.oBackColorPickerView=new A(l.i18n("MAILWEBCLIENT/LABEL_BACKGROUND_COLOR"),this.setBackColorFromPopup,this),this.inactive=r.observable(!1),this.sPlaceholderText="",this.bAllowChangeInputDirection=p.IsRTL||y.AllowChangeInputDirection,this.disableEdit=r.observable(!1),this.textChanged=r.observable(!1)}var o=s(2),n=s(1),r=s(44),a=s(205),l=s(185),h=s(181),c=s(182),u=s(180),d=s(278),p=s(43),m=s(192),g=s(193),f=s(326),b=s(341),v=s(316),y=s(313),A=s(342);i.prototype.ViewTemplate="MailWebclient_HtmlEditorView",i.prototype.setInactive=function(e){this.inactive(e),this.inactive()?this.setPlaceholder():this.removePlaceholder()},i.prototype.setPlaceholder=function(){var e=this.removeAllTags(this.getText());""!==e&&"&nbsp;"!==e||(this.setText("<span>"+this.sPlaceholderText+"</span>"),this.oCrea&&this.oCrea.setBlur())},i.prototype.removePlaceholder=function(){var e=this.oCrea?this.removeAllTags(this.oCrea.getText(!1)):"";e===this.sPlaceholderText&&(this.setText(""),this.oCrea&&this.oCrea.setFocus(!0))},i.prototype.hasOpenedPopup=function(){return this.visibleInsertLinkPopup()||this.visibleLinkPopup()||this.visibleImagePopup()||this.visibleInsertImagePopup()||this.visibleFontColorPopup()},i.prototype.setDisableEdit=function(e){this.disableEdit(!!e)},i.prototype.correctFontFromSettings=function(){var e=this.sDefaultFont,t=!1;o.each(this.aFonts,function(s){s.toLowerCase()===e.toLowerCase()&&(e=s,t=!0)}),t?this.sDefaultFont=e:this.aFonts.push(e)},i.prototype.showLinkPopup=function(e){var t=n(this.workareaDom()),s=t.closest(".panel.compose"),i=t.position(),o=e.position(),r=e.height(),a=Math.round(o.left+i.left),l=Math.round(o.top+r+i.top);this.linkHref(e.attr("href")||e.text()),n(this.linkPopupDom()).css({left:a,top:l}),n(this.linkHrefDom()).css({left:a,top:l}),u.firefox||1!==s.length||n(this.linkPopupDom()).css({"max-width":s.width()-a-40+"px","white-space":"pre-line","word-wrap":"break-word"}),this.visibleLinkPopup(!0)},i.prototype.hideLinkPopup=function(){this.visibleLinkPopup(!1)},i.prototype.showChangeLink=function(){this.visibleLinkHref(!0),this.hideLinkPopup()},i.prototype.changeLink=function(){this.oCrea.changeLink(this.linkHref()),this.hideChangeLink()},i.prototype.hideChangeLink=function(){this.visibleLinkHref(!1)},i.prototype.showImagePopup=function(e,t){var s=n(this.workareaDom()),i=s.position(),o=s.offset();this.imagePopupLeft(Math.round(t.pageX+i.left-o.left)),this.imagePopupTop(Math.round(t.pageY+i.top-o.top)),this.visibleImagePopup(!0)},i.prototype.hideImagePopup=function(){this.visibleImagePopup(!1)},i.prototype.resizeImage=function(e){var t={width:"auto",height:"auto"};switch(e){case Enums.HtmlEditorImageSizes.Small:t.width="300px";break;case Enums.HtmlEditorImageSizes.Medium:t.width="600px";break;case Enums.HtmlEditorImageSizes.Large:t.width="1200px";break;case Enums.HtmlEditorImageSizes.Original:t.width="auto"}this.oCrea.changeCurrentImage(t),this.visibleImagePopup(!1)},i.prototype.onImageOver=function(e){if("IMG"===e.target.nodeName&&!this.visibleImagePopup()){this.imageSelected(!0),this.tooltipText(l.i18n("MAILWEBCLIENT/ACTION_CLICK_TO_EDIT_IMAGE"));var t=this,s=n(this.workareaDom());s.bind("mousemove.image",function(e){var i=s.position(),o=s.offset();t.tooltipPopupTop(Math.round(e.pageY+i.top-o.top)),t.tooltipPopupLeft(Math.round(e.pageX+i.left-o.left))})}return!0},i.prototype.onImageOut=function(e){if(this.imageSelected()){this.imageSelected(!1);var t=n(this.workareaDom());t.unbind("mousemove.image")}return!0},i.prototype.commit=function(){this.textChanged(!1)},i.prototype.init=function(e,t,s,i){this.sPlaceholderText=i||"",this.oCrea?(this.oCrea.$container=n("#"+this.oCrea.oOptions.creaId),0===this.oCrea.$container.children().length&&this.oCrea.start(this.isEnable())):(n(document.body).on("click",o.bind(function(e){var t=n(e.target).parents("span.dropdown_helper");0===t.length&&this.closeAllPopups(!0)},this)),this.initEditorUploader(),this.oCrea=new b({creaId:this.creaId,fontNameArray:this.aFonts,defaultFontName:this.sDefaultFont,defaultFontSize:this.iDefaultSize,isRtl:p.IsRTL,enableDrop:!1,onChange:o.bind(this.textChanged,this,!0),onCursorMove:o.bind(this.setFontValuesFromText,this),onFocus:o.bind(this.onCreaFocus,this),onBlur:o.bind(this.onCreaBlur,this),onUrlIn:o.bind(this.showLinkPopup,this),onUrlOut:o.bind(this.hideLinkPopup,this),onImageSelect:o.bind(this.showImagePopup,this),onImageBlur:o.bind(this.hideImagePopup,this),onItemOver:u.mobileDevice||c.isMobile()?null:o.bind(this.onImageOver,this),onItemOut:u.mobileDevice||c.isMobile()?null:o.bind(this.onImageOut,this),openInsertLinkDialog:o.bind(this.insertLink,this),onUrlClicked:!0}),this.oCrea.start(this.isEnable())),this.oCrea.setTabIndex(s),this.clearUndoRedo(),this.setText(e,t),this.setFontValuesFromText(),this.aUploadedImagesData=[],this.selectedFont(this.sDefaultFont),this.selectedSize(this.iDefaultSize)},i.prototype.isInitialized=function(){return!!this.oCrea},i.prototype.setFocus=function(){this.oCrea&&this.oCrea.setFocus(!1)},i.prototype.changeSignatureContent=function(e,t){this.oCrea&&this.oCrea.changeSignatureContent(e,t)},i.prototype.setFontValuesFromText=function(){this.lockFontSubscribing(!0),this.isFWBold(this.oCrea.getIsBold()),this.isFSItalic(this.oCrea.getIsItalic()),this.isTDUnderline(this.oCrea.getIsUnderline()),this.isTDStrikeThrough(this.oCrea.getIsStrikeThrough()),this.isEnumeration(this.oCrea.getIsEnumeration()),this.isBullets(this.oCrea.getIsBullets()),this.selectedFont(this.oCrea.getFontName()),this.selectedSize(""+this.oCrea.getFontSizeInNumber()),this.lockFontSubscribing(!1)},i.prototype.isUndoAvailable=function(){return!!this.oCrea&&this.oCrea.isUndoAvailable()},i.prototype.getPlainText=function(){return this.oCrea?this.oCrea.getPlainText():""},i.prototype.getText=function(e){var t=this.oCrea?this.oCrea.getText(e):"";return""!==this.sPlaceholderText&&this.removeAllTags(t)===this.sPlaceholderText?"":t},i.prototype.setText=function(e,t){this.oCrea&&(t?this.oCrea.setPlainText(e):this.oCrea.setText(e),this.inactive()&&""===e&&this.setPlaceholder())},i.prototype.undoAndClearRedo=function(){this.oCrea&&(this.oCrea.undo(),this.oCrea.clearRedo())},i.prototype.clearUndoRedo=function(){this.oCrea&&this.oCrea.clearUndoRedo()},i.prototype.isEditing=function(){return!!this.oCrea&&this.oCrea.bEditing},i.prototype.removeAllTags=function(e){return e.replace(/<style>.*<\/style>/g,"").replace(/<[^>]*>/g,"")},i.prototype.onCreaFocus=function(){this.oCrea&&(this.closeAllPopups(),this.textFocused(!0))},i.prototype.onCreaBlur=function(){this.oCrea&&this.textFocused(!1)},i.prototype.onEscHandler=function(){m.hasOpenedMaximizedPopups()||this.closeAllPopups()},i.prototype.closeAllPopups=function(e){e=!!e,e||this.visibleLinkPopup(!1),this.visibleInsertLinkPopup(!1),this.visibleImagePopup(!1),this.visibleInsertImagePopup(!1),this.visibleFontColorPopup(!1)},i.prototype.insertHtml=function(e){this.oCrea&&(this.oCrea.isFocused()||this.oCrea.setFocus(!0),
this.oCrea.insertHtml(e,!1))},i.prototype.insertLink=function(e,t){this.inactive()||this.visibleInsertLinkPopup()||(t.stopPropagation(),this.linkForInsert(this.oCrea.getSelectedText()),this.closeAllPopups(),this.visibleInsertLinkPopup(!0),this.linkFocused(!0))},i.prototype.insertLinkFromPopup=function(e,t){this.linkForInsert().length>0&&(a.isCorrectEmail(this.linkForInsert())?this.oCrea.insertEmailLink(this.linkForInsert()):this.oCrea.insertLink(this.linkForInsert())),this.closeInsertLinkPopup(e,t)},i.prototype.closeInsertLinkPopup=function(e,t){this.visibleInsertLinkPopup(!1),t&&t.stopPropagation()},i.prototype.textColor=function(e,t){this.inactive()||(this.closeAllPopups(),this.visibleFontColorPopup()||(t.stopPropagation(),this.visibleFontColorPopup(!0),this.oFontColorPickerView.onShow(),this.oBackColorPickerView.onShow()))},i.prototype.colorToHex=function(e){if("#"===e.substr(0,1))return e;for(var t=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e),s=h.pInt(t[2]),i=h.pInt(t[3]),o=h.pInt(t[4]),n=o|i<<8|s<<16,r=n.toString(16);r.length<6;)r="0"+r;return t[1]+"#"+r},i.prototype.setTextColorFromPopup=function(e){this.oCrea.textColor(this.colorToHex(e)),this.closeAllPopups()},i.prototype.setBackColorFromPopup=function(e){this.oCrea.backgroundColor(this.colorToHex(e)),this.closeAllPopups()},i.prototype.insertImage=function(e,t){return this.inactive()||!y.AllowInsertImage||this.visibleInsertImagePopup()||(t.stopPropagation(),this.imagePathFromWeb(""),this.closeAllPopups(),this.visibleInsertImagePopup(!0),this.initUploader()),!0},i.prototype.insertWebImageFromPopup=function(e,t){y.AllowInsertImage&&this.imagePathFromWeb().length>0&&this.oCrea.insertImage(this.imagePathFromWeb()),this.closeInsertImagePopup(e,t)},i.prototype.insertComputerImageFromPopup=function(e,t){var s=new f,i="",o=!1;s.parse(t),i=s.getActionUrl("view"),y.AllowInsertImage&&i.length>0&&(o=this.oCrea.insertImage(i),o&&(n(this.oCrea.$editableArea).find('img[src="'+i+'"]').attr("data-x-src-cid",e),t.CID=e,this.aUploadedImagesData.push(t))),this.closeInsertImagePopup()},i.prototype.getUploadedImagesData=function(){return this.aUploadedImagesData},i.prototype.closeInsertImagePopup=function(e,t){this.visibleInsertImagePopup(!1),t&&t.stopPropagation()},i.prototype.initUploader=function(){this.imageUploaderButton()&&!this.oJua&&(this.oJua=new d({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.imageUploaderButton(),hiddenElementsPosition:p.IsRTL?"right":"left",disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!0,hidden:o.extendOwn({Module:y.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:v.currentAccountId()})}},c.getCommonRequestParameters())}),this.bInsertImageAsBase64?this.oJua.on("onSelect",o.bind(this.onEditorDrop,this)):this.oJua.on("onSelect",o.bind(this.onFileUploadSelect,this)).on("onComplete",o.bind(this.onFileUploadComplete,this)))},i.prototype.initEditorUploader=function(){if(y.AllowInsertImage&&this.uploaderAreaDom()&&!this.editorUploader){var e=null,t=null;this.oParent&&this.oParent.composeUploaderDragOver&&this.oParent.onFileUploadProgress&&this.oParent.onFileUploadStart&&this.oParent.onFileUploadComplete?(e=o.bind(function(){this.editorUploaderBodyDragOver(!0),this.oParent.composeUploaderDragOver(!0)},this),t=o.bind(function(){this.editorUploaderBodyDragOver(!1),this.oParent.composeUploaderDragOver(!1)},this),this.editorUploader=new d({action:"?/Api/",name:"jua-uploader",queueSize:1,dragAndDropElement:this.bAllowImageDragAndDrop?this.uploaderAreaDom():null,disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!this.bAllowImageDragAndDrop,hidden:o.extendOwn({Module:y.ServerModuleName,Method:"UploadAttachment",Parameters:function(){return JSON.stringify({AccountID:v.currentAccountId()})}},c.getCommonRequestParameters())}),this.editorUploader.on("onDragEnter",o.bind(this.oParent.composeUploaderDragOver,this.oParent,!0)).on("onDragLeave",o.bind(this.oParent.composeUploaderDragOver,this.oParent,!1)).on("onBodyDragEnter",e).on("onBodyDragLeave",t).on("onProgress",o.bind(this.oParent.onFileUploadProgress,this.oParent)).on("onSelect",o.bind(this.onEditorDrop,this)).on("onStart",o.bind(this.oParent.onFileUploadStart,this.oParent)).on("onComplete",o.bind(this.oParent.onFileUploadComplete,this.oParent))):(e=o.bind(this.editorUploaderBodyDragOver,this,!0),t=o.bind(this.editorUploaderBodyDragOver,this,!1),this.editorUploader=new d({queueSize:1,dragAndDropElement:this.bAllowImageDragAndDrop?this.uploaderAreaDom():null,disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!this.bAllowImageDragAndDrop}),this.editorUploader.on("onBodyDragEnter",e).on("onBodyDragLeave",t).on("onSelect",o.bind(this.onEditorDrop,this)))}},i.prototype.isDragAndDropSupported=function(){return!!this.editorUploader&&this.editorUploader.isDragAndDropSupported()},i.prototype.onEditorDrop=function(e,t){var s=null,i=null,o=this,n=!1,r=""+Math.random(),a="";if(t&&t.File&&"string"==typeof t.File.type)if(y.AllowInsertImage&&0===t.File.type.indexOf("image/"))i=t.File,y.ImageUploadSizeLimit>0&&i.size>y.ImageUploadSizeLimit?m.showPopup(g,[l.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE")]):(s=new window.FileReader,n=this.oCrea.isFocused(),n||this.oCrea.setFocus(!0),a=i.name+"_"+r,this.oCrea.insertHtml('<img id="'+a+'" src="./static/styles/images/wait.gif" />',!0),n||this.oCrea.fixFirefoxCursorBug(),s.onload=function(e){o.oCrea.changeImageSource(a,e.target.result)},s.readAsDataURL(i));else{if(this.oParent&&this.oParent.onFileUploadSelect)return this.oParent.onFileUploadSelect(e,t),!0;u.ie10AndAbove||m.showPopup(g,[l.i18n("MAILWEBCLIENT/ERROR_NOT_IMAGE_CHOOSEN")])}return!1},i.prototype.isFileImage=function(e){if("string"==typeof e.Type)return-1!==e.Type.indexOf("image");var t=e.FileName.lastIndexOf("."),s=e.FileName.substr(t+1),i=["jpg","jpeg","gif","tif","tiff","png"];return-1!==n.inArray(s,i)},i.prototype.onFileUploadSelect=function(e,t){return this.isFileImage(t)?(this.closeInsertImagePopup(),!0):(m.showPopup(g,[l.i18n("MAILWEBCLIENT/ERROR_NOT_IMAGE_CHOOSEN")]),!1)},i.prototype.onFileUploadComplete=function(e,t,s){var i="";s&&s.Result?s.Result.Error?(i="size"===s.Result.Error?l.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):l.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN"),m.showPopup(g,[i])):(this.oCrea.setFocus(!0),this.insertComputerImageFromPopup(e,s.Result.Attachment)):m.showPopup(g,[l.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN")])},i.prototype.undo=function(){return this.inactive()||this.oCrea.undo(),!1},i.prototype.redo=function(){return this.inactive()||this.oCrea.redo(),!1},i.prototype.bold=function(){return this.inactive()||(this.oCrea.bold(),this.isFWBold(!this.isFWBold())),!1},i.prototype.italic=function(){return this.inactive()||(this.oCrea.italic(),this.isFSItalic(!this.isFSItalic())),!1},i.prototype.underline=function(){return this.inactive()||(this.oCrea.underline(),this.isTDUnderline(!this.isTDUnderline())),!1},i.prototype.strikeThrough=function(){return this.inactive()||(this.oCrea.strikeThrough(),this.isTDStrikeThrough(!this.isTDStrikeThrough())),!1},i.prototype.numbering=function(){return this.inactive()||(this.oCrea.numbering(),this.isBullets(!1),this.isEnumeration(!this.isEnumeration())),!1},i.prototype.bullets=function(){return this.inactive()||(this.oCrea.bullets(),this.isEnumeration(!1),this.isBullets(!this.isBullets())),!1},i.prototype.removeFormat=function(){return this.inactive()||this.oCrea.removeFormat(),!1},i.prototype.setRtlDirection=function(){return this.inactive()||this.oCrea.setRtlDirection(),!1},i.prototype.setLtrDirection=function(){return this.inactive()||this.oCrea.setLtrDirection(),!1},e.exports=i},341:function(e,t,s){"use strict";function i(e){this.oOptions=o.extend({creaId:"creaId",fontNameArray:["Tahoma"],defaultFontName:"Tahoma",defaultFontSize:3,dropableArea:null,isRtl:!1,onChange:function(){},onCursorMove:function(){},onFocus:function(){},onBlur:function(){},onUrlIn:function(){},onUrlOut:function(){},onImageSelect:function(){},onImageBlur:function(){},onItemOver:null,onItemOut:null,openInsertLinkDialog:function(){},onUrlClicked:!1},void 0===e?{}:e)}var o=s(2),n=s(1),r=s(181),a=s(180);i.prototype.oOptions={},i.prototype.$container=null,i.prototype.$editableArea=null,i.prototype.aEditableAreaHtml=[],i.prototype.iUndoRedoPosition=0,i.prototype.bEditable=!1,i.prototype.bFocused=!1,i.prototype.bEditing=!1,i.prototype.aSizes=[{inNumber:1,inPixels:10},{inNumber:2,inPixels:13},{inNumber:3,inPixels:16},{inNumber:4,inPixels:18},{inNumber:5,inPixels:24},{inNumber:6,inPixels:32},{inNumber:7,inPixels:48}],i.prototype.bInUrl=!1,i.prototype.oCurrLink=null,i.prototype.oCurrImage=null,i.prototype.bInImage=!1,i.prototype.sBasicFontName="",i.prototype.sBasicFontSize="",i.prototype.sBasicDirection="",i.prototype.start=function(e){function t(e){var t=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;return t.test(e)}function s(e){return!!e.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)}this.$container=n("#"+this.oOptions.creaId),this.$editableArea=n("<div></div>").addClass("crea-content-editable").prop("contentEditable","true").appendTo(this.$container);var i=this;this.$editableArea.on("focus",function(){i.bFocused=!0}),this.$editableArea.on("blur",function(){i.bFocused=!1}),this.$editableArea.on("click","img",function(e){var t=n(this);i.bInImage=!0,i.oCurrImage=t,i.oOptions.onImageSelect(t,e),e.stopPropagation()}),this.$editableArea.on("click",function(e){i.bInImage=!1,i.oCurrImage=null,i.oOptions.onImageBlur()}),null!==i.oOptions.onItemOver&&this.$editableArea.on("mouseover",function(e){i.oOptions.onItemOver(e)}),null!==i.oOptions.onItemOver&&this.$editableArea.on("mouseout",function(e){i.oOptions.onItemOut(e)}),this.$editableArea.on("cut paste",function(){i.bEditing=!0,i.editableSave(),o.defer(function(){i.editableSave()})}),this.$editableArea.on("paste",function(e){if(e=e.originalEvent||e,e.clipboardData){var o,n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("text/html");i.pasteImage(e)?e.preventDefault():t(n)?(e.preventDefault(),i.execCom("insertHTML",'<a href="'+n+'">'+n+"</a>")):s(n)?(e.preventDefault(),i.execCom("insertHTML",'<a href="mailto:'+n+'">'+n+"</a>")):""!==r&&(e.preventDefault(),o=r.split(/<!--StartFragment-->|<!--EndFragment-->/gi),3===o.length&&(r=o[1]),r=i.replacePToBr(r),i.execCom("insertHTML",r))}}),this.$editableArea.on("keydown",function(e){var o=e.keyCode||e.which||e.charCode||0,n=e.ctrlKey||e.metaKey,r=e.altKey,a=e.shiftKey,l="";if(i.bEditing=!0,a&&n&&o===Enums.Key.z||n&&o===Enums.Key.y)e.preventDefault(),i.editableRedo();else if(n&&!r&&o===Enums.Key.z)e.preventDefault(),i.editableUndo();else if(!n||o!==Enums.Key.k&&o!==Enums.Key.b&&o!==Enums.Key.i&&o!==Enums.Key.u)r||a||n||o!==Enums.Key.Del&&o!==Enums.Key.Backspace||i.editableSave();else switch(e.preventDefault(),o){case Enums.Key.k:l=i.getSelectedText(),t(l)?i.insertLink(l):s(l)?i.insertLink("mailto:"+l):i.oOptions.openInsertLinkDialog();break;case Enums.Key.b:i.bold();break;case Enums.Key.i:i.italic();break;case Enums.Key.u:i.underline()}}),this.$editableArea.on("keyup",function(e){var t=e.keyCode||e.which||e.charCode||0,s=e.ctrlKey||e.metaKey,o=e.altKey,n=e.shiftKey;o||n||s||(t===Enums.Key.Space||t===Enums.Key.Enter||t===Enums.Key.Del||t===Enums.Key.Backspace?i.editableSave():i.oOptions.onChange())}),this.initContentEditable(),this.setEditable(e)},i.prototype.clearUndoRedo=function(){this.aEditableAreaHtml=[],this.iUndoRedoPosition=0,this.bEditing=!1},i.prototype.isUndoAvailable=function(){return this.iUndoRedoPosition>0},i.prototype.clearRedo=function(){this.aEditableAreaHtml=this.aEditableAreaHtml.slice(0,this.iUndoRedoPosition+1)},i.prototype.editableSave=function(){var e=this.$editableArea.html(),t=o.last(this.aEditableAreaHtml),s=t?t[0]:"";e!==s&&(this.clearRedo(),this.aEditableAreaHtml.push([e,this.getCaretPos(this.$editableArea[0])]),this.iUndoRedoPosition=this.aEditableAreaHtml.length-1,this.oOptions.onChange())},i.prototype.editableUndo=function(){var e=this.$editableArea.html(),t=this.aEditableAreaHtml[this.iUndoRedoPosition],s=t?t[0]:"";e!==s&&this.editableSave(),this.iUndoRedoPosition>0&&(this.iUndoRedoPosition--,this.$editableArea.html(this.aEditableAreaHtml[this.iUndoRedoPosition]),this.setCaretPos(this.$editableArea[0],this.aEditableAreaHtml[this.iUndoRedoPosition][1]))},i.prototype.editableRedo=function(){this.iUndoRedoPosition<this.aEditableAreaHtml.length-1&&(this.iUndoRedoPosition++,this.$editableArea.html(this.aEditableAreaHtml[this.iUndoRedoPosition]),this.setCaretPos(this.$editableArea[0],this.aEditableAreaHtml[this.iUndoRedoPosition]?this.aEditableAreaHtml[this.iUndoRedoPosition][1]:{}))},i.prototype.getCaretPos=function(e){var t=null,s={},i={},o=0,n={};return window.getSelection&&document.createRange?(t=window.getSelection(),t.rangeCount>0&&(s=t.getRangeAt(0),i=s.cloneRange(),i.selectNodeContents(e),i.setEnd(s.startContainer,s.startOffset),o=(""+i).length,n={start:o,end:o+(""+s).length})):document.selection&&document.body.createTextRange&&(s=document.selection.createRange(),i=document.body.createTextRange(),i.moveToElementText(e),"function"==typeof i.setEndPoint&&i.setEndPoint("EndToStart",s),o=i.text.length,n={start:o,end:o+s.text.length}),n},i.prototype.setCaretPos=function(e,t){if(window.getSelection&&document.createRange){var s=[e],i={},o={},n=!1,r=!1,a=0,l=0,h=0,c=document.createRange();for(c.setStart(e,0),c.collapse(!0),i=s.pop();!r&&i;){if(3===i.nodeType)l=a+i.length,!n&&t.start>=a&&t.start<=l&&(c.setStart(i,t.start-a),n=!0),n&&t.end>=a&&t.end<=l&&(c.setEnd(i,t.end-a),r=!0),a=l;else for(h=i.childNodes.length;h--;)s.push(i.childNodes[h]);i=s.pop()}o=window.getSelection(),o.removeAllRanges(),o.addRange(c)}else if(document.selection&&document.body.createTextRange){var u=document.body.createTextRange();u.moveToElementText(e),u.collapse(!0),u.moveEnd("character",t.end),u.moveStart("character",t.start),u.select()}},i.prototype.setTabIndex=function(e){e&&this.$editableArea.attr("tabindex",e)},i.prototype.initContentEditable=function(){this.$editableArea.bind({mousemove:o.bind(this.storeSelectionPosition,this),mouseup:o.bind(this.onCursorMove,this),keydown:o.bind(this.onButtonPressed,this),keyup:o.bind(this.onCursorMove,this),click:o.bind(this.onClickWith,this),focus:this.oOptions.onFocus,blur:this.oOptions.onBlur}),window.File&&window.FileReader&&window.FileList&&this.oOptions.enableDrop&&this.$editableArea.bind({dragover:o.bind(this.onDragOver,this),dragleave:o.bind(this.onDragLeave,this),drop:o.bind(this.onFileSelect,this)});var e=this,t=o.debounce(function(){e.oCurrLink=null,e.bInUrl=!1,e.oOptions.onUrlOut()},300);n("html, body").on("scroll",t)},i.prototype.onCursorMove=function(e){var t=-1;window.event?t=window.event.keyCode:e&&(t=e.which),13===t&&this.breakQuotes(e),17===t&&this.$editableArea.find("a").css("cursor","inherit"),8===t&&this.uniteWithNextQuote(e),46===t&&a.chrome&&this.uniteWithPrevQuote(e),this.storeSelectionPosition(),this.oOptions.onCursorMove()},i.prototype.onClickWith=function(e){e.ctrlKey&&"A"===e.target.nodeName&&window.open(e.target.href,"_blank"),this.checkAnchorNode()},i.prototype.onButtonPressed=function(e){var t=-1;window.event?t=window.event.keyCode:e&&(t=e.which),17===t&&this.$editableArea.find("a").css("cursor","pointer")},i.prototype.onFileSelect=function(e){if(e=(e&&e.originalEvent?e.originalEvent:e)||window.event){e.stopPropagation(),e.preventDefault();var t=null,s=null,i=e.files||(e.dataTransfer?e.dataTransfer.files:null),o=this;i&&1===i.length&&this.checkIsImage(i[0])&&(s=i[0],t=new window.FileReader,t.onload=function(){return function(e){o.insertImage(e.target.result)}}(),t.readAsDataURL(s))}},i.prototype.onDragLeave=function(){this.$editableArea.removeClass("editorDragOver")},i.prototype.onDragOver=function(e){e.stopPropagation(),e.preventDefault(),this.$editableArea.addClass("editorDragOver")},i.prototype.pasteImage=function(e){var t=e.clipboardData&&e.clipboardData.items,s=this,i=!1;return window.File&&window.FileReader&&window.FileList&&t&&o.each(t,function(e){if(s.checkIsImage(e)&&e.getAsFile){var t=null,o=e.getAsFile();o&&(t=new window.FileReader,t.onload=function(){return function(e){s.insertImage(e.target.result)}}(),t.readAsDataURL(o),i=!0)}}),i},i.prototype.checkIsImage=function(e){return e&&e.type&&0===e.type.indexOf("image/")},i.prototype.setPlainText=function(e){"string"!=typeof e&&(e=""),this.$editableArea&&(this.editableSave(),this.$editableArea.empty().text(e).css("white-space","pre"),this.editableSave())},i.prototype.setText=function(e){if("string"!=typeof e&&(e=""),this.$editableArea){0===e.length&&(e="<br />");var t=n(e),s=n(e),i=s.children(),o=i.first(),r=1===s.length&&"font-wrapper"===s.data("crea"),a=1===s.length&&1===i.length&&"body"===s.data("xDivType")&&"font-wrapper"===o.data("crea");r?(this.setBasicStyles(s.css("font-family"),s.css("font-size"),s.css("direction")),t=s.contents()):a?(this.setBasicStyles(o.css("font-family"),o.css("font-size"),o.css("direction")),t=o.contents()):this.setBasicStyles(this.oOptions.defaultFontName,this.convertFontSizeToPixels(this.oOptions.defaultFontSize),this.oOptions.isRtl?"rtl":"ltr"),this.$editableArea.empty().append(t).css("white-space","normal"),this.clearUndoRedo(),this.editableSave()}},i.prototype.setBasicStyles=function(e,t,s){this.sBasicFontName=e,this.sBasicFontSize=t,this.sBasicDirection=s,this.$editableArea.css({"font-family":this.getFontNameWithFamily(this.sBasicFontName),"font-size":this.sBasicFontSize,direction:this.sBasicDirection})},i.prototype.replacePToBr=function(e){return e.replace(/<\/p>/gi,"<br />").replace(/<p [^>]*>/gi,"").replace(/<p>/gi,"")},i.prototype.getPlainText=function(){var e="";return this.$editableArea&&(e=this.$editableArea.html().replace(/([^>]{1})<div>/gi,"$1\n").replace(/<style[^>]*>[^<]*<\/style>/gi,"\n").replace(/<br *\/{0,1}>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<\/div>/gi,"\n").replace(/<a [^>]*href="([^"]*?)"[^>]*>(.*?)<\/a>/gi,"$2 ($1)").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"')),e},i.prototype.getText=function(e){var t=null,s="";return this.$editableArea&&this.$editableArea.length>0&&(e&&(t=this.$editableArea.find('div[data-anchor="signature"]'),t.removeAttr("data-anchor")),s=this.$editableArea.html(),s=this.replacePToBr(s),s='<div data-crea="font-wrapper" style="font-family: '+this.sBasicFontName+"; font-size: "+this.sBasicFontSize+"; direction: "+this.sBasicDirection+'">'+s+"</div>"),s},i.prototype.changeSignatureContent=function(e,t){var s,i,o,r,a,l,h,c=this.$editableArea.find('div[data-anchor="signature"]'),u=n(e).closest('div[data-crea="font-wrapper"]'),d=n(t).closest('div[data-crea="font-wrapper"]');if(c.length>0)o=c.html(),""===t?c.html(o+e):o.indexOf(t)!==-1?c.html(o.replace(t,e)):o.indexOf(e)!==-1||(s=0===u.length||0===d.length?t:d.html(),i=0===u.length||0===d.length?e:u.html(),o.indexOf(s)!==-1?c.html(o.replace(s,e)):o.indexOf(i)!==-1||c.html(o+e));else{l=t;try{r=this.$editableArea.find('*:contains("'+l+'")')}catch(e){r=n("")}if(0===r.length&&d.length>0){l=d.html();try{r=this.$editableArea.find('*:contains("'+l+'")')}catch(e){r=n("")}}r.length>0&&(r=n(r[0]),a=r.closest("blockquote")),a&&0===a.length?r.html(r.html().replace(l,e)):(c=this.$editableArea.find('div[data-anchor="reply-title"]'),h=c.length>0?n(c[0]).closest("blockquote"):c,(0===c.length||h.length>0)&&(c=this.$editableArea.find("blockquote")),c.length>0?n(c[0]).before(n('<br /><div data-anchor="signature">'+e+"</div><br />")):this.$editableArea.append(n('<br /><div data-anchor="signature">'+e+"</div><br />")))}this.editableSave()},i.prototype.isFocused=function(){return this.bFocused},i.prototype.setFocus=function(e){var t=this.$editableArea.contents(),s=3,i=null,r="";this.$editableArea.focus(),e&&o.isArray(this.aRanges)&&this.aRanges.length>0?this.restoreSelectionPosition():t.length>0&&(t[0].nodeType===s?i=n(t[0]):(i=n(document.createTextNode("")),n(t[0]).before(i)),r=i.text(),this.setCursorPosition(i[0],r.length))},i.prototype.setBlur=function(){this.$editableArea.blur()},i.prototype.setEditable=function(e){e?this.enableContentEditable():this.disableContentEditable()},i.prototype.disableContentEditable=function(){this.bEditable=!1,this.$editableArea.prop("contentEditable","false")},i.prototype.enableContentEditable=function(){this.$editableArea.prop("contentEditable","true"),setTimeout(o.bind(function(){this.bEditable=!0},this),0)},i.prototype.fixFirefoxCursorBug=function(){a.firefox&&(this.disableContentEditable(),setTimeout(o.bind(function(){this.enableContentEditable()},this),0))},i.prototype.setRtlDirection=function(){this.setBasicStyles(this.sBasicFontName,this.sBasicFontSize,"rtl")},i.prototype.setLtrDirection=function(){this.setBasicStyles(this.sBasicFontName,this.sBasicFontSize,"ltr")},i.prototype.pasteHtmlAtCaret=function(e){var t,s;if(window.getSelection){if(t=window.getSelection(),t.getRangeAt&&t.rangeCount){s=t.getRangeAt(0),s.deleteContents();var i=document.createElement("div");i.innerHTML=e;for(var o,n,r=document.createDocumentFragment();o=i.firstChild;)n=r.appendChild(o);s.insertNode(r),n&&(s=s.cloneRange(),s.setStartAfter(n),s.collapse(!0),t.removeAllRanges(),t.addRange(s))}}else document.selection&&"Control"!==document.selection.type&&(s=document.selection.createRange(),s&&s.pasteHTML&&s.pasteHTML(e))},i.prototype.execCom=function(e,t,s){var i,o=!1;return this.bEditable&&(this.editableSave(),a.opera&&this.restoreSelectionPosition(),"insertHTML"===e&&a.ie?this.pasteHtmlAtCaret(t):o=void 0===t?window.document.execCommand(e):window.document.execCommand(e,!1,t),a.chrome&&(this.storeSelectionPosition(),"insertHTML"===e&&this.aRanges.length>0&&(i=this.aRanges[0],i.setEnd(i.startContainer,i.startOffset),this.restoreSelectionPosition())),s||this.editableSave()),o},i.prototype.insertHtml=function(e,t){this.execCom("insertHTML",e,t)},i.prototype.changeImageSource=function(e,t){this.$editableArea.find('img[id="'+e+'"]').attr("src",t),this.editableSave()},i.prototype.insertEmailLink=function(e){this.restoreSelectionPosition(),""===this.getSelectedText()?this.execCom("insertHTML",'<a href="mailto:'+e+'">'+e+"</a>"):this.insertLink("mailto:"+e)},i.prototype.insertLink=function(e){if(e=this.normaliseURL(e),this.restoreSelectionPosition(e),""===this.getSelectedText()&&a.ie)this.execCom("insertHTML",'<a href="'+e+'">'+e+"</a>");else{var t=a.ie8AndBelow?"CreateLink":"createlink";this.execCom(t,e)}this.changeFocusLink(e)},i.prototype.removeLink=function(){var e=a.ie8AndBelow?"Unlink":"unlink";this.execCom(e)},i.prototype.insertImage=function(e){var t=a.ie8AndBelow?"InsertImage":"insertimage";return this.isFocused()?this.restoreSelectionPosition():this.setFocus(!0),this.execCom(t,e)},i.prototype.numbering=function(){this.execCom("InsertOrderedList")},i.prototype.bullets=function(){this.execCom("InsertUnorderedList")},i.prototype.horizontalLine=function(){this.execCom("InsertHorizontalRule")},i.prototype.getFontNameWithFamily=function(e){var t="";switch(e){case"Arial":case"Arial Black":case"Tahoma":case"Verdana":t=", sans-serif";break;case"Courier New":t=", monospace";break;case"Times New Roman":t=", serif"}return e+t},i.prototype.fontName=function(e){var t=!this.aRanges;this.setFocus(!0),this.execCom("FontName",this.getFontNameWithFamily(e)),t&&this.setBasicStyles(e,this.sBasicFontSize,this.sBasicDirection)},i.prototype.fontSize=function(e){var t=!this.aRanges;this.setFocus(!0),this.execCom("FontSize",e),t&&this.setBasicStyles(this.sBasicFontName,this.convertFontSizeToPixels(e),this.sBasicDirection)},i.prototype.bold=function(){this.execCom("Bold"),this.$editableArea.focus()},i.prototype.italic=function(){this.execCom("Italic"),this.$editableArea.focus()},i.prototype.underline=function(){this.execCom("Underline"),this.$editableArea.focus()},i.prototype.strikeThrough=function(){this.execCom("StrikeThrough"),this.$editableArea.focus()},i.prototype.undo=function(){this.editableUndo()},i.prototype.redo=function(){this.editableRedo()},i.prototype.alignLeft=function(){this.execCom("JustifyLeft")},i.prototype.center=function(){this.execCom("JustifyCenter")},i.prototype.alignRight=function(){this.execCom("JustifyRight")},i.prototype.justify=function(){this.execCom("JustifyFull")},i.prototype.textColor=function(e){this.execCom("ForeColor",e),this.$editableArea.focus()},i.prototype.backgroundColor=function(e){var t=a.ie?"BackColor":"hilitecolor";this.execCom(t,e),this.$editableArea.focus()},i.prototype.removeFormat=function(){this.execCom("removeformat"),this.$editableArea.focus()},i.prototype.getFontName=function(){if(this.bEditable){var e=window.document.queryCommandValue("FontName"),t=this.sBasicFontName,s="";"string"==typeof e&&(e=e.replace(/'/g,""),n.each(this.oOptions.fontNameArray,function(t,i){(e.indexOf(i)>-1||e.indexOf(i.toLowerCase())>-1)&&(s=i)}),""!==s&&(t=s))}return t},i.prototype.getIsBold=function(){if(this.bEditable)var e=window.document.queryCommandState("bold");return e},i.prototype.getIsItalic=function(){if(this.bEditable)var e=window.document.queryCommandState("italic");return e},i.prototype.getIsUnderline=function(){if(this.bEditable)var e=window.document.queryCommandState("underline");return e},i.prototype.getIsEnumeration=function(){if(this.bEditable)var e=window.document.queryCommandState("insertOrderedList");return e},i.prototype.getIsBullets=function(){if(this.bEditable)var e=window.document.queryCommandState("insertUnorderedList");return e},i.prototype.getIsStrikeThrough=function(){if(this.bEditable)var e=window.document.queryCommandState("StrikeThrough");return e},i.prototype.convertFontSizeToPixels=function(e){var t=0;return n.each(this.aSizes,function(s,i){0===t&&e<=i.inNumber&&(t=i.inPixels)}),t+"px"},i.prototype.convertFontSizeToNumber=function(e){var t=r.pInt(e),s=0;return t>0&&n.each(this.aSizes,function(e,i){0===s&&t<=i.inPixels&&(s=i.inNumber)}),s},i.prototype.getFontSizeInNumber=function(){var e="",t=0;return this.bEditable&&(e=window.document.queryCommandValue("FontSize"),t=r.pInt(e)),(isNaN(t)||t<=0)&&(t=this.convertFontSizeToNumber(this.sBasicFontSize)),t},i.prototype.changeLink=function(e){var t=this.normaliseURL(e),s=n(this.oCurrLink);this.oCurrLink&&(s.attr("href")===s.text()&&s.text(t),"A"===this.oCurrLink.tagName?s.attr("href",t):s.parent().attr("href",t),this.oCurrLink=null,this.bInUrl=!1)},i.prototype.removeCurrentLink=function(){if(this.oCurrLink&&document.createRange&&window.getSelection){var e=document.createRange(),t=window.getSelection();e.selectNodeContents(this.oCurrLink),t.removeAllRanges(),t.addRange(e),this.removeLink(),this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()}},i.prototype.changeFocusLink=function(e){var t=null,s=null;a.firefox&&window.getSelection&&(t=window.getSelection(),s=t.focusNode?t.focusNode.parentElement:null,s&&"A"===s.tagName&&n(s).attr("href",e))},i.prototype.removeCurrentImage=function(){this.oCurrImage&&(this.oCurrImage.remove(),this.oCurrImage=null,this.bInImage=!1,this.oOptions.onImageBlur()),this.setFocus(!0)},i.prototype.changeCurrentImage=function(e){if(this.oCurrImage&&void 0!==e){var t=this.oCurrImage;n.each(e,function(e,s){t.css(e,s)})}this.setFocus(!0)},i.prototype.showImageTooltip=function(e){if(this.oCurrImage&&void 0!==e){var t=this.oCurrImage;n.each(e,function(e,s){t.css(e,s)})}},i.prototype.normaliseURL=function(e){return e.search(/^https?:\/\/|^mailto:|^tel:/g)!==-1?e:"http://"+e},i.prototype.getSelectedText=function(){var e="",t=null;return window.getSelection&&(t=window.getSelection(),t.rangeCount>0&&(e=""+t.getRangeAt(0))),e},i.prototype.storeSelectionPosition=function(){var e=this.getSelectionRanges();o.isArray(e)&&e.length>0&&(this.aRanges=e)},i.prototype.editableIsActive=function(){return!(!n(document.activeElement).hasClass("crea-content-editable")&&!n(document.activeElement).children().first().hasClass("crea-content-editable"))},i.prototype.getSelectionRanges=function(){var e=[];if(window.getSelection&&this.editableIsActive())for(var t=window.getSelection(),s=null,i=0,o=t.rangeCount;i<o;i++)s=t.getRangeAt(i),e.push(s);return e},i.prototype.checkAnchorNode=function(){if(window.getSelection&&this.editableIsActive()){var e=window.getSelection(),t=null;e.anchorNode&&(e.anchorNode.parentElement||e.anchorNode.parentNode)&&(t=e.anchorNode.parentElement||e.anchorNode.parentNode,"A"===t.tagName||"A"===t.parentNode.tagName||"A"===t.parentElement.tagName?this.bInUrl&&t===this.oCurrLink?this.bInUrl&&t===this.oCurrLink&&(this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()):(this.oCurrLink=t,this.bInUrl=!0,this.oOptions.onUrlIn(n(t))):this.bInUrl&&(this.oCurrLink=null,this.bInUrl=!1,this.oOptions.onUrlOut()))}},i.prototype.restoreSelectionPosition=function(e){var t="",s=null,i=null,n=null;t=this.setSelectionRanges(this.aRanges),window.getSelection&&o.isArray(this.aRanges)&&(e=void 0!==e?e:"",a.firefox&&""===t&&""!==e&&(window.getSelection&&window.getSelection().getRangeAt?(s=window.getSelection(),s.getRangeAt&&s.rangeCount>0&&(i=s.getRangeAt(0),n=i.createContextualFragment(e),i.insertNode(n))):document.selection&&document.selection.createRange&&document.selection.createRange().pasteHTML(e)))},i.prototype.setSelectionRanges=function(e){var t=null,s=null,i=0,n=0,r="";if(window.getSelection&&o.isArray(e))for(n=e.length,t=window.getSelection(),a.ie10AndAbove||t.removeAllRanges();i<n;i++)s=e[i],s&&(t.addRange(s),r+=""+s);return r},i.prototype.uniteWithNextQuote=function(){var e=window.getSelection?window.getSelection():null,t=e?e.focusNode:null,s=t?this.getLastBlockQuote(t):null,i=s?n(s).next():null,o=i&&i.length>0&&"BLOCKQUOTE"===i[0].tagName?i[0]:null,r=[],a=0,l=0,h=null;if(s&&o){for(n("<br />").appendTo(s),r=n(o).contents(),l=r.length,a=0;a<l;a++)h=r[a],n(h).appendTo(s);n(o).remove()}},i.prototype.uniteWithPrevQuote=function(){var e=window.getSelection?window.getSelection():null,t=e?e.focusNode:null,s=t?this.getLastBlockQuote(t):null;this.getPrevAndUnite(s),this.getPrevAndUnite(s)},i.prototype.getPrevAndUnite=function(e){var t=e?n(e).prev():null,s=t&&t.length>0&&"BLOCKQUOTE"===t[0].tagName?t[0]:null,i=[],o=0,r=0,a=null;if(e&&s){for(n("<br />").prependTo(e),i=n(s).contents(),r=i.length,o=r-1;o>0;o--)a=i[o],n(a).prependTo(e);n(s).remove()}},i.prototype.getLastBlockQuote=function(e){for(var t=e,s=null;t&&t.parentNode;)"BLOCKQUOTE"===t.tagName&&(s=t),t=t.parentNode;return s},i.prototype.breakQuotes=function(e){var t=window.getSelection?window.getSelection():null,s=t?t.focusNode:null,i=s?this.getLastBlockQuote(s):null;s&&i&&this.breakBlocks(s,i,t.focusOffset)},i.prototype.setCursorPosition=function(e,t){if(document.createRange&&window.getSelection){var s=document.createRange(),i=window.getSelection();i.removeAllRanges(),s.setStart(e,t),s.setEnd(e,t),s.collapse(!0),i.addRange(s),this.aRanges=[s]}},i.prototype.cloneNode=function(e){var t=null,s="";try{t=n(e).clone()}catch(i){s=e.tagName,t=n("<"+s+"></"+s+">")}return t},i.prototype.breakBlocks=function(e,t,s){for(var i=e,o=null,r=[],a=0,l=0,h=null,c=!0,u=null,d=null,p=null,m=null,g=!1,f=!0,b=null;f&&i.parentNode;){for(p=u,m=d,u=this.cloneNode(i).empty(),d=this.cloneNode(i).empty(),r=n(i).contents(),l=r.length,c=!0,null===o&&(o=r[s]),0===l&&(u=null),a=0;a<l;a++)h=r[a],h===o?(null===p?a===s&&"BR"===h.tagName||n(h).appendTo(d):(p.html().length>0&&p.appendTo(u),m.appendTo(d)),c=!1):c?n(h).appendTo(u):n(h).appendTo(d);g=t===i,g&&(f=!1),o=i,i=i.parentNode}null!==u&&null!==d&&(u.insertBefore(n(t)),b=n("<span>&nbsp;</span>").insertBefore(n(t)),n("<br>").insertBefore(n(t)),d.insertBefore(n(t)),n(t).remove(),this.setCursorPosition(b[0],0))},e.exports=i},342:function(e,t,s){"use strict";function i(e,t,s){this.aGreyColors=["rgb(0, 0, 0)","rgb(68, 68, 68)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(204, 204, 204)","rgb(238, 238, 238)","rgb(243, 243, 243)","rgb(255, 255, 255)"],this.aBrightColors=["rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],
this.aColorLines=[["rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)"],["rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)"],["rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)"],["rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)"],["rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)"],["rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]],this.caption=e,this.pickHandler=t,this.pickContext=s,this.colorPickerDom=n.observable(null)}var o=s(2),n=s(44),r=s(1);i.prototype.ViewTemplate="MailWebclient_ColorPickerView",i.prototype.onShow=function(){r(this.colorPickerDom()).find("span.color-item").on("click",o.bind(function(e){e.stopPropagation(),this.setColorFromPopup(r(e.target).data("color"))},this))},i.prototype.setColorFromPopup=function(e){this.pickHandler.call(this.pickContext,e)},e.exports=i},343:function(e,t,s){"use strict";function i(e){d=s(182),c=s(315),this.id=n.observable(l.pInt(e.AccountID)),this.email=n.observable(l.pString(e.Email)),this.friendlyName=n.observable(l.pString(e.FriendlyName)),this.incomingLogin=n.observable(l.pString(e.IncomingLogin)),this.signature=n.observable(l.pString(e.Signature)),this.useSignature=n.observable(!!e.UseSignature),this.serverId=n.observable(l.pInt(e.ServerId)),this.oServer=new b(e.Server),this.useToAuthorize=n.observable(!!e.UseToAuthorize),this.canBeUsedToAuthorize=n.observable(!!e.CanBeUsedToAuthorize),this.useThreading=n.observable(!!e.UseThreading),this.useThreading.subscribe(function(){this.requireCache(),y.clearMessagesCache(this.id())},this),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder,this.isCurrent=n.observable(!1),this.isEdited=n.observable(!1),this.hash=n.computed(function(){return h.getHash(this.id()+this.email())},this),this.passwordSpecified=n.observable(!0),this.fetchers=n.observableArray([]),this.identities=n.observable(null),this.autoresponder=n.observable(null),this.forward=n.observable(null),this.filters=n.observable(null),this.quota=n.observable(0),this.usedSpace=n.observable(0),this.quotaRecieved=n.observable(!1),this.fullEmail=n.computed(function(){return r.getFullEmail(this.friendlyName(),this.email())},this),this.bDefault=A.AllowDefaultAccountForUser&&this.email()===d.getUserPublicId(),this.aExtend=l.pObject(e.Extend)}var o=s(2),n=s(44),r=s(205),a=s(185),l=s(181),h=s(217),c=null,u=s(186),d=null,p=s(43),m=s(192),g=s(201),f=s(344),b=s(346),v=null,y=null,A=s(313);i.prototype.threadingIsAvailable=function(){return this.oServer.bEnableThreading&&this.useThreading()},i.prototype.updateFromServer=function(e){this.email(l.pString(e.Email)),this.friendlyName(l.pString(e.FriendlyName)),this.incomingLogin(l.pString(e.IncomingLogin)),this.serverId(l.pInt(e.ServerId)),this.oServer=new b(e.Server),this.useToAuthorize(!!e.UseToAuthorize),this.useThreading(!!e.UseThreading),this.bSaveRepliesToCurrFolder=!!e.SaveRepliesToCurrFolder},i.prototype.requireAccounts=function(){null===v&&(v=s(314))},i.prototype.requireCache=function(){null===y&&(y=s(316))},i.prototype.onGetQuotaResponse=function(e,t){o.isArray(e.Result)&&1<e.Result.length&&(this.quota(l.pInt(e.Result[1])),this.usedSpace(l.pInt(e.Result[0])),this.requireCache(),y.quotaChangeTrigger(!y.quotaChangeTrigger())),this.quotaRecieved(!0)},i.prototype.updateQuotaParams=function(){p.ShowQuotaBar&&c.send("GetQuota",{AccountID:this.id()},this.onGetQuotaResponse,this)},i.prototype.updateFriendlyName=function(e){this.friendlyName(e)},i.prototype.changeAccount=function(){this.requireAccounts(),v.changeCurrentAccount(this.id(),!0)},i.prototype.getDefaultIdentity=function(){return o.find(this.identities()||[],function(e){return e.isDefault()})},i.prototype.getFetchersIdentitiesEmails=function(){var e=this.identities()||[],t=[];return o.each(this.fetchers(),function(e){t.push(e.email())}),o.each(e,function(e){t.push(e.email())}),t},i.prototype.remove=function(){var e=o.bind(this.confirmedRemove,this);this.bDefault||m.showPopup(g,[a.i18n("MAILWEBCLIENT/CONFIRM_REMOVE_ACCOUNT"),e,this.email()])},i.prototype.confirmedRemove=function(e){e&&c.send("DeleteAccount",{AccountID:this.id()},this.onAccountDeleteResponse,this)},i.prototype.onAccountDeleteResponse=function(e,t){if(e.Result){var i=s(330);o.isFunction(i.closeComposePopup)&&i.closeComposePopup(),this.requireAccounts(),v.deleteAccount(this.id())}else u.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_REMOVE_ACCOUNT"))},i.prototype.requestFilters=function(){c.send("GetFilters",{AccountID:this.id()},this.onGetFiltersResponse,this)},i.prototype.onGetFiltersResponse=function(e,t){var s=new f;e.Result&&s.parse(this.id(),e.Result),this.filters(s)},e.exports=i},344:function(e,t,s){"use strict";function i(){this.iAccountId=0,this.collection=n.observableArray([])}var o=s(2),n=s(44),r=s(345);i.prototype.parse=function(e,t){var s=0,i=t.length,n=null;if(this.iAccountId=e,o.isArray(t))for(i=t.length;s<i;s++)n=new r(e),n.parse(t[s]),this.collection.push(n)},e.exports=i},345:function(e,t,s){"use strict";function i(e){this.iAccountId=e,this.enable=o.observable(!0).extend({reversible:!0}),this.field=o.observable("").extend({reversible:!0}),this.condition=o.observable("").extend({reversible:!0}),this.filter=o.observable("").extend({reversible:!0}),this.action=o.observable("").extend({reversible:!0}),this.folder=o.observable("").extend({reversible:!0})}var o=s(44),n=s(181);i.prototype.parse=function(e){this.enable(!!e.Enable),this.field(n.pInt(e.Field)),this.condition(n.pInt(e.Condition)),this.filter(n.pString(e.Filter)),this.action(n.pInt(e.Action)),this.folder(n.pString(e.FolderFullName)),this.commit()},i.prototype.revert=function(){this.enable.revert(),this.field.revert(),this.condition.revert(),this.filter.revert(),this.action.revert(),this.folder.revert()},i.prototype.commit=function(){this.enable.commit(),this.field.commit(),this.condition.commit(),this.filter.commit(),this.action.commit(),this.folder.commit()},i.prototype.toString=function(){var e=[this.enable(),this.field(),this.condition(),this.filter(),this.action(),this.folder()];return e.join(":")},e.exports=i},346:function(e,t,s){"use strict";function i(e){this.iId=e?o.pInt(e.EntityId)||o.pInt(e.ServerId):0,this.iTenantId=e?o.pInt(e.TenantId):0,this.sName=e?o.pString(e.Name):"",this.sIncomingServer=e?o.pString(e.IncomingServer):"",this.iIncomingPort=e?o.pInt(e.IncomingPort):143,this.bIncomingUseSsl=!!e&&!!e.IncomingUseSsl,this.sOutgoingServer=e?o.pString(e.OutgoingServer):"",this.iOutgoingPort=e?o.pInt(e.OutgoingPort):25,this.bOutgoingUseSsl=!!e&&!!e.OutgoingUseSsl,this.sDomains=e?o.pString(e.Domains):"",this.sSmtpAuthType=e?o.pString(e.SmtpAuthType):window.Enums.SmtpAuthType.UseUserCredentials,this.sSmtpLogin=e?o.pString(e.SmtpLogin):"",this.sSmtpPassword=e?o.pString(e.SmtpPassword):"",this.bEnableSieve=!!e&&!!e.EnableSieve,this.iSievePort=e&&e.SievePort?o.pInt(e.SievePort):4190,this.bEnableThreading=!!e&&!!e.EnableThreading,this.bUseFullEmailAddressAsLogin=!e||!!e.UseFullEmailAddressAsLogin,this.bSetExternalAccessServers=o.pBool(e&&e.SetExternalAccessServers,!1),this.sExternalAccessImapServer=o.pString(e&&e.ExternalAccessImapServer,""),this.iExternalAccessImapPort=o.pInt(e&&e.ExternalAccessImapPort,143),this.sExternalAccessSmtpServer=o.pString(e&&e.ExternalAccessSmtpServer,""),this.iExternalAccessSmtpPort=o.pInt(e&&e.ExternalAccessSmtpPort,25),this.bAllowToDelete=o.pBool(e&&e.AllowToDelete,!0),this.bAllowEditDomains=o.pBool(e&&e.AllowEditDomains,!0)}var o=s(181);e.exports=i},347:function(e,t,s){"use strict";function i(){this.FETCHER=!0,this.id=o.observable(0),this.accountId=o.observable(0),this.hash=o.computed(function(){return a.getHash(this.accountId()+"fetcher"+this.id())},this),this.isEnabled=o.observable(!1),this.isLocked=o.observable(!1).extend({autoResetToFalse:1e3}),this.email=o.observable(""),this.userName=o.observable(""),this.folder=o.observable(""),this.useSignature=o.observable(!1),this.signature=o.observable(""),this.incomingServer=o.observable(""),this.incomingPort=o.observable(0),this.incomingUseSsl=o.observable(!1),this.incomingLogin=o.observable(""),this.leaveMessagesOnServer=o.observable(""),this.isOutgoingEnabled=o.observable(!1),this.outgoingServer=o.observable(""),this.outgoingPort=o.observable(0),this.outgoingUseSsl=o.observable(!1),this.outgoingUseAuth=o.observable(!1),this.iCheckIntervalMinutes=0,this.fullEmail=o.computed(function(){return n.getFullEmail(this.userName(),this.email())},this)}var o=s(44),n=s(205),r=s(181),a=s(217);i.prototype.parse=function(e){this.id(r.pInt(e.EntityId)),this.accountId(r.pInt(e.IdAccount)),this.isEnabled(!!e.IsEnabled),this.isLocked(!!e.IsLocked),this.email(r.pString(e.Email)),this.userName(r.pString(e.Name)),this.folder(r.pString(e.Folder)),this.useSignature(!!e.UseSignature),this.signature(r.pString(e.Signature)),this.incomingServer(r.pString(e.IncomingServer)),this.incomingPort(r.pInt(e.IncomingPort)),this.incomingUseSsl(!!e.IncomingUseSsl),this.incomingLogin(r.pString(e.IncomingLogin)),this.leaveMessagesOnServer(!!e.LeaveMessagesOnServer),this.isOutgoingEnabled(!!e.IsOutgoingEnabled),this.outgoingServer(r.pString(e.OutgoingServer)),this.outgoingPort(r.pInt(e.OutgoingPort)),this.outgoingUseSsl(!!e.OutgoingUseSsl),this.outgoingUseAuth(!!e.OutgoingUseAuth),this.iCheckIntervalMinutes=r.pInt(e.CheckInterval,0)},e.exports=i},348:function(e,t,s){"use strict";function i(){this.bAccountPart=!1,this.isDefault=o.observable(!1),this.email=o.observable(""),this.friendlyName=o.observable(""),this.fullEmail=o.computed(function(){return n.getFullEmail(this.friendlyName(),this.email())},this),this.accountId=o.observable(-1),this.id=o.observable(-1),this.signature=o.observable(""),this.useSignature=o.observable(!1),this.hash=o.computed(function(){return a.getHash(this.accountId()+"identity"+this.id())},this)}var o=s(44),n=s(205),r=s(181),a=s(217);i.prototype.parse=function(e){"Object/Aurora\\Modules\\Mail\\Classes\\Identity"===e["@Object"]&&(this.bAccountPart=!!e.AccountPart,this.isDefault(!!e.Default),this.email(r.pString(e.Email)),this.friendlyName(r.pString(e.FriendlyName)),this.accountId(r.pInt(e.IdAccount)),this.id(r.pInt(e.EntityId)),this.signature(r.pString(e.Signature)),this.useSignature(!!e.UseSignature))},e.exports=i},349:function(e,t,s){"use strict";var i=s(2),o=s(1),n=s(44),r=s(42),a=r.run("MailWebclient","getComposeMessageToAddresses");o.isFunction(a)&&(n.bindingHandlers.makeLinkComposeMailTo={update:function(e,t,s,i,n){var r=o(e),l=t();r.show(),r.hasClass("button")||r.addClass("link"),r.click(function(){a(l)})}}),n.bindingHandlers.moveToFolderFilter={init:function(e,t,s,n,r){var a=o(e),l=t(),h=o(e).find(l.container),c=i.isArray(l.options)?l.options:l.options(),u=l.value?l.value():"",d=i.find(c,function(e){return e[l.optionsValue]===u});d||(u="",l.value("")),a.removeClass("expand"),h.empty(),i.each(c,function(e){var t=o('<span class="item"></span>').text(e[l.optionsText]).data("value",e[l.optionsValue]);u===e[l.optionsValue]&&t.addClass("selected"),e.jq=t,h.append(t)}),h.on("click",".item",function(){var e=o(this).data("value");l.value(e)}),a.click(function(){a.toggleClass("expand"),a.hasClass("expand")&&i.defer(function(){o(document).one("click",function(){a.removeClass("expand")})})})},update:function(e,t){var s=o(e),n=t(),r=i.isArray(n.options)?n.options:n.options(),a=n.value?n.value():"",l=i.find(r,function(e){return e[n.optionsValue]===a}),h=s.find(".link");i.each(r,function(e){e.jq&&e.jq.toggleClass("selected",a===e[n.optionsValue])}),l&&h.text(o.trim(l[n.optionsText]))}}},350:function(e,t,s){"use strict";function i(){y.call(this,"MailWebclient"),this.bNewTab=u.isNewTab(),this.isLoading=r.observable(!1),this.bAllowSearchMessagesBySubject=M.AllowSearchMessagesBySubject,w.folderList.subscribe(this.onFolderListSubscribe,this),this.messages=w.messages,this.messages.subscribe(this.onMessagesSubscribe,this),this.currentMessage=w.currentMessage,this.currentMessage.subscribe(this.onCurrentMessageSubscribe,this),b.timeFormat.subscribe(this.onCurrentMessageSubscribe,this),b.dateFormat.subscribe(this.onCurrentMessageSubscribe,this),this.displayedMessageUid=r.observable(""),this.browserTitle=r.computed(function(){var e=this.currentMessage(),t=e?e.subject():"",s=t?t+" - ":"";return s+C.getEmail()+" - "+a.i18n("MAILWEBCLIENT/HEADING_MESSAGE_BROWSER_TAB")},this),this.isCurrentMessage=r.computed(function(){return!!this.currentMessage()},this),this.isCurrentMessageLoaded=r.computed(function(){return this.isCurrentMessage()&&!this.isLoading()},this),this.visibleNoMessageSelectedText=r.computed(function(){return this.messages().length>0&&!this.isCurrentMessage()},this),this.prevMessageUid=w.prevMessageUid,this.nextMessageUid=w.nextMessageUid,this.isEnablePrevMessage=r.computed(function(){return u.isNewTab()&&l.isNonEmptyString(this.prevMessageUid())},this),this.isEnableNextMessage=r.computed(function(){return u.isNewTab()&&l.isNonEmptyString(this.nextMessageUid())},this),this.isEnableDelete=this.isCurrentMessage,this.isEnableReply=this.isCurrentMessageLoaded,this.isEnableReplyAll=this.isCurrentMessageLoaded,this.isEnableResend=this.isCurrentMessageLoaded,this.isEnableForward=this.isCurrentMessageLoaded,this.isEnablePrint=this.isCurrentMessageLoaded,this.isEnableSave=function(){return this.isCurrentMessage()&&""!==this.currentMessage().sDownloadAsEmlUrl},this.deleteCommand=c.createCommand(this,this.executeDeleteMessage,this.isEnableDelete),this.prevMessageCommand=c.createCommand(this,this.executePrevMessage,this.isEnablePrevMessage),this.nextMessageCommand=c.createCommand(this,this.executeNextMessage,this.isEnableNextMessage),this.replyCommand=c.createCommand(this,this.executeReply,this.isEnableReply),this.replyAllCommand=c.createCommand(this,this.executeReplyAll,this.isEnableReplyAll),this.resendCommand=c.createCommand(this,this.executeResend,this.isEnableResend),this.forwardCommand=c.createCommand(this,this.executeForward,this.isEnableForward),this.printCommand=c.createCommand(this,this.executePrint,this.isEnablePrint),this.saveCommand=c.createCommand(this,this.executeSave,this.isEnableSave),this.forwardAsAttachment=c.createCommand(this,this.executeForwardAsAttachment,this.isCurrentMessageLoaded),this.moreCommand=c.createCommand(this,null,this.isCurrentMessageLoaded),this.moreSectionCommands=r.observableArray([]),u.broadcastEvent("MailWebclient::AddMoreSectionCommand",o.bind(function(e){var t=o.extend({Text:"",CssClass:"",Handler:function(){}},e);t.Command=c.createCommand(this,t.Handler,this.isCurrentMessageLoaded),this.moreSectionCommands.push(t)},this)),this.visiblePicturesControl=r.observable(!1),this.visibleShowPicturesLink=r.observable(!1),this.visibleConfirmationControl=r.computed(function(){return this.currentMessage()&&""!==this.currentMessage().readingConfirmationAddressee()&&this.currentMessage()&&this.currentMessage().readingConfirmationAddressee()!==C.getEmail()},this),this.isCurrentNotDraftOrSent=r.computed(function(){var e=w.folderList().currentFolder();return e&&e.fullName().length>0&&e.type()!==Enums.FolderTypes.Drafts&&e.type()!==Enums.FolderTypes.Sent},this),this.isCurrentSentFolder=r.computed(function(){var e=w.folderList().currentFolder();return!!e&&e.fullName().length>0&&e.type()===Enums.FolderTypes.Sent},this),this.isCurrentNotDraftFolder=r.computed(function(){var e=w.folderList().currentFolder();return!!e&&e.fullName().length>0&&e.type()!==Enums.FolderTypes.Drafts},this),this.isVisibleReplyTool=this.isCurrentNotDraftOrSent,this.isVisibleResendTool=this.isCurrentSentFolder,this.isVisibleForwardTool=this.isCurrentNotDraftFolder,this.uid=r.observable(""),this.folder=r.observable(""),this.folder.subscribe(function(){this.jqPanelHelper&&this.jqPanelHelper.trigger("resize",[null,"min",null,!0])},this),this.subject=r.observable(""),this.emptySubject=r.computed(function(){return""===n.trim(this.subject())},this),this.subjectForDisplay=r.computed(function(){return this.emptySubject()?a.i18n("MAILWEBCLIENT/LABEL_NO_SUBJECT"):this.subject()},this),this.importance=r.observable(Enums.Importance.Normal),this.oFromAddr=r.observable(null),this.from=r.observable(""),this.fromEmail=r.observable(""),this.fullFrom=r.observable(""),this.to=r.observable(""),this.aToAddr=r.observableArray([]),this.cc=r.observable(""),this.aCcAddr=r.observableArray([]),this.bcc=r.observable(""),this.aBccAddr=r.observableArray([]),this.allRecipients=r.observableArray([]),this.currentAccountEmail=r.observable(),this.meSender=a.i18n("MAILWEBCLIENT/LABEL_ME_SENDER"),this.meRecipient=a.i18n("MAILWEBCLIENT/LABEL_ME_RECIPIENT"),this.fullDate=r.observable(""),this.midDate=r.observable(""),this.textBody=r.observable(""),this.textBodyForNewWindow=r.observable(""),this.domTextBody=r.observable(null),this.rtlMessage=r.observable(!1),this.contentHasFocus=r.observable(!1),this.topControllers=r.observableArray(),this.bodyControllers=r.observableArray(),this.controllers=r.computed(function(){return o.union(this.topControllers(),this.bodyControllers())},this),u.broadcastEvent("MailWebclient::RegisterMessagePaneController",o.bind(function(e,t){this.registerController(e,t)},this)),this.fakeHeader=r.computed(function(){var e=!!o.find(this.topControllers(),function(e){return!!e.visible&&e.visible()});return!(this.visiblePicturesControl()||this.visibleConfirmationControl()||e)},this),this.sAttachmentsSwitcherViewTemplate=u.isMobile()?"MailWebclient_Message_AttachmentsSwitcherView":"",this.sQuickReplyViewTemplate=u.isMobile()?"":"MailWebclient_Message_QuickReplyView",this.attachments=r.observableArray([]),this.notInlineAttachments=r.computed(function(){return o.filter(this.attachments(),function(e){return!e.linked()})},this),this.notInlineAttachmentsInString=r.computed(function(){return o.map(this.notInlineAttachments(),function(e){return e.fileName()},this).join(", ")},this),this.allAttachmentsDownloadMethods=r.observableArray([]),this.visibleDownloadAllAttachmentsSeparately=r.computed(function(){return this.notInlineAttachments().length>1},this),this.visibleExtendedDownload=r.computed(function(){return this.visibleDownloadAllAttachmentsSeparately()||this.allAttachmentsDownloadMethods().length>0},this),u.broadcastEvent("MailWebclient::AddAllAttachmentsDownloadMethod",o.bind(function(e){this.allAttachmentsDownloadMethods.push(e)},this)),this.detailsVisible=r.observable("1"===f.getData("MessageDetailsVisible")),this.detailsTooltip=r.computed(function(){return this.detailsVisible()?a.i18n("COREWEBCLIENT/ACTION_HIDE_DETAILS"):a.i18n("COREWEBCLIENT/ACTION_SHOW_DETAILS")},this),this.hasNotInlineAttachments=r.computed(function(){return this.notInlineAttachments().length>0},this),this.hasBodyText=r.computed(function(){return this.textBody().length>0},this),this.visibleAddMenu=r.observable(!1),this.replyText=r.observable(""),this.replyTextFocus=r.observable(!1),this.replyPaneVisible=r.computed(function(){return this.currentMessage()&&this.currentMessage().completelyFilled()},this),this.replySendingStarted=r.observable(!1),this.replySavingStarted=r.observable(!1),this.replyAutoSavingStarted=r.observable(!1),this.requiresPostponedSending=r.observable(!1),this.replyAutoSavingStarted.subscribe(function(){!this.replyAutoSavingStarted()&&this.requiresPostponedSending()&&(F.sendPostponedMail(this.replyDraftUid()),this.requiresPostponedSending(!1))},this),this.hasReplyAllCcAddrs=r.observable(!1),this.placeholderText=r.computed(function(){return this.hasReplyAllCcAddrs()?a.i18n("MAILWEBCLIENT/LABEL_QUICK_REPLY_ALL"):a.i18n("MAILWEBCLIENT/LABEL_QUICK_REPLY")},this),this.sendButtonText=r.computed(function(){return this.hasReplyAllCcAddrs()?a.i18n("MAILWEBCLIENT/ACTION_SEND_ALL"):a.i18n("MAILWEBCLIENT/ACTION_SEND")},this),r.computed(function(){(!this.replyTextFocus()||this.replyAutoSavingStarted()||this.replySavingStarted()||this.replySendingStarted())&&this.stopAutosaveTimer(),!this.replyTextFocus()||this.replyAutoSavingStarted()||this.replySavingStarted()||this.replySendingStarted()||this.startAutosaveTimer()},this),this.saveButtonText=r.computed(function(){return this.replyAutoSavingStarted()?a.i18n("MAILWEBCLIENT/ACTION_SAVE_IN_PROGRESS"):a.i18n("MAILWEBCLIENT/ACTION_SAVE")},this),this.replyDraftUid=r.observable(""),this.replyLoadingText=r.computed(function(){return this.replySendingStarted()?a.i18n("COREWEBCLIENT/INFO_SENDING"):this.replySavingStarted()?a.i18n("MAILWEBCLIENT/INFO_SAVING"):""},this),this.isEnableSendQuickReply=r.computed(function(){return this.isCurrentMessageLoaded()&&""!==this.replyText()&&!this.replySendingStarted()},this),this.isEnableSaveQuickReply=r.computed(function(){return this.isEnableSendQuickReply()&&!this.replySavingStarted()&&!this.replyAutoSavingStarted()},this),this.saveQuickReplyCommand=c.createCommand(this,this.executeSaveQuickReply,this.isEnableSaveQuickReply),this.sendQuickReplyCommand=c.createCommand(this,this.executeSendQuickReply,this.isEnableSendQuickReply),this.domMessageHeader=r.observable(null),this.domQuickReply=r.observable(null),this.domMessageForPrint=r.observable(null),this.replyTextFocusThrottled=r.observable(!1).extend({throttle:50}),this.replyTextFocus.subscribe(function(){this.replyTextFocusThrottled(this.replyTextFocus())},this),this.isQuickReplyActive=r.computed(function(){return this.replyText().length>0||this.replyTextFocusThrottled()},this),this.jqPanelHelper=null,this.visibleAttachments=r.observable(!1),this.showMessage=function(){this.visibleAttachments(!1)},this.showAttachments=function(){this.visibleAttachments(!0)},this.sDefaultFontName=M.DefaultFontName,m.registerDayOfMonthFunction(o.bind(this.updateMomentDate,this)),u.broadcastEvent("MailWebclient::ConstructView::after",{Name:"CMessagePaneView",View:this})}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(181),h=s(179),c=s(217),u=s(182),d=s(337),p=s(42),m=s(317),g=s(195),f=s(221),b=s(43),v=s(200),y=s(198),A=s(330),E=s(318),S=s(338),F=s(336),C=s(314),I=s(315),w=s(316),M=s(313),T=s(326),L=u.isNewTab()&&window.opener&&window.opener.MainTabMailMethods;o.extendOwn(i.prototype,y.prototype),i.prototype.ViewTemplate=u.isNewTab()?"MailWebclient_MessagePaneScreenView":"MailWebclient_MessagePaneView",i.prototype.ViewConstructorName="CMessagePaneView",i.prototype.resizeDblClick=function(e,t){""!==t.target.className&&t.target.className.search(/add_contact|icon|link|title|subject|link|date|from/)&&(c.calmEvent(t),c.removeSelection(),this.jqPanelHelper||(this.jqPanelHelper=n(".MailLayout .panel_helper")),this.jqPanelHelper.trigger("resize",[5,"min",!0]))},i.prototype.notifySender=function(){if(this.currentMessage()&&""!==this.currentMessage().readingConfirmationAddressee()){var e=a.i18n("MAILWEBCLIENT/LABEL_RETURN_RECEIPT_MAIL_TEXT",{EMAIL:C.getEmail(),SUBJECT:this.subject()}).replace(/\\r\\n/g,"\n");I.send("SendMessage",{To:this.currentMessage().readingConfirmationAddressee(),Subject:a.i18n("MAILWEBCLIENT/LABEL_RETURN_RECEIPT_MAIL_SUBJECT"),Text:e,ConfirmFolder:this.currentMessage().folder(),ConfirmUid:this.currentMessage().uid()}),this.currentMessage().readingConfirmationAddressee("")}},i.prototype.onFolderListSubscribe=function(){u.isNewTab()&&this.onMessagesSubscribe()},i.prototype.onMessagesSubscribe=function(){!this.currentMessage()&&this.uid().length>0&&w.setCurrentMessage(this.uid(),this.folder())},i.prototype.passReplyDataToNewTab=function(e){this.currentMessage()&&this.currentMessage().sUniq===e&&""!==this.replyText()&&(d.passReplyData(e,{ReplyText:this.replyText(),ReplyDraftUid:this.replyDraftUid()}),this.replyText(""),this.replyDraftUid(""))},i.prototype.onCurrentMessageSubscribe=function(){var e=this.currentMessage(),t=e?C.getAccount(e.accountId()):null,s=null;if(L&&e?(s=L.getReplyData(e.sUniq),s&&(this.replyText(s.ReplyText),this.replyDraftUid(s.ReplyDraftUid))):e&&e.uid()===this.displayedMessageUid()||(this.replyText(""),this.replyDraftUid("")),e&&this.uid()===e.uid()){if(this.hasReplyAllCcAddrs(F.hasReplyAllCcAddrs(e)),this.subject(e.subject()),this.importance(e.importance()),this.from(e.oFrom.getDisplay()),this.fromEmail(e.oFrom.getFirstEmail()),this.fullFrom(e.oFrom.getFull()),e.oFrom.aCollection.length>0?this.oFromAddr(e.oFrom.aCollection[0]):this.oFromAddr(null),this.to(e.oTo.getFull()),this.aToAddr(e.oTo.aCollection),this.cc(e.oCc.getFull()),this.aCcAddr(e.oCc.aCollection),this.bcc(e.oBcc.getFull()),this.aBccAddr(e.oBcc.aCollection),this.currentAccountEmail(t.email()),this.allRecipients(o.uniq(o.union(this.aToAddr(),this.aCcAddr(),this.aBccAddr()))),this.midDate(e.oDateModel.getMidDate()),this.fullDate(e.oDateModel.getFullDate()),this.isLoading(""!==e.uid()&&!e.completelyFilled()),this.setMessageBody(),this.rtlMessage(e.rtl()),u.isNewTab()){var i=[];o.each(e.attachments(),o.bind(function(e){var t=new T;t.copyProperties(e),i.push(t)},this)),this.attachments(i)}else this.attachments(e.attachments());if(!e.completelyFilled()||e.truncated()){var r=e.completelyFilled()?e.truncated:e.completelyFilled;u.isNewTab()?e.completelyFilledNewTabSubscription=r.subscribe(this.onCurrentMessageSubscribe,this):e.completelyFilledSubscription=r.subscribe(this.onCurrentMessageSubscribe,this)}else e.completelyFilledSubscription?(e.completelyFilledSubscription.dispose(),e.completelyFilledSubscription=void 0):e.completelyFilledNewTabSubscription&&(e.completelyFilledNewTabSubscription.dispose(),e.completelyFilledNewTabSubscription=void 0)}else this.hasReplyAllCcAddrs(!1),this.isLoading(!1),n(this.domTextBody()).empty().data("displayed-message-uid",""),this.displayedMessageUid(""),this.rtlMessage(!1),this.attachments([]),this.visiblePicturesControl(!1),this.visibleShowPicturesLink(!1);this.doAfterPopulatingMessage()},i.prototype.updateMomentDate=function(){var e=this.currentMessage();e&&e.oDateModel&&(this.midDate(e.oDateModel.getMidDate()),this.fullDate(e.oDateModel.getFullDate()))},i.prototype.setMessageBody=function(){if(this.currentMessage()){var e=this.currentMessage(),t=e.text(),s=n(this.domTextBody()),i=null,o="",r=t.length,l=5e6,h=[];this.textBody(t),s.data("displayed-message-uid")===e.uid()&&(h=this.getBlockquotesStatus()),s.empty(),e.isPlain()||r>l?(s.html(t),this.visiblePicturesControl(!1)):(i=e.getDomText(),o=i.length>0?i.html():"",s.append(o),this.visiblePicturesControl(e.hasExternals()&&!e.isExternalsAlwaysShown()),this.visibleShowPicturesLink(!e.isExternalsShown()),a.htmlStartsWithBlockquote(o)||this.doHidingBlockquotes(h)),s.data("displayed-message-uid",e.uid()),this.displayedMessageUid(e.uid())}},i.prototype.getBlockquotesStatus=function(){var e=[];return n(n("blockquote",n(this.domTextBody())).get()).each(function(){var t=n(this);t.hasClass("blockquote_before_toggle")&&e.push(t.hasClass("collapsed"))}),e},i.prototype.doHidingBlockquotes=function(e){var t=120,s=80,i=0;n(n("blockquote",n(this.domTextBody())).get()).each(function(){var o=n(this),r=o.parents("blockquote"),l=n('<span class="blockquote_toggle"></span>').html(a.i18n("MAILWEBCLIENT/ACTION_SHOW_QUOTED_TEXT")),h=!0;0===r.length&&o.height()>t&&(o.addClass("blockquote_before_toggle").after(l).wrapInner('<div class="blockquote_content"></div>'),l.bind("click",function(){h?(o.height("auto"),l.html(a.i18n("MAILWEBCLIENT/ACTION_HIDE_QUOTED_TEXT")),h=!1):(o.height(s),l.html(a.i18n("MAILWEBCLIENT/ACTION_SHOW_QUOTED_TEXT")),h=!0),o.toggleClass("collapsed",h)}),i<e.length&&(h=e[i],i++),o.height(h?s:"auto").toggleClass("collapsed",h))})},i.prototype.onRoute=function(e){var t=E.parseMailbox(e);C.changeCurrentAccountByHash(t.AccountHash),""!==this.replyText()&&this.uid()!==t.Uid&&this.saveReplyMessage(!1),this.uid(t.Uid),this.folder(t.Folder),w.setCurrentMessage(this.uid(),this.folder()),this.contentHasFocus(!0)},i.prototype.showPictures=function(){w.showExternalPictures(!1),this.visibleShowPicturesLink(!1),this.setMessageBody()},i.prototype.alwaysShowPictures=function(){var e=this.currentMessage()?this.currentMessage().oFrom.getFirstEmail():"";e.length>0&&I.send("SetEmailSafety",{Email:e}),w.showExternalPictures(!0),this.visiblePicturesControl(!1),this.setMessageBody()},i.prototype.openInNewWindow=function(){this.openMessageInNewWindowBound(this.currentMessage())},i.prototype.getReplyHtmlText=function(){return'<div style="font-family: '+this.sDefaultFontName+'; font-size: 16px">'+F.getHtmlFromText(this.replyText())+"</div>"},i.prototype.executeReplyOrForward=function(e){this.currentMessage()&&(F.setReplyData(this.getReplyHtmlText(),this.replyDraftUid()),this.replyText(""),this.replyDraftUid(""),A.composeMessageAsReplyOrForward(e,this.currentMessage().folder(),this.currentMessage().uid()))},i.prototype.executeDeleteMessage=function(){this.currentMessage()&&(L?L.deleteMessage(this.currentMessage().uid(),function(){window.close()}):u.isMobile()&&S.deleteMessages([this.currentMessage().uid()],u))},i.prototype.executePrevMessage=function(){this.isEnablePrevMessage()&&g.setHash(E.getViewMessage(w.folderList().currentFolderFullName(),this.prevMessageUid()))},i.prototype.executeNextMessage=function(){this.isEnableNextMessage()&&g.setHash(E.getViewMessage(w.folderList().currentFolderFullName(),this.nextMessageUid()))},i.prototype.executeReply=function(){this.executeReplyOrForward(Enums.ReplyType.Reply)},i.prototype.executeReplyAll=function(){this.executeReplyOrForward(Enums.ReplyType.ReplyAll)},i.prototype.executeResend=function(){this.executeReplyOrForward(Enums.ReplyType.Resend)},i.prototype.executeForward=function(){this.executeReplyOrForward(Enums.ReplyType.Forward)},i.prototype.executePrint=function(){var e=this.currentMessage(),t=e?v.open("",this.subject()+"-print"):null,s="";e&&t&&(this.textBodyForNewWindow(e.getConvertedHtml(h.getAppPath(),!0)),s=n(this.domMessageForPrint()).html(),n(t.document.body).html(s),t.print())},i.prototype.executeSave=function(){this.isEnableSave()&&h.downloadByUrl(this.currentMessage().sDownloadAsEmlUrl)},i.prototype.executeForwardAsAttachment=function(){this.currentMessage()&&A.composeMessageWithEml(this.currentMessage())},i.prototype.changeAddMenuVisibility=function(){var e=!this.visibleAddMenu();this.visibleAddMenu(e)},i.prototype.onSendOrSaveMessageResponse=function(e,t){var s=F.onSendOrSaveMessageResponse(e,t,this.requiresPostponedSending());switch(s.Method){case"SendMessage":this.replySendingStarted(!1),s.Result&&this.replyText("");break;case"SaveMessage":s.Result&&this.replyDraftUid(s.NewUid),this.replySavingStarted(!1),this.replyAutoSavingStarted(!1)}},i.prototype.executeSendQuickReply=function(){this.isEnableSendQuickReply()&&(this.replySendingStarted(!0),this.requiresPostponedSending(this.replyAutoSavingStarted()),F.sendReplyMessage("SendMessage",this.getReplyHtmlText(),this.replyDraftUid(),this.onSendOrSaveMessageResponse,this,this.requiresPostponedSending()),this.replyTextFocus(!1))},i.prototype.executeSaveQuickReply=function(){this.saveReplyMessage(!1)},i.prototype.saveReplyMessage=function(e){this.isEnableSaveQuickReply()&&(e?this.replyAutoSavingStarted(!0):this.replySavingStarted(!0),F.sendReplyMessage("SaveMessage",this.getReplyHtmlText(),this.replyDraftUid(),this.onSendOrSaveMessageResponse,this))},i.prototype.stopAutosaveTimer=function(){window.clearTimeout(this.autoSaveTimer)},i.prototype.startAutosaveTimer=function(){if(this.isEnableSaveQuickReply()){var e=o.bind(this.saveReplyMessage,this,!0);this.stopAutosaveTimer(),M.AllowAutosaveInDrafts&&(this.autoSaveTimer=window.setTimeout(e,1e3*M.AutoSaveIntervalSeconds))}},i.prototype.executeAllAttachmentsDownloadMethod=function(e){this.currentMessage()&&e(this.currentMessage().accountId(),this.currentMessage().getAttachmentsHashes())},i.prototype.downloadAllAttachmentsSeparately=function(){
this.currentMessage()&&this.currentMessage().downloadAllAttachmentsSeparately()},i.prototype.onShow=function(){this.bShown=!0},i.prototype.onHide=function(){this.bShown=!1},i.prototype.onBind=function(e){p.run("SessionTimeoutWeblient","registerFunction",[o.bind(function(){""!==this.replyText()&&this.saveReplyMessage(!1)},this)]),this.$MailViewDom=o.isUndefined(e)?this.$viewDom:e,this.$MailViewDom.on("mousedown","a",function(e){if(e&&3!==e.which){var t=n(this).attr("href");if(t&&"mailto:"===(""+t).toLowerCase().substr(0,7))return A.composeMessageToAddresses(""+t),!1}return!0}),u.isMobile()||this.hotKeysBind()},i.prototype.hotKeysBind=function(){n(document).on("keydown",n.proxy(function(e){var t=this.bShown&&e&&!e.ctrlKey&&!e.shiftKey&&!c.isTextFieldFocused()&&this.isEnableReply();t&&e.keyCode===Enums.Key.q?(e.preventDefault(),this.replyTextFocus(!0)):t&&e.keyCode===Enums.Key.r&&this.executeReply()},this))},i.prototype.showSourceHeaders=function(){var e=this.currentMessage(),t=e&&e.completelyFilled()?v.open("",this.subject()+"-headers"):null;t&&n(t.document.body).html("<pre>"+a.encodeHtml(e.sourceHeaders())+"</pre>")},i.prototype.switchDetailsVisibility=function(){this.detailsVisible(!this.detailsVisible()),f.setData("MessageDetailsVisible",this.detailsVisible()?"1":"0")},i.prototype.registerController=function(e,t){switch(t){case"BeforeMessageHeaders":this.topControllers.push(e);break;case"BeforeMessageBody":this.bodyControllers.push(e)}n.isFunction(e.assignMessagePaneExtInterface)&&e.assignMessagePaneExtInterface(this.getExtInterface())},i.prototype.getExtInterface=function(){return{changeText:o.bind(function(e){var t=this.currentMessage();t&&this.isCurrentMessageLoaded()&&(t.text(e),t.$text=null,this.setMessageBody())},this)}},i.prototype.doAfterPopulatingMessage=function(){var e=this.currentMessage(),t=e&&this.isCurrentMessageLoaded(),s=t?{aToEmails:e.oTo.getEmails(),bPlain:e.isPlain(),sRawText:e.textRaw(),sText:e.text(),sAccountEmail:C.getEmail(e.accountId()),sFromEmail:e.oFrom.getFirstEmail(),iSensitivity:e.sensitivity(),aExtend:e.aExtend}:null;o.each(this.controllers(),o.bind(function(e){n.isFunction(e.doAfterPopulatingMessage)&&e.doAfterPopulatingMessage(s)},this)),p.run("ContactsWebclient","applyContactsCards",[this.$MailViewDom.find("span.address")])},i.prototype.searchBySubject=function(){if(M.AllowSearchMessagesBySubject){var e=this.currentMessage().folder(),t=1,s=this.currentMessage().uid(),i="",r="",a=this.currentMessage().subject(),l=a.split(":"),h=M.PrefixesToRemoveBeforeSearchMessagesBySubject,c=[];0===h.length?i=l:(o.each(l,function(e){if(c.length>0)c.push(e);else{var t=!1,s=n.trim(e);o.each(h,function(e){var i=RegExp("^"+e+"(\\[\\d*\\]){0,1}$","i");t=t||i.test(s)}),t||c.push(e)}}),i=n.trim(c.join(":"))),g.setHash(E.getMailbox(e,t,s,i,r))}},e.exports=new i},351:function(e,t,s){"use strict";function i(e){var t=null,s={},i={},o=0;return window.getSelection&&document.createRange?(t=window.getSelection(),t.rangeCount>0&&(s=t.getRangeAt(0),i=s.cloneRange(),i.selectNodeContents(e),i.setEnd(s.startContainer,s.startOffset),o=(""+i).length,r(e).html().length<o&&(o=0))):document.selection&&document.body.createTextRange&&(s=document.selection.createRange(),i=document.body.createTextRange(),i.moveToElementText(e),"function"==typeof i.setEndPoint&&i.setEndPoint("EndToStart",s),o=i.text.length),o}function o(e,t){var s,i,o;if(!e)return!1;if(document.createRange)s=document.createRange(),s.selectNodeContents(e),s.setStart(e,t),s.setEnd(e,t),i=window.getSelection(),i.removeAllRanges(),i.addRange(s);else{if(e.createTextRange)return o=e.createTextRange(),o.collapse(!0),o.moveEnd(t),o.moveStart(t),o.select(),!0;if(e.setSelectionRange)return e.setSelectionRange(t,t),!0}return!1}var n=s(2),r=s(1),a=s(44);a.bindingHandlers.highlighter={init:function(e,t,s,a,l){function h(t){if(E){var s=0,a=c.text(),l=a.split(f),h=[],u='<span class="search_highlight">$&</span>';n.each(l,function(e){var t=e.split("");n.any(g,function(t){return t===e})?n.each(t,function(e){h.push(r(e.replace(/(.)/,u)))}):n.each(t,function(e){" "===e?h.push(document.createTextNode("")):h.push(document.createTextNode(e))})}),c.is(":focus")?(s=i(e),c.empty().append(h),o(e,s)):c.empty().append(h)}}var c=r(e),u=t(),d=u.valueObserver?u.valueObserver:null,p=u.highlighterValueObserver?u.highlighterValueObserver:null,m=u.highlightTrigger?u.highlightTrigger:null,g=["from:","to:","subject:","text:","email:","has:","date:","text:","body:"],f=function(){var e="";return r.each(g,function(t,s){e=t?e+"|\\b"+s:e+"\\b"+s}),RegExp("("+e+")","g")}(),b=function(e){return e.replace(/\xC2\xA0/g," ").replace(/\xA0/g," ").replace(/[\s]+/g," ")},v=-1,y=window.navigator.language||window.navigator.userLanguage,A=["zh","zh-TW","zh-CN","zh-HK","zh-SG","zh-MO","ja","ja-JP","ko","ko-KR","vi","vi-VN","th","th-TH"],E=!n.include(A,y);r(e).on("keydown",function(e){return e.keyCode!==Enums.Key.Enter}).on("keyup",function(e){var t=[Enums.Key.Left,Enums.Key.Right,Enums.Key.Home,Enums.Key.End],s=-1!==r.inArray(e.keyCode,t);return e.keyCode===Enums.Key.Shift||e.keyCode===Enums.Key.Alt||e.keyCode===Enums.Key.Ctrl||e.keyCode===Enums.Key.Dash||e.keyCode===Enums.Key.Apostrophe||e.keyCode===Enums.Key.Six&&e.shiftKey||s||(e.ctrlKey||v===Enums.Key.Ctrl)&&e.keyCode===Enums.Key.a||(d(b(c.text())),h(!1)),v=e.keyCode,!0}).on("paste",function(e){if(document.queryCommandSupported("insertText")){e.preventDefault();var t="";e.clipboardData||e.originalEvent.clipboardData?t=(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData&&(t=window.clipboardData.getData("Text")),document.execCommand("insertText",!1,t)}setTimeout(function(){d(b(c.text())),h(!1)},0)}),setTimeout(function(){h(!0)},0),m.notifySubscribers(),m.subscribe(function(e){setTimeout(function(){h(!!e)},0)},this),p.subscribe(function(){var e=c.text(),t=d();e.replace(""," ")!==t.replace(""," ")&&c.text(t)},this)}}},352:function(e,t,s){"use strict";function i(){u.call(this,p.ServerModuleName),this.bRtl=c.IsRTL,this.bAllowMailto=p.AllowAppRegisterMailto&&(l.firefox||l.chrome),this.bAllowShowMessagesCountInFolderList=p.AllowShowMessagesCountInFolderList,this.bAllowHorizontalLayout=p.AllowHorizontalLayout,this.mailsPerPageValues=n.observableArray(a.getAdaptedPerPageList(p.MailsPerPage)),this.aLayoutValues=[{text:r.i18n("MAILWEBCLIENT/LABEL_VERT_SPLIT_LAYOUT"),value:!1},{text:r.i18n("MAILWEBCLIENT/LABEL_HORIZ_SPLIT_LAYOUT"),value:!0}],this.mailsPerPage=n.observable(p.MailsPerPage),this.allowAutosaveInDrafts=n.observable(p.AllowAutosaveInDrafts),this.allowChangeInputDirection=n.observable(p.AllowChangeInputDirection),this.showMessagesCountInFolderList=n.observable(p.showMessagesCountInFolderList()),this.horizontalLayout=n.observable(p.HorizontalLayout)}var o=s(2),n=s(44),r=s(185),a=s(181),l=s(180),h=s(42),c=s(43),u=h.run("SettingsWebclient","getAbstractSettingsFormViewClass"),d=s(338),p=s(313);o.extendOwn(i.prototype,u.prototype),i.prototype.ViewTemplate="MailWebclient_Settings_MailSettingsFormView",i.prototype.registerMailto=function(){d.registerMailto()},i.prototype.getCurrentValues=function(){return[this.mailsPerPage(),this.allowAutosaveInDrafts(),this.allowChangeInputDirection(),this.showMessagesCountInFolderList(),this.horizontalLayout()]},i.prototype.revertGlobalValues=function(){this.mailsPerPage(p.MailsPerPage),this.allowAutosaveInDrafts(p.AllowAutosaveInDrafts),this.allowChangeInputDirection(p.AllowChangeInputDirection),this.showMessagesCountInFolderList(p.showMessagesCountInFolderList()),this.horizontalLayout(p.HorizontalLayout)},i.prototype.getParametersForSave=function(){return{MailsPerPage:this.mailsPerPage(),AllowAutosaveInDrafts:this.allowAutosaveInDrafts(),AllowChangeInputDirection:this.allowChangeInputDirection(),ShowMessagesCountInFolderList:this.showMessagesCountInFolderList(),HorizontalLayout:this.horizontalLayout()}},i.prototype.applySavedValues=function(e){e.HorizontalLayout!==p.HorizontalLayout&&window.location.reload(),p.update(e.MailsPerPage,e.AllowAutosaveInDrafts,e.AllowChangeInputDirection,e.ShowMessagesCountInFolderList)},i.prototype.setAccessLevel=function(e,t){this.visible(""===e)},e.exports=new i},353:function(e,t,s){"use strict";function i(){this.bAllowAddAccounts=g.AllowAddAccounts,this.bAllowMultiAccounts=g.AllowMultiAccounts,this.bAllowIdentities=!!g.AllowIdentities,this.bAllowFetchers=!!g.AllowFetchers,this.accounts=m.collection,this.editedAccountId=m.editedId,this.editedFetcher=n.observable(null),this.editedFetcherId=n.computed(function(){return this.editedFetcher()?this.editedFetcher().id():null},this),this.editedIdentity=n.observable(null),this.editedIdentityId=n.computed(function(){return this.editedIdentity()?this.editedIdentity().id():null},this),this.allowFolders=n.observable(!1),this.allowForward=n.observable(!1),this.allowAutoresponder=n.observable(!1),this.allowFilters=n.observable(!1),this.allowSignature=n.observable(!1),this.aAccountTabs=[{name:"properties",title:r.i18n("MAILWEBCLIENT/LABEL_PROPERTIES_TAB"),view:A,visible:A.visibleTab},{name:"folders",title:r.i18n("MAILWEBCLIENT/LABEL_MANAGE_FOLDERS_TAB"),view:v,visible:this.allowFolders},{name:"forward",title:r.i18n("MAILWEBCLIENT/LABEL_FORWARD_TAB"),view:y,visible:this.allowForward},{name:"autoresponder",title:r.i18n("MAILWEBCLIENT/LABEL_AUTORESPONDER_TAB"),view:f,visible:this.allowAutoresponder},{name:"filters",title:r.i18n("MAILWEBCLIENT/LABEL_FILTERS_TAB"),view:b,visible:this.allowFilters},{name:"signature",title:r.i18n("MAILWEBCLIENT/LABEL_SIGNATURE_TAB"),view:C,visible:this.allowSignature}],this.aIdentityTabs=[{name:"properties",title:r.i18n("MAILWEBCLIENT/LABEL_PROPERTIES_TAB"),view:new E(this),visible:n.observable(!0)},{name:"signature",title:r.i18n("MAILWEBCLIENT/LABEL_SIGNATURE_TAB"),view:C,visible:n.observable(!0)}],this.aFetcherTabs=[{name:"incoming",title:r.i18n("MAILWEBCLIENT/LABEL_POP3_SETTINGS_TAB"),view:new S(this),visible:n.observable(!0)},{name:"outgoing",title:r.i18n("MAILWEBCLIENT/LABEL_SMTP_SETTINGS_TAB"),view:F,visible:n.observable(!0)},{name:"signature",title:r.i18n("MAILWEBCLIENT/LABEL_SIGNATURE_TAB"),view:C,visible:n.observable(!0)}],this.currentTab=n.observable(null),this.tabs=n.computed(function(){return this.editedIdentity()?this.aIdentityTabs:this.editedFetcher()?this.aFetcherTabs:this.aAccountTabs},this),m.editedId.subscribe(function(){this.populate()},this)}var o=s(2),n=s(44),r=s(185),a=s(42),l=s(195),h=s(188),c=s(192),u=s(354),d=s(357),p=s(359),m=s(314),g=s(313),f=s(361),b=s(363),v=s(364),y=s(368),A=s(370),E=s(358),S=s(372),F=s(373),C=s(374);i.prototype.ViewTemplate="MailWebclient_Settings_AccountsSettingsPaneView",i.prototype.hasUnsavedChanges=function(){var e=this.currentTab();return e&&e.view&&o.isFunction(e.view.hasUnsavedChanges)&&e.view.hasUnsavedChanges()},i.prototype.revert=function(){var e=this.currentTab();e&&e.view&&o.isFunction(e.view.revert)&&e.view.revert()},i.prototype.hide=function(e,t){this.currentTab()&&o.isFunction(this.currentTab().view.hide)?this.currentTab().view.hide(e,t):e()},i.prototype.showTab=function(e){var t=e.length>0?e[0]:"account",s=m.getEdited(),i=e.length>1?e[1]:s?s.hash():"",n=e.length>2?e[2]:"";this.editedIdentity("identity"===t?m.getIdentityByHash(i)||null:null),this.editedFetcher("fetcher"===t?m.getFetcherByHash(i)||null:null),"account"===t&&("create"!==e[1]||m.hasAccount()?""!==i&&(s&&s.hash()===i?this.populate():o.find(m.collection(),function(e){return e.hash()===i})?m.changeEditedAccountByHash(i):l.replaceHash(["settings","mail-accounts"])):(this.addAccount(),h.showError(r.i18n("MAILWEBCLIENT/INFO_SPECIFY_CREDENTIALS")),l.replaceHashDirectly(["settings","mail-accounts"]))),this.changeTab(n||this.getAutoselectedTab().name)},i.prototype.getAutoselectedTab=function(){var e=o.find(this.tabs(),function(e){return e.visible()});return e||(e=this.tabs()[0]),e},i.prototype.addAccount=function(){c.showPopup(u,[o.bind(function(e){var t=m.getAccount(e);t&&this.editAccount(t.hash())},this)])},i.prototype.editAccount=function(e){a.run("SettingsWebclient","setAddHash",[["account",e]])},i.prototype.addIdentity=function(e,t){t.stopPropagation(),c.showPopup(d,[e])},i.prototype.editIdentity=function(e){a.run("SettingsWebclient","setAddHash",[["identity",e]])},i.prototype.addFetcher=function(e,t){t.stopPropagation(),c.showPopup(p,[e])},i.prototype.editFetcher=function(e){a.run("SettingsWebclient","setAddHash",[["fetcher",e]])},i.prototype.changeRoute=function(e){var t=m.getEdited(),s=["account",t?t.hash():"",e];this.editedIdentity()?s=["identity",this.editedIdentity().hash(),e]:this.editedFetcher()&&(s=["fetcher",this.editedFetcher().hash(),e]),a.run("SettingsWebclient","setAddHash",[s])},i.prototype.changeTab=function(e){var t=this.currentTab(),s=o.find(this.tabs(),function(t){return t.visible()&&t.name===e}),i=function(){s&&(o.isFunction(s.view.showTab)&&s.view.showTab(this.editedIdentity()||this.editedFetcher()),this.currentTab(s))}.bind(this),n=!0;s?t&&o.isFunction(t.view.hide)&&(t.view.hide(i,o.bind(function(){o.isFunction(l.stopListening)&&o.isFunction(l.startListening)&&l.stopListening(),this.changeRoute(t.name),o.isFunction(l.startListening)&&l.startListening()},this)),n=!1):t||(s=this.getAutoselectedTab()),t||o.delay(o.bind(function(){this.changeRoute(s.name)},this)),n&&i()},i.prototype.populate=function(){var e=m.getEdited();e&&(this.allowFolders(!0),this.allowForward(!!g.AllowForward&&e.oServer.bEnableSieve),this.allowAutoresponder(!!g.AllowAutoresponder&&e.oServer.bEnableSieve),this.allowFilters(!!g.AllowFilters&&e.oServer.bEnableSieve),this.allowSignature(!g.AllowIdentities),this.currentTab()&&this.currentTab().visible()||this.currentTab(this.getAutoselectedTab()))},i.prototype.onRemoveIdentity=function(){this.editedIdentity(null),this.changeTab(this.currentTab()?this.currentTab().name:"")},i.prototype.onRemoveFetcher=function(){this.editedFetcher(null),this.changeRoute("")},e.exports=new i},354:function(e,t,s){"use strict";function i(){u.call(this),this.loading=r.observable(!1),this.friendlyName=r.observable(""),this.email=r.observable(""),this.email.focused=r.observable(!1),this.incomingLogin=r.observable(""),this.incomingLogin.focused=r.observable(!1),this.incomingPassword=r.observable(""),this.incomingPassword.focused=r.observable(!1),this.oServerPairPropertiesView=new g("acc_create"),this.email.focused.subscribe(function(){this.email.focused()||""!==n.trim(this.incomingLogin())||this.incomingLogin(this.email())},this),this.aRequiredFields=[this.email,this.incomingLogin,this.incomingPassword].concat(this.oServerPairPropertiesView.aRequiredFields)}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(181),h=s(256),c=s(186),u=s(194),d=s(314),p=s(315),m=s(343),g=s(355);o.extendOwn(i.prototype,u.prototype),i.prototype.PopupTemplate="MailWebclient_Settings_CreateAccountPopup",i.prototype.init=function(){this.friendlyName(""),this.email(""),this.incomingLogin(""),this.incomingLogin.focused(!1),this.incomingPassword(""),this.oServerPairPropertiesView.fullInit()},i.prototype.onOpen=function(e){this.fCallback=e,this.init(),this.focusFieldToEdit()},i.prototype.focusFieldToEdit=function(){var e=o.find(this.aRequiredFields,function(e){return""===e()});e?e.focused(!0):this.aRequiredFields.length>0&&this.aRequiredFields[0].focused(!0)},i.prototype.onClose=function(){this.init()},i.prototype.save=function(){if(h.checkIfFieldsEmpty(this.aRequiredFields,a.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY"))){var e={FriendlyName:this.friendlyName(),Email:n.trim(this.email()),IncomingLogin:n.trim(this.incomingLogin()),IncomingPassword:n.trim(this.incomingPassword()),Server:this.oServerPairPropertiesView.getParametersForSave()};this.loading(!0),p.send("CreateAccount",e,this.onAccountCreateResponse,this)}else this.loading(!1)},i.prototype.onAccountCreateResponse=function(e,t){if(this.loading(!1),e.Result){var s=l.pInt(e.Result.AccountID),i=new m(e.Result);d.addAccount(i),d.populateIdentities(),d.changeEditedAccount(s),1===d.collection().length&&d.changeCurrentAccount(s),this.fCallback&&this.fCallback(s),this.closePopup()}else c.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_CREATE_ACCOUNT"))},e.exports=new i},355:function(e,t,s){"use strict";function i(e,t){this.servers=r.observableArray([]),this.serversRetrieved=r.observable(!1),this.serverOptions=r.observableArray([{Name:a.i18n("MAILWEBCLIENT/LABEL_CONFIGURE_SERVER_MANUALLY"),Id:0}]),this.selectedServerId=r.observable(0),this.oLastEditableServer=new m,this.iEditedServerId=0,this.selectedServerId.subscribe(function(){var e=this.selectedServerId(),t=o.find(this.servers(),function(t){return t.iId===e});t?(this.oIncoming.isEnabled()&&(this.oLastEditableServer=new m(this.getParametersForSave())),this.setExternalAccessServers(t.bSetExternalAccessServers),this.externalAccessImapServer(t.sExternalAccessImapServer),this.externalAccessImapPort(t.iExternalAccessImapPort),this.externalAccessSmtpServer(t.sExternalAccessSmtpServer),this.externalAccessSmtpPort(t.iExternalAccessSmtpPort),this.tenantId(t.iTenantId),this.name(t.sName),this.oIncoming.set(t.sIncomingServer,t.iIncomingPort,t.bIncomingUseSsl),this.oIncoming.isEnabled(this.bAdminEdit),this.oOutgoing.set(t.sOutgoingServer,t.iOutgoingPort,t.bOutgoingUseSsl),this.oOutgoing.isEnabled(this.bAdminEdit),this.outgoingUseAuth(t.sSmtpAuthType===window.Enums.SmtpAuthType.UseUserCredentials),this.outgoingUseAuth.enable(this.bAdminEdit),this.domains(t.sDomains),this.smtpAuthType(t.sSmtpAuthType),this.smtpLogin(t.sSmtpLogin),this.smtpPassword(t.sSmtpPassword),this.enableSieve(t.bEnableSieve),this.sievePort(t.iSievePort),this.enableThreading(t.bEnableThreading),this.useFullEmailAddressAsLogin(t.bUseFullEmailAddressAsLogin)):(this.setExternalAccessServers(this.oLastEditableServer.bSetExternalAccessServers),this.externalAccessImapServer(this.oLastEditableServer.sExternalAccessImapServer),this.externalAccessImapPort(this.oLastEditableServer.iExternalAccessImapPort),this.externalAccessSmtpServer(this.oLastEditableServer.sExternalAccessSmtpServer),this.externalAccessSmtpPort(this.oLastEditableServer.iExternalAccessSmtpPort),this.tenantId(0),this.name(this.oLastEditableServer.sName),this.oIncoming.set(this.oLastEditableServer.sIncomingServer,this.oLastEditableServer.iIncomingPort,this.oLastEditableServer.bIncomingUseSsl),this.oIncoming.isEnabled(!0),this.oOutgoing.set(this.oLastEditableServer.sOutgoingServer,this.oLastEditableServer.iOutgoingPort,this.oLastEditableServer.bOutgoingUseSsl),this.oOutgoing.isEnabled(!0),this.outgoingUseAuth(this.oLastEditableServer.sSmtpAuthType===window.Enums.SmtpAuthType.UseUserCredentials),this.outgoingUseAuth.enable(!0),this.domains(""),this.smtpAuthType(window.Enums.SmtpAuthType.UseUserCredentials),this.smtpLogin(""),this.smtpPassword(""),this.enableSieve(!1),this.sievePort(4190),this.enableThreading(!0),this.useFullEmailAddressAsLogin(!0)),this.setCurrentValues()},this),this.tenantId=r.observable(0),this.name=r.observable(""),this.name.focused=r.observable(!1),this.bAdminEdit=t,this.oIncoming=new g(143,993,e+"_incoming",a.i18n("MAILWEBCLIENT/LABEL_IMAP_SERVER"),t?this.name:null),this.oOutgoing=new g(25,465,e+"_outgoing",a.i18n("MAILWEBCLIENT/LABEL_SMTP_SERVER"),this.oIncoming.server),this.outgoingUseAuth=r.observable(!0),this.outgoingUseAuth.enable=r.observable(!0),this.domains=r.observable(""),this.bAllowEditDomains=p.AllowEditDomainsInServer,this.name.focused.subscribe(function(){this.bAllowEditDomains&&!this.name.focused()&&""===this.domains()&&this.domains(this.name())},this),this.smtpAuthType=r.observable(window.Enums.SmtpAuthType.UseUserCredentials),this.smtpLogin=r.observable(""),this.smtpPassword=r.observable(""),this.enableSieve=r.observable(!1),this.sievePort=r.observable(4190),this.enableThreading=r.observable(!0),this.useFullEmailAddressAsLogin=r.observable(!0),this.currentValues=r.observable(""),this.aRequiredFields=[this.oIncoming.server,this.oIncoming.port,this.oOutgoing.server,this.oOutgoing.port],t&&this.aRequiredFields.unshift(this.name),this.setExternalAccessServers=r.observable(!1),this.externalAccessImapServer=r.observable(this.oIncoming.server()),this.externalAccessImapPort=r.observable(this.oIncoming.port()),this.externalAccessSmtpServer=r.observable(this.oOutgoing.server()),this.externalAccessSmtpPort=r.observable(this.oOutgoing.port()),r.computed(function(){this.setExternalAccessServers()||(this.externalAccessImapServer(this.oIncoming.server()),this.externalAccessImapPort(this.oIncoming.port()),this.externalAccessSmtpServer(this.oOutgoing.server()),this.externalAccessSmtpPort(this.oOutgoing.port()))},this)}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(181),h=s(256),c=s(186),u=s(182),d=s(315),p=s(313),m=s(346),g=s(356);i.prototype.ViewTemplate="MailWebclient_Settings_ServerPairPropertiesView",i.prototype.serverInit=function(e){this.setServer(e?new m:this.oLastEditableServer)},i.prototype.fullInit=function(){this.setServer(this.oLastEditableServer),this.serversRetrieved()||this.requestServers()},i.prototype.setServer=function(e){this.oLastEditableServer=e,this.setServerId(e.iId)},i.prototype.setServerId=function(e){if(this.serversRetrieved()){var t=0===this.selectedServerId();this.selectedServerId(0),this.selectedServerId(e),t&&0===e&&this.selectedServerId.valueHasMutated()}else this.iEditedServerId=e},i.prototype.requestServers=function(){var e=o.isFunction(u.getTenantId)?u.getTenantId():0;this.serversRetrieved(!1),d.send("GetServers",{TenantId:e},function(e){if(o.isArray(e.Result)){var t=[{Name:a.i18n("MAILWEBCLIENT/LABEL_CONFIGURE_SERVER_MANUALLY"),Id:0}];o.each(e.Result,function(e){t.push({Name:e.Name,Id:l.pInt(e.EntityId)})}),this.servers(o.map(e.Result,function(e){return new m(e)})),this.serverOptions(t),this.serversRetrieved(!0),this.iEditedServerId&&(this.setServerId(this.iEditedServerId),this.iEditedServerId=0)}else c.showErrorByCode(e)},this)},i.prototype.clear=function(){this.oIncoming.clear(),this.oOutgoing.clear(),this.outgoingUseAuth(!0)},i.prototype.setCurrentValues=function(){var e=this.bAdminEdit?[this.selectedServerId(),this.name()]:[],t=[this.oIncoming.port(),this.oIncoming.server(),this.oIncoming.ssl(),this.oOutgoing.port(),this.oOutgoing.server(),this.oOutgoing.ssl(),this.outgoingUseAuth(),this.domains(),this.smtpAuthType(),this.smtpLogin(),this.smtpPassword(),this.enableSieve(),this.sievePort(),this.enableThreading(),this.useFullEmailAddressAsLogin(),this.setExternalAccessServers(),this.externalAccessImapServer(),this.externalAccessImapPort(),this.externalAccessSmtpServer(),this.externalAccessSmtpPort()];this.currentValues(e.concat(t).join(":"))},i.prototype.getCurrentValues=function(){return this.setCurrentValues(),[this.currentValues()]},i.prototype.getSmtpAuthType=function(){return this.bAdminEdit||this.smtpAuthType()===window.Enums.SmtpAuthType.UseSpecifiedCredentials?this.smtpAuthType():this.outgoingUseAuth()?window.Enums.SmtpAuthType.UseUserCredentials:window.Enums.SmtpAuthType.NoAuthentication},i.prototype.getParametersForSave=function(){var e=this.selectedServerId(),t=this.oLastEditableServer.iId,s=this.getSmtpAuthType(),i={};return 0!==e||o.find(this.servers(),function(e){return t===e.iId})||(e=t),i={ServerId:e,Name:this.bAdminEdit?this.name():this.oIncoming.server(),IncomingServer:this.oIncoming.server(),IncomingPort:this.oIncoming.getIntPort(),IncomingUseSsl:this.oIncoming.ssl(),OutgoingServer:this.oOutgoing.server(),OutgoingPort:this.oOutgoing.getIntPort(),OutgoingUseSsl:this.oOutgoing.ssl(),Domains:this.domains(),SmtpAuthType:s,SmtpLogin:s===window.Enums.SmtpAuthType.UseSpecifiedCredentials?n.trim(this.smtpLogin()):"",SmtpPassword:s===window.Enums.SmtpAuthType.UseSpecifiedCredentials?n.trim(this.smtpPassword()):"",EnableSieve:this.enableSieve(),SievePort:this.sievePort(),EnableThreading:this.enableThreading(),UseFullEmailAddressAsLogin:this.useFullEmailAddressAsLogin(),SetExternalAccessServers:this.setExternalAccessServers()},this.setExternalAccessServers()&&(i.ExternalAccessImapServer=this.externalAccessImapServer(),i.ExternalAccessImapPort=this.externalAccessImapPort(),i.ExternalAccessSmtpServer=this.externalAccessSmtpServer(),i.ExternalAccessSmtpPort=this.externalAccessSmtpPort()),i},i.prototype.validateBeforeSave=function(){return h.checkIfFieldsEmpty(this.aRequiredFields,a.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY"))},i.prototype.onDomainsClick=function(){this.bAllowEditDomains||(n(".tabsbar .item.admin.domain").removeClass("recivedAnim"),setTimeout(function(){n(".tabsbar .item.admin.domain").addClass("recivedAnim")}))},e.exports=i},356:function(e,t,s){"use strict";function i(e,t,s,i,r){this.server=n.observable(""),this.server.focused=n.observable(!1),this.label=i,this.defaultPort=n.observable(e),this.defaultSslPort=n.observable(t),this.port=n.observable(e),this.port.focused=n.observable(!1),this.ssl=n.observable(!1),this.isEnabled=n.observable(!0),this.id=s,o.isFunction(r)&&r.focused.subscribe(function(){r.focused()||""!==this.server()||this.server(r())},this),this.ssl.subscribe(function(){var e=a.pInt(this.port());this.ssl()?e===this.defaultPort()&&this.port(this.defaultSslPort()):e===this.defaultSslPort()&&this.port(this.defaultPort())},this)}var o=s(1),n=s(44),r=s(2),a=s(181);i.prototype.set=function(e,t,s){this.server(e),this.ssl(s),this.port(t)},i.prototype.clear=function(){this.server(""),this.ssl(!1),this.port(this.defaultPort())},i.prototype.getIntPort=function(){return a.pInt(this.port())},i.prototype.parentSave=function(e,t){e.focused&&e.focused(!1);var s=r.find(t,function(e){return r.isFunction(e.save)});s&&s.save()},e.exports=i},357:function(e,t,s){"use strict";function i(){n.call(this),this.oIdentitySettingsFormView=new l(this,!0)}var o=s(2),n=s(194),r=s(314),a=s(348),l=s(358);o.extendOwn(i.prototype,n.prototype),i.prototype.PopupTemplate="MailWebclient_Settings_CreateIdentityPopup",i.prototype.onOpen=function(e){var t=r.getAccount(e),s=new a;s.accountId(e),s.email(t.email()),this.oIdentitySettingsFormView.onShow(s),this.oIdentitySettingsFormView.populate(),this.oIdentitySettingsFormView.friendlyNameHasFocus(!0)},e.exports=new i},358:function(e,t,s){"use strict";function i(e,t){p.call(this,f.ServerModuleName),this.identity=r.observable(null),this.oParent=e,this.bCreate=t,this.disableCheckbox=r.observable(!1),this.isDefault=r.observable(!1),this.email=r.observable(""),this.accountPart=r.observable(!1),this.friendlyName=r.observable(""),this.friendlyNameHasFocus=r.observable(!1)}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(181),h=s(217),c=s(186),u=s(42),d=s(188),p=u.run("SettingsWebclient","getAbstractSettingsFormViewClass"),m=s(314),g=s(315),f=s(313);o.extendOwn(i.prototype,p.prototype),i.prototype.ViewTemplate="MailWebclient_Settings_IdentitySettingsFormView",i.prototype.ViewConstructorName="CIdentitySettingsFormView",i.prototype.onShow=function(e){this.identity(e&&!e.FETCHER?e:null),this.populate()},i.prototype.getCurrentValues=function(){return[this.friendlyName(),this.email()]},i.prototype.getParametersForSave=function(){if(this.identity()){var e={AccountID:this.identity().accountId(),Default:this.isDefault(),FriendlyName:this.friendlyName(),AccountPart:this.identity().bAccountPart};return this.identity().bAccountPart||(o.extendOwn(e,{Email:n.trim(this.email())}),this.bCreate||(e.EntityId=this.identity().id())),e}return{}},i.prototype.save=function(){""===n.trim(this.email())?d.showError(h.i18n("MAILWEBCLIENT/ERROR_IDENTITY_FIELDS_BLANK")):(this.isSaving(!0),this.updateSavedState(),g.send(this.bCreate?"CreateIdentity":"UpdateIdentity",this.getParametersForSave(),this.onResponse,this))},i.prototype.onResponse=function(e,t){if(this.isSaving(!1),e.Result){var s=t.Parameters,i=l.pInt(s.AccountID),n=0<i?m.getAccount(i):null;m.populateIdentities(function(){var t=m.getCurrent(),s=t.identities(),i=o.find(s,function(t){return t.id()===e.Result});i&&u.run("SettingsWebclient","setAddHash",[["identity",i.hash()]])}),this.bCreate&&o.isFunction(this.oParent.closePopup)&&this.oParent.closePopup(),s.AccountPart&&n&&n.updateFriendlyName(s.FriendlyName),this.disableCheckbox(this.isDefault()),d.showReport(a.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS"))}else c.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_IDENTITY_ADDING"))},i.prototype.populate=function(){var e=this.identity();e&&(this.isDefault(e.isDefault()),this.email(e.email()),this.accountPart(e.bAccountPart),this.friendlyName(e.friendlyName()),this.disableCheckbox(e.isDefault()),setTimeout(function(){this.updateSavedState()}.bind(this),1))},i.prototype.remove=function(){if(this.identity()&&!this.identity().bAccountPart){var e={AccountID:this.identity().accountId(),EntityId:this.identity().id()};g.send("DeleteIdentity",e,this.onAccountIdentityDeleteResponse,this),!this.bCreate&&o.isFunction(this.oParent.onRemoveIdentity)&&this.oParent.onRemoveIdentity()}},i.prototype.onAccountIdentityDeleteResponse=function(e,t){e.Result||c.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_IDENTITY_DELETING")),m.populateIdentities()},i.prototype.cancel=function(){o.isFunction(this.oParent.cancelPopup)&&this.oParent.cancelPopup()},e.exports=i},359:function(e,t,s){"use strict";function i(){p.call(this),this.iAccountId=0,this.loading=r.observable(!1),this.newFolderCreating=r.observable(!1),this.incomingLogin=r.observable(""),this.incomingPassword=r.observable(""),this.oIncoming=new v(110,995,"fectcher_add_incoming",a.i18n("MAILWEBCLIENT/LABEL_POP3_SERVER")),this.folder=r.observable(""),this.options=r.observableArray([]),f.folderList.subscribe(function(){this.populateOptions()},this),this.addNewFolderCommand=l.createCommand(this,this.onAddNewFolderClick),this.leaveMessagesOnServer=r.observable(!1),this.loginIsSelected=r.observable(!1),this.passwordIsSelected=r.observable(!1),this.defaultOptionsAfterRender=l.defaultOptionsAfterRender}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(217),h=s(186),c=s(188),u=s(191),d=s(192),p=s(194),m=s(360),g=s(314),f=s(316),b=s(313),v=s(356);o.extendOwn(i.prototype,p.prototype),i.prototype.PopupTemplate="MailWebclient_Settings_CreateFetcherPopup",i.prototype.onOpen=function(e){this.iAccountId=e,this.bShown=!0,this.populateOptions(),this.incomingLogin(""),this.incomingPassword(""),this.oIncoming.clear(),this.folder(""),this.leaveMessagesOnServer(!0)},i.prototype.populateOptions=function(){this.bShown&&this.options(f.folderList().getOptions("",!0,!1,!1))},i.prototype.onClose=function(){this.bShown=!1},i.prototype.save=function(){if(this.isEmptyRequiredFields())c.showError(a.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY"));else{var e={AccountId:this.iAccountId,Folder:this.folder(),IncomingServer:this.oIncoming.server(),IncomingPort:this.oIncoming.getIntPort(),IncomingUseSsl:this.oIncoming.ssl(),IncomingLogin:n.trim(this.incomingLogin()),IncomingPassword:n.trim(this.incomingPassword()),LeaveMessagesOnServer:this.leaveMessagesOnServer()};this.loading(!0),u.send(b.FetchersServerModuleName,"CreateFetcher",e,this.onCreateFetcherResponse,this)}},i.prototype.onCreateFetcherResponse=function(e,t){this.loading(!1),e.Result?(g.populateFetchers(),this.closePopup()):h.showErrorByCode(e,a.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},i.prototype.cancelPopup=function(){this.newFolderCreating()||this.closePopup()},i.prototype.isEmptyRequiredFields=function(){switch(""){case this.oIncoming.server():return this.oIncoming.server.focused(!0),!0;case n.trim(this.incomingLogin()):return this.loginIsSelected(!0),!0;case n.trim(this.incomingPassword()):return this.passwordIsSelected(!0),!0;default:return!1}},i.prototype.onAddNewFolderClick=function(){this.newFolderCreating(!0),d.showPopup(m,[o.bind(this.chooseFolderInList,this)])},i.prototype.chooseFolderInList=function(e,t){var s=f.folderList().sDelimiter,i=[];""!==e&&""!==t&&(this.options(f.folderList().getOptions("",!0,!1,!1)),o.each(this.options(),o.bind(function(o){e===o.name&&(i=o.fullName.split(s),i.pop(),t===i.join(s)&&this.folder(o.fullName))},this))),this.newFolderCreating(!1)},e.exports=new i},360:function(e,t,s){"use strict";function i(){c.call(this),this.isCreating=r.observable(!1),p.folderListLoading.subscribe(function(){
var e=p.folderListLoading.indexOf(p.editedFolderList().iAccountId)!==-1;!e&&this.isCreating()&&(n.isFunction(this.fCallback)&&this.fCallback(this.folderName(),this.parentFolder()),this.isCreating(!1),this.closePopup())},this),this.options=r.observableArray([]),this.parentFolder=r.observable(""),this.folderName=r.observable(""),this.folderNameFocus=r.observable(!1),this.fCallback=null,this.defaultOptionsAfterRender=l.defaultOptionsAfterRender}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(217),h=s(186),c=s(194),u=s(314),d=s(315),p=s(316);o.extendOwn(i.prototype,c.prototype),i.prototype.PopupTemplate="MailWebclient_Settings_CreateFolderPopup",i.prototype.onOpen=function(e){this.options(p.editedFolderList().getOptions(a.i18n("MAILWEBCLIENT/LABEL_NO_PARENT_FOLDER"),!0,!1,!0)),this.fCallback=e,this.folderName(""),this.folderNameFocus(!0)},i.prototype.create=function(){var e=""===this.parentFolder()?p.editedFolderList().sNamespaceFolder:this.parentFolder(),t={AccountID:u.editedId(),FolderNameInUtf8:this.folderName(),FolderParentFullNameRaw:e,Delimiter:p.editedFolderList().sDelimiter};this.folderNameFocus(!1),this.isCreating(!0),d.send("CreateFolder",t,this.onCreateFolderResponse,this)},i.prototype.onCreateFolderResponse=function(e,t){e.Result?p.getFolderList(u.editedId()):(this.isCreating(!1),h.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_CREATE_FOLDER")))},i.prototype.cancelPopup=function(){this.isCreating()||(n.isFunction(this.fCallback)&&this.fCallback("",""),this.closePopup())},e.exports=new i},361:function(e,t,s){"use strict";function i(){u.call(this,m.ServerModuleName),this.enable=n.observable(!1),this.subject=n.observable(""),this.message=n.observable(""),d.editedId.subscribe(function(){this.bShown&&this.populate()},this)}var o=s(2),n=s(44),r=s(185),a=s(181),l=s(186),h=s(42),c=s(188),u=h.run("SettingsWebclient","getAbstractSettingsFormViewClass"),d=s(314),p=s(315),m=s(313),g=s(362);o.extendOwn(i.prototype,u.prototype),i.prototype.ViewTemplate="MailWebclient_Settings_AccountAutoresponderSettingsFormView",i.prototype.getCurrentValues=function(){return[this.enable(),this.subject(),this.message()]},i.prototype.onShow=function(){this.populate()},i.prototype.revert=function(){this.populate()},i.prototype.getParametersForSave=function(){return{AccountID:d.editedId(),Enable:this.enable(),Subject:this.subject(),Message:this.message()}},i.prototype.applySavedValues=function(e){var t=d.getEdited(),s=t.autoresponder();s&&(s.enable=e.Enable,s.subject=e.Subject,s.message=e.Message)},i.prototype.save=function(){this.isSaving(!0),this.updateSavedState(),p.send("UpdateAutoresponder",this.getParametersForSave(),this.onResponse,this)},i.prototype.onResponse=function(e,t){if(this.isSaving(!1),e.Result===!1)l.showErrorByCode(e,r.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"));else{var s=t.Parameters;this.applySavedValues(s),c.showReport(r.i18n("MAILWEBCLIENT/REPORT_AUTORESPONDER_UPDATE_SUCCESS"))}},i.prototype.populate=function(){var e=d.getEdited();e&&(null!==e.autoresponder()?(this.enable(e.autoresponder().enable),this.subject(e.autoresponder().subject),this.message(e.autoresponder().message)):p.send("GetAutoresponder",{AccountID:e.id()},this.onGetAutoresponderResponse,this)),this.updateSavedState()},i.prototype.onGetAutoresponderResponse=function(e,t){if(e&&e.Result){var s=t.Parameters,i=a.pInt(s.AccountID),o=d.getAccount(i),n=new g;o&&(n.parse(i,e.Result),o.autoresponder(n),i===d.editedId()&&this.populate())}},e.exports=new i},362:function(e,t,s){"use strict";function i(){this.iAccountId=0,this.enable=!1,this.subject="",this.message=""}var o=s(181);i.prototype.parse=function(e,t){this.iAccountId=e,this.enable=!!t.Enable,this.subject=o.pString(t.Subject),this.message=o.pString(t.Message)},e.exports=i},363:function(e,t,s){"use strict";function i(){c.call(this,m.ServerModuleName),this.bShown=!1,this.foldersOptions=n.observableArray([]),p.editedFolderList.subscribe(function(){this.bShown&&this.populate()},this),this.loading=n.observable(!0),this.collection=n.observableArray([]),this.fieldOptions=[{text:r.i18n("MAILWEBCLIENT/LABEL_FROM"),value:0},{text:r.i18n("MAILWEBCLIENT/LABEL_TO"),value:1},{text:r.i18n("MAILWEBCLIENT/LABEL_SUBJECT"),value:2}],this.conditionOptions=[{text:r.i18n("MAILWEBCLIENT/LABEL_CONTAINING"),value:0},{text:r.i18n("MAILWEBCLIENT/LABEL_EQUAL_TO"),value:1},{text:r.i18n("MAILWEBCLIENT/LABEL_NOT_CONTAINING"),value:2}],this.actionOptions=[{text:r.i18n("MAILWEBCLIENT/LABEL_MOVE_FILTER_ACTION"),value:3},{text:r.i18n("MAILWEBCLIENT/LABEL_DELETE_FILTER_ACTION"),value:1}],this.phaseArray=[""],o.each(r.i18n("MAILWEBCLIENT/INFO_FILTER").split(/,{0,1}\s/),function(e){var t=this.phaseArray.length-1;"%"===e.substr(0,1)||"%"===this.phaseArray[t].substr(-1,1)?this.phaseArray.push(e):this.phaseArray[t]+=" "+e},this),this.firstState=null}var o=s(2),n=s(44),r=s(185),a=s(181),l=s(188),h=s(42),c=h.run("SettingsWebclient","getAbstractSettingsFormViewClass"),u=s(314),d=s(315),p=s(316),m=s(313),g=s(345),f=s(344);o.extendOwn(i.prototype,c.prototype),i.prototype.ViewTemplate="MailWebclient_Settings_AccountFiltersSettingsFormView",i.prototype.onShow=function(){this.populate()},i.prototype.onHide=function(){this.bShown=!1},i.prototype.populate=function(){var e=p.editedFolderList(),t=[];e.iAccountId===u.editedId()?(t=e.getOptions(r.i18n("MAILWEBCLIENT/LABEL_FOLDER_NOT_SELECTED"),!0,!0,!1,!0),this.foldersOptions(t),this.populateFilters()):(this.loading(!0),this.collection([]))},i.prototype.revert=function(){o.each(this.collection(),function(e){e.revert()})},i.prototype.commit=function(){o.each(this.collection(),function(e){e.commit()})},i.prototype.getCurrentValues=function(){return o.map(this.collection(),function(e){return""+e},this)},i.prototype.getParametersForSave=function(){var e=o.map(this.collection(),function(e){return{Enable:e.enable()?"1":"0",Field:e.field(),Filter:e.filter(),Condition:e.condition(),Action:e.action(),FolderFullName:e.folder()}});return{AccountID:u.editedId(),Filters:e}},i.prototype.save=function(){var e=o.some(this.collection(),function(e){return""===e.filter()||"3"===a.pString(e.action())&&""===e.folder()});e?l.showError(r.i18n("MAILWEBCLIENT/ERROR_FILTER_FIELDS_EMPTY")):(this.isSaving(!0),this.commit(),this.updateSavedState(),d.send("UpdateFilters",this.getParametersForSave(),this.onAccountSieveFiltersUpdateResponse,this))},i.prototype.populateFilters=function(){var e=u.getEdited();e&&(null!==e.filters()?(this.loading(!1),this.collection(e.filters().collection()),this.updateSavedState()):(this.loading(!0),this.collection([]),d.send("GetFilters",{AccountID:e.id()},this.onGetFiltersResponse,this)))},i.prototype.deleteFilter=function(e){this.collection.remove(e)},i.prototype.addFilter=function(){var e=new g(u.editedId());this.collection.push(e)},i.prototype.displayFilterPart=function(e,t){var s="";return s="%FIELD%"===e?"Field":"%CONDITION%"===e?"Condition":"%STRING%"===e?"String":"%ACTION%"===e?"Action":"%FOLDER%"===e?"Folder":"%DEPENDED"===e.substr(0,9)?"DependedText":"Text",t+s},i.prototype.getDependedText=function(e){return e=a.pString(e),e&&(e=e.replace(/%/g,"").split("=")[1]||""),e},i.prototype.getDependedField=function(e,t){return e=a.pString(e),e&&(e=e.replace(/[=](.*)/g,"").split("-")[1]||"",e=e.toLowerCase()),!!t[e]&&t[e]()},i.prototype.onGetFiltersResponse=function(e,t){var s=t.Parameters,i=a.pInt(s.AccountID),o=u.getAccount(i),n=new f;this.loading(!1),e&&e.Result&&o?(n.parse(i,e.Result),o.filters(n),i===u.editedId()&&this.populateFilters()):l.showError(r.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},i.prototype.onAccountSieveFiltersUpdateResponse=function(e,t){this.isSaving(!1),t&&t.Method?e&&e.Result?l.showReport(r.i18n("MAILWEBCLIENT/REPORT_FILTERS_UPDATE_SUCCESS")):l.showError(r.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED")):l.showError(r.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},e.exports=new i},364:function(e,t,s){"use strict";function i(){this.bAllowTemplateFolders=y.AllowTemplateFolders,this.highlighted=r.observable(!1).extend({autoResetToFalse:500}),this.collection=r.observableArray(v.editedFolderList().collection()),this.oCollSubscription=v.editedFolderList().collection.subscribe(function(e){this.collection(e)},this),this.totalMessageCount=r.observable(0),this.enableButtons=r.computed(function(){return v.editedFolderList().initialized()},this),v.editedFolderList.subscribe(function(e){this.collection(e.collection()),this.setTotalMessageCount(),this.oCollSubscription.dispose(),this.oCollSubscription=e.collection.subscribe(function(e){this.collection(e)},this)},this),this.addNewFolderCommand=l.createCommand(this,this.addNewFolder,this.enableButtons),this.setSystemFoldersCommand=l.createCommand(this,this.setSystemFolders,this.enableButtons),this.showMovedWithMouseItem=r.computed(function(){return!c.isMobile()},this),this.allowImportExport=r.observable(u.isModuleEnabled("ImportExportMailPlugin")),c.subscribeEvent("MailWebclient::AttemptDeleteNonemptyFolder",o.bind(function(){this.highlighted(!0)},this)),c.broadcastEvent("MailWebclient::ConstructView::after",{Name:"CAccountFoldersPaneView",View:this}),this.afterMove=o.debounce(o.bind(this.folderListOrderUpdate,this),3e3)}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(217),h=s(186),c=s(182),u=s(42),d=s(192),p=s(360),m=s(365),g=u.run("ImportExportMailPlugin","getImportExportPopup"),f=s(314),b=s(315),v=s(316),y=s(313);s(366),i.prototype.ViewTemplate="MailWebclient_Settings_AccountFoldersPaneView",i.prototype.folderListOrderUpdate=function(){var e=v.editedFolderList().repopulateLinedCollection(),t={AccountID:f.editedId(),FolderList:o.compact(o.map(e,function(e){if(!e.bVirtual)return e.fullName()}))};b.send("UpdateFoldersOrder",t,function(e){e.Result||(h.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_CHANGE_FOLDERS_ORDER")),v.getFolderList(f.editedId()))},this)},i.prototype.hide=function(e){var t=f.editedId();o.delay(function(){v.getFolderList(t)},3e3),n.isFunction(e)&&e()},i.prototype.show=function(){this.setTotalMessageCount()},i.prototype.setTotalMessageCount=function(){var e=v.editedFolderList();0===e.iAccountId?this.totalMessageCount(0):(this.totalMessageCount(e.getTotalMessageCount()),e.countsCompletelyFilled()||(e.countsCompletelyFilledSubscribtion&&(e.countsCompletelyFilledSubscribtion.dispose(),e.countsCompletelyFilledSubscribtion=null),e.countsCompletelyFilledSubscribtion=e.countsCompletelyFilled.subscribe(function(){e.countsCompletelyFilled()&&(this.totalMessageCount(e.getTotalMessageCount()),e.countsCompletelyFilledSubscribtion.dispose(),e.countsCompletelyFilledSubscribtion=null)},this)))},i.prototype.addNewFolder=function(){d.showPopup(p)},i.prototype.setSystemFolders=function(){d.showPopup(m)},i.prototype.importExport=function(){this.allowImportExport()&&d.showPopup(g,[{}])},e.exports=new i},365:function(e,t,s){"use strict";function i(){h.call(this),this.folders=d.editedFolderList,this.sentFolderFullName=n.observable(""),this.draftsFolderFullName=n.observable(""),this.spamFolderFullName=n.observable(""),this.trashFolderFullName=n.observable(""),this.options=n.observableArray([]),this.defaultOptionsAfterRender=a.defaultOptionsAfterRender,this.bAllowSpamFolderEditing=p.AllowSpamFolder}var o=s(2),n=s(44),r=s(185),a=s(217),l=s(186),h=s(194),c=s(314),u=s(315),d=s(316),p=s(313);o.extendOwn(i.prototype,h.prototype),i.prototype.PopupTemplate="MailWebclient_Settings_SetSystemFoldersPopup",i.prototype.onOpen=function(){var e=d.editedFolderList();this.options(e.getOptions(r.i18n("MAILWEBCLIENT/LABEL_NO_FOLDER_USAGE_ASSIGNED"),!1,!1,!1)),this.sentFolderFullName(e.sentFolderFullName()),this.draftsFolderFullName(e.draftsFolderFullName()),p.AllowSpamFolder&&this.spamFolderFullName(e.spamFolderFullName()),this.trashFolderFullName(e.trashFolderFullName())},i.prototype.onResponseFoldersSetupSystem=function(e,t){e.Result===!1&&(l.showErrorByCode(e,r.i18n("MAILWEBCLIENT/ERROR_SETUP_SPECIAL_FOLDERS")),d.getFolderList(c.editedId()))},i.prototype.apply=function(){var e=d.editedFolderList(),t=!1,s=null;this.sentFolderFullName()!==e.sentFolderFullName()&&(e.sentFolderFullName(this.sentFolderFullName()),t=!0),this.draftsFolderFullName()!==e.draftsFolderFullName()&&(e.draftsFolderFullName(this.draftsFolderFullName()),t=!0),p.AllowSpamFolder&&this.spamFolderFullName()!==e.spamFolderFullName()&&(e.spamFolderFullName(this.spamFolderFullName()),t=!0),this.trashFolderFullName()!==e.trashFolderFullName()&&(e.trashFolderFullName(this.trashFolderFullName()),t=!0),t&&(s={AccountID:c.editedId(),Sent:e.sentFolderFullName(),Drafts:e.draftsFolderFullName(),Trash:e.trashFolderFullName(),Spam:e.spamFolderFullName()},u.send("SetupSystemFolders",s,this.onResponseFoldersSetupSystem,this)),this.closePopup()},e.exports=new i},366:function(e,t,s){var i,o,n;!function(r){o=[s(44),s(1),s(367),s(224),s(223)],i=r,n="function"==typeof i?i.apply(t,o):i,!(void 0!==n&&(e.exports=n))}(function(e,t){var s="ko_sortItem",i="ko_sourceIndex",o="ko_sortList",n="ko_parentList",r="ko_dragItem",a=e.utils.unwrapObservable,l=e.utils.domData.get,h=e.utils.domData.set,c=t.ui&&t.ui.version,u=c&&c.indexOf("1.6.")&&c.indexOf("1.7.")&&(c.indexOf("1.8.")||"1.8.24"===c),d=function(t,i){e.utils.arrayForEach(t,function(e){1===e.nodeType&&(h(e,s,i),h(e,n,l(e.parentNode,o)))})},p=function(t,s){var i,o={},n=a(t())||{};return n.data?(o[s]=n.data,o.name=n.template):o[s]=t(),e.utils.arrayForEach(["afterAdd","afterRender","as","beforeRemove","includeDestroyed","templateEngine","templateOptions","nodes"],function(t){n.hasOwnProperty(t)?o[t]=n[t]:e.bindingHandlers.sortable.hasOwnProperty(t)&&(o[t]=e.bindingHandlers.sortable[t])}),"foreach"===s&&(o.afterRender?(i=o.afterRender,o.afterRender=function(e,t){d.call(t,e,t),i.call(t,e,t)}):o.afterRender=d),o},m=function(e,t){var s=a(t);if(s)for(var i=0;i<e;i++)s[i]&&a(s[i]._destroy)&&e++;return e},g=function(s,i){var o,n;i?(n=document.getElementById(i),n&&(o=new e.templateSources.domElement(n),o.text(t.trim(o.text())))):t(s).contents().each(function(){this&&1!==this.nodeType&&s.removeChild(this)})};e.bindingHandlers.sortable={init:function(c,d,f,b,v){var y,A,E=t(c),S=a(d())||{},F=p(d,"foreach"),C={};g(c,F.name),t.extend(!0,C,e.bindingHandlers.sortable),S.options&&C.options&&(e.utils.extend(C.options,S.options),delete S.options),e.utils.extend(C,S),C.connectClass&&(e.isObservable(C.allowDrop)||"function"==typeof C.allowDrop)?e.computed({read:function(){var t=a(C.allowDrop),s="function"==typeof t?t.call(this,F.foreach):t;e.utils.toggleDomNodeCssClass(c,C.connectClass,s)},disposeWhenNodeIsRemoved:c},this):e.utils.toggleDomNodeCssClass(c,C.connectClass,C.allowDrop),e.bindingHandlers.template.init(c,function(){return F},f,b,v),y=C.options.start,A=C.options.update,C.options.helper||(C.options.helper=function(e,s){return s.is("tr")&&s.children().each(function(){t(this).width(t(this).width())}),s});var I=setTimeout(function(){var d,p=C.options.receive;E.sortable(e.utils.extend(C.options,{start:function(t,s){var o=s.item[0];h(o,i,e.utils.arrayIndexOf(s.item.parent().children(),o)),s.item.find("input:focus").change(),y&&y.apply(this,arguments)},receive:function(e,t){"function"==typeof p&&p.call(this,e,t),d=l(t.item[0],r),d&&(d.clone&&(d=d.clone()),C.dragged&&(d=C.dragged.call(this,d,e,t)||d))},update:function(r,c){var p,g,f,b,v,y=c.item[0],E=c.item.parent()[0],S=l(y,s)||d;if(S||t(y).remove(),d=null,S&&this===E||!u&&t.contains(this,E)){if(p=l(y,n),f=l(y,i),g=l(y.parentNode,o),b=e.utils.arrayIndexOf(c.item.parent().children(),y),F.includeDestroyed||(f=m(f,p),b=m(b,g)),(C.beforeMove||C.afterMove)&&(v={item:S,sourceParent:p,sourceParentNode:p&&c.sender||y.parentNode,sourceIndex:f,targetParent:g,targetIndex:b,cancelDrop:!1},C.beforeMove&&C.beforeMove.call(this,v,r,c)),p?t(p===g?this:c.sender||this).sortable("cancel"):t(y).remove(),v&&v.cancelDrop)return;if(C.hasOwnProperty("strategyMove")&&C.strategyMove!==!1){if(b>=0)if(p)if(p!==g)p.splice(f,1),g.splice(b,0,S),h(y,s,null),c.item.remove();else{var I=a(p);p.valueWillMutate&&p.valueWillMutate(),I.splice(f,1),I.splice(b,0,S),p.valueHasMutated&&p.valueHasMutated()}else g.splice(b,0,S),h(y,s,null),c.item.remove()}else b>=0&&(p&&(p.splice(f,1),e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates(),e.options&&e.options.deferUpdates&&e.tasks.runEarly()),g.splice(b,0,S)),h(y,s,null);e.processAllDeferredBindingUpdates&&e.processAllDeferredBindingUpdates(),C.afterMove&&C.afterMove.call(this,v,r,c)}A&&A.apply(this,arguments)},connectWith:!!C.connectClass&&"."+C.connectClass})),void 0!==C.isEnabled&&e.computed({read:function(){E.sortable(a(C.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:c})},0);return e.utils.domNodeDisposal.addDisposeCallback(c,function(){(E.data("ui-sortable")||E.data("sortable"))&&E.sortable("destroy"),e.utils.toggleDomNodeCssClass(c,C.connectClass,!1),clearTimeout(I)}),{controlsDescendantBindings:!0}},update:function(t,s,i,n,r){var a=p(s,"foreach");h(t,o,a.foreach),e.bindingHandlers.template.update(t,function(){return a},i,n,r)},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,options:{}},e.bindingHandlers.draggable={init:function(s,i,o,n,l){var c=a(i())||{},u=c.options||{},d=e.utils.extend({},e.bindingHandlers.draggable.options),m=p(i,"data"),g=c.connectClass||e.bindingHandlers.draggable.connectClass,f=void 0!==c.isEnabled?c.isEnabled:e.bindingHandlers.draggable.isEnabled;return c="data"in c?c.data:c,h(s,r,c),e.utils.extend(d,u),d.connectToSortable=!!g&&"."+g,t(s).draggable(d),void 0!==f&&e.computed({read:function(){t(s).draggable(a(f)?"enable":"disable")},disposeWhenNodeIsRemoved:s}),e.utils.domNodeDisposal.addDisposeCallback(s,function(){t(s).draggable("destroy")}),e.bindingHandlers.template.init(s,function(){return m},o,n,l)},update:function(t,s,i,o,n){var r=p(s,"data");return e.bindingHandlers.template.update(t,function(){return r},i,o,n)},connectClass:e.bindingHandlers.sortable.connectClass,options:{helper:"clone"}},e.bindingHandlers.droppable={init:function(i,o,n,h,c){var u=a(o())||{},d=u.options||{},p=e.utils.extend({},e.bindingHandlers.droppable.options),m=void 0!==u.isEnabled?u.isEnabled:e.bindingHandlers.droppable.isEnabled;e.utils.extend(p,d),u="data"in u?u.data:o(),p.drop=function(e,t){var i=l(t.draggable[0],r)||l(t.draggable[0],s);u(i)},t(i).droppable(p),void 0!==m&&e.computed({read:function(){t(i).droppable(a(m)?"enable":"disable")},disposeWhenNodeIsRemoved:i}),e.utils.domNodeDisposal.addDisposeCallback(i,function(){t(i).droppable("destroy")})},options:{accept:"*"}}})},367:function(e,t,s){var i,o,n;/*!
	 * jQuery UI Sortable 1.12.1
	 * http://jqueryui.com
	 *
	 * Copyright jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 */
!function(r){o=[s(1),s(225),s(227),s(226),s(230),s(209),s(213)],i=r,n="function"==typeof i?i.apply(t,o):i,!(void 0!==n&&(e.exports=n))}(function(e){return e.widget("ui.sortable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,s){return e>=t&&e<t+s},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){var t=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),e.each(this.items,function(){t._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,s){var i=null,o=!1,n=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(t),e(t.target).parents().each(function(){if(e.data(this,n.widgetName+"-item")===n)return i=e(this),!1}),e.data(t.target,n.widgetName+"-item")===n&&(i=e(t.target)),!!i&&(!(this.options.handle&&!s&&(e(this.options.handle,i).find("*").addBack().each(function(){this===t.target&&(o=!0)}),!o))&&(this.currentItem=i,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(t,s,i){var o,n,r=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&"auto"!==r.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",r.cursor),this.storedStylesheet=e("<style>*{ cursor: "+r.cursor+" !important; }</style>").appendTo(n)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(o=this.containers.length-1;o>=0;o--)this.containers[o]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var s,i,o,n,r=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-this.overflowOffset.top<r.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-r.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-this.overflowOffset.left<r.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-r.scrollSpeed)):(t.pageY-this.document.scrollTop()<r.scrollSensitivity?a=this.document.scrollTop(this.document.scrollTop()-r.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<r.scrollSensitivity&&(a=this.document.scrollTop(this.document.scrollTop()+r.scrollSpeed)),t.pageX-this.document.scrollLeft()<r.scrollSensitivity?a=this.document.scrollLeft(this.document.scrollLeft()-r.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<r.scrollSensitivity&&(a=this.document.scrollLeft(this.document.scrollLeft()+r.scrollSpeed))),a!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),s=this.items.length-1;s>=0;s--)if(i=this.items[s],o=i.item[0],n=this._intersectsWithPointer(i),n&&i.instance===this.currentContainer&&!(o===this.currentItem[0]||this.placeholder[1===n?"next":"prev"]()[0]===o||e.contains(this.placeholder[0],o)||"semi-dynamic"===this.options.type&&e.contains(this.element[0],o))){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(i))break;this._rearrange(t,i),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,s){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var i=this,o=this.placeholder.offset(),n=this.options.axis,r={};n&&"x"!==n||(r.left=o.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(r.top=o.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(r,parseInt(this.options.revert,10)||500,function(){i._clear(t)})}else this._clear(t,s);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new e.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var s=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},e(s).each(function(){var s=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);s&&i.push((t.key||s[1]+"[]")+"="+(t.key&&t.expression?s[1]:s[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(t){var s=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},s.each(function(){i.push(e(t.item||this).attr(t.attribute||"id")||"")}),i},_intersectsWith:function(e){var t=this.positionAbs.left,s=t+this.helperProportions.width,i=this.positionAbs.top,o=i+this.helperProportions.height,n=e.left,r=n+e.width,a=e.top,l=a+e.height,h=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||i+h>a&&i+h<l,d="y"===this.options.axis||t+c>n&&t+c<r,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:n<t+this.helperProportions.width/2&&s-this.helperProportions.width/2<r&&a<i+this.helperProportions.height/2&&o-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t,s,i="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),o="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),n=i&&o;return!!n&&(t=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection(),this.floating?"right"===s||"down"===t?2:1:t&&("down"===t?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),s=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),i=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&s||"left"===o&&!s:i&&("down"===i&&t||"up"===i&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function s(){a.push(this)}var i,o,n,r,a=[],l=[],h=this._connectWith();if(h&&t)for(i=h.length-1;i>=0;i--)for(n=e(h[i],this.document[0]),o=n.length-1;o>=0;o--)r=e.data(n[o],this.widgetFullName),r&&r!==this&&!r.options.disabled&&l.push([e.isFunction(r.options.items)?r.options.items.call(r.element):e(r.options.items,r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),r]);for(l.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=l.length-1;i>=0;i--)l[i][0].each(s);return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var s=0;s<t.length;s++)if(t[s]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var s,i,o,n,r,a,l,h,c=this.items,u=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(s=d.length-1;s>=0;s--)for(o=e(d[s],this.document[0]),i=o.length-1;i>=0;i--)n=e.data(o[i],this.widgetFullName),n&&n!==this&&!n.options.disabled&&(u.push([e.isFunction(n.options.items)?n.options.items.call(n.element[0],t,{item:this.currentItem}):e(n.options.items,n.element),n]),this.containers.push(n));for(s=u.length-1;s>=0;s--)for(r=u[s][1],a=u[s][0],i=0,h=a.length;i<h;i++)l=e(a[i]),l.data(this.widgetName+"-item",r),c.push({item:l,instance:r,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var s,i,o,n;for(s=this.items.length-1;s>=0;s--)i=this.items[s],i.instance!==this.currentContainer&&this.currentContainer&&i.item[0]!==this.currentItem[0]||(o=this.options.toleranceElement?e(this.options.toleranceElement,i.item):i.item,t||(i.width=o.outerWidth(),i.height=o.outerHeight()),n=o.offset(),i.left=n.left,i.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(s=this.containers.length-1;s>=0;s--)n=this.containers[s].element.offset(),this.containers[s].containerCache.left=n.left,this.containers[s].containerCache.top=n.top,this.containers[s].containerCache.width=this.containers[s].element.outerWidth(),this.containers[s].containerCache.height=this.containers[s].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var s,i=t.options;i.placeholder&&i.placeholder.constructor!==String||(s=i.placeholder,i.placeholder={element:function(){var i=t.currentItem[0].nodeName.toLowerCase(),o=e("<"+i+">",t.document[0]);return t._addClass(o,"ui-sortable-placeholder",s||t.currentItem[0].className)._removeClass(o,"ui-sortable-helper"),"tbody"===i?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(o)):"tr"===i?t._createTrPlaceholder(t.currentItem,o):"img"===i&&o.attr("src",t.currentItem.attr("src")),s||o.css("visibility","hidden"),o},update:function(e,o){s&&!i.forcePlaceholderSize||(o.height()||o.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,s){var i=this;t.children().each(function(){e("<td>&#160;</td>",i.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(s)})},_contactContainers:function(t){var s,i,o,n,r,a,l,h,c,u,d=null,p=null;for(s=this.containers.length-1;s>=0;s--)if(!e.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(d&&e.contains(this.containers[s].element[0],d.element[0]))continue;d=this.containers[s],p=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",t,this._uiHash(this)),this.containers[s].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(o=1e4,n=null,c=d.floating||this._isFloating(this.currentItem),r=c?"left":"top",a=c?"width":"height",u=c?"pageX":"pageY",i=this.items.length-1;i>=0;i--)e.contains(this.containers[p].element[0],this.items[i].item[0])&&this.items[i].item[0]!==this.currentItem[0]&&(l=this.items[i].item.offset()[r],h=!1,t[u]-l>this.items[i][a]/2&&(h=!0),Math.abs(t[u]-l)<o&&(o=Math.abs(t[u]-l),n=this.items[i],this.direction=h?"up":"down"));if(!n&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1));n?this._rearrange(t,n,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var s=this.options,i=e.isFunction(s.helper)?e(s.helper.apply(this.element[0],[t,this.currentItem])):"clone"===s.helper?this.currentItem.clone():this.currentItem;return i.parents("body").length||e("parent"!==s.appendTo?s.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),i[0].style.width&&!s.forceHelperSize||i.width(this.currentItem.width()),i[0].style.height&&!s.forceHelperSize||i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,s,i,o=this.options;"parent"===o.containment&&(o.containment=this.helper[0].parentNode),"document"!==o.containment&&"window"!==o.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===o.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===o.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||(t=e(o.containment)[0],s=e(o.containment).offset(),i="hidden"!==e(t).css("overflow"),this.containment=[s.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,s.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,s.left+(i?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,s.top+(i?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,s){s||(s=this.position);var i="absolute"===t?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(o[0].tagName);return{top:s.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:o.scrollTop())*i,left:s.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:o.scrollLeft())*i}},_generatePosition:function(t){var s,i,o=this.options,n=t.pageX,r=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),o.grid&&(s=this.originalPageY+Math.round((r-this.originalPageY)/o.grid[1])*o.grid[1],r=this.containment?s-this.offset.click.top>=this.containment[1]&&s-this.offset.click.top<=this.containment[3]?s:s-this.offset.click.top>=this.containment[1]?s-o.grid[1]:s+o.grid[1]:s,i=this.originalPageX+Math.round((n-this.originalPageX)/o.grid[0])*o.grid[0],n=this.containment?i-this.offset.click.left>=this.containment[0]&&i-this.offset.click.left<=this.containment[2]?i:i-this.offset.click.left>=this.containment[0]?i-o.grid[0]:i+o.grid[0]:i)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(e,t,s,i){s?s[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var o=this.counter;this._delay(function(){o===this.counter&&this.refreshPositions(!i)})},_clear:function(e,t){function s(e,t,s){return function(i){s._trigger(e,i,t._uiHash(t))}}this.reverting=!1;var i,o=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&o.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||o.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(o.push(function(e){this._trigger("remove",e,this._uiHash())}),o.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),o.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||o.push(s("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(o.push(s("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(i=0;i<o.length;i++)o[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var s=t||this;return{helper:s.helper,placeholder:s.placeholder||e([]),position:s.position,originalPosition:s.originalPosition,offset:s.positionAbs,item:s.currentItem,sender:t?t.element:null}}})})},368:function(e,t,s){"use strict";function i(){p.call(this,v.ServerModuleName),this.enable=r.observable(!1),this.email=r.observable(""),this.email.focused=r.observable(!1),f.editedId.subscribe(function(){this.bShown&&this.populate()},this)}var o=s(2),n=s(1),r=s(44),a=s(205),l=s(185),h=s(181),c=s(186),u=s(42),d=s(188),p=u.run("SettingsWebclient","getAbstractSettingsFormViewClass"),m=s(192),g=s(193),f=s(314),b=s(315),v=s(313),y=s(369);o.extendOwn(i.prototype,p.prototype),i.prototype.ViewTemplate="MailWebclient_Settings_AccountForwardSettingsFormView",i.prototype.getCurrentValues=function(){return[this.enable(),this.email()]},i.prototype.revert=function(){this.populate()},i.prototype.getParametersForSave=function(){var e=f.getEdited();return{AccountID:e.id(),Enable:this.enable(),Email:n.trim(this.email())}},i.prototype.applySavedValues=function(e){var t=f.getEdited(),s=t.forward();s&&(s.enable=e.Enable,s.email=e.Email)},i.prototype.save=function(){var e=function(){this.isSaving(!0),this.updateSavedState(),b.send("UpdateForward",this.getParametersForSave(),this.onResponse,this)}.bind(this),t=n.trim(this.email());this.enable()&&""===t?this.email.focused(!0):this.enable()&&""!==t?a.isCorrectEmail(t)?e():m.showPopup(g,[l.i18n("MAILWEBCLIENT/ERROR_INPUT_CORRECT_EMAILS")+" "+t]):e()},i.prototype.onResponse=function(e,t){if(this.isSaving(!1),e.Result===!1)c.showErrorByCode(e,l.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"));else{var s=t.Parameters;this.applySavedValues(s),d.showReport(l.i18n("MAILWEBCLIENT/REPORT_FORWARD_UPDATE_SUCCESS"))}},i.prototype.populate=function(){var e=f.getEdited(),t=e.forward()?e.forward():null;null!==t?(this.enable(t.enable),this.email(t.email)):b.send("GetForward",{AccountID:e.id()},this.onGetForwardResponse,this),this.updateSavedState()},i.prototype.onGetForwardResponse=function(e,t){if(e&&e.Result){var s=t.Parameters,i=h.pInt(s.AccountID),o=f.getAccount(i),n=new y;o&&(n.parse(i,e.Result),o.forward(n),i===f.editedId()&&this.populate())}},e.exports=new i},369:function(e,t,s){"use strict";function i(){this.iAccountId=0,this.enable=!1,this.email=""}var o=s(181);i.prototype.parse=function(e,t){this.iAccountId=e,this.enable=!!t.Enable,this.email=o.pString(t.Email)},e.exports=i},370:function(e,t,s){"use strict";function i(){p.call(this,v.ServerModuleName),this.sFakePass="xxxxxxxx",this.bAllowIdentities=v.AllowIdentities,this.useToAuthorize=r.observable(!1),this.canBeUsedToAuthorize=r.observable(!1),this.isDefaultAccount=r.observable(!1),this.friendlyName=r.observable(""),this.email=r.observable(""),this.incomingLogin=r.observable(""),this.incomingPassword=r.observable(""),this.useThreading=r.observable(!1),this.saveRepliesToCurrFolder=r.observable(!1),this.oServerPairPropertiesView=new y("acc_edit"),this.enableThreading=this.oServerPairPropertiesView.enableThreading,this.enableThreading.subscribe(function(){this.enableThreading()||this.useThreading(!1)},this),this.allowChangePassword=r.observable(!1),this.incLoginFocused=r.observable(!1),this.incLoginFocused.subscribe(function(){this.incLoginFocused()&&""===this.incomingLogin()&&this.incomingLogin(this.email())},this),f.editedId.subscribe(function(){this.bShown&&this.populate()},this),this.updateSavedState(),this.oServerPairPropertiesView.currentValues.subscribe(function(){this.updateSavedState()},this),this.visibleTab=r.observable(!0),r.computed(function(){var e=f.getEdited();e?(this.allowChangePassword(c.run("ChangePasswordWebclient","isChangePasswordButtonAllowed",[f.collection().length,e])),this.isDefaultAccount(e.bDefault)):(this.allowChangePassword(!1),this.isDefaultAccount(!1))},this),this.isDisableAuthorize=r.observable(d.userAccountsCount()<=1),this.oDefaultAccountHostsSettingsView=s(371)}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(181),h=s(186),c=s(42),u=s(188),d=s(182),p=c.run("SettingsWebclient","getAbstractSettingsFormViewClass"),m=s(192),g=c.run("ChangePasswordWebclient","getChangePasswordPopup"),f=s(314),b=s(315),v=s(313),y=s(355);o.extendOwn(i.prototype,p.prototype),i.prototype.ViewTemplate="MailWebclient_Settings_AccountSettingsFormView",i.prototype.onShow=function(){this.oServerPairPropertiesView.fullInit(),this.populate()},i.prototype.getCurrentValues=function(){var e=[this.useToAuthorize(),this.friendlyName(),this.email(),this.incomingLogin(),this.incomingPassword(),this.useThreading(),this.saveRepliesToCurrFolder()],t=this.oServerPairPropertiesView.currentValues();return e.concat(t)},i.prototype.getParametersForSave=function(){var e=f.getEdited(),t=n.trim(this.incomingPassword());return{AccountID:e.id(),UseToAuthorize:this.useToAuthorize(),FriendlyName:this.friendlyName(),Email:n.trim(this.email()),IncomingLogin:n.trim(this.incomingLogin()),IncomingPassword:t===this.sFakePass?"":t,Server:this.oServerPairPropertiesView.getParametersForSave(),UseThreading:this.useThreading(),SaveRepliesToCurrFolder:this.saveRepliesToCurrFolder()}},i.prototype.revert=function(){this.populate()},i.prototype.populate=function(){var e=f.getEdited();e?(this.friendlyName(e.friendlyName()),this.email(e.email()),this.incomingLogin(e.incomingLogin()),this.incomingPassword(this.sFakePass),this.oServerPairPropertiesView.setServer(e.oServer),this.useToAuthorize(e.useToAuthorize()),this.canBeUsedToAuthorize(e.canBeUsedToAuthorize()),this.useThreading(e.useThreading()),this.saveRepliesToCurrFolder(e.bSaveRepliesToCurrFolder),this.isDisableAuthorize(!!this.useToAuthorize()&&d.userAccountsCount()<=1)):(this.friendlyName(""),this.email(""),this.incomingLogin(""),this.incomingPassword(""),this.oServerPairPropertiesView.clear(),this.useToAuthorize(!0),this.canBeUsedToAuthorize(!1),this.useThreading(!1),this.isDisableAuthorize(!0)),this.updateSavedState()},i.prototype.remove=function(){if(this.isDisableAuthorize())u.showError(a.i18n("COREWEBCLIENT/ERROR_ACCOUNT_DELETING_DISABLE"),!0);else{var e=f.getEdited();e&&e.remove()}},i.prototype.save=function(){this.isSaving(!0),this.updateSavedState(),b.send("UpdateAccount",this.getParametersForSave(),this.onResponse,this)},i.prototype.onResponse=function(e,t){if(this.isSaving(!1),e.Result){var s=t.Parameters,i=l.pInt(s.AccountID),o=f.getAccount(i);o&&(o.updateFromServer(e.Result),this.populate(),u.showReport(a.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS")))}else h.showErrorByCode(e,a.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"))},i.prototype.changePassword=function(){this.allowChangePassword()&&m.showPopup(g,[{iAccountId:f.editedId(),sModule:v.ServerModuleName,bHasOldPassword:!0}])},e.exports=new i},371:function(e,t,s){"use strict";function i(){this.defaultAccount=a.getDefault(),this.visible=o.observable(!!this.defaultAccount&&this.defaultAccount.oServer.bSetExternalAccessServers),this.externalAccessImapServer=o.observable(this.visible()?this.defaultAccount.oServer.sExternalAccessImapServer:""),this.externalAccessImapPort=o.observable(this.visible()?this.defaultAccount.oServer.iExternalAccessImapPort:143),this.externalAccessSmtpServer=o.observable(this.visible()?this.defaultAccount.oServer.sExternalAccessSmtpServer:""),this.externalAccessSmtpPort=o.observable(this.visible()?this.defaultAccount.oServer.iExternalAccessSmtpPort:25),this.credentialsHintText=n.mobileCredentialsHintText,this.bDemo=r.IsDemo}var o=s(44),n=s(182),r=s(43),a=s(314);i.prototype.ViewTemplate="MailWebclient_DefaultAccountHostsSettingsView",
e.exports=new i},372:function(e,t,s){"use strict";function i(e){g.call(this,v.ServerModuleName),this.oParent=e,this.bShown=!1,this.fetcher=r.observable(null),this.idFetcher=r.observable(null),this.isEnabled=r.observable(!0),this.incomingLogin=r.observable(""),this.sFakePass="******",this.incomingPassword=r.observable(this.sFakePass),this.oIncoming=new y(110,995,"fetcher_edit_incoming",a.i18n("MAILWEBCLIENT/LABEL_POP3_SERVER")),this.sFetcherFolder="",this.folder=r.observable(""),this.options=r.observableArray([]),b.folderList.subscribe(function(){this.populateOptions()},this),this.leaveMessagesOnServer=r.observable(!1),this.passwordIsSelected=r.observable(!1),this.defaultOptionsAfterRender=l.defaultOptionsAfterRender,this.fetcherIntervalHint=r.computed(function(){var e=this.fetcher()?this.fetcher().iCheckIntervalMinutes:0;return 0!==e?a.i18n("MAILWEBCLIENT/INFO_POP3_FETCHER_PLURAL",{INTERVAL:e},null,e):""},this)}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(217),h=s(186),c=s(42),u=s(188),d=s(191),p=s(192),m=s(201),g=c.run("SettingsWebclient","getAbstractSettingsFormViewClass"),f=s(314),b=s(316),v=s(313),y=s(356);o.extendOwn(i.prototype,g.prototype),i.prototype.ViewTemplate="MailWebclient_Settings_FetcherIncomingSettingsFormView",i.prototype.onShow=function(e){this.fetcher(e&&e.FETCHER?e:null),this.populateOptions(),this.populate()},i.prototype.hide=function(e){this.bShown=!1,e()},i.prototype.populateOptions=function(){this.bShown&&(this.options(b.folderList().getOptions("",!0,!1,!1)),this.sFetcherFolder!==this.folder()&&(this.folder(this.sFetcherFolder),this.updateSavedState()))},i.prototype.getCurrentValues=function(){return[this.isEnabled(),this.oIncoming.server(),this.oIncoming.port(),this.oIncoming.ssl(),this.incomingPassword(),this.folder(),this.leaveMessagesOnServer()]},i.prototype.getParametersForSave=function(){if(this.fetcher()){var e=n.trim(this.incomingPassword()),t={FetcherId:this.idFetcher(),IsEnabled:this.isEnabled(),Folder:this.folder(),IncomingServer:this.oIncoming.server(),IncomingPort:this.oIncoming.getIntPort(),IncomingUseSsl:this.oIncoming.ssl(),LeaveMessagesOnServer:this.leaveMessagesOnServer()};return""!==e&&e!==this.sFakePass&&(t.IncomingPassword=e),t}return{}},i.prototype.save=function(){this.isEmptyRequiredFields()?u.showError(a.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY")):(this.isSaving(!0),this.updateSavedState(),d.send(v.FetchersServerModuleName,"UpdateFetcher",this.getParametersForSave(),this.onResponse,this))},i.prototype.onResponse=function(e,t){this.isSaving(!1),e.Result?(f.populateFetchers(),u.showReport(a.i18n("MAILWEBCLIENT/REPORT_SUCCESSFULLY_SAVED"))):h.showErrorByCode(e,a.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},i.prototype.populate=function(){var e=this.fetcher();e&&(this.sFetcherFolder=e.folder(),this.idFetcher(e.id()),this.isEnabled(e.isEnabled()),this.folder(e.folder()),this.oIncoming.set(e.incomingServer(),e.incomingPort(),e.incomingUseSsl()),this.incomingLogin(e.incomingLogin()),this.incomingPassword(this.sFakePass),this.leaveMessagesOnServer(e.leaveMessagesOnServer()),this.updateSavedState())},i.prototype.isEmptyRequiredFields=function(){return""===this.oIncoming.server()?(this.oIncoming.server.focused(!0),!0):""===n.trim(this.incomingPassword())&&(this.passwordIsSelected(!0),!0)},i.prototype.remove=function(){var e=this.fetcher(),t=function(t){if(t){var s={FetcherId:e.id()};d.send(v.FetchersServerModuleName,"DeleteFetcher",s,this.onAccountDeleteFetcherResponse,this),this.oParent&&o.isFunction(this.oParent.onRemoveFetcher)&&this.oParent.onRemoveFetcher()}}.bind(this);e&&p.showPopup(m,[a.i18n("MAILWEBCLIENT/CONFIRM_REMOVE_FETCHER"),t,e.incomingLogin()])},i.prototype.onAccountDeleteFetcherResponse=function(e,t){e.Result||h.showErrorByCode(e,a.i18n("MAILWEBCLIENT/ERROR_FETCHER_DELETING")),f.populateFetchers()},e.exports=i},373:function(e,t,s){"use strict";function i(){d.call(this,m.ServerModuleName),this.fetcher=r.observable(null),this.idFetcher=r.observable(null),this.isEnabled=r.observable(!0),this.email=r.observable(""),this.userName=r.observable(""),this.isOutgoingEnabled=r.observable(!1),this.focusEmail=r.observable(!1),this.oOutgoing=new g(25,465,"fetcher_edit_outgoing",a.i18n("MAILWEBCLIENT/LABEL_SMTP_SERVER")),this.outgoingUseAuth=r.observable(!1),this.isAllEnabled=r.computed(function(){return this.isEnabled()&&this.isOutgoingEnabled()},this),this.isAllEnabled.subscribe(function(){this.oOutgoing.isEnabled(this.isAllEnabled())},this),this.oOutgoing.isEnabled(this.isAllEnabled()),this.firstState=null}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(186),h=s(42),c=s(188),u=s(191),d=h.run("SettingsWebclient","getAbstractSettingsFormViewClass"),p=s(314),m=s(313),g=s(356);o.extendOwn(i.prototype,d.prototype),i.prototype.ViewTemplate="MailWebclient_Settings_FetcherOutgoingSettingsFormView",i.prototype.onShow=function(e){this.fetcher(e&&e.FETCHER?e:null),this.populate()},i.prototype.getCurrentValues=function(){return[this.isOutgoingEnabled(),this.oOutgoing.server(),this.oOutgoing.port(),this.oOutgoing.ssl(),this.outgoingUseAuth(),this.userName(),this.email()]},i.prototype.getParametersForSave=function(){return this.fetcher()?{FetcherId:this.idFetcher(),IsOutgoingEnabled:this.isOutgoingEnabled(),Email:n.trim(this.email()),Name:this.userName(),OutgoingServer:this.oOutgoing.server(),OutgoingPort:this.oOutgoing.getIntPort(),OutgoingUseSsl:this.oOutgoing.ssl(),OutgoingUseAuth:this.outgoingUseAuth()}:{}},i.prototype.save=function(){this.isEnabled()&&(this.isEmptyRequiredFields()?c.showError(a.i18n("MAILWEBCLIENT/ERROR_REQUIRED_FIELDS_EMPTY")):(this.isSaving(!0),this.updateSavedState(),u.send(m.FetchersServerModuleName,"UpdateFetcherSmtpSettings",this.getParametersForSave(),this.onResponse,this)))},i.prototype.onResponse=function(e,t){this.isSaving(!1),e.Result?(p.populateFetchers(),c.showReport(a.i18n("MAILWEBCLIENT/REPORT_SUCCESSFULLY_SAVED"))):l.showErrorByCode(e,a.i18n("COREWEBCLIENT/ERROR_UNKNOWN"))},i.prototype.populate=function(){var e=this.fetcher();e&&(this.fetcher(e),this.idFetcher(e.id()),this.isEnabled(e.isEnabled()),this.email(e.email()),this.userName(e.userName()),this.isOutgoingEnabled(e.isOutgoingEnabled()),this.oOutgoing.set(e.outgoingServer(),e.outgoingPort(),e.outgoingUseSsl()),this.outgoingUseAuth(e.outgoingUseAuth()),this.updateSavedState())},i.prototype.isEmptyRequiredFields=function(){if(this.isOutgoingEnabled()){if(this.outgoingUseAuth()&&this.isOutgoingEnabled()&&""===this.oOutgoing.server())return this.oOutgoing.server.focused(!0),!0;if(this.outgoingUseAuth()&&""===n.trim(this.email()))return this.focusEmail(!0),!0}return!1},e.exports=new i},374:function(e,t,s){"use strict";function i(){p.call(this,f.ServerModuleName),this.fetcherOrIdentity=n.observable(null),this.useSignatureRadio=n.observable(Enums.UseSignature.Off),this.signature=n.observable(""),this.oHtmlEditor=new b(!0),this.oHtmlEditor.textFocused.subscribe(function(){this.oHtmlEditor.textFocused()&&this.useSignatureRadio(Enums.UseSignature.On)},this),this.useSignatureRadio.subscribe(function(){this.oHtmlEditor.setInactive(this.useSignatureRadio()===Enums.UseSignature.Off)},this),this.enableImageDragNDrop=n.observable(!1),this.enabled=n.observable(!0)}var o=s(2),n=s(44),r=s(185),a=s(181),l=s(186),h=s(180),c=s(42),u=s(188),d=s(191),p=c.run("SettingsWebclient","getAbstractSettingsFormViewClass"),m=s(314),g=s(315),f=s(313),b=s(340);o.extendOwn(i.prototype,p.prototype),i.prototype.ViewTemplate="MailWebclient_Settings_SignatureSettingsFormView",i.prototype.ViewConstructorName="CSignatureSettingsFormView",i.prototype.onShow=function(e){this.fetcherOrIdentity(e||null),this.populate(),o.defer(o.bind(this.init,this))},i.prototype.init=function(){this.oHtmlEditor.setInactive(this.useSignatureRadio()===Enums.UseSignature.Off),this.oHtmlEditor.init(this.signature(),!1,"",r.i18n("MAILWEBCLIENT/LABEL_ENTER_SIGNATURE_HERE")),this.enableImageDragNDrop(this.oHtmlEditor.isDragAndDropSupported()&&!h.ie10AndAbove)},i.prototype.getCurrentValues=function(){return this.oHtmlEditor.isInitialized()&&this.signature(this.oHtmlEditor.getText()),[this.useSignatureRadio(),this.signature()]},i.prototype.revert=function(){this.populate()},i.prototype.getParametersForSave=function(){this.signature(this.oHtmlEditor.getText());var e=m.getEdited(),t=this.fetcherOrIdentity()?this.fetcherOrIdentity().accountId():e?e.id():0,s={AccountID:t,UseSignature:this.useSignatureRadio()===Enums.UseSignature.On,Signature:this.signature()};return this.fetcherOrIdentity()&&(this.fetcherOrIdentity().FETCHER?o.extendOwn(s,{FetcherId:this.fetcherOrIdentity().id()}):this.fetcherOrIdentity().bAccountPart||o.extendOwn(s,{IdentityId:this.fetcherOrIdentity().id()})),s},i.prototype.applySavedValues=function(e){if(e.FetcherId)m.populateFetchers();else if(!e.IdentityId){var t=m.getAccount(e.AccountID);t&&(t.useSignature(!!e.UseSignature),t.signature(e.Signature))}m.populateIdentities()},i.prototype.populate=function(){var e=m.getEdited(),t=this.fetcherOrIdentity()||e;t?(this.useSignatureRadio(t.useSignature()?Enums.UseSignature.On:Enums.UseSignature.Off),this.signature(t.signature()),this.oHtmlEditor.setText(this.signature())):e&&g.send("GetSignature",{AccountID:e.id()},this.onGetSignatureResponse,this),this.updateSavedState()},i.prototype.onGetSignatureResponse=function(e,t){if(e&&e.Result){var s=t.Parameters,i=a.pInt(s.AccountID),o=m.getAccount(i);o&&(this.parseSignature(e.Result),i===m.editedId()&&this.populate())}},i.prototype.save=function(){this.isSaving(!0),this.updateSavedState(),this.fetcherOrIdentity()&&this.fetcherOrIdentity().FETCHER?d.send(f.FetchersServerModuleName,"UpdateSignature",this.getParametersForSave(),this.onResponse,this):g.send("UpdateSignature",this.getParametersForSave(),this.onResponse,this)},i.prototype.onResponse=function(e,t){this.isSaving(!1),e.Result?(this.applySavedValues(t.Parameters),u.showReport(r.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS"))):l.showErrorByCode(e,r.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"))},e.exports=new i},375:function(e,t,s){"use strict";function i(){p.call(this,"MailWebclient"),c.broadcastEvent("MailWebclient::ConstructView::before",{Name:this.ViewConstructorName,View:this,MailCache:b}),this.browserTitle=r.computed(function(){return f.getEmail()+" - "+a.i18n("MAILWEBCLIENT/HEADING_BROWSER_TAB")}),this.folderList=b.folderList,this.domFoldersMoveTo=r.observable(null),this.openMessageInNewWindowBound=o.bind(this.openMessageInNewWindow,this),this.oFolderList=new y,this.oMessageList=new A(this.openMessageInNewWindowBound),this.oBaseMessagePaneView=E,this.messagePane=r.observable(this.oBaseMessagePaneView),this.messagePane().openMessageInNewWindowBound=this.openMessageInNewWindowBound,this.messagePane.subscribe(function(){this.bindMessagePane()},this),this.isEnableGroupOperations=this.oMessageList.isEnableGroupOperations,this.composeLink=r.observable(u.buildHashFromArray(g.getCompose())),this.sCustomBigButtonModule="",this.fCustomBigButtonHandler=null,this.customBigButtonText=r.observable(""),this.bigButtonCommand=h.createCommand(this,function(){o.isFunction(this.fCustomBigButtonHandler)?this.fCustomBigButtonHandler():this.executeCompose()}),this.bigButtonText=r.computed(function(){return""!==this.customBigButtonText()?this.customBigButtonText():a.i18n("MAILWEBCLIENT/ACTION_NEW_MESSAGE")},this),this.checkMailCommand=h.createCommand(this,this.executeCheckMail),this.checkMailIndicator=r.observable(!0).extend({throttle:50}),r.computed(function(){this.checkMailIndicator(b.checkMailStarted()||b.messagesLoading())},this),this.customModulesDisabledMark=r.observableArray([]),this.visibleMarkTool=r.computed(function(){return!l.isNonEmptyArray(this.customModulesDisabledMark())},this),this.markAsReadCommand=h.createCommand(this.oMessageList,this.oMessageList.executeMarkAsRead,this.isEnableGroupOperations),this.markAsUnreadCommand=h.createCommand(this.oMessageList,this.oMessageList.executeMarkAsUnread,this.isEnableGroupOperations),this.markAllReadCommand=h.createCommand(this.oMessageList,this.oMessageList.executeMarkAllRead),this.customModulesDisabledMove=r.observableArray([]),this.visibleMoveTool=r.computed(function(){return!l.isNonEmptyArray(this.customModulesDisabledMove())},this),this.moveToFolderCommand=h.createCommand(this,function(){},this.isEnableGroupOperations),this.deleteCommand=h.createCommand(this.oMessageList,this.oMessageList.executeDelete,this.isEnableGroupOperations),this.selectedCount=r.computed(function(){return this.oMessageList.checkedUids().length},this),this.emptyTrashCommand=h.createCommand(b,b.executeEmptyTrash,this.oMessageList.isNotEmptyList),this.emptySpamCommand=h.createCommand(b,b.executeEmptySpam,this.oMessageList.isNotEmptyList),this.spamCommand=h.createCommand(this.oMessageList,this.oMessageList.executeSpam,this.isEnableGroupOperations),this.notSpamCommand=h.createCommand(this.oMessageList,this.oMessageList.executeNotSpam,this.isEnableGroupOperations),this.isVisibleReplyTool=r.computed(function(){return this.folderList().currentFolder()&&this.folderList().currentFolderFullName().length>0&&this.folderList().currentFolderType()!==Enums.FolderTypes.Drafts&&this.folderList().currentFolderType()!==Enums.FolderTypes.Sent},this),this.isVisibleForwardTool=r.computed(function(){return this.folderList().currentFolder()&&this.folderList().currentFolderFullName().length>0&&this.folderList().currentFolderType()!==Enums.FolderTypes.Drafts},this),this.isSpamFolder=r.computed(function(){return this.folderList().currentFolderType()===Enums.FolderTypes.Spam},this),this.customModulesDisabledSpam=r.observableArray([]),this.allowedSpamAction=r.computed(function(){return v.AllowSpamFolder&&this.folderList().spamFolder()&&!this.isSpamFolder()&&!l.isNonEmptyArray(this.customModulesDisabledSpam())},this),this.allowedNotSpamAction=r.computed(function(){return v.AllowSpamFolder&&this.isSpamFolder()},this),this.isTrashFolder=r.computed(function(){return this.folderList().currentFolderType()===Enums.FolderTypes.Trash},this),this.jqPanelHelper=null,v.HorizontalLayout&&n("html").addClass("layout-horiz-split"),c.broadcastEvent("MailWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var o=s(2),n=s(1),r=s(44),a=s(185),l=s(181),h=s(217),c=s(182),u=s(195),d=s(200),p=s(198),m=s(330),g=s(318),f=s(314),b=s(316),v=s(313),y=s(376),A=s(377),E=s(350);o.extendOwn(i.prototype,p.prototype),i.prototype.ViewTemplate=v.HorizontalLayout?"MailWebclient_MailHorizontalLayoutView":"MailWebclient_MailView",i.prototype.ViewConstructorName="CMailView",i.prototype.hasUnsavedChanges=function(){return this.messagePane()&&o.isFunction(this.messagePane().hasUnsavedChanges)&&this.messagePane().hasUnsavedChanges()},i.prototype.discardChanges=function(){this.messagePane()&&o.isFunction(this.messagePane().discardChanges)&&this.messagePane().discardChanges()},i.prototype.setCustomPreviewPane=function(e,t){this.messagePane().__customModuleName!==e&&(o.isFunction(this.messagePane().onHide)&&this.messagePane().onHide(),t.__customModuleName=e,this.messagePane(t),o.isFunction(this.messagePane().onShow)&&this.messagePane().onShow())},i.prototype.removeCustomPreviewPane=function(e){this.messagePane().__customModuleName===e&&(o.isFunction(this.messagePane().onHide)&&this.messagePane().onHide(),this.messagePane(this.oBaseMessagePaneView),o.isFunction(this.messagePane().onShow)&&this.messagePane().onShow())},i.prototype.setCustomBigButton=function(e,t,s){this.sCustomBigButtonModule=e,this.fCustomBigButtonHandler=t,this.customBigButtonText(s)},i.prototype.removeCustomBigButton=function(e){this.sCustomBigButtonModule===e&&(this.sCustomBigButtonModule="",this.fCustomBigButtonHandler=null,this.customBigButtonText(""))},i.prototype.resetDisabledTools=function(e,t){n.inArray("spam",t)!==-1?this.customModulesDisabledSpam(o.union(this.customModulesDisabledSpam(),[e])):this.customModulesDisabledSpam(o.without(this.customModulesDisabledSpam(),e)),n.inArray("move",t)!==-1?this.customModulesDisabledMove(o.union(this.customModulesDisabledMove(),[e])):this.customModulesDisabledMove(o.without(this.customModulesDisabledMove(),e)),n.inArray("mark",t)!==-1?this.customModulesDisabledMark(o.union(this.customModulesDisabledMark(),[e])):this.customModulesDisabledMark(o.without(this.customModulesDisabledMark(),e))},i.prototype.executeCompose=function(){m.composeMessage()},i.prototype.executeCheckMail=function(){b.checkMessageFlags(),b.executeCheckMail(!0)},i.prototype.openMessageInNewWindow=function(e){if(e){var t=e.folder(),s=e.uid(),i=this.folderList().getFolderByFullName(t),n=i.type()===Enums.FolderTypes.Drafts,r="";n?r=u.buildHashFromArray(g.getComposeFromMessage("drafts",t,s)):(r=u.buildHashFromArray(g.getViewMessage(t,s)),o.isFunction(this.messagePane().passReplyDataToNewTab)&&this.messagePane().passReplyDataToNewTab(e.sUniq)),d.openTab("?message-newtab"+r)}},i.prototype.resizeDblClick=function(e,t){t.preventDefault(),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,h.removeSelection(),this.jqPanelHelper||(this.jqPanelHelper=n(".MailLayout .panel_helper")),this.jqPanelHelper.trigger("resize",[600,"max"])},i.prototype.onRoute=function(e){if(!f.hasAccount())return void u.replaceHash(["settings","mail-accounts","account","create"]);var t=g.parseMailbox(e);f.changeCurrentAccountByHash(t.AccountHash),this.oMessageList.onRoute(e),o.isFunction(this.messagePane().onRoute)&&this.messagePane().onRoute(e,t),t.MailtoCompose&&(m.composeMessageToAddresses(e[2]),u.replaceHash(g.getMailbox()))},i.prototype.onShow=function(){this.oMessageList.onShow(),o.isFunction(this.messagePane().onShow)&&this.messagePane().onShow()},i.prototype.onHide=function(){this.oMessageList.onHide(),o.isFunction(this.messagePane().onHide)&&this.messagePane().onHide()},i.prototype.bindMessagePane=function(){o.isFunction(this.messagePane().onBind)&&(this.messagePane().onBind(this.$viewDom),this.messagePane().__bound=!0)},i.prototype.onBind=function(){var e=this.folderList,t=this.oMessageList;this.oMessageList.onBind(this.$viewDom),this.bindMessagePane(),n(this.domFoldersMoveTo()).on("click","span.folder",function(s){var i=n(this).data("folder");e().currentFolderFullName()!==i&&(s.ctrlKey?t.executeCopyToFolder(i):t.executeMoveToFolder(i))}),c.isMobile()||this.hotKeysBind()},i.prototype.hotKeysBind=function(){n(document).on("keydown",n.proxy(function(e){var t=e.keyCode,s=e&&!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!h.isTextFieldFocused()&&this.shown(),i=this.oMessageList,o=i.collection()[0],n=o&&b.currentMessage()&&o.uid()===b.currentMessage().uid();s&&t===Enums.Key.s||s&&n&&t===Enums.Key.Up?(e.preventDefault(),this.searchFocus()):i.isFocused()&&e&&t===Enums.Key.Down&&o?(e.preventDefault(),i.isFocused(!1),i.routeForMessage(o)):s&&t===Enums.Key.n&&(this.executeCompose(),e.preventDefault())},this))},i.prototype.routeMessageView=function(e,t){u.setHash(g.getMailbox(e,this.oMessageList.oPageSwitcher.currentPage(),t))},i.prototype.dragAndDropHelper=function(e,t){e&&e.checked(!0);var s=h.draggableItems(),i=this.oMessageList.checkedOrSelectedUids(),o=i.length;return s.data("p7-message-list-folder",this.folderList().currentFolderFullName()),s.data("p7-message-list-uids",i),n(".count-text",s).text(a.i18n("MAILWEBCLIENT/LABEL_DRAG_MESSAGES_PLURAL",{COUNT:t?"+ "+o:o},null,o)),s},i.prototype.messagesDrop=function(e,t,s){if(e){var i=s&&s.helper?s.helper:null,o=i?i.data("p7-message-list-folder"):"",n=i?i.data("p7-message-list-uids"):null;""!==o&&null!==n&&(h.uiDropHelperAnim(t,s),t.ctrlKey?this.oMessageList.executeCopyToFolder(e.fullName()):this.oMessageList.executeMoveToFolder(e.fullName()),this.uncheckMessages())}},i.prototype.searchFocus=function(){this.oMessageList.selector.useKeyboardKeys()&&!h.isTextFieldFocused()&&this.oMessageList.isFocused(!0)},i.prototype.onVolumerClick=function(e,t){t.stopPropagation()},i.prototype.uncheckMessages=function(){o.each(b.messages(),function(e){e.checked(!1)})},e.exports=i},376:function(e,t,s){"use strict";function i(){this.folderList=p.folderList,this.manageFoldersHash=o.computed(function(){if(r.isModuleEnabled("SettingsWebclient")){var e=d.getCurrent();if(e)return a.buildHashFromArray(["settings","mail-accounts","account",e.hash(),"folders"])}return"#"},this),this.quotaProc=o.observable(-1),this.quotaDesc=o.observable(""),h.ShowQuotaBar&&o.computed(function(){p.quotaChangeTrigger();var e=d.getCurrent(),t=e?e.quota():0,s=e?e.usedSpace():0,i=0<t?Math.ceil(s/t*100):-1;return i=100<i?100:i,this.quotaProc(i),this.quotaDesc(-1<i?n.i18n("COREWEBCLIENT/INFO_QUOTA",{PROC:i,QUOTA:n.getFriendlySize(1024*t)}):""),h.QuotaWarningPerc>0&&i!==-1&&h.QuotaWarningPerc>100-i&&l.showError(n.i18n("COREWEBCLIENT/WARNING_QUOTA_ALMOST_REACHED"),!0),!0},this),this.visibleNewFolderButton=o.computed(function(){return m.AllowAddNewFolderOnMainScreen&&this.folderList().collection().length>0},this)}var o=s(44),n=s(185),r=s(42),a=s(195),l=s(188),h=s(43),c=s(192),u=s(360),d=s(314),p=s(316),m=s(313);i.prototype.ViewTemplate="MailWebclient_FoldersView",i.prototype.addNewFolder=function(){c.showPopup(u)},e.exports=i},377:function(e,t,s){"use strict";function i(e){this.uploaderArea=r.observable(null),this.bDragActive=r.observable(!1),this.bDragActiveComp=r.computed(function(){return this.bDragActive()},this),this.openMessageInNewWindowBound=e,this.isFocused=r.observable(!1),this.messagesContainer=r.observable(null),this.searchInput=r.observable(""),this.searchInputFrom=r.observable(""),this.searchInputTo=r.observable(""),this.searchInputSubject=r.observable(""),this.searchInputText=r.observable(""),this.searchSpan=r.observable(""),this.highlightTrigger=r.observable(""),this.currentMessage=F.currentMessage,this.currentMessage.subscribe(function(){this.isFocused(!1),this.selector.itemSelected(this.currentMessage())},this),this.folderList=F.folderList,this.folderList.subscribe(this.onFolderListSubscribe,this),this.folderFullName=r.observable(""),this.folderType=r.observable(Enums.FolderTypes.User),this.filters=r.observable(""),this.uidList=F.uidList,this.uidList.subscribe(function(){this.uidList().searchCountSubscription&&(this.uidList().searchCountSubscription.dispose(),this.uidList().searchCountSubscription=void 0),this.uidList().searchCountSubscription=this.uidList().resultCount.subscribe(function(){this.uidList().resultCount()>=0&&this.oPageSwitcher.setCount(this.uidList().resultCount())},this),this.uidList().resultCount()>=0&&this.oPageSwitcher.setCount(this.uidList().resultCount())},this),this.useThreading=r.computed(function(){var e=S.getCurrent(),t=this.folderList().currentFolder(),s=t&&t.withoutThreads(),i=""===this.uidList().search()&&""===this.uidList().filters();return e&&e.threadingIsAvailable()&&!s&&i},this),this.collection=F.messages,this._search=r.observable(""),this.search=r.computed({read:function(){return n.trim(this._search())},write:this._search,owner:this}),this.isEmptyList=r.computed(function(){return 0===this.collection().length},this),this.isNotEmptyList=r.computed(function(){return 0!==this.collection().length},this),this.isSearch=r.computed(function(){return this.search().length>0},this),this.isUnseenFilter=r.computed(function(){return this.filters()===Enums.FolderFilter.Unseen},this),this.isLoading=F.messagesLoading,this.isError=F.messagesLoadingError,this.visibleInfoLoading=r.computed(function(){return!this.isSearch()&&this.isLoading()},this),this.visibleInfoSearchLoading=r.computed(function(){return this.isSearch()&&this.isLoading()},this),this.visibleInfoSearchList=r.computed(function(){return this.isSearch()&&!this.isUnseenFilter()&&!this.isLoading()&&!this.isEmptyList()},this),this.visibleInfoMessageListEmpty=r.computed(function(){return!this.isLoading()&&!this.isSearch()&&""===this.filters()&&this.isEmptyList()&&!this.isError()},this),this.visibleInfoStarredFolderEmpty=r.computed(function(){return!this.isLoading()&&!this.isSearch()&&this.filters()===Enums.FolderFilter.Flagged&&this.isEmptyList()&&!this.isError()},this),this.visibleInfoSearchEmpty=r.computed(function(){return this.isSearch()&&!this.isUnseenFilter()&&this.isEmptyList()&&!this.isError()&&!this.isLoading()},this),this.visibleInfoMessageListError=r.computed(function(){return!this.isSearch()&&this.isError()},this),this.visibleInfoSearchError=r.computed(function(){return this.isSearch()&&this.isError()},this),this.visibleInfoUnseenFilterList=r.computed(function(){return this.isUnseenFilter()&&(this.isLoading()||!this.isEmptyList())},this),this.visibleInfoUnseenFilterEmpty=r.computed(function(){return this.isUnseenFilter()&&this.isEmptyList()&&!this.isError()&&!this.isLoading()},this),this.searchText=r.computed(function(){return l.i18n("MAILWEBCLIENT/INFO_SEARCH_RESULT",{SEARCH:this.calculateSearchStringForDescription(),FOLDER:this.folderList().currentFolder()?l.encodeHtml(this.folderList().currentFolder().displayName()):""})},this),this.unseenFilterText=r.computed(function(){return""===this.search()?l.i18n("MAILWEBCLIENT/INFO_UNREAD_MESSAGES",{FOLDER:this.folderList().currentFolder()?l.encodeHtml(this.folderList().currentFolder().displayName()):""}):l.i18n("MAILWEBCLIENT/INFO_UNREAD_MESSAGES_SEARCH_RESULT",{SEARCH:this.calculateSearchStringForDescription(),FOLDER:this.folderList().currentFolder()?l.encodeHtml(this.folderList().currentFolder().displayName()):""})},this),this.unseenFilterEmptyText=r.computed(function(){return""===this.search()?l.i18n("MAILWEBCLIENT/INFO_NO_UNREAD_MESSAGES"):l.i18n("MAILWEBCLIENT/INFO_NO_UNREAD_MESSAGES_FOUND")},this),this.isEnableGroupOperations=r.observable(!1).extend({throttle:250}),this.selector=new m(this.collection,o.bind(this.routeForMessage,this),o.bind(this.onDeletePress,this),o.bind(this.onMessageDblClick,this),o.bind(this.onEnterPress,this),null,!1,!1,!1,!1,!1),this.checkedUids=r.computed(function(){var e=this.selector.listChecked(),t=o.map(e,function(e){return e.uid()}),s=F.folderList().currentFolder(),i=s?s.getThreadCheckedUidsFromList(e):[],n=o.union(t,i);return n},this),this.checkedOrSelectedUids=r.computed(function(){var e=this.checkedUids();return 0===e.length&&F.currentMessage()&&!F.currentMessage().deleted()&&(e=[F.currentMessage().uid()]),e},this),r.computed(function(){this.isEnableGroupOperations(0<this.selector.listCheckedOrSelected().length)},this),this.checkAll=this.selector.koCheckAll(),this.checkAllIncomplite=this.selector.koCheckAllIncomplete(),this.pageSwitcherLocked=r.observable(!1),this.oPageSwitcher=new v(0,C.MailsPerPage),this.oPageSwitcher.currentPage.subscribe(function(e){var t=this.folderList().currentFolderFullName(),s=!u.isMobile()&&this.currentMessage()?this.currentMessage().uid():"",i=this.search();this.pageSwitcherLocked()||this.changeRoutingForMessageList(t,e,s,i,this.filters())},this),this.currentPage=r.observable(0),d.firefox||d.ie?this.listChangedThrottle=r.observable(!1).extend({throttle:10}):this.listChangedThrottle=r.observable(!1),this.firstCompleteCollection=r.observable(!0),this.collection.subscribe(function(){this.collection().length>0&&(h.isNonEmptyArray(this.aRouteParams)?(this.onRoute(this.aRouteParams),this.aRouteParams=[]):this.firstCompleteCollection(!1))},this),this.listChanged=r.computed(function(){return[this.firstCompleteCollection(),F.currentAccountId(),this.folderFullName(),this.filters(),this.search(),this.oPageSwitcher.currentPage()]},this),this.listChanged.subscribe(function(){this.listChangedThrottle(!this.listChangedThrottle())},this),this.bAdvancedSearch=r.observable(!1),this.searchAttachmentsCheckbox=r.observable(!1),this.searchAttachments=r.observable(""),this.searchAttachments.subscribe(function(e){this.searchAttachmentsCheckbox(!!e)},this),this.searchAttachmentsFocus=r.observable(!1),this.searchFromFocus=r.observable(!1),this.searchSubjectFocus=r.observable(!1),this.searchToFocus=r.observable(!1),this.searchTextFocus=r.observable(!1),this.searchTrigger=r.observable(null),this.searchDateStartFocus=r.observable(!1),this.searchDateEndFocus=r.observable(!1),this.searchDateStartDom=r.observable(null),this.searchDateStart=r.observable(""),this.searchDateEndDom=r.observable(null),this.searchDateEnd=r.observable(""),this.dateFormatDatePicker="yy.mm.dd",this.attachmentsPlaceholder=r.computed(function(){return l.i18n("MAILWEBCLIENT/LABEL_HAS_ATTACHMENTS")},this),o.delay(o.bind(function(){this.createDatePickerObject(this.searchDateStartDom(),this.searchDateStart),this.createDatePickerObject(this.searchDateEndDom(),this.searchDateEnd)},this),1e3),this.customMessageItemViewTemplate=r.observable(""),u.broadcastEvent("MailWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this,MailCache:F})}var o=s(2),n=s(1),r=s(44),a=s(264),l=s(185),h=s(181),c=s(186),u=s(182),d=s(180),p=s(278),m=s(280),g=s(42),f=s(195),b=s(188),v=s(246),y=s(330),A=s(318),E=s(338),S=s(314),F=s(316),C=s(313);s(378),i.prototype.ViewTemplate="MailWebclient_MessagesView",i.prototype.ViewConstructorName="CMessageListView",i.prototype.addNewAccount=function(){u.Api.createMailAccount(S.getEmail())},i.prototype.createDatePickerObject=function(e,t){n(e).datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:a.getMonthNamesArray(),dayNamesMin:l.i18n("COREWEBCLIENT/LIST_DAY_NAMES_MIN").split(" "),nextText:"",prevText:"",firstDay:h.pInt(g.run("CalendarWebclient","getWeekStartsOn")),showOn:"focus",dateFormat:this.dateFormatDatePicker,onClose:function(e){r.isObservable(t)&&t(e)}}),n(e).mousedown(function(){n("#ui-datepicker-div").toggle()})},i.prototype.changeRoutingForMessageList=function(e,t,s,i,o){var n=f.setHash(A.getMailbox(e,t,s,i,o));n&&i.length>0&&this.search()===i&&this.listChangedThrottle(!this.listChangedThrottle())},i.prototype.onEnterPress=function(e){e.openThread()},i.prototype.onMessageDblClick=function(e){if(!this.isSavingDraft(e)){var t=this.folderList().getFolderByFullName(e.folder()),s=-1!==n.inArray(e.folder(),F.getCurrentTemplateFolders()),i={Message:e,Cancel:!1};u.broadcastEvent("MailWebclient::MessageDblClick::before",i),i.Cancel||(t.type()===Enums.FolderTypes.Drafts||s?y.composeMessageFromDrafts(e.folder(),e.uid()):this.openMessageInNewWindowBound(e))}},i.prototype.onFolderListSubscribe=function(){this.setCurrentFolder(),this.requestMessageList()},i.prototype.onShow=function(e){this.selector.useKeyboardKeys(!0),this.oPageSwitcher.show(),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)},i.prototype.onHide=function(e){this.selector.useKeyboardKeys(!1),this.oPageSwitcher.hide(),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},i.prototype.onRoute=function(e){var t=this.folderList().inboxFolder(),s=t?t.fullName():"",i=A.parseMailbox(e,s),o=""===this.folderFullName()?s:this.folderFullName(),n=this.currentPage()!==i.Page||o!==i.Folder||this.filters()!==i.Filters||i.Filters===Enums.FolderFilter.Unseen&&F.waitForUnseenMessages()||this.search()!==i.Search,r=C.MailsPerPage!==this.oPageSwitcher.perPage();this.pageSwitcherLocked(!0),o!==i.Folder||this.search()!==i.Search||this.filters()!==i.Filters?this.oPageSwitcher.clear():this.oPageSwitcher.setPage(i.Page,C.MailsPerPage),this.pageSwitcherLocked(!1),i.Page!==this.oPageSwitcher.currentPage()&&(0===this.folderList().iAccountId?this.aRouteParams=e:f.replaceHash(A.getMailbox(i.Folder,this.oPageSwitcher.currentPage(),i.Uid,i.Search,i.Filters))),this.currentPage(this.oPageSwitcher.currentPage()),this.folderFullName(i.Folder),this.filters(i.Filters),this.search(i.Search),this.searchInput(this.search()),this.searchSpan.notifySubscribers(),this.setCurrentFolder(),(n||r||0===this.collection().length)&&(i.Filters===Enums.FolderFilter.Unseen&&F.waitForUnseenMessages(!0),this.requestMessageList()),this.highlightTrigger.notifySubscribers(!0)},i.prototype.setCurrentFolder=function(){this.folderList().setCurrentFolder(this.folderFullName(),this.filters()),this.folderType(F.folderList().currentFolderType())},i.prototype.requestMessageList=function(){var e=this.folderList().currentFolderFullName(),t=this.oPageSwitcher.currentPage();e.length>0?F.changeCurrentMessageList(e,t,this.search(),this.filters()):F.checkCurrentFolderList()},i.prototype.calculateSearchStringFromAdvancedForm=function(){
var e=this.searchInputFrom(),t=this.searchInputTo(),s=this.searchInputSubject(),i=this.searchInputText(),o=this.searchAttachmentsCheckbox(),r=this.searchDateStart(),a=this.searchDateEnd(),l=[],h=function(e){return e=n.trim(e).replace(/"/g,'\\"'),(-1<e.indexOf(" ")||-1<e.indexOf('"'))&&(e='"'+e+'"'),e};return""!==e&&l.push("from:"+h(e)),""!==t&&l.push("to:"+h(t)),""!==s&&l.push("subject:"+h(s)),""!==i&&l.push("text:"+h(i)),o&&l.push("has:attachments"),""===r&&""===a||l.push("date:"+h(r)+"/"+h(a)),l.join(" ")},i.prototype.onSearchClick=function(){var e=this.folderList().currentFolderFullName(),t=1,s=this.searchInput();this.bAdvancedSearch()&&(s=this.calculateSearchStringFromAdvancedForm(),this.searchInput(s),this.bAdvancedSearch(!1)),this.changeRoutingForMessageList(e,t,"",s,this.filters())},i.prototype.onRetryClick=function(){this.requestMessageList()},i.prototype.onClearSearchClick=function(){var e=this.folderList().currentFolderFullName(),t=this.currentMessage()?this.currentMessage().uid():"",s="",i=1;this.clearAdvancedSearch(),this.changeRoutingForMessageList(e,i,t,s,this.filters())},i.prototype.onClearFilterClick=function(){var e=this.folderList().currentFolderFullName(),t=this.currentMessage()?this.currentMessage().uid():"",s="",i=1,o="";this.clearAdvancedSearch(),this.changeRoutingForMessageList(e,i,t,s,o)},i.prototype.onStopSearchClick=function(){this.onClearSearchClick()},i.prototype.isSavingDraft=function(e){var t=this.folderList().currentFolder();return t.type()===Enums.FolderTypes.Drafts&&e.uid()===F.savingDraftUid()},i.prototype.routeForMessage=function(e){if(null!==e&&!this.isSavingDraft(e)){var t=this.folderList().currentFolder(),s=this.folderList().currentFolderFullName(),i=this.oPageSwitcher.currentPage(),o=e.uid(),n=this.search();""!==o&&(u.isMobile()&&t.type()===Enums.FolderTypes.Drafts?f.setHash(A.getComposeFromMessage("drafts",e.folder(),e.uid())):(this.changeRoutingForMessageList(s,i,o,n,this.filters()),u.isMobile()&&F.currentMessage()&&o===F.currentMessage().uid()&&F.currentMessage.valueHasMutated()))}},i.prototype.onBind=function(e){var t=this,s=o.bind(function(e){e&&e.stopPropagation&&e.stopPropagation()},this);n(".message_list",e).on("click",function(){t.isFocused(!1)}).on("click",".message_sub_list .item .flag",function(e){t.onFlagClick(r.dataFor(this)),e&&e.stopPropagation&&e.stopPropagation()}).on("dblclick",".message_sub_list .item .flag",s).on("click",".message_sub_list .item .thread-pin",s).on("dblclick",".message_sub_list .item .thread-pin",s),this.selector.initOnApplyBindings(".message_sub_list .item",".message_sub_list .item.selected",".message_sub_list .item .custom_checkbox",n(".message_list",e),n(".message_list_scroll.scroll-inner",e)),this.initUploader()},i.prototype.onFlagClick=function(e){this.isSavingDraft(e)||F.executeGroupOperation("SetMessageFlagged",[e.uid()],"flagged",!e.flagged())},i.prototype.executeMarkAsRead=function(){F.executeGroupOperation("SetMessagesSeen",this.checkedOrSelectedUids(),"seen",!0)},i.prototype.executeMarkAsUnread=function(){F.executeGroupOperation("SetMessagesSeen",this.checkedOrSelectedUids(),"seen",!1)},i.prototype.executeMarkAllRead=function(){F.executeGroupOperation("SetAllMessagesSeen",[],"seen",!0)},i.prototype.executeMoveToFolder=function(e){F.moveMessagesToFolder(e,this.checkedOrSelectedUids())},i.prototype.executeCopyToFolder=function(e){F.copyMessagesToFolder(e,this.checkedOrSelectedUids())},i.prototype.onDeletePress=function(e){var t=o.map(e,function(e){return e.uid()});t.length>0&&E.deleteMessages(t)},i.prototype.executeDelete=function(){E.deleteMessages(this.checkedOrSelectedUids())},i.prototype.executeSpam=function(){var e=this.folderList().spamFolderFullName();this.folderList().currentFolderFullName()!==e&&F.moveMessagesToFolder(e,this.checkedOrSelectedUids())},i.prototype.executeNotSpam=function(){var e=this.folderList().inboxFolder();e&&this.folderList().currentFolderFullName()!==e.fullName()&&F.moveMessagesToFolder(e.fullName(),this.checkedOrSelectedUids())},i.prototype.clearAdvancedSearch=function(){this.searchInputFrom(""),this.searchInputTo(""),this.searchInputSubject(""),this.searchInputText(""),this.bAdvancedSearch(!1),this.searchAttachmentsCheckbox(!1),this.searchAttachments(""),this.searchDateStart(""),this.searchDateEnd("")},i.prototype.onAdvancedSearchClick=function(){this.bAdvancedSearch(!this.bAdvancedSearch())},i.prototype.calculateSearchStringForDescription=function(){return'<span class="part">'+l.encodeHtml(this.search())+"</span>"},i.prototype.initUploader=function(){var e=this;this.uploaderArea()&&(this.oJua=new p({action:"?/Api/",name:"jua-uploader",queueSize:2,dragAndDropElement:this.uploaderArea(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:o.extendOwn({Module:C.ServerModuleName,Method:"UploadMessage",Parameters:function(){return JSON.stringify({AccountID:F.currentAccountId(),Folder:e.folderFullName()})}},u.getCommonRequestParameters())}),this.oJua.on("onDrop",o.bind(this.onFileDrop,this)).on("onComplete",o.bind(this.onFileUploadComplete,this)).on("onBodyDragEnter",o.bind(this.bDragActive,this,!0)).on("onBodyDragLeave",o.bind(this.bDragActive,this,!1)))},i.prototype.onFileDrop=function(e){e&&e.File&&e.File.type&&0===e.File.type.indexOf("message/")||b.showError(l.i18n("MAILWEBCLIENT/ERROR_FILE_NOT_EML"))},i.prototype.onFileUploadComplete=function(e,t,s){var i=t&&s&&!s.ErrorCode;i?F.executeCheckMail(!0):c.showErrorByCode(s||{},l.i18n("COREWEBCLIENT/ERROR_UPLOAD_FILE"))},e.exports=i},378:function(e,t,s){var i,o,n;/*!
	 * jQuery UI Datepicker 1.12.1
	 * http://jqueryui.com
	 *
	 * Copyright jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 */
!function(r){o=[s(1),s(209),s(208)],i=r,n="function"==typeof i?i.apply(t,o):i,!(void 0!==n&&(e.exports=n))}(function(e){function t(e){for(var t,s;e.length&&e[0]!==document;){if(t=e.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(s=parseInt(e.css("zIndex"),10),!isNaN(s)&&0!==s))return s;e=e.parent()}return 0}function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=i(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function i(t){var s="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.on("mouseout",s,function(){e(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&e(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&e(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",s,o)}function o(){e.datepicker._isDisabledDatepicker(r.inline?r.dpDiv.parent()[0]:r.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&e(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&e(this).addClass("ui-datepicker-next-hover"))}function n(t,s){e.extend(t,s);for(var i in s)null==s[i]&&(t[i]=s[i]);return t}e.extend(e.ui,{datepicker:{version:"1.12.1"}});var r;return e.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return n(this._defaults,e||{}),this},_attachDatepicker:function(t,s){var i,o,n;i=t.nodeName.toLowerCase(),o="div"===i||"span"===i,t.id||(this.uuid+=1,t.id="dp"+this.uuid),n=this._newInst(e(t),o),n.settings=e.extend({},s||{}),"input"===i?this._connectDatepicker(t,n):o&&this._inlineDatepicker(t,n)},_newInst:function(t,s){var o=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:o,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:s,dpDiv:s?i(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,s){var i=e(t);s.append=e([]),s.trigger=e([]),i.hasClass(this.markerClassName)||(this._attachments(i,s),i.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(s),e.data(t,"datepicker",s),s.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,s){var i,o,n,r=this._get(s,"appendText"),a=this._get(s,"isRTL");s.append&&s.append.remove(),r&&(s.append=e("<span class='"+this._appendClass+"'>"+r+"</span>"),t[a?"before":"after"](s.append)),t.off("focus",this._showDatepicker),s.trigger&&s.trigger.remove(),i=this._get(s,"showOn"),"focus"!==i&&"both"!==i||t.on("focus",this._showDatepicker),"button"!==i&&"both"!==i||(o=this._get(s,"buttonText"),n=this._get(s,"buttonImage"),s.trigger=e(this._get(s,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:n,alt:o,title:o}):e("<button type='button'></button>").addClass(this._triggerClass).html(n?e("<img/>").attr({src:n,alt:o,title:o}):o)),t[a?"before":"after"](s.trigger),s.trigger.on("click",function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,s,i,o,n=new Date(2009,11,20),r=this._get(e,"dateFormat");r.match(/[DM]/)&&(t=function(e){for(s=0,i=0,o=0;o<e.length;o++)e[o].length>s&&(s=e[o].length,i=o);return i},n.setMonth(t(this._get(e,r.match(/MM/)?"monthNames":"monthNamesShort"))),n.setDate(t(this._get(e,r.match(/DD/)?"dayNames":"dayNamesShort"))+20-n.getDay())),e.input.attr("size",this._formatDate(e,n).length)}},_inlineDatepicker:function(t,s){var i=e(t);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(s.dpDiv),e.data(t,"datepicker",s),this._setDate(s,this._getDefaultDate(s),!0),this._updateDatepicker(s),this._updateAlternate(s),s.settings.disabled&&this._disableDatepicker(t),s.dpDiv.css("display","block"))},_dialogDatepicker:function(t,s,i,o,r){var a,l,h,c,u,d=this._dialogInst;return d||(this.uuid+=1,a="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+a+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),e("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},e.data(this._dialogInput[0],"datepicker",d)),n(d.settings,o||{}),s=s&&s.constructor===Date?this._formatDate(d,s):s,this._dialogInput.val(s),this._pos=r?r.length?r:[r.pageX,r.pageY]:null,this._pos||(l=document.documentElement.clientWidth,h=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+c,h/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(t){var s,i=e(t),o=e.data(t,"datepicker");i.hasClass(this.markerClassName)&&(s=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===s?(o.append.remove(),o.trigger.remove(),i.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):"div"!==s&&"span"!==s||i.removeClass(this.markerClassName).empty(),r===o&&(r=null))},_enableDatepicker:function(t){var s,i,o=e(t),n=e.data(t,"datepicker");o.hasClass(this.markerClassName)&&(s=t.nodeName.toLowerCase(),"input"===s?(t.disabled=!1,n.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==s&&"span"!==s||(i=o.children("."+this._inlineClass),i.children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var s,i,o=e(t),n=e.data(t,"datepicker");o.hasClass(this.markerClassName)&&(s=t.nodeName.toLowerCase(),"input"===s?(t.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==s&&"span"!==s||(i=o.children("."+this._inlineClass),i.children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,s,i){var o,r,a,l,h=this._getInst(t);return 2===arguments.length&&"string"==typeof s?"defaults"===s?e.extend({},e.datepicker._defaults):h?"all"===s?e.extend({},h.settings):this._get(h,s):null:(o=s||{},"string"==typeof s&&(o={},o[s]=i),void(h&&(this._curInst===h&&this._hideDatepicker(),r=this._getDateDatepicker(t,!0),a=this._getMinMaxDate(h,"min"),l=this._getMinMaxDate(h,"max"),n(h.settings,o),null!==a&&void 0!==o.dateFormat&&void 0===o.minDate&&(h.settings.minDate=this._formatDate(h,a)),null!==l&&void 0!==o.dateFormat&&void 0===o.maxDate&&(h.settings.maxDate=this._formatDate(h,l)),"disabled"in o&&(o.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),h),this._autoSize(h),this._setDate(h,r),this._updateAlternate(h),this._updateDatepicker(h))))},_changeDatepicker:function(e,t,s){this._optionDatepicker(e,t,s)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var s=this._getInst(e);s&&(this._setDate(s,t),this._updateDatepicker(s),this._updateAlternate(s))},_getDateDatepicker:function(e,t){var s=this._getInst(e);return s&&!s.inline&&this._setDateFromField(s,t),s?this._getDate(s):null},_doKeyDown:function(t){var s,i,o,n=e.datepicker._getInst(t.target),r=!0,a=n.dpDiv.is(".ui-datepicker-rtl");if(n._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),r=!1;break;case 13:return o=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",n.dpDiv),o[0]&&e.datepicker._selectDay(t.target,n.selectedMonth,n.selectedYear,o[0]),s=e.datepicker._get(n,"onSelect"),s?(i=e.datepicker._formatDate(n),s.apply(n.input?n.input[0]:null,[i,n])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(n,"stepBigMonths"):-e.datepicker._get(n,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(n,"stepBigMonths"):+e.datepicker._get(n,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),r=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),r=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?1:-1,"D"),r=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(n,"stepBigMonths"):-e.datepicker._get(n,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),r=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?-1:1,"D"),r=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(n,"stepBigMonths"):+e.datepicker._get(n,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),r=t.ctrlKey||t.metaKey;break;default:r=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):r=!1;r&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var s,i,o=e.datepicker._getInst(t.target);if(e.datepicker._get(o,"constrainInput"))return s=e.datepicker._possibleChars(e.datepicker._get(o,"dateFormat")),i=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||i<" "||!s||s.indexOf(i)>-1},_doKeyUp:function(t){var s,i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{s=e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i)),s&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(e){}return!0},_showDatepicker:function(s){if(s=s.target||s,"input"!==s.nodeName.toLowerCase()&&(s=e("input",s.parentNode)[0]),!e.datepicker._isDisabledDatepicker(s)&&e.datepicker._lastInput!==s){var i,o,r,a,l,h,c;i=e.datepicker._getInst(s),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),o=e.datepicker._get(i,"beforeShow"),r=o?o.apply(s,[s,i]):{},r!==!1&&(n(i.settings,r),i.lastVal=null,e.datepicker._lastInput=s,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(s.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(s),e.datepicker._pos[1]+=s.offsetHeight),a=!1,e(s).parents().each(function(){return a|="fixed"===e(this).css("position"),!a}),l={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),l=e.datepicker._checkOffset(i,l,a),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":a?"fixed":"absolute",display:"none",left:l.left+"px",top:l.top+"px"}),i.inline||(h=e.datepicker._get(i,"showAnim"),c=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",t(e(s))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[h]?i.dpDiv.show(h,e.datepicker._get(i,"showOptions"),c):i.dpDiv[h||"show"](h?c:null),e.datepicker._shouldFocusInput(i)&&i.input.trigger("focus"),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,r=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var s,i=this._getNumberOfMonths(t),n=i[1],a=17,l=t.dpDiv.find("."+this._dayOverClass+" a");l.length>0&&o.apply(l.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),t.dpDiv[(1!==i[0]||1!==i[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.trigger("focus"),t.yearshtml&&(s=t.yearshtml,setTimeout(function(){s===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),s=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,s,i){var o=t.dpDiv.outerWidth(),n=t.dpDiv.outerHeight(),r=t.input?t.input.outerWidth():0,a=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(i?0:e(document).scrollLeft()),h=document.documentElement.clientHeight+(i?0:e(document).scrollTop());return s.left-=this._get(t,"isRTL")?o-r:0,s.left-=i&&s.left===t.input.offset().left?e(document).scrollLeft():0,s.top-=i&&s.top===t.input.offset().top+a?e(document).scrollTop():0,s.left-=Math.min(s.left,s.left+o>l&&l>o?Math.abs(s.left+o-l):0),s.top-=Math.min(s.top,s.top+n>h&&h>n?Math.abs(n+a):0),s},_findPos:function(t){for(var s,i=this._getInst(t),o=this._get(i,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[o?"previousSibling":"nextSibling"];return s=e(t).offset(),[s.left,s.top]},_hideDatepicker:function(t){var s,i,o,n,r=this._curInst;!r||t&&r!==e.data(t,"datepicker")||this._datepickerShowing&&(s=this._get(r,"showAnim"),i=this._get(r,"duration"),o=function(){e.datepicker._tidyDialog(r)},e.effects&&(e.effects.effect[s]||e.effects[s])?r.dpDiv.hide(s,e.datepicker._get(r,"showOptions"),i,o):r.dpDiv["slideDown"===s?"slideUp":"fadeIn"===s?"fadeOut":"hide"](s?i:null,o),s||o(),this._datepickerShowing=!1,n=this._get(r,"onClose"),n&&n.apply(r.input?r.input[0]:null,[r.input?r.input.val():"",r]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var s=e(t.target),i=e.datepicker._getInst(s[0]);(s[0].id===e.datepicker._mainDivId||0!==s.parents("#"+e.datepicker._mainDivId).length||s.hasClass(e.datepicker.markerClassName)||s.closest("."+e.datepicker._triggerClass).length||!e.datepicker._datepickerShowing||e.datepicker._inDialog&&e.blockUI)&&(!s.hasClass(e.datepicker.markerClassName)||e.datepicker._curInst===i)||e.datepicker._hideDatepicker()}},_adjustDate:function(t,s,i){var o=e(t),n=this._getInst(o[0]);this._isDisabledDatepicker(o[0])||(this._adjustInstDate(n,s+("M"===i?this._get(n,"showCurrentAtPos"):0),i),this._updateDatepicker(n))},_gotoToday:function(t){var s,i=e(t),o=this._getInst(i[0]);this._get(o,"gotoCurrent")&&o.currentDay?(o.selectedDay=o.currentDay,o.drawMonth=o.selectedMonth=o.currentMonth,o.drawYear=o.selectedYear=o.currentYear):(s=new Date,o.selectedDay=s.getDate(),o.drawMonth=o.selectedMonth=s.getMonth(),o.drawYear=o.selectedYear=s.getFullYear()),this._notifyChange(o),this._adjustDate(i)},_selectMonthYear:function(t,s,i){var o=e(t),n=this._getInst(o[0]);n["selected"+("M"===i?"Month":"Year")]=n["draw"+("M"===i?"Month":"Year")]=parseInt(s.options[s.selectedIndex].value,10),this._notifyChange(n),this._adjustDate(o)},_selectDay:function(t,s,i,o){var n,r=e(t);e(o).hasClass(this._unselectableClass)||this._isDisabledDatepicker(r[0])||(n=this._getInst(r[0]),n.selectedDay=n.currentDay=e("a",o).html(),n.selectedMonth=n.currentMonth=s,n.selectedYear=n.currentYear=i,this._selectDate(t,this._formatDate(n,n.currentDay,n.currentMonth,n.currentYear)))},_clearDate:function(t){var s=e(t);this._selectDate(s,"")},_selectDate:function(t,s){var i,o=e(t),n=this._getInst(o[0]);s=null!=s?s:this._formatDate(n),n.input&&n.input.val(s),this._updateAlternate(n),i=this._get(n,"onSelect"),i?i.apply(n.input?n.input[0]:null,[s,n]):n.input&&n.input.trigger("change"),n.inline?this._updateDatepicker(n):(this._hideDatepicker(),this._lastInput=n.input[0],"object"!=typeof n.input[0]&&n.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(t){var s,i,o,n=this._get(t,"altField");n&&(s=this._get(t,"altFormat")||this._get(t,"dateFormat"),i=this._getDate(t),o=this.formatDate(s,i,this._getFormatConfig(t)),e(n).val(o))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,s=new Date(e.getTime());return s.setDate(s.getDate()+4-(s.getDay()||7)),t=s.getTime(),s.setMonth(0),s.setDate(1),Math.floor(Math.round((t-s)/864e5)/7)+1},parseDate:function(t,s,i){if(null==t||null==s)throw"Invalid arguments";if(s="object"==typeof s?""+s:s+"",""===s)return null;var o,n,r,a,l=0,h=(i?i.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),u=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,d=(i?i.dayNames:null)||this._defaults.dayNames,p=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,m=(i?i.monthNames:null)||this._defaults.monthNames,g=-1,f=-1,b=-1,v=-1,y=!1,A=function(e){var s=o+1<t.length&&t.charAt(o+1)===e;return s&&o++,s},E=function(e){var t=A(e),i="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,o="y"===e?i:1,n=RegExp("^\\d{"+o+","+i+"}"),r=s.substring(l).match(n);if(!r)throw"Missing number at position "+l;return l+=r[0].length,parseInt(r[0],10)},S=function(t,i,o){var n=-1,r=e.map(A(t)?o:i,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(r,function(e,t){var i=t[1];if(s.substr(l,i.length).toLowerCase()===i.toLowerCase())return n=t[0],l+=i.length,!1}),n!==-1)return n+1;throw"Unknown name at position "+l},F=function(){if(s.charAt(l)!==t.charAt(o))throw"Unexpected literal at position "+l;l++};for(o=0;o<t.length;o++)if(y)"'"!==t.charAt(o)||A("'")?F():y=!1;else switch(t.charAt(o)){case"d":b=E("d");break;case"D":S("D",u,d);break;case"o":v=E("o");break;case"m":f=E("m");break;case"M":f=S("M",p,m);break;case"y":g=E("y");break;case"@":a=new Date(E("@")),g=a.getFullYear(),f=a.getMonth()+1,b=a.getDate();break;case"!":a=new Date((E("!")-this._ticksTo1970)/1e4),g=a.getFullYear(),f=a.getMonth()+1,b=a.getDate();break;case"'":A("'")?F():y=!0;break;default:F()}if(l<s.length&&(r=s.substr(l),!/^\s+/.test(r)))throw"Extra/unparsed characters found in date: "+r;if(g===-1?g=(new Date).getFullYear():g<100&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(g<=c?0:-100)),v>-1)for(f=1,b=v;;){if(n=this._getDaysInMonth(g,f-1),b<=n)break;f++,b-=n}if(a=this._daylightSavingAdjust(new Date(g,f-1,b)),a.getFullYear()!==g||a.getMonth()+1!==f||a.getDate()!==b)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,s){if(!t)return"";var i,o=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,n=(s?s.dayNames:null)||this._defaults.dayNames,r=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,a=(s?s.monthNames:null)||this._defaults.monthNames,l=function(t){var s=i+1<e.length&&e.charAt(i+1)===t;return s&&i++,s},h=function(e,t,s){var i=""+t;if(l(e))for(;i.length<s;)i="0"+i;return i},c=function(e,t,s,i){return l(e)?i[t]:s[t]},u="",d=!1;if(t)for(i=0;i<e.length;i++)if(d)"'"!==e.charAt(i)||l("'")?u+=e.charAt(i):d=!1;else switch(e.charAt(i)){case"d":u+=h("d",t.getDate(),2);break;case"D":u+=c("D",t.getDay(),o,n);break;case"o":u+=h("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=h("m",t.getMonth()+1,2);break;case"M":u+=c("M",t.getMonth(),r,a);break;case"y":u+=l("y")?t.getFullYear():(t.getFullYear()%100<10?"0":"")+t.getFullYear()%100;break;case"@":u+=t.getTime();break;case"!":u+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?u+="'":d=!0;break;default:u+=e.charAt(i)}return u},_possibleChars:function(e){var t,s="",i=!1,o=function(s){var i=t+1<e.length&&e.charAt(t+1)===s;return i&&t++,i};for(t=0;t<e.length;t++)if(i)"'"!==e.charAt(t)||o("'")?s+=e.charAt(t):i=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":s+="0123456789";break;case"D":case"M":return null;case"'":o("'")?s+="'":i=!0;break;default:s+=e.charAt(t)}return s},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var s=this._get(e,"dateFormat"),i=e.lastVal=e.input?e.input.val():null,o=this._getDefaultDate(e),n=o,r=this._getFormatConfig(e);try{n=this.parseDate(s,i,r)||o}catch(e){i=t?"":i}e.selectedDay=n.getDate(),e.drawMonth=e.selectedMonth=n.getMonth(),e.drawYear=e.selectedYear=n.getFullYear(),e.currentDay=i?n.getDate():0,e.currentMonth=i?n.getMonth():0,e.currentYear=i?n.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,s,i){var o=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},n=function(s){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),s,e.datepicker._getFormatConfig(t))}catch(e){}for(var i=(s.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,o=i.getFullYear(),n=i.getMonth(),r=i.getDate(),a=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=a.exec(s);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":n+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(o,n));break;case"y":case"Y":o+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(o,n))}l=a.exec(s)}return new Date(o,n,r)},r=null==s||""===s?i:"string"==typeof s?n(s):"number"==typeof s?isNaN(s)?i:o(s):new Date(s.getTime());return r=r&&""+r=="Invalid Date"?i:r,r&&(r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0)),this._daylightSavingAdjust(r)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,s){var i=!t,o=e.selectedMonth,n=e.selectedYear,r=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=r.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=r.getMonth(),e.drawYear=e.selectedYear=e.currentYear=r.getFullYear(),o===e.selectedMonth&&n===e.selectedYear||s||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(i?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var s=this._get(t,"stepMonths"),i="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(i,-s,"M")},next:function(){e.datepicker._adjustDate(i,+s,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(i)},selectDay:function(){return e.datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(i,this,"Y"),!1}};e(this).on(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,s,i,o,n,r,a,l,h,c,u,d,p,m,g,f,b,v,y,A,E,S,F,C,I,w,M,T,L,D,N,R,P,_,x,k,O,U,B,H=new Date,W=this._daylightSavingAdjust(new Date(H.getFullYear(),H.getMonth(),H.getDate())),V=this._get(e,"isRTL"),K=this._get(e,"showButtonPanel"),j=this._get(e,"hideIfNoPrevNext"),z=this._get(e,"navigationAsDateFormat"),q=this._getNumberOfMonths(e),G=this._get(e,"showCurrentAtPos"),Y=this._get(e,"stepMonths"),$=1!==q[0]||1!==q[1],Q=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(e,"min"),X=this._getMinMaxDate(e,"max"),Z=e.drawMonth-G,ee=e.drawYear;if(Z<0&&(Z+=12,ee--),X)for(t=this._daylightSavingAdjust(new Date(X.getFullYear(),X.getMonth()-q[0]*q[1]+1,X.getDate())),t=J&&t<J?J:t;this._daylightSavingAdjust(new Date(ee,Z,1))>t;)Z--,Z<0&&(Z=11,ee--);for(e.drawMonth=Z,e.drawYear=ee,s=this._get(e,"prevText"),s=z?this.formatDate(s,this._daylightSavingAdjust(new Date(ee,Z-Y,1)),this._getFormatConfig(e)):s,i=this._canAdjustMonth(e,-1,ee,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+s+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"e":"w")+"'>"+s+"</span></a>":j?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+s+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"e":"w")+"'>"+s+"</span></a>",o=this._get(e,"nextText"),o=z?this.formatDate(o,this._daylightSavingAdjust(new Date(ee,Z+Y,1)),this._getFormatConfig(e)):o,n=this._canAdjustMonth(e,1,ee,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+o+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"w":"e")+"'>"+o+"</span></a>":j?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+o+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"w":"e")+"'>"+o+"</span></a>",r=this._get(e,"currentText"),a=this._get(e,"gotoCurrent")&&e.currentDay?Q:W,r=z?this.formatDate(r,a,this._getFormatConfig(e)):r,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",h=K?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(V?l:"")+(this._isInRange(e,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+r+"</button>":"")+(V?"":l)+"</div>":"",c=parseInt(this._get(e,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(e,"showWeek"),d=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),m=this._get(e,"monthNames"),g=this._get(e,"monthNamesShort"),f=this._get(e,"beforeShowDay"),b=this._get(e,"showOtherMonths"),v=this._get(e,"selectOtherMonths"),y=this._getDefaultDate(e),A="",S=0;S<q[0];S++){for(F="",this.maxRows=4,C=0;C<q[1];C++){if(I=this._daylightSavingAdjust(new Date(ee,Z,e.selectedDay)),w=" ui-corner-all",M="",$){if(M+="<div class='ui-datepicker-group",q[1]>1)switch(C){case 0:M+=" ui-datepicker-group-first",w=" ui-corner-"+(V?"right":"left");break;case q[1]-1:M+=" ui-datepicker-group-last",w=" ui-corner-"+(V?"left":"right");break;default:M+=" ui-datepicker-group-middle",w=""}M+="'>"}for(M+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+w+"'>"+(/all|left/.test(w)&&0===S?V?n:i:"")+(/all|right/.test(w)&&0===S?V?i:n:"")+this._generateMonthYearHeader(e,Z,ee,J,X,S>0||C>0,m,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",T=u?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",E=0;E<7;E++)L=(E+c)%7,T+="<th scope='col'"+((E+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[L]+"'>"+p[L]+"</span></th>";for(M+=T+"</tr></thead><tbody>",D=this._getDaysInMonth(ee,Z),ee===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,D)),N=(this._getFirstDayOfMonth(ee,Z)-c+7)%7,R=Math.ceil((N+D)/7),P=$&&this.maxRows>R?this.maxRows:R,this.maxRows=P,_=this._daylightSavingAdjust(new Date(ee,Z,1-N)),x=0;x<P;x++){for(M+="<tr>",k=u?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(_)+"</td>":"",E=0;E<7;E++)O=f?f.apply(e.input?e.input[0]:null,[_]):[!0,""],U=_.getMonth()!==Z,B=U&&!v||!O[0]||J&&_<J||X&&_>X,k+="<td class='"+((E+c+6)%7>=5?" ui-datepicker-week-end":"")+(U?" ui-datepicker-other-month":"")+(_.getTime()===I.getTime()&&Z===e.selectedMonth&&e._keyEvent||y.getTime()===_.getTime()&&y.getTime()===I.getTime()?" "+this._dayOverClass:"")+(B?" "+this._unselectableClass+" ui-state-disabled":"")+(U&&!b?"":" "+O[1]+(_.getTime()===Q.getTime()?" "+this._currentClass:"")+(_.getTime()===W.getTime()?" ui-datepicker-today":""))+"'"+(U&&!b||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(B?"":" data-handler='selectDay' data-event='click' data-month='"+_.getMonth()+"' data-year='"+_.getFullYear()+"'")+">"+(U&&!b?"&#xa0;":B?"<span class='ui-state-default'>"+_.getDate()+"</span>":"<a class='ui-state-default"+(_.getTime()===W.getTime()?" ui-state-highlight":"")+(_.getTime()===Q.getTime()?" ui-state-active":"")+(U?" ui-priority-secondary":"")+"' href='#'>"+_.getDate()+"</a>")+"</td>",_.setDate(_.getDate()+1),_=this._daylightSavingAdjust(_);M+=k+"</tr>"}Z++,Z>11&&(Z=0,ee++),M+="</tbody></table>"+($?"</div>"+(q[0]>0&&C===q[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),F+=M}A+=F}return A+=h,e._keyEvent=!1,A},_generateMonthYearHeader:function(e,t,s,i,o,n,r,a){var l,h,c,u,d,p,m,g,f=this._get(e,"changeMonth"),b=this._get(e,"changeYear"),v=this._get(e,"showMonthAfterYear"),y="<div class='ui-datepicker-title'>",A="";if(n||!f)A+="<span class='ui-datepicker-month'>"+r[t]+"</span>";else{
for(l=i&&i.getFullYear()===s,h=o&&o.getFullYear()===s,A+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;c<12;c++)(!l||c>=i.getMonth())&&(!h||c<=o.getMonth())&&(A+="<option value='"+c+"'"+(c===t?" selected='selected'":"")+">"+a[c]+"</option>");A+="</select>"}if(v||(y+=A+(!n&&f&&b?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",n||!b)y+="<span class='ui-datepicker-year'>"+s+"</span>";else{for(u=this._get(e,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?s+parseInt(e.substring(1),10):e.match(/[+\-].*/)?d+parseInt(e,10):parseInt(e,10);return isNaN(t)?d:t},m=p(u[0]),g=Math.max(m,p(u[1]||"")),m=i?Math.max(m,i.getFullYear()):m,g=o?Math.min(g,o.getFullYear()):g,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m<=g;m++)e.yearshtml+="<option value='"+m+"'"+(m===s?" selected='selected'":"")+">"+m+"</option>";e.yearshtml+="</select>",y+=e.yearshtml,e.yearshtml=null}return y+=this._get(e,"yearSuffix"),v&&(y+=(!n&&f&&b?"":"&#xa0;")+A),y+="</div>"},_adjustInstDate:function(e,t,s){var i=e.selectedYear+("Y"===s?t:0),o=e.selectedMonth+("M"===s?t:0),n=Math.min(e.selectedDay,this._getDaysInMonth(i,o))+("D"===s?t:0),r=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(i,o,n)));e.selectedDay=r.getDate(),e.drawMonth=e.selectedMonth=r.getMonth(),e.drawYear=e.selectedYear=r.getFullYear(),"M"!==s&&"Y"!==s||this._notifyChange(e)},_restrictMinMax:function(e,t){var s=this._getMinMaxDate(e,"min"),i=this._getMinMaxDate(e,"max"),o=s&&t<s?s:t;return i&&o>i?i:o},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,s,i){var o=this._getNumberOfMonths(e),n=this._daylightSavingAdjust(new Date(s,i+(t<0?t:o[0]*o[1]),1));return t<0&&n.setDate(this._getDaysInMonth(n.getFullYear(),n.getMonth())),this._isInRange(e,n)},_isInRange:function(e,t){var s,i,o=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),r=null,a=null,l=this._get(e,"yearRange");return l&&(s=l.split(":"),i=(new Date).getFullYear(),r=parseInt(s[0],10),a=parseInt(s[1],10),s[0].match(/[+\-].*/)&&(r+=i),s[1].match(/[+\-].*/)&&(a+=i)),(!o||t.getTime()>=o.getTime())&&(!n||t.getTime()<=n.getTime())&&(!r||t.getFullYear()>=r)&&(!a||t.getFullYear()<=a)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,s,i){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var o=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(i,s,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),o,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).on("mousedown",e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var s=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(s)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(s)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(s))},e.datepicker=new s,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.12.1",e.datepicker})},379:function(e,t,s){"use strict";function i(){l.call(this,r.i18n("MAILWEBCLIENT/ACTION_SHOW_MAIL")),this.unseenCount=c.newMessagesCount,this.inactiveTitle=n.computed(function(){return r.i18n("MAILWEBCLIENT/HEADING_UNREAD_MESSAGES_BROWSER_TAB_PLURAL",{COUNT:this.unseenCount()},null,this.unseenCount())+" - "+h.getEmail()},this),this.accounts=a.ShowEmailAsTabName?h.collection:n.observableArray([]),a.ShowEmailAsTabName&&(this.linkText=n.computed(function(){var e=h.getEmail();return e.length>0?e:r.i18n("MAILWEBCLIENT/HEADING_BROWSER_TAB")})),this.mainHref=n.computed(function(){return this.isCurrent()?"javascript: void(0);":this.hash()},this)}var o=s(2),n=s(44),r=s(185),a=s(313),l=s(268),h=s(314),c=s(316);o.extendOwn(i.prototype,l.prototype),i.prototype.ViewTemplate="MailWebclient_HeaderItemView";var u=new i;u.allowChangeTitle(!0),e.exports=u}});